(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[5142,9216,6534],{36136:e=>{e.exports={"nav-button":"nav-button-znwuaSC1",link:"link-znwuaSC1",background:"background-znwuaSC1",icon:"icon-znwuaSC1","flip-icon":"flip-icon-znwuaSC1","size-large":"size-large-znwuaSC1","preserve-paddings":"preserve-paddings-znwuaSC1","size-medium":"size-medium-znwuaSC1","size-small":"size-small-znwuaSC1","size-xsmall":"size-xsmall-znwuaSC1","size-xxsmall":"size-xxsmall-znwuaSC1","visually-hidden":"visually-hidden-znwuaSC1"}},268976:e=>{e.exports={button:"button-D4RPB3ZC",content:"content-D4RPB3ZC",iconOnly:"iconOnly-D4RPB3ZC",link:"link-D4RPB3ZC",brand:"brand-D4RPB3ZC",primary:"primary-D4RPB3ZC",secondary:"secondary-D4RPB3ZC",gray:"gray-D4RPB3ZC",green:"green-D4RPB3ZC",red:"red-D4RPB3ZC",black:"black-D4RPB3ZC","black-friday":"black-friday-D4RPB3ZC","cyber-monday":"cyber-monday-D4RPB3ZC",xsmall:"xsmall-D4RPB3ZC",startIconWrap:"startIconWrap-D4RPB3ZC",endIconWrap:"endIconWrap-D4RPB3ZC",withStartIcon:"withStartIcon-D4RPB3ZC",withEndIcon:"withEndIcon-D4RPB3ZC",small:"small-D4RPB3ZC",medium:"medium-D4RPB3ZC",large:"large-D4RPB3ZC",xlarge:"xlarge-D4RPB3ZC",animated:"animated-D4RPB3ZC",stretch:"stretch-D4RPB3ZC",grouped:"grouped-D4RPB3ZC",adjustPosition:"adjustPosition-D4RPB3ZC",firstRow:"firstRow-D4RPB3ZC",firstCol:"firstCol-D4RPB3ZC","no-corner-top-left":"no-corner-top-left-D4RPB3ZC","no-corner-top-right":"no-corner-top-right-D4RPB3ZC","no-corner-bottom-right":"no-corner-bottom-right-D4RPB3ZC","no-corner-bottom-left":"no-corner-bottom-left-D4RPB3ZC",textWrap:"textWrap-D4RPB3ZC",multilineContent:"multilineContent-D4RPB3ZC",secondaryText:"secondaryText-D4RPB3ZC",primaryText:"primaryText-D4RPB3ZC"}},957723:e=>{e.exports={wrapper:"wrapper-GZajBGIm",input:"input-GZajBGIm",view:"view-GZajBGIm",danger:"danger-GZajBGIm"}},431542:e=>{e.exports={box:"box-ywH2tsV_",noOutline:"noOutline-ywH2tsV_",disabled:"disabled-ywH2tsV_","intent-danger":"intent-danger-ywH2tsV_",checked:"checked-ywH2tsV_",check:"check-ywH2tsV_",icon:"icon-ywH2tsV_",dot:"dot-ywH2tsV_",disableActiveStyles:"disableActiveStyles-ywH2tsV_"}},822306:e=>{e.exports={checkbox:"checkbox-vyj6oJxw",reverse:"reverse-vyj6oJxw",label:"label-vyj6oJxw",baseline:"baseline-vyj6oJxw"}},997180:e=>{e.exports={divider:"divider-pzdcWv_c","orientation-horizontal":"orientation-horizontal-pzdcWv_c","orientation-vertical":"orientation-vertical-pzdcWv_c","size-xsmall":"size-xsmall-pzdcWv_c","size-small":"size-small-pzdcWv_c","size-medium":"size-medium-pzdcWv_c","size-large":"size-large-pzdcWv_c","size-xlarge":"size-xlarge-pzdcWv_c","size-xxlarge":"size-xxlarge-pzdcWv_c","type-primary":"type-primary-pzdcWv_c","type-secondary":"type-secondary-pzdcWv_c"}},520121:e=>{e.exports={dialog:"dialog-aRAWUDhF",rounded:"rounded-aRAWUDhF",shadowed:"shadowed-aRAWUDhF",fullscreen:"fullscreen-aRAWUDhF",darker:"darker-aRAWUDhF",backdrop:"backdrop-aRAWUDhF"}},849844:e=>{e.exports={loader:"loader-UL6iwcBa",static:"static-UL6iwcBa",item:"item-UL6iwcBa","tv-button-loader":"tv-button-loader-UL6iwcBa",
medium:"medium-UL6iwcBa",small:"small-UL6iwcBa",black:"black-UL6iwcBa",white:"white-UL6iwcBa",gray:"gray-UL6iwcBa",primary:"primary-UL6iwcBa"}},197464:e=>{e.exports={"light-tab-button":"light-tab-button-_v4jz9BC",selected:"selected-_v4jz9BC",content:"content-_v4jz9BC","start-icon-wrap":"start-icon-wrap-_v4jz9BC",xsmall:"xsmall-_v4jz9BC",small:"small-_v4jz9BC",medium:"medium-_v4jz9BC"}},995283:e=>{e.exports={"light-tabs":"light-tabs-LqEaU5HP",medium:"medium-LqEaU5HP"}},960990:e=>{e.exports={separator:"separator-gVkHdN_4"}},137456:e=>{e.exports={header:"header-W5uTS8cc",wrapper:"wrapper-W5uTS8cc",statusLine:"statusLine-W5uTS8cc",informer:"informer-W5uTS8cc",text:"text-W5uTS8cc",button:"button-W5uTS8cc",settingsButton:"settingsButton-W5uTS8cc button-W5uTS8cc",settingsPopupMenu:"settingsPopupMenu-W5uTS8cc"}},586619:e=>{e.exports={delayedDataTitleColor:"var(--themed-color-delay-mode,#F57C00)",batsQuotesTitleColor:"var(--themed-color-notaccurate-mode,#D81B60)",icon:"icon-ljwP914Q",button:"button-ljwP914Q",wrapper:"wrapper-ljwP914Q",infoContainer:"infoContainer-ljwP914Q",title:"title-ljwP914Q",text:"text-ljwP914Q",actionButton:"actionButton-ljwP914Q",delayedDataIcon:"delayedDataIcon-ljwP914Q",batsQuotesIcon:"batsQuotesIcon-ljwP914Q"}},637079:e=>{e.exports={rootContainer:"rootContainer-LlInYWMC",hidden:"hidden-LlInYWMC","trading-panel-content":"trading-panel-content-LlInYWMC","trading-panel-spinner":"trading-panel-spinner-LlInYWMC","trading-panel-header":"trading-panel-header-LlInYWMC","trading-panel-tabs":"trading-panel-tabs-LlInYWMC","trading-panel-handle":"trading-panel-handle-LlInYWMC"}},253330:e=>{e.exports={"tablet-normal-breakpoint":"screen and (max-width: 768px)","small-height-breakpoint":"screen and (max-height: 360px)","tablet-small-breakpoint":"screen and (max-width: 430px)"}},808473:e=>{e.exports={dialog:"dialog-b8SxMnzX",wrapper:"wrapper-b8SxMnzX",separator:"separator-b8SxMnzX",bounded:"bounded-b8SxMnzX"}},780822:e=>{e.exports={"small-height-breakpoint":"screen and (max-height: 360px)",container:"container-BZKENkhT",unsetAlign:"unsetAlign-BZKENkhT",title:"title-BZKENkhT",subtitle:"subtitle-BZKENkhT",textWrap:"textWrap-BZKENkhT",ellipsis:"ellipsis-BZKENkhT",close:"close-BZKENkhT",icon:"icon-BZKENkhT"}},52036:e=>{e.exports={"tablet-normal-breakpoint":"screen and (max-width: 768px)","tooltip-offset":"20px",dialog:"dialog-qyCw0PaN",dragging:"dragging-qyCw0PaN",mobile:"mobile-qyCw0PaN",fullscreen:"fullscreen-qyCw0PaN",dialogAnimatedAppearance:"dialogAnimatedAppearance-qyCw0PaN",dialogAnimation:"dialogAnimation-qyCw0PaN",dialogTooltip:"dialogTooltip-qyCw0PaN"}},669658:e=>{e.exports={"default-drawer-min-top-distance":"100px",wrap:"wrap-_HnK0UIN",positionBottom:"positionBottom-_HnK0UIN",backdrop:"backdrop-_HnK0UIN",drawer:"drawer-_HnK0UIN",positionLeft:"positionLeft-_HnK0UIN"}},547625:e=>{e.exports={separator:"separator-Pf4rIzEt"}},58128:e=>{e.exports={checkbox:"checkbox-aOSYFxuH"}},808667:e=>{e.exports={icon:"icon-vDz9Zwc6",toolboxLabel:"toolboxLabel-vDz9Zwc6"}},862794:e=>{e.exports={icon:"icon-WB2y0EnP",
dropped:"dropped-WB2y0EnP"}},389986:(e,t,i)=>{"use strict";i.d(t,{CloseButton:()=>u});var r=i(50959),s=i(270762),o=i(117105),n=i(315130),a=i(238822),l=i(663346),c=i(534983);function d(e="large"){switch(e){case"large":return o;case"medium":default:return n;case"small":return a;case"xsmall":return l;case"xxsmall":return c}}const u=r.forwardRef(((e,t)=>r.createElement(s.NavButton,{...e,ref:t,icon:d(e.size)})))},270762:(e,t,i)=>{"use strict";i.d(t,{NavButton:()=>c});var r=i(50959),s=i(497754),o=i(72571),n=(i(15378),i(36136));function a(e){const{size:t="large",preservePaddings:i,isLink:r,flipIconOnRtl:o,className:a}=e;return s(n["nav-button"],n[`size-${t}`],i&&n["preserve-paddings"],o&&n["flip-icon"],r&&n.link,a)}function l(e){const{children:t,icon:i}=e;return r.createElement(r.Fragment,null,r.createElement("span",{className:n.background}),r.createElement(o.Icon,{icon:i,className:n.icon,"aria-hidden":!0}),t&&r.createElement("span",{className:n["visually-hidden"]},t))}const c=(0,r.forwardRef)(((e,t)=>{const{icon:i,type:s="button",preservePaddings:o,flipIconOnRtl:n,size:c,"aria-label":d,...u}=e;return r.createElement("button",{...u,className:a({...e,children:d}),ref:t,type:s},r.createElement(l,{icon:i},d))}));c.displayName="NavButton";var d=i(591365),u=i(273388);(0,r.forwardRef)(((e,t)=>{const{icon:i,renderComponent:s,"aria-label":o,...n}=e,c=null!=s?s:d.CustomComponentDefaultLink;return r.createElement(c,{...n,className:a({...e,children:o,isLink:!0}),reference:(0,u.isomorphicRef)(t)},r.createElement(l,{icon:i},o))})).displayName="NavAnchorButton"},171529:(e,t,i)=>{"use strict";i.d(t,{SquareButton:()=>_});var r=i(50959),s=i(497754),o=i(331774),n=i(72571),a=i(268976),l=i.n(a);const c="apply-overflow-tooltip apply-overflow-tooltip--check-children-recursively apply-overflow-tooltip--allow-text apply-common-tooltip";function d(e){const{color:t="brand",size:i="medium",variant:r="primary",stretch:n=!1,icon:a,startIcon:d,endIcon:u,iconOnly:h=!1,className:p,isGrouped:g,cellState:m,disablePositionAdjustment:_=!1,primaryText:b,secondaryText:v,isAnchor:y=!1}=e,f=function(e){let t="";return 0!==e&&(1&e&&(t=s(t,l()["no-corner-top-left"])),2&e&&(t=s(t,l()["no-corner-top-right"])),4&e&&(t=s(t,l()["no-corner-bottom-right"])),8&e&&(t=s(t,l()["no-corner-bottom-left"]))),t}((0,o.getGroupCellRemoveRoundBorders)(m));return s(p,l().button,l()[i],l()[t],l()[r],n&&l().stretch,(a||d)&&l().withStartIcon,u&&l().withEndIcon,h&&l().iconOnly,f,g&&l().grouped,g&&!_&&l().adjustPosition,g&&m.isTop&&l().firstRow,g&&m.isLeft&&l().firstCol,b&&v&&l().multilineContent,y&&l().link,c)}function u(e){const{startIcon:t,icon:i,iconOnly:o,children:a,endIcon:d,primaryText:u,secondaryText:h}=e,p=null!=t?t:i,g=!(t||i||d||o)&&!a&&u&&h;return r.createElement(r.Fragment,null,p&&r.createElement(n.Icon,{icon:p,className:l().startIconWrap}),a&&r.createElement("span",{className:l().content},a),d&&!o&&r.createElement(n.Icon,{icon:d,className:l().endIconWrap}),g&&function(e){return e.primaryText&&e.secondaryText&&r.createElement("div",{className:s(l().textWrap,c)
},r.createElement("span",{className:l().primaryText}," ",e.primaryText," "),"string"==typeof e.secondaryText?r.createElement("span",{className:l().secondaryText}," ",e.secondaryText," "):r.createElement("span",{className:l().secondaryText},r.createElement("span",null,e.secondaryText.firstLine),r.createElement("span",null,e.secondaryText.secondLine)))}(e))}var h=i(601198),p=i(380327),g=i(800417);function m(e){const{className:t,color:i,variant:r,size:s,stretch:o,animated:n,icon:a,iconOnly:l,startIcon:c,endIcon:d,primaryText:u,secondaryText:h,...p}=e;return{...p,...(0,g.filterDataProps)(e),...(0,g.filterAriaProps)(e)}}function _(e){const{reference:t,tooltipText:i,...s}=e,{isGrouped:o,cellState:n,disablePositionAdjustment:a}=(0,r.useContext)(p.ControlGroupContext),l=d({...s,isGrouped:o,cellState:n,disablePositionAdjustment:a});return r.createElement("button",{...m(s),className:l,ref:t,"data-overflow-tooltip-text":null!=i?i:e.primaryText?[e.primaryText,e.secondaryText].join(" "):(0,h.getTextForTooltip)(e.children)},r.createElement(u,{...s}))}i(15378)},408323:(e,t,i)=>{"use strict";i.d(t,{CheckboxInput:()=>c});var r=i(50959),s=i(497754),o=i(800417),n=i(611031),a=i(957723),l=i.n(a);function c(e){const t=s(l().wrapper,e.className);return r.createElement("span",{className:t,title:e.title,style:e.style},r.createElement("input",{id:e.id,tabIndex:e.tabIndex,className:s(e.intent&&l()[e.intent],l().input),type:"checkbox",name:e.name,checked:e.checked,disabled:e.disabled,value:e.value,autoFocus:e.autoFocus,role:e.role,onChange:function(){var t;null===(t=e.onChange)||void 0===t||t.call(e,e.value)},ref:e.reference,"aria-required":e["aria-required"],"aria-describedby":e["aria-describedby"],"aria-invalid":e["aria-invalid"],...(0,o.filterDataProps)(e)}),r.createElement(n.CheckboxView,{className:l().view,indeterminate:e.indeterminate,checked:e.checked,disabled:e.disabled,intent:e.intent,tabIndex:e.tabIndex}))}},611031:(e,t,i)=>{"use strict";i.d(t,{CheckboxView:()=>c});var r=i(50959),s=i(497754),o=i(72571),n=i(465890),a=i(431542),l=i.n(a);function c(e){const{indeterminate:t,checked:i,tabIndex:a,className:c,disabled:d,disableActiveStyles:u,intent:h,hideIcon:p,...g}=e,m=t||!i||p?"":n,_=s(l().box,l()[`intent-${h}`],!t&&l().check,!!t&&l().dot,-1===a&&l().noOutline,c,i&&l().checked,d&&l().disabled,u&&l().disableActiveStyles);return r.createElement("span",{className:_,...g},r.createElement(o.Icon,{icon:m,className:l().icon}))}},302946:(e,t,i)=>{"use strict";i.d(t,{Checkbox:()=>c});var r=i(50959),s=i(497754),o=i(230789),n=i(408323),a=i(822306),l=i.n(a);class c extends r.PureComponent{render(){const{inputClassName:e,labelClassName:t,...i}=this.props,o=s(this.props.className,l().checkbox,{[l().reverse]:Boolean(this.props.labelPositionReverse),[l().baseline]:Boolean(this.props.labelAlignBaseline)}),a=s(l().label,t,{[l().disabled]:this.props.disabled});let c=null;return this.props.label&&(c=r.createElement("span",{className:a,title:this.props.title},this.props.label)),r.createElement("label",{className:o},r.createElement(n.CheckboxInput,{...i,
className:e}),c)}}c.defaultProps={value:"on"};(0,o.makeSwitchGroupItem)(c);i(611031)},331774:(e,t,i)=>{"use strict";function r(e){let t=0;return e.isTop&&e.isLeft||(t+=1),e.isTop&&e.isRight||(t+=2),e.isBottom&&e.isLeft||(t+=8),e.isBottom&&e.isRight||(t+=4),t}i.d(t,{getGroupCellRemoveRoundBorders:()=>r})},80137:(e,t,i)=>{"use strict";i.d(t,{Dialog:()=>c});var r=i(50959),s=i(497754),o=i(682925),n=i(801808),a=i(800417),l=i(520121);class c extends r.PureComponent{constructor(){super(...arguments),this._manager=new n.OverlapManager,this._handleSlot=e=>{this._manager.setContainer(e)}}render(){const{rounded:e=!0,shadowed:t=!0,fullscreen:i=!1,darker:n=!1,className:c,backdrop:d,containerTabIndex:u=-1}=this.props,h=s(c,l.dialog,e&&l.rounded,t&&l.shadowed,i&&l.fullscreen,n&&l.darker),p=(0,a.filterDataProps)(this.props),g=this.props.style?{...this._createStyles(),...this.props.style}:this._createStyles();return r.createElement(r.Fragment,null,r.createElement(o.SlotContext.Provider,{value:this._manager},d&&r.createElement("div",{onClick:this.props.onClickBackdrop,className:l.backdrop}),r.createElement("div",{...p,className:h,style:g,ref:this.props.reference,onFocus:this.props.onFocus,onMouseDown:this.props.onMouseDown,onMouseUp:this.props.onMouseUp,onClick:this.props.onClick,onKeyDown:this.props.onKeyDown,tabIndex:u,"aria-label":this.props.containerAriaLabel},this.props.children)),r.createElement(o.Slot,{reference:this._handleSlot}))}_createStyles(){const{bottom:e,left:t,width:i,right:r,top:s,zIndex:o,height:n}=this.props;return{bottom:e,left:t,right:r,top:s,zIndex:o,maxWidth:i,height:n}}}},975228:(e,t,i)=>{"use strict";i.d(t,{hoverMouseEventFilter:()=>o,useAccurateHover:()=>n,useHover:()=>s});var r=i(50959);function s(){const[e,t]=(0,r.useState)(!1);return[e,{onMouseOver:function(e){o(e)&&t(!0)},onMouseOut:function(e){o(e)&&t(!1)}}]}function o(e){return!e.currentTarget.contains(e.relatedTarget)}function n(e){const[t,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const t=t=>{if(null===e.current)return;const r=e.current.contains(t.target);i(r)};return document.addEventListener("mouseover",t),()=>document.removeEventListener("mouseover",t)}),[]),t}},234404:(e,t,i)=>{"use strict";i.d(t,{Loader:()=>l});var r,s=i(50959),o=i(497754),n=i(849844),a=i.n(n);function l(e){const{className:t,size:i="medium",staticPosition:r,color:n="black"}=e,l=o(a().item,a()[n],a()[i]);return s.createElement("span",{className:o(a().loader,r&&a().static,t)},s.createElement("span",{className:l}),s.createElement("span",{className:l}),s.createElement("span",{className:l}))}!function(e){e.Medium="medium",e.Small="small"}(r||(r={}))},672511:(e,t,i)=>{"use strict";i.d(t,{Spinner:()=>n});var r=i(50959),s=i(497754),o=i(843442);i(907727);function n(e){const t=s(e.className,"tv-spinner","tv-spinner--shown",`tv-spinner--size_${o.spinnerSizeMap[e.size||o.DEFAULT_SIZE]}`);return r.createElement("div",{className:t,style:e.style,role:"progressbar"})}},230789:(e,t,i)=>{"use strict";i.d(t,{SwitchGroup:()=>n,makeSwitchGroupItem:()=>a});var r=i(50959),s=i(174786);const o=(0,
r.createContext)({getName:()=>"",getValues:()=>[],getOnChange:()=>s.default,subscribe:s.default,unsubscribe:s.default});class n extends r.PureComponent{constructor(e){super(e),this._subscriptions=new Set,this._getName=()=>this.props.name,this._getValues=()=>this.props.values,this._getOnChange=()=>this.props.onChange,this._subscribe=e=>{this._subscriptions.add(e)},this._unsubscribe=e=>{this._subscriptions.delete(e)},this.state={switchGroupContext:{getName:this._getName,getValues:this._getValues,getOnChange:this._getOnChange,subscribe:this._subscribe,unsubscribe:this._unsubscribe}}}render(){return r.createElement(o.Provider,{value:this.state.switchGroupContext},this.props.children)}componentDidUpdate(e){this._notify(this._getUpdates(this.props.values,e.values))}_notify(e){this._subscriptions.forEach((t=>t(e)))}_getUpdates(e,t){return[...t,...e].filter((i=>t.includes(i)?!e.includes(i):e.includes(i)))}}function a(e){var t;return t=class extends r.PureComponent{constructor(){super(...arguments),this._onChange=e=>{this.context.getOnChange()(e)},this._onUpdate=e=>{e.includes(this.props.value)&&this.forceUpdate()}}componentDidMount(){this.context.subscribe(this._onUpdate)}render(){return r.createElement(e,{...this.props,name:this._getName(),onChange:this._onChange,checked:this._isChecked()})}componentWillUnmount(){this.context.unsubscribe(this._onUpdate)}_getName(){return this.context.getName()}_isChecked(){return this.context.getValues().includes(this.props.value)}},t.contextType=o,t}},298563:(e,t,i)=>{"use strict";i.d(t,{useTabsMainHandlers:()=>p});var r=i(50959),s=i(269842),o=i(118965),n=i(586240),a=i(671129);var l=i(429510),c=i(984164),d=i(772069),u=i(525388),h=i(865968);function p(e,t,i){const{id:p,items:g,activationType:m,orientation:_,disabled:b,onActivate:v,isActive:y,overflowBehaviour:f,enableActiveStateStyles:k,tablistLabelId:P,tablistLabel:S}=t,C=(0,o.useMobileTouchState)(),w=function(e){const t=(0,a.useSafeMatchMedia)(n["media-mf-phone-landscape"],!0),i=(0,o.useMobileTouchState)();return null!=e?e:i||!t?"scroll":"collapse"}(f),B=(0,r.useRef)(!1),T=(0,r.useCallback)((e=>e.id),[]),E=null!=k?k:!C,{visibleItems:O,hiddenItems:D,containerRefCallback:I,innerContainerRefCallback:x,moreButtonRef:M,setItemRef:N}=(0,l.useCollapsible)(g,T,y),A="collapse"===w?O:g,L=(0,r.useMemo)((()=>"collapse"===w?D:[]),[w,D]),V=(0,r.useCallback)((e=>L.includes(e)),[L]),{isOpened:R,open:F,close:W,onButtonClick:q}=(0,d.useDisclosure)({id:p,disabled:b}),{tabsBindings:U,tablistBinding:z,scrollWrapBinding:$,onActivate:Q,onHighlight:H,isHighlighted:j}=(0,c.useTabs)({id:p,items:[...A,...L],activationType:m,orientation:_,disabled:b,tablistLabelId:P,tablistLabel:S,scrollIntoViewOptions:i.scrollIntoViewOptions,onActivate:v,isActive:y,isCollapsed:V,isRtl:i.isRtl,isDisclosureOpened:R}),G=L.find(j),K=(0,r.useCallback)((()=>{const e=g.find(y);e&&H(e)}),[H,y,g]),Z=(0,r.useCallback)((e=>U.find((t=>t.id===e.id))),[U]),J=(0,r.useCallback)((()=>{W(),K(),B.current=!0}),[W,K]),X=(0,r.useCallback)((()=>{G&&(Q(G),H(G,250))}),[Q,H,G]);$.ref=(0,
u.useMergedRefs)([$.ref,I]),z.ref=(0,u.useMergedRefs)([z.ref,x]),z.onKeyDown=(0,s.createSafeMulticastEventHandler)((0,h.useKeyboardEventHandler)([(0,h.useKeyboardClose)(R,J),(0,h.useKeyboardActionHandler)([13,32],X,(0,r.useCallback)((()=>Boolean(G)),[G]))]),z.onKeyDown);const Y=(0,r.useCallback)((e=>{B.current=!0,q(e)}),[B,q]),ee=(0,r.useCallback)((e=>{e&&Q(e)}),[Q]);return(0,r.useEffect)((()=>{B.current?B.current=!1:(G&&!R&&F(),!G&&R&&W())}),[G,R,F,W]),{enableActiveStateStyles:E,moreButtonRef:M,setItemRef:N,getBindings:Z,handleMoreButtonClick:Y,handleCollapsedItemClick:ee,scrollWrapBinding:$,overflowBehaviour:w,tablistBinding:z,visibleTabs:A,hiddenTabs:L,handleActivate:Q,isMobileTouch:C,getItemId:T,isDisclosureOpened:R,isHighlighted:j,closeDisclosure:W}}},738036:(e,t,i)=>{"use strict";i.d(t,{OutsideEvent:()=>s});var r=i(908783);function s(e){const{children:t,...i}=e;return t((0,r.useOutsideEvent)(i))}},763281:(e,t,i)=>{"use strict";i.d(t,{OrderTicketProvider:()=>u,SettingsContext:()=>a,WidgetContext:()=>l});var r=i(50959),s=i(661851),o=i(895318),n=i(363111);const a=r.createContext(o.defaultSettings),l=r.createContext({mode:n.OrderEditorDisplayMode.Panel,orderPanelStatus:n.OrderPanelStatus.Active});function c(e){const{children:t,settings$:i}=e,n=(0,s.useObservable)(i,o.defaultSettings);return r.createElement(a.Provider,{value:n},t)}function d(e){const{children:t,mode:i,orderPanelStatus$:o}=e,a=(0,s.useObservable)(o);return r.createElement(l.Provider,{value:{mode:i,orderPanelStatus:null!=a?a:n.OrderPanelStatus.Active}},t)}function u(e){const{children:t,settings$:i,mode:s,orderPanelStatus$:o}=e;return r.createElement(d,{mode:s,orderPanelStatus$:o},r.createElement(c,{settings$:i},t))}},363111:(e,t,i)=>{"use strict";i.d(t,{BracketDefaultPips:()=>l,BracketSubControlType:()=>d,CalculatorDecKeyCodes:()=>p,CalculatorIncKeyCodes:()=>g,OrderEditorDisplayMode:()=>o,OrderPanelStatus:()=>r,OrderPlacingStatus:()=>s,PriceSubControlType:()=>h,QuantitySubControlType:()=>u,orderTypes:()=>b});var r,s,o,n,a,l,c,d,u,h,p,g,m,_=i(609838);!function(e){e[e.Wait=0]="Wait",e[e.Active=1]="Active",e[e.Editing=2]="Editing",e[e.Preview=3]="Preview"}(r||(r={})),function(e){e[e.Creating=0]="Creating",e[e.Placed=1]="Placed"}(s||(s={})),function(e){e.Popup="popup",e.Panel="panel",e.ResizableDrawer="resizabledrawer"}(o||(o={})),function(e){e[e.AbsolutePrice=0]="AbsolutePrice",e[e.RelativePrice=1]="RelativePrice"}(n||(n={})),function(e){e[e.Quantity=0]="Quantity",e[e.RiskInCurrency=1]="RiskInCurrency",e[e.RiskInPercent=2]="RiskInPercent",e[e.BaseCurrencyQuantity=3]="BaseCurrencyQuantity",e[e.QuoteCurrencyQuantity=4]="QuoteCurrencyQuantity",e[e.OrderSizeCalculator=5]="OrderSizeCalculator"}(a||(a={})),function(e){e[e.TakeProfit=75]="TakeProfit",e[e.StopLoss=25]="StopLoss"}(l||(l={})),function(e){e[e.Pips=0]="Pips",e[e.Price=1]="Price",e[e.RiskInCurrency=2]="RiskInCurrency",e[e.RiskInPercent=3]="RiskInPercent"}(c||(c={})),function(e){e.Price="Price",e.Pips="Pips",e.Money="Money",e.Percent="Percent"}(d||(d={})),function(e){e.Units="Units",
e.RiskInCurrency="RiskInCurrency",e.RiskInPercent="RiskInPercent",e.BaseCurrency="BaseCurrency",e.QuoteCurrency="QuoteCurrency"}(u||(u={})),function(e){e.Absolute="Absolute",e.Relative="Relative"}(h||(h={})),function(e){e[e.Minus=189]="Minus",e[e.NumMinus=109]="NumMinus",e[e.FirefoxMinus=173]="FirefoxMinus"}(p||(p={})),function(e){e[e.Plus=187]="Plus",e[e.NumPlus=107]="NumPlus",e[e.FirefoxPlus=61]="FirefoxPlus"}(g||(g={})),function(e){e[e.SideBuy=0]="SideBuy",e[e.SideSell=1]="SideSell"}(m||(m={}));const b={1:_.t(null,void 0,i(790258)),2:_.t(null,void 0,i(490138)),3:_.t(null,void 0,i(898251)),4:_.t(null,void 0,i(978369))}},895318:(e,t,i)=>{"use strict";i.d(t,{defaultCryptoBracketsSettings:()=>s,defaultSettings:()=>r});const r={showRelativePriceControl:!0,showCurrencyRiskInQty:!0,showPercentRiskInQty:!0,showBracketsInCurrency:!0,showBracketsInPercent:!0,showOrderPreview:!0,showCryptoBracketsInCurrency:!1,showCryptoBracketsInPercent:!1,enableQuantityInRisk:!0},s={showCryptoBracketsInCurrency:!1,showCryptoBracketsInPercent:!1}},600297:(e,t,i)=>{"use strict";i.d(t,{Button:()=>n,ButtonType:()=>r});var r,s=i(50959),o=i(171529);function n(e){const{value:t,buttonType:i,className:n,icon:a,onClick:l}=e;let c;switch(i){case r.PlusValue:case r.IncDec:c=t;break;case r.Clear:c="clear";break;case r.Default:c="default"}return s.createElement(o.SquareButton,{className:n,"data-value":c,"data-name":`qtyButtonCalculator-${c}`,onClick:()=>{l(t,i)},size:"xsmall",variant:"secondary",color:"gray",onMouseDown:e=>e.preventDefault()},a||t)}!function(e){e[e.PlusValue=0]="PlusValue",e[e.IncDec=1]="IncDec",e[e.Clear=2]="Clear",e[e.Default=3]="Default"}(r||(r={}))},651674:(e,t,i)=>{"use strict";i.d(t,{createReactRoot:()=>h});var r=i(50959),s=i(632227),o=i(904237);const n=(0,r.createContext)({isOnMobileAppPage:()=>!1,isRtl:!1,locale:{language:"en"}});var a=i(69111),l=i(431520),c=i(887859);const d={iOs:"old",android:"new",old:"old",new:"new",any:"any"};function u(e){const[t]=(0,r.useState)({isOnMobileAppPage:e=>(0,a.isOnMobileAppPage)(d[e]),isRtl:(0,l.isRtl)(),locale:(0,c.getLocale)()});return r.createElement(n.Provider,{value:t},e.children)}function h(e,t,i="legacy"){const n=r.createElement(u,null,e);if("modern"===i){const e=(0,o.createRoot)(t);return e.render(n),{render(t){e.render(r.createElement(u,null,t))},unmount(){e.unmount()}}}return s.render(n,t),{render(e){s.render(r.createElement(u,null,e),t)},unmount(){s.unmountComponentAtNode(t)}}}},70870:(e,t,i)=>{"use strict";i.d(t,{alertSounds:()=>h,enableAlertSoundsForMobile:()=>_,onStopped:()=>m,play:()=>p,stop:()=>g});var r=i(609838),s=i(69111),o=i(937778),n=i(240534);const a=i.p+"alarm_clock.ba219c712b5dce956b08.mp3",l=(0,o.getLogger)("Lib.Sound",{color:"#dea433"}),c="notification/notification",d=[{title:r.t(null,void 0,i(510526)),path:"alert/alarm_clock",soundForAlerts:!0,filePath:a}];const u={};function h(){return d.filter((e=>!!e.soundForAlerts))}function p(e=c,t){if((0,s.isOnMobileAppPage)("any"))return Promise.resolve();l.logNormal(`Sound play attempt for "${e}" duration-${t||0}s;`)
;return v(e).play(t)}function g(e,t=!1){if((0,s.isOnMobileAppPage)("any"))return;let i=[];e?i.push(v(e)):i=Object.values(u),i.forEach((e=>{e.stop(t)}))}function m(e,t){(0,s.isOnMobileAppPage)("any")||v(e).playing.subscribe((e=>{e||t()}),{once:!0})}function _(){b(h().map((e=>e.path)))}function b(e){if((0,s.isOnMobileAppPage)("any"))return;if(!e)return;if(!/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(window.navigator.userAgent))return;if(Array.isArray(e)||(e=[e]),0===(e=e.filter((e=>{const t=v(e);return!(!t||!t.el.load||t._mobilePreloadActive)&&(t._mobilePreloadActive=!0,!0)}))).length)return void l.logNormal("enableForMobile no sounds passed");const t=()=>{const r=[];Array.isArray(e)&&e.forEach((e=>{const t=v(e);t.el.load();const i=t.play().catch((e=>{if("AbortError"!==e.name)throw l.logError(`enableForMobile for "${t.el.src}" preload error: - ${e.message}`),e}));t.el.pause(),r.push(i)})),Promise.all(r).then((()=>{l.logNormal("enableForMobile sounds initialized")})),i.forEach((e=>{document.removeEventListener(e,t,!0)}))},i=["click","touchend","keydown"];i.forEach((e=>{document.addEventListener(e,t,!0)}))}const v=e=>{if(e in u)return u[e];l.logNormal(`requested sound  ${e} not cached, building a new audio element`);const t=d.find((t=>t.path===e));if(void 0===t)throw new Error(`Cannot find sound "${e}"`);const i=new Audio(t.filePath),r={el:i,playing:new n.WatchedValue(!1),play:(t=0)=>r.playing.value()?(l.logNormal("sound already playing"),Promise.reject("already playing")):(r.playing.setValue(!0),new Promise(((i,s)=>{let o=t>0;const n=()=>{const t=function(e){try{l.logNormal(`"${e.el.src}" triggering html5 play method, readyState - ${e.el.readyState}; muted - ${e.el.muted}; volume - ${e.el.volume}; currentTime - ${e.el.currentTime}`);let t=e.el.play();return t||(t=Promise.resolve()),t}catch(t){return l.logError(`play method for "${e.el.src}" catch error - ${t.message}`),Promise.reject(t)}}(r);t.catch((t=>{l.logNormal(`stop counting sound "${e}"; as playing due to an error: ${t.message}`),r.stop(),s(t)}))};r._onEnded=()=>{o?n():(r.stop(),i())},r.el.addEventListener("ended",r._onEnded),o&&setTimeout((()=>{l.logNormal(`"${e}" repeat timeout - ${t}s off`),o=!1}),1e3*t),n()}))),stop:(e=!1)=>{r.el.pause(),e&&(r.el.currentTime=0),r.playing.setValue(!1),r._onEnded&&r.el.removeEventListener("ended",r._onEnded)}};u[e]=r;return["canplaythrough","error"].forEach((t=>{i.addEventListener(t,(()=>{l.logNormal(`for sound "${e}", event - ${t} is fired`)}),!1)})),l.logNormal(`canPlayType - ${i.canPlayType("audio/mp3")}`),u[e]};b(d.filter((e=>!!e.common)).map((e=>e.path)))},650733:(e,t,i)=>{"use strict";i.d(t,{batsToRealtimeCrucialHtml:()=>S,batsToRealtimeHtml1:()=>f,batsToRealtimeHtml2WithExchange:()=>P,batsToRealtimeHtml2WithoutExchange:()=>k,delayHtml:()=>u,delayNoRealtimeHtml:()=>g,delayToRealtimeHtml:()=>p,delayTooltip:()=>o,delayWithoutMarketAgreement:()=>y,eodHtml:()=>m,eodTooltip:()=>n,exchangeByOriginalExchangeTooltip:()=>c,notAccurate1PerSecondTooltip:()=>a,notAccurateCboeTooltip:()=>l,
tFEXorMOEXorLSEorChixauHtml:()=>h,tickByTickHtml1:()=>b,tickByTickHtml1FullInfo:()=>_,tickByTickHtml2:()=>v,tvCalculatedPairHtml:()=>C,tvCalculatedPairTooltip:()=>d});var r=i(609838),s=i(662605);const o=r.t(null,void 0,i(543348)),n=r.t(null,void 0,i(705805)),a=r.t(null,void 0,i(991006)),l=r.t(null,void 0,i(58796)),c=r.t(null,void 0,i(655154)),d=r.t(null,void 0,i(944138)),u=(r.t(null,void 0,i(994972)),r.t(null,void 0,i(295246)),r.t(null,void 0,i(50035)),r.t(null,void 0,i(345321)),r.t(null,void 0,i(675119)),r.t(null,void 0,i(667607)),(0,s.htmlEscape)(r.t(null,void 0,i(889142)))),h=(0,s.htmlEscape)(r.t(null,void 0,i(651211))),p=(0,s.htmlEscape)(r.t(null,void 0,i(807281))),g=(0,s.htmlEscape)(r.t(null,void 0,i(920987))),m=(0,s.htmlEscape)(r.t(null,void 0,i(932925))),_=(0,s.htmlEscape)(r.t(null,void 0,i(138368))),b=(0,s.htmlEscape)(r.t(null,void 0,i(833039))),v=(0,s.htmlEscape)(r.t(null,void 0,i(23998))),y=(0,s.htmlEscape)(r.t(null,void 0,i(195400))),f=r.t(null,void 0,i(131539)),k=(r.t(null,{context:'Part of: "Real-time data for {symbolName} is provided by {exchange} exchange."'},i(348473)),r.t(null,{context:'Part of: "Real-time data for {symbolName} is provided by {exchange} exchange."'},i(684455)),r.t(null,void 0,i(624669))),P=r.t(null,void 0,i(352668)),S=r.t(null,void 0,i(344492)),C=(r.t(null,void 0,i(840225)),r.t(null,void 0,i(578162)),r.t(null,void 0,i(154316)),r.t(null,void 0,i(28632)),r.t(null,void 0,i(925608)),r.t(null,void 0,i(733161)),r.t(null,void 0,i(254480)),r.t(null,void 0,i(944138)),r.t(null,void 0,i(90589)))},190787:(e,t,i)=>{"use strict";function r(e,t){null===e.firstChild?e.textContent=t:e.firstChild.nodeValue=t}i.d(t,{updateTextNode:()=>r})},887859:(e,t,i)=>{"use strict";i.d(t,{getLocale:()=>n,getLocaleIso:()=>a});var r=i(650151)
;const s=JSON.parse('{"ar_AE":{"language":"ar","language_name":"العربية","flag":"sa","geoip_code":"sa","countries_with_this_language":["ae","bh","dj","dz","eg","er","iq","jo","km","kw","lb","ly","ma","mr","om","qa","sa","sd","so","sy","td","tn","ye"],"priority":500,"dir":"rtl","iso":"ar","iso_639_3":"arb","show_on_widgets":true,"global_name":"Arabic"},"br":{"language":"pt","language_name":"Português","flag":"br","geoip_code":"br","priority":650,"iso":"pt","iso_639_3":"por","show_on_widgets":true,"global_name":"Portuguese"},"ca_ES":{"language":"ca_ES","language_name":"Català","flag":"es","geoip_code":"es","priority":745,"iso":"ca","iso_639_3":"cat","disabled":true,"show_on_widgets":true,"global_name":"Catalan"},"cs":{"language":"cs","language_name":"Czech","flag":"cz","geoip_code":"cz","priority":718,"iso":"cs","iso_639_3":"ces","show_on_widgets":true,"global_name":"Czech","is_in_european_union":true,"isBattle":true},"de_DE":{"language":"de","language_name":"Deutsch","flag":"de","geoip_code":"de","countries_with_this_language":["at","ch"],"priority":756,"iso":"de","iso_639_3":"deu","show_on_widgets":true,"global_name":"German","is_in_european_union":true},"en":{"language":"en","language_name":"English","flag":"us","geoip_code":"us","priority":1000,"iso":"en","iso_639_3":"eng","show_on_widgets":true,"global_name":"English","is_only_recommended_tw_autorepost":true},"es":{"language":"es","language_name":"Español","flag":"es","geoip_code":"es","countries_with_this_language":["mx","ar","ve","cl","co","pe","uy","py","cr","gt","c","bo","pa","pr"],"priority":744,"iso":"es","iso_639_3":"spa","show_on_widgets":true,"global_name":"Spanish","is_in_european_union":true},"fa_IR":{"language":"fa","language_name":"فارسى","flag":"ir","geoip_code":"ir","priority":480,"dir":"rtl","iso":"fa","iso_639_3":"fas","show_on_widgets":false,"global_name":"Iranian","disabled":true},"fr":{"language":"fr","language_name":"Français","flag":"fr","geoip_code":"fr","priority":750,"iso":"fr","iso_639_3":"fra","show_on_widgets":true,"global_name":"French","is_in_european_union":true},"he_IL":{"language":"he_IL","language_name":"עברית","flag":"il","geoip_code":"il","priority":490,"dir":"rtl","iso":"he","iso_639_3":"heb","show_on_widgets":true,"global_name":"Israeli"},"hu_HU":{"language":"hu_HU","language_name":"Magyar","flag":"hu","geoip_code":"hu","priority":724,"iso":"hu","iso_639_3":"hun","show_on_widgets":true,"global_name":"Hungarian","is_in_european_union":true,"disabled":true},"id":{"language":"id_ID","language_name":"Bahasa Indonesia","flag":"id","geoip_code":"id","priority":648,"iso":"id","iso_639_3":"ind","show_on_widgets":true,"global_name":"Indonesian"},"in":{"language":"en","language_name":"English ‎(India)‎","flag":"in","geoip_code":"in","priority":800,"iso":"en","iso_639_3":"eng","show_on_widgets":true,"global_name":"Indian"},"it":{"language":"it","language_name":"Italiano","flag":"it","geoip_code":"it","priority":737,"iso":"it","iso_639_3":"ita","show_on_widgets":true,"global_name":"Italian","is_in_european_union":true},"ja":{"language":"ja","language_name":"日本語","flag":"jp","geoip_code":"jp","priority":600,"iso":"ja","iso_639_3":"jpn","show_on_widgets":true,"global_name":"Japanese"},"kr":{"language":"ko","language_name":"한국어","flag":"kr","geoip_code":"kr","priority":550,"iso":"ko","iso_639_3":"kor","show_on_widgets":true,"global_name":"Korean"},"ms_MY":{"language":"ms_MY","language_name":"Bahasa Melayu","flag":"my","geoip_code":"my","priority":647,"iso":"ms","iso_639_3":"zlm","show_on_widgets":true,"global_name":"Malaysian"},"pl":{"language":"pl","language_name":"Polski","flag":"pl","geoip_code":"pl","priority":725,"iso":"pl","iso_639_3":"pol","show_on_widgets":true,"global_name":"Polish","is_in_european_union":true},"ru":{"language":"ru","language_name":"Русский","flag":"ru","geoip_code":"ru","countries_with_this_language":["am","by","kg","kz","md","tj","tm","uz"],"priority":700,"iso":"ru","iso_639_3":"rus","show_on_widgets":true,"global_name":"Russian","is_only_recommended_tw_autorepost":true},"sv_SE":{"language":"sv","language_name":"Svenska","flag":"se","geoip_code":"se","priority":723,"iso":"sv","iso_639_3":"swe","show_on_widgets":true,"global_name":"Swedish","is_in_european_union":true},"th_TH":{"language":"th","language_name":"ภาษาไทย","flag":"th","geoip_code":"th","priority":646,"iso":"th","iso_639_3":"tha","show_on_widgets":true,"global_name":"Thai"},"tr":{"language":"tr","language_name":"Türkçe","flag":"tr","geoip_code":"tr","priority":713,"iso":"tr","iso_639_3":"tur","show_on_widgets":true,"global_name":"Turkish","is_only_recommended_tw_autorepost":true},"vi_VN":{"language":"vi","language_name":"Tiếng Việt","flag":"vn","geoip_code":"vn","priority":645,"iso":"vi","iso_639_3":"vie","show_on_widgets":true,"global_name":"Vietnamese"},"zh_CN":{"language":"zh","language_name":"简体中文","flag":"cn","geoip_code":"cn","countries_with_this_language":["zh"],"priority":537,"iso":"zh-Hans","iso_639_3":"cmn","show_on_widgets":true,"global_name":"Chinese"},"zh_TW":{"language":"zh_TW","language_name":"繁體中文","flag":"tw","geoip_code":"tw","countries_with_this_language":["hk"],"priority":536,"iso":"zh-Hant","iso_639_3":"cmn","show_on_widgets":true,"global_name":"Taiwanese"},"el":{"language":"el","language_name":"Greek","flag":"gr","geoip_code":"gr","priority":625,"iso":"el","iso_639_3":"ell","global_name":"Greek","is_in_european_union":true,"isBattle":true},"nl_NL":{"language":"nl_NL","language_name":"Dutch","flag":"nl","geoip_code":"nl","priority":731,"iso":"nl","iso_639_3":"nld","global_name":"Dutch","is_in_european_union":true,"isBattle":true},"ro":{"language":"ro","language_name":"Romanian","flag":"ro","geoip_code":"ro","priority":707,"iso":"ro","iso_639_3":"ron","global_name":"Romanian","is_in_european_union":true,"isBattle":true}}'),o=function(){
const e=document.querySelectorAll("link[rel~=link-locale][data-locale]");if(0===e.length)return s;const t={};return e.forEach((e=>{const i=(0,r.ensureNotNull)(e.getAttribute("data-locale"));t[i]={...s[i],href:e.href}})),t}();function n(e){return e=e||window.locale,o[e]}function a(e){var t;return e=e||window.locale,null===(t=o[e])||void 0===t?void 0:t.iso}},996038:(e,t,i)=>{"use strict";i.d(t,{DialogBreakpoints:()=>s});var r=i(253330);const s={SmallHeight:r["small-height-breakpoint"],TabletSmall:r["tablet-small-breakpoint"],TabletNormal:r["tablet-normal-breakpoint"]}},533408:(e,t,i)=>{"use strict";i.d(t,{AdaptivePopupDialog:()=>E});var r=i(50959),s=i(650151),o=i(497754),n=i.n(o),a=i(180185),l=i(431520),c=i(698043),d=i(59216),u=i(494707),h=i(996038),p=i(930052),g=i(910549);var m=i(206594),_=i(559410),b=i(609838),v=i(389986),y=i(190410),f=i(780822);function k(e){const{title:t,titleTextWrap:s=!1,subtitle:o,showCloseIcon:a=!0,onClose:l,onCloseButtonKeyDown:c,renderBefore:d,renderAfter:u,draggable:h,className:p,unsetAlign:g,closeAriaLabel:m=b.t(null,void 0,i(47742)),closeButtonReference:_}=e,[k,P]=(0,r.useState)(!1);return r.createElement(y.DialogHeaderContext.Provider,{value:{setHideClose:P}},r.createElement("div",{className:n()(f.container,p,(o||g)&&f.unsetAlign)},d,r.createElement("div",{"data-dragg-area":h,className:f.title},r.createElement("div",{className:n()(s?f.textWrap:f.ellipsis)},t),o&&r.createElement("div",{className:n()(f.ellipsis,f.subtitle)},o)),u,a&&!k&&r.createElement(v.CloseButton,{className:f.close,"data-name":"close","aria-label":m,onClick:l,onKeyDown:c,ref:_,size:"medium",preservePaddings:!0})))}var P=i(273388),S=i(800417),C=i(440891),w=i(808473);const B={vertical:20},T={vertical:0};class E extends r.PureComponent{constructor(){super(...arguments),this._controller=null,this._reference=null,this._orientationMediaQuery=null,this._embedResizerOverridesEnabled=C.enabled("embed_resizer_overrides"),this._renderChildren=(e,t)=>(this._controller=e,this.props.render({requestResize:this._requestResize,centerAndFit:this._centerAndFit,isSmallWidth:t})),this._handleReference=e=>this._reference=e,this._handleCloseBtnClick=()=>{this.props.onKeyboardClose&&this.props.onKeyboardClose(),this._handleClose()},this._handleClose=()=>{this.props.onClose()},this._handleOpen=()=>{void 0!==this.props.onOpen&&this.props.isOpened&&this.props.onOpen(this.props.fullScreen||window.matchMedia(h.DialogBreakpoints.TabletSmall).matches)},this._handleKeyDown=e=>{if(!e.defaultPrevented){if(this.props.onKeyDown&&this.props.onKeyDown(e),27===(0,a.hashFromEvent)(e)){if(e.defaultPrevented)return;if(this.props.forceCloseOnEsc&&this.props.forceCloseOnEsc())return this.props.onKeyboardClose&&this.props.onKeyboardClose(),void this._handleClose();const{activeElement:i}=document;if(null!==i){if(e.preventDefault(),"true"===(t=i).getAttribute("data-haspopup")&&"true"!==t.getAttribute("data-expanded"))return void this._handleClose();const r=this._reference;if(null!==r&&(0,c.isTextEditingField)(i))return void r.focus()
;if(null==r?void 0:r.contains(i))return this.props.onKeyboardClose&&this.props.onKeyboardClose(),void this._handleClose()}}var t,i;(function(e){if("function"==typeof e)return e();return Boolean(e)})(this.props.disableTabNavigationContainment)||(i=e,[9,a.Modifiers.Shift+9].includes((0,a.hashFromEvent)(i))&&i.stopPropagation())}},this._requestResize=()=>{null!==this._controller&&this._controller.recalculateBounds()},this._centerAndFit=()=>{null!==this._controller&&this._controller.centerAndFit()},this._calculatePositionWithOffsets=(e,t)=>{const i=(0,s.ensureDefined)(this.props.fullScreenViewOffsets).value();return{top:i.top,left:(0,l.isRtl)()?-i.right:i.left,width:t.clientWidth-i.left-i.right,height:t.clientHeight-i.top-i.bottom}}}componentDidMount(){this.props.ignoreClosePopupsAndDialog||_.subscribe(m.CLOSE_POPUPS_AND_DIALOGS_COMMAND,this._handleClose,null),this._handleOpen(),void 0!==this.props.onOpen&&(this._orientationMediaQuery=window.matchMedia("(orientation: portrait)"),this._orientationMediaQuery.addEventListener("change",this._handleOpen)),this.props.fullScreenViewOffsets&&this.props.fullScreen&&this.props.fullScreenViewOffsets.subscribe(this._requestResize)}componentWillUnmount(){this.props.ignoreClosePopupsAndDialog||_.unsubscribe(m.CLOSE_POPUPS_AND_DIALOGS_COMMAND,this._handleClose,null),null!==this._orientationMediaQuery&&this._orientationMediaQuery.removeEventListener("change",this._handleOpen),this.props.fullScreenViewOffsets&&this.props.fullScreen&&this.props.fullScreenViewOffsets.unsubscribe(this._requestResize)}focus(){(0,s.ensureNotNull)(this._reference).focus()}getElement(){return this._reference}contains(e){var t,i;return null!==(i=null===(t=this._reference)||void 0===t?void 0:t.contains(e))&&void 0!==i&&i}render(){const{className:e,wrapperClassName:t,headerClassName:i,isOpened:s,title:o,titleTextWrap:a,dataName:l,onClickOutside:c,additionalElementPos:m,additionalHeaderElement:_,backdrop:b,shouldForceFocus:v=!0,shouldReturnFocus:y,onForceFocus:f,showSeparator:C,subtitle:E,draggable:O=!0,fullScreen:D=!1,showCloseIcon:I=!0,rounded:x=!0,isAnimationEnabled:M,growPoint:N,dialogTooltip:A,unsetHeaderAlign:L,onDragStart:V,dataDialogName:R,closeAriaLabel:F,containerAriaLabel:W,reference:q,containerTabIndex:U,closeButtonReference:z,onCloseButtonKeyDown:$,shadowed:Q,fullScreenViewOffsets:H,fixedBody:j,onClick:G}=this.props,K="after"!==m?_:void 0,Z="after"===m?_:void 0,J="string"==typeof o?o:R||"",X=(0,S.filterDataProps)(this.props),Y=(0,P.mergeRefs)([this._handleReference,q]);return r.createElement(p.MatchMedia,{rule:h.DialogBreakpoints.SmallHeight},(m=>r.createElement(p.MatchMedia,{rule:h.DialogBreakpoints.TabletSmall},(h=>r.createElement(d.PopupDialog,{rounded:!(h||D)&&x,className:n()(w.dialog,D&&H&&w.bounded,e),isOpened:s,reference:Y,onKeyDown:this._handleKeyDown,onClickOutside:c,onClickBackdrop:c,fullscreen:h||D,guard:m?T:B,boundByScreen:h||D,shouldForceFocus:v,onForceFocus:f,shouldReturnFocus:y,backdrop:b,draggable:O,isAnimationEnabled:M,growPoint:N,name:this.props.dataName,dialogTooltip:A,onDragStart:V,
containerAriaLabel:W,containerTabIndex:U,calculateDialogPosition:D&&H?this._calculatePositionWithOffsets:void 0,shadowed:Q,fixedBody:j,onClick:G,...X},r.createElement("div",{className:n()(w.wrapper,t),"data-name":l,"data-dialog-name":J},void 0!==o&&r.createElement(k,{draggable:O&&!(h||D),onClose:this._handleCloseBtnClick,renderAfter:Z,renderBefore:K,subtitle:E,title:o,titleTextWrap:a,showCloseIcon:I,className:i,unsetAlign:L,closeAriaLabel:F,closeButtonReference:z,onCloseButtonKeyDown:$}),C&&r.createElement(u.Separator,{className:w.separator}),r.createElement(g.PopupContext.Consumer,null,(e=>this._renderChildren(e,h||D)))))))))}}},190410:(e,t,i)=>{"use strict";i.d(t,{DialogHeaderContext:()=>r});const r=i(50959).createContext({setHideClose:()=>{}})},910549:(e,t,i)=>{"use strict";i.d(t,{PopupContext:()=>r});const r=i(50959).createContext(null)},59216:(e,t,i)=>{"use strict";i.d(t,{PopupDialog:()=>D});var r,s=i(50959),o=i(497754),n=i(650151),a=i(80137),l=i(874485),c=i(738036),d=i(822960),u=i(442092);function h(e,t,i,r){return e+t>r&&(e=r-t),e<i&&(e=i),e}function p(e){return{x:(0,d.clamp)(e.x,20,document.documentElement.clientWidth-20),y:(0,d.clamp)(e.y,20,window.innerHeight-20)}}function g(e){return{x:e.clientX,y:e.clientY}}function m(e){return{x:e.touches[0].clientX,y:e.touches[0].clientY}}!function(e){e[e.MouseGuardZone=20]="MouseGuardZone"}(r||(r={}));class _{constructor(e,t,i={boundByScreen:!0}){this._drag=null,this._canBeTouchClick=!1,this._frame=null,this._onMouseDragStart=e=>{if(0!==e.button||this._isTargetNoDraggable(e))return;e.preventDefault(),document.addEventListener("mousemove",this._onMouseDragMove),document.addEventListener("mouseup",this._onMouseDragEnd);const t=p(g(e));this._dragStart(t)},this._onTouchDragStart=e=>{if(this._isTargetNoDraggable(e))return;this._canBeTouchClick=!0,e.preventDefault(),this._header.addEventListener("touchmove",this._onTouchDragMove,{passive:!1});const t=p(m(e));this._dragStart(t)},this._onMouseDragEnd=e=>{e.target instanceof Node&&this._header.contains(e.target)&&e.preventDefault(),document.removeEventListener("mousemove",this._onMouseDragMove),document.removeEventListener("mouseup",this._onMouseDragEnd),this._onDragStop()},this._onTouchDragEnd=e=>{this._header.removeEventListener("touchmove",this._onTouchDragMove),this._onDragStop(),this._canBeTouchClick&&(this._canBeTouchClick=!1,function(e){if(e instanceof SVGElement){const t=document.createEvent("SVGEvents");t.initEvent("click",!0,!0),e.dispatchEvent(t)}e instanceof HTMLElement&&e.click()}(e.target))},this._onMouseDragMove=e=>{const t=p(g(e));this._dragMove(t)},this._onTouchDragMove=e=>{this._canBeTouchClick=!1,e.preventDefault();const t=p(m(e));this._dragMove(t)},this._onDragStop=()=>{this._drag=null,this._header.classList.remove("dragging"),this._options.onDragEnd&&this._options.onDragEnd()},this._dialog=e,this._header=t,this._options=i,this._header.addEventListener("mousedown",this._onMouseDragStart),this._header.addEventListener("touchstart",this._onTouchDragStart),
this._header.addEventListener("touchend",this._onTouchDragEnd)}destroy(){null!==this._frame&&cancelAnimationFrame(this._frame),this._header.removeEventListener("mousedown",this._onMouseDragStart),document.removeEventListener("mouseup",this._onMouseDragEnd),this._header.removeEventListener("touchstart",this._onTouchDragStart),this._header.removeEventListener("touchend",this._onTouchDragEnd),document.removeEventListener("mouseleave",this._onMouseDragEnd)}updateOptions(e){this._options=e}_dragStart(e){const t=this._dialog.getBoundingClientRect();this._drag={startX:e.x,startY:e.y,finishX:e.x,finishY:e.y,dialogX:t.left,dialogY:t.top};const i=Math.round(t.left),r=Math.round(t.top);this._dialog.style.transform=`translate(${i}px, ${r}px)`,this._header.classList.add("dragging"),this._options.onDragStart&&this._options.onDragStart()}_dragMove(e){if(this._drag){if(this._drag.finishX=e.x,this._drag.finishY=e.y,null!==this._frame)return;this._frame=requestAnimationFrame((()=>{if(this._drag){const t=e.x-this._drag.startX,i=e.y-this._drag.startY;this._moveDialog(this._drag.dialogX+t,this._drag.dialogY+i)}this._frame=null}))}}_moveDialog(e,t){const i=this._dialog.getBoundingClientRect(),{boundByScreen:r}=this._options,s=h(e,i.width,r?0:-1/0,r?window.innerWidth:1/0),o=h(t,i.height,r?0:-1/0,r?window.innerHeight:1/0);this._dialog.style.transform=`translate(${Math.round(s)}px, ${Math.round(o)}px)`}_isTargetNoDraggable(e){return e.target instanceof Element&&null!==e.target.closest("[data-disable-drag]")}}const b={vertical:0};var v,y=i(813113),f=i(910549),k=i(285089),P=i(937778),S=i(924910);!function(e){e.Open="dialog-open",e.Close="dialog-close",e.FullscreenOn="dialog-fullscreen-on",e.FullscreenOff="dialog-fullscreen-off"}(v||(v={}));const C=(0,P.getLogger)("DialogEventDispatcher");class w{constructor(){this._openSessionId=null}dispatch(e){if("dialog-open"===e){if(null!==this._openSessionId)return void C.logError("Multiple calls to open dialog");this._openSessionId=(0,S.randomHash)()}null!==this._openSessionId?(window.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:{dialogSessionId:this._openSessionId}})),"dialog-close"===e&&(this._openSessionId=null)):C.logError("Empty open dialog session id")}}var B=i(69111),T=(i(440891),i(52036));T["tooltip-offset"];const E=class{constructor(e,t){this._frame=null,this._isFullscreen=!1,this._handleResize=()=>{null===this._frame&&(this._frame=requestAnimationFrame((()=>{this.recalculateBounds(),this._frame=null})))},this._dialog=e,this._guard=t.guard||b,this._calculateDialogPosition=t.calculateDialogPosition,this._initialHeight=e.style.height,window.addEventListener("resize",this._handleResize)}updateOptions(e){this._guard=e.guard||b,this._calculateDialogPosition=e.calculateDialogPosition}setFullscreen(e){this._isFullscreen!==e&&(this._isFullscreen=e,this.recalculateBounds())}centerAndFit(){const{x:e,y:t}=this.getDialogsTopLeftCoordinates(),i=this._calcAvailableHeight(),r=this._calcDialogHeight();if(i===r)if(this._calculateDialogPosition){
const{left:e,top:t}=this._calculateDialogPosition(this._dialog,document.documentElement,this._guard);this._dialog.style.transform=`translate(${Math.round(e)}px, ${Math.round(t)}px)`}else this._dialog.style.height=r+"px";this._dialog.style.top="0px",this._dialog.style.left="0px",this._dialog.style.transform=`translate(${e}px, ${t}px)`}getDialogsTopLeftCoordinates(){const{clientWidth:e,clientHeight:t}=this._getClientDimensions(),i=this._calcDialogHeight(),r=e/2-this._dialog.clientWidth/2,s=t/2-i/2+this._getTopOffset();return{x:Math.round(r),y:Math.round(s)}}recalculateBounds(){var e;const{clientWidth:t,clientHeight:i}=this._getClientDimensions(),{vertical:r}=this._guard,s=null===(e=this._calculateDialogPosition)||void 0===e?void 0:e.call(this,this._dialog,{clientWidth:t,clientHeight:i},{vertical:r});if(this._isFullscreen){if(this._dialog.style.top="0px",this._dialog.style.left="0px",this._dialog.style.width="100%",this._dialog.style.height="100%",this._dialog.style.transform="none",s){const{left:e,top:t,width:i,height:r}=s;this._dialog.style.transform=`translate(${Math.round(e)}px, ${Math.round(t)}px)`,i&&(this._dialog.style.width=`${i}px`,this._dialog.style.minWidth="unset"),r&&(this._dialog.style.height=`${r}px`,this._dialog.style.minHeight="unset")}}else if(s){const{left:e,top:t}=s;this._dialog.style.transform=`translate(${Math.round(e)}px, ${Math.round(t)}px)`}else{this._dialog.style.width="",this._dialog.style.height="";const e=this._dialog.getBoundingClientRect(),s=i-2*r,o=h(e.left,e.width,0,t),n=h(e.top,e.height,r,i);this._dialog.style.top="0px",this._dialog.style.left="0px",this._dialog.style.transform=`translate(${Math.round(o)}px, ${Math.round(n)}px)`,this._dialog.style.height=s<e.height?s+"px":this._initialHeight}}destroy(){window.removeEventListener("resize",this._handleResize),null!==this._frame&&(cancelAnimationFrame(this._frame),this._frame=null)}_getClientDimensions(){return{clientHeight:document.documentElement.clientHeight,clientWidth:document.documentElement.clientWidth}}_getTopOffset(){return 0}_calcDialogHeight(){const e=this._calcAvailableHeight();return e<this._dialog.clientHeight?e:this._dialog.clientHeight}_calcAvailableHeight(){return this._getClientDimensions().clientHeight-2*this._guard.vertical}};class O extends s.PureComponent{constructor(e){super(e),this._dialog=null,this._cleanUpFunctions=[],this._prevActiveElement=null,this._eventDispatcher=new w,this._handleDialogRef=e=>{const{reference:t}=this.props;this._dialog=e,"function"==typeof t&&t(e)},this._handleFocus=()=>{this._moveToTop()},this._handleMouseDown=e=>{this._moveToTop()},this._handleTouchStart=e=>{this._moveToTop()},this.state={canFitTooltip:!1},this._prevActiveElement=document.activeElement}render(){return s.createElement(f.PopupContext.Provider,{value:this},s.createElement(c.OutsideEvent,{mouseDown:!0,touchStart:!0,handler:this.props.onClickOutside},(e=>s.createElement("div",{ref:e,"data-outside-boundary-for":this.props.name,onFocus:this._handleFocus,onMouseDown:this._handleMouseDown,onTouchStart:this._handleTouchStart,
"data-dialog-name":this.props["data-dialog-name"]},s.createElement(a.Dialog,{style:this._applyAnimationCSSVariables(),...this.props,reference:this._handleDialogRef,className:o(T.dialog,(0,B.isOnMobileAppPage)("any")&&!this.props.noMobileAppShadows&&T.mobile,this.props.fullscreen&&T.fullscreen,this.props.className)},!1,this.props.children)))))}componentDidMount(){const{draggable:e,boundByScreen:t,onDragStart:i}=this.props,r=(0,n.ensureNotNull)(this._dialog);if(this._eventDispatcher.dispatch("dialog-open"),e){const e=r.querySelector("[data-dragg-area]");if(e&&e instanceof HTMLElement){const s=new _(r,e,{boundByScreen:Boolean(t),onDragStart:i});this._cleanUpFunctions.push((()=>s.destroy())),this._drag=s}}this.props.autofocus&&!r.contains(document.activeElement)&&r.focus(),(this._isFullScreen()||this.props.fixedBody)&&(0,k.setFixedBodyState)(!0);const{guard:s,calculateDialogPosition:o}=this.props;if(this.props.resizeHandler)this._resize=this.props.resizeHandler;else{const e=new E(r,{guard:s,calculateDialogPosition:o});this._cleanUpFunctions.push((()=>e.destroy())),this._resize=e}if(this._isFullScreen()&&this._eventDispatcher.dispatch("dialog-fullscreen-on"),this.props.isAnimationEnabled&&this.props.growPoint&&this._applyAppearanceAnimation(this.props.growPoint),this.props.centeredOnMount&&this._resize.centerAndFit(),this._resize.setFullscreen(this._isFullScreen()),this.props.shouldForceFocus){if(this.props.onForceFocus)return void this.props.onForceFocus(r);r.focus()}if(!r.contains(document.activeElement)){const e=function(e){const t=e.querySelector("[autofocus]:not([disabled])");if(t)return t;if(e.tabIndex>=0)return e;const i=(0,u.getActiveElementSelectors)(),r=Array.from(e.querySelectorAll(i)).filter((0,u.createScopedVisibleElementFilter)(e));let s=Number.NEGATIVE_INFINITY,o=null;for(let e=0;e<r.length;e++){const t=r[e],i=t.getAttribute("tabindex");if(null!==i){const e=parseInt(i,10);!isNaN(e)&&e>s&&(s=e,o=t)}}return o}(r);e instanceof HTMLElement&&e.focus()}}componentDidUpdate(e){const t=e.fullscreen;if(this._resize){const{guard:e,calculateDialogPosition:t}=this.props;this._resize.updateOptions({guard:e,calculateDialogPosition:t}),this._resize.setFullscreen(this._isFullScreen())}if(this._drag&&this._drag.updateOptions({boundByScreen:Boolean(this.props.boundByScreen),onDragStart:this.props.onDragStart}),e.fullscreen!==this.props.fullscreen){const e=this.props.fullscreen;e&&!t?this._eventDispatcher.dispatch("dialog-fullscreen-on"):!e&&t&&this._eventDispatcher.dispatch("dialog-fullscreen-off")}}componentWillUnmount(){var e;if(this.props.shouldReturnFocus&&this._prevActiveElement&&document.body.contains(this._prevActiveElement)&&(null===document.activeElement||document.activeElement===document.body||(null===(e=this._dialog)||void 0===e?void 0:e.contains(document.activeElement))))try{setTimeout((()=>{this._prevActiveElement.focus({preventScroll:!0})}))}catch(e){}for(const e of this._cleanUpFunctions)e();(this._isFullScreen()||this.props.fixedBody)&&(0,k.setFixedBodyState)(!1),
this._isFullScreen()&&this._eventDispatcher.dispatch("dialog-fullscreen-off"),this._eventDispatcher.dispatch("dialog-close")}focus(){this._dialog&&this._dialog.focus()}centerAndFit(){this._resize&&this._resize.centerAndFit()}recalculateBounds(){this._resize&&this._resize.recalculateBounds()}_moveToTop(){null!==this.context&&this.context.moveToTop()}_applyAnimationCSSVariables(){return{"--animationTranslateStartX":null,"--animationTranslateStartY":null,"--animationTranslateEndX":null,"--animationTranslateEndY":null}}_applyAppearanceAnimation(e){if(this._resize&&this._dialog){const{x:t,y:i}=e,{x:r,y:s}=this._resize.getDialogsTopLeftCoordinates();this._dialog.style.setProperty("--animationTranslateStartX",`${t}px`),this._dialog.style.setProperty("--animationTranslateStartY",`${i}px`),this._dialog.style.setProperty("--animationTranslateEndX",`${r}px`),this._dialog.style.setProperty("--animationTranslateEndY",`${s}px`),this._dialog.classList.add(T.dialogAnimatedAppearance)}}_handleTooltipFit(){0}_isFullScreen(){return Boolean(this.props.fullscreen)}}O.contextType=y.PortalContext,O.defaultProps={boundByScreen:!0,draggable:!0,centeredOnMount:!0,shouldReturnFocus:!0};const D=(0,l.makeOverlapable)(O,!0)},163694:(e,t,i)=>{"use strict";i.d(t,{DrawerContext:()=>n,DrawerManager:()=>o});var r=i(50959),s=i(285089);class o extends r.PureComponent{constructor(e){super(e),this._isBodyFixed=!1,this._addDrawer=e=>{this.setState((t=>({stack:[...t.stack,e]})))},this._removeDrawer=e=>{this.setState((t=>({stack:t.stack.filter((t=>t!==e))})))},this.state={stack:[]}}componentDidUpdate(e,t){!t.stack.length&&this.state.stack.length&&((0,s.setFixedBodyState)(!0),this._isBodyFixed=!0),t.stack.length&&!this.state.stack.length&&this._isBodyFixed&&((0,s.setFixedBodyState)(!1),this._isBodyFixed=!1)}componentWillUnmount(){this.state.stack.length&&this._isBodyFixed&&(0,s.setFixedBodyState)(!1)}render(){return r.createElement(n.Provider,{value:{addDrawer:this._addDrawer,removeDrawer:this._removeDrawer,currentDrawer:this.state.stack.length?this.state.stack[this.state.stack.length-1]:null}},this.props.children)}}const n=r.createContext(null)},759339:(e,t,i)=>{"use strict";i.d(t,{Drawer:()=>p});var r=i(50959),s=i(650151),o=i(497754),n=i(924910),a=i(813113),l=i(163694),c=i(28466),d=i(742554),u=i(669658);var h;function p(e){const{position:t="Bottom",onClose:i,children:d,reference:h,className:p,theme:m=u}=e,_=(0,s.ensureNotNull)((0,r.useContext)(l.DrawerContext)),[b]=(0,r.useState)((()=>(0,n.randomHash)())),v=(0,r.useRef)(null),y=(0,r.useContext)(c.CloseDelegateContext);return(0,r.useLayoutEffect)((()=>((0,s.ensureNotNull)(v.current).focus({preventScroll:!0}),y.subscribe(_,i),_.addDrawer(b),()=>{_.removeDrawer(b),y.unsubscribe(_,i)})),[]),r.createElement(a.Portal,null,r.createElement("div",{ref:h,className:o(u.wrap,u[`position${t}`])},b===_.currentDrawer&&r.createElement("div",{className:u.backdrop,onClick:i}),r.createElement(g,{className:o(m.drawer,u[`position${t}`],p),ref:v,"data-name":e["data-name"]},d)))}!function(e){e.Left="Left",e.Bottom="Bottom"
}(h||(h={}));const g=(0,r.forwardRef)(((e,t)=>{const{className:i,...s}=e;return r.createElement(d.TouchScrollContainer,{className:o(u.drawer,i),tabIndex:-1,ref:t,...s})}))},522224:(e,t,i)=>{"use strict";i.d(t,{hoverMouseEventFilter:()=>r.hoverMouseEventFilter,useAccurateHover:()=>r.useAccurateHover,useHover:()=>r.useHover});var r=i(975228)},661851:(e,t,i)=>{"use strict";i.d(t,{useObservable:()=>o,useObservableSubscription:()=>s});var r=i(50959);function s(e,t){(0,r.useEffect)((()=>{const i=e.subscribe(t);return()=>i.unsubscribe()}),[e,t])}function o(e,t){const i=(0,r.useCallback)(void 0!==t?()=>t:()=>{let t;return e.subscribe((e=>{t=e})).unsubscribe(),t},[t,e]),[o,n]=(0,r.useState)(i),a=(0,r.useCallback)((e=>n((()=>e))),[n]);return s(e,a),o}},494707:(e,t,i)=>{"use strict";i.d(t,{Separator:()=>n});var r=i(50959),s=i(497754),o=i(547625);function n(e){return r.createElement("div",{className:s(o.separator,e.className)})}},874485:(e,t,i)=>{"use strict";i.d(t,{makeOverlapable:()=>o});var r=i(50959),s=i(813113);function o(e,t){return class extends r.PureComponent{render(){const{isOpened:i,root:o}=this.props;if(!i)return null;const n=r.createElement(e,{...this.props,zIndex:150});return"parent"===o?n:r.createElement(s.Portal,{shouldTrapFocus:t},n)}}}},379266:(e,t,i)=>{"use strict";i.d(t,{PopupMenuItemToggle:()=>l});var r=i(50959),s=i(497754),o=i(192063),n=i(302946),a=i(58128);function l(e){const{isDisabled:t,hint:i,label:l,isChecked:c,checkboxClassName:d,labelClassName:u,indeterminate:h,isActive:p,checkboxTabIndex:g,checkboxReference:m,checkboxDataRole:_,...b}=e;return r.createElement(o.PopupMenuItem,{...b,isDisabled:t,shortcut:i,dontClosePopup:!0,labelRowClassName:u,label:r.createElement(n.Checkbox,{reference:m,disabled:t,label:l,checked:c,indeterminate:h,className:s(a.checkbox,d),tabIndex:g,"data-role":_})})}},730743:(e,t,i)=>{"use strict";i.d(t,{calcSubMenuPos:()=>s});var r=i(431520);function s(e,t,i={x:0,y:10}){if(t){const{left:i,right:s,top:o}=t.getBoundingClientRect(),n=document.documentElement.clientWidth,a={x:i-e,y:o},l={x:s,y:o};return(0,r.isRtl)()?i<=e?l:a:n-s>=e?l:a}return i}},132455:(e,t,i)=>{"use strict";i.d(t,{Spinner:()=>r.Spinner});var r=i(672511)},106056:(e,t,i)=>{"use strict";var r,s,o;i.d(t,{CloseTrigger:()=>r,ToastAnimationStage:()=>s,ToastPriority:()=>o}),function(e){e.Swipe="swipe",e.Click="click"}(r||(r={})),function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove",e[e.None=2]="None"}(s||(s={})),function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(o||(o={}))},515783:(e,t,i)=>{"use strict";i.d(t,{ToolWidgetCaret:()=>l});var r=i(50959),s=i(497754),o=i(72571),n=i(862794),a=i(100578);function l(e){const{dropped:t,className:i}=e;return r.createElement(o.Icon,{className:s(i,n.icon,{[n.dropped]:t}),icon:a})}},742554:(e,t,i)=>{"use strict";i.d(t,{TouchScrollContainer:()=>c});var r=i(50959),s=i(259142),o=i(650151),n=i(601227);const a=CSS.supports("overscroll-behavior","none");let l=0;const c=(0,r.forwardRef)(((e,t)=>{const{children:i,...o}=e,c=(0,r.useRef)(null);return(0,
r.useImperativeHandle)(t,(()=>c.current)),(0,r.useLayoutEffect)((()=>{if(n.CheckMobile.iOS())return l++,null!==c.current&&(a?1===l&&(document.body.style.overscrollBehavior="none"):(0,s.disableBodyScroll)(c.current,{allowTouchMove:d(c)})),()=>{l--,null!==c.current&&(a?0===l&&(document.body.style.overscrollBehavior=""):(0,s.enableBodyScroll)(c.current))}}),[]),r.createElement("div",{ref:c,...o},i)}));function d(e){return t=>{const i=(0,o.ensureNotNull)(e.current),r=document.activeElement;return!i.contains(t)||null!==r&&i.contains(r)&&r.contains(t)}}},638177:e=>{e.exports={button:"button-GwQQdU8S",hover:"hover-GwQQdU8S",clicked:"clicked-GwQQdU8S",isInteractive:"isInteractive-GwQQdU8S",accessible:"accessible-GwQQdU8S",isGrouped:"isGrouped-GwQQdU8S",isActive:"isActive-GwQQdU8S",isOpened:"isOpened-GwQQdU8S",isDisabled:"isDisabled-GwQQdU8S",text:"text-GwQQdU8S",icon:"icon-GwQQdU8S",endIcon:"endIcon-GwQQdU8S"}},852495:e=>{e.exports={button:"button-xNqEcuN2"}},194878:e=>{e.exports={button:"button-merBkM5y",hover:"hover-merBkM5y",clicked:"clicked-merBkM5y",accessible:"accessible-merBkM5y",arrow:"arrow-merBkM5y",arrowWrap:"arrowWrap-merBkM5y",isOpened:"isOpened-merBkM5y"}},976920:e=>{e.exports={blockHidden:"blockHidden-e6PF69Df","pane-button":"pane-button-e6PF69Df"}},634937:e=>{e.exports={toggle:"toggle-NYDT3E70",label:"label-NYDT3E70"}},844972:e=>{e.exports={dropdownButton:"dropdownButton-NgHNzdZC",bigIcon:"bigIcon-NgHNzdZC"}},527500:e=>{e.exports={toggleContentWrapper:"toggleContentWrapper-i9xADy_f",checkBoxWrapper:"checkBoxWrapper-i9xADy_f"}},806345:e=>{e.exports={"css-value-padding":"4px"}},891751:e=>{e.exports={"css-value-padding":"4px",container:"container-hw_3o_pb",informerWrapper:"informerWrapper-hw_3o_pb",notAvailableOnMobile:"notAvailableOnMobile-hw_3o_pb",column:"column-hw_3o_pb",touchMode:"touchMode-hw_3o_pb",buttonsWrapper:"buttonsWrapper-hw_3o_pb",button:"button-hw_3o_pb",sellButton:"sellButton-hw_3o_pb",buyButton:"buyButton-hw_3o_pb",brokerButton:"brokerButton-hw_3o_pb",highButtons:"highButtons-hw_3o_pb",withoutBg:"withoutBg-hw_3o_pb",lastCharSup:"lastCharSup-hw_3o_pb",spreadQtyWrapper:"spreadQtyWrapper-hw_3o_pb",spread:"spread-hw_3o_pb",withoutQty:"withoutQty-hw_3o_pb",qty:"qty-hw_3o_pb",loader:"loader-hw_3o_pb",circleLoader:"circleLoader-hw_3o_pb",loading:"loading-hw_3o_pb",buttonText:"buttonText-hw_3o_pb",brokerButtonIconWrap:"brokerButtonIconWrap-hw_3o_pb",brokerButtonDefault:"brokerButtonDefault-hw_3o_pb",buttons:"buttons-hw_3o_pb"}},33335:e=>{e.exports={mobile:"screen and (max-width: 567px)"}},264946:e=>{e.exports={tabs:"tabs-oqHzGqN1",divider:"divider-oqHzGqN1"}},641901:e=>{e.exports={popupWrapper:"popupWrapper-sxxSUmLh"}},820669:e=>{e.exports={"small-height-breakpoint":"screen and (max-height: 360px)",moreButton:"moreButton-LjodxXHh",header:"header-LjodxXHh",brokerSelectScreenWrapper:"brokerSelectScreenWrapper-LjodxXHh",mobile:"mobile-LjodxXHh"}},72693:e=>{e.exports={content:"content-iSoiahCU",contentInner:"contentInner-iSoiahCU"}},162458:(e,t,i)=>{"use strict";i.d(t,{HorizontalAttachEdge:()=>s,
HorizontalDropDirection:()=>n,VerticalAttachEdge:()=>r,VerticalDropDirection:()=>o,getPopupPositioner:()=>c});var r,s,o,n,a=i(650151);!function(e){e[e.Top=0]="Top",e[e.Bottom=1]="Bottom",e[e.AutoStrict=2]="AutoStrict"}(r||(r={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(s||(s={})),function(e){e[e.FromTopToBottom=0]="FromTopToBottom",e[e.FromBottomToTop=1]="FromBottomToTop"}(o||(o={})),function(e){e[e.FromLeftToRight=0]="FromLeftToRight",e[e.FromRightToLeft=1]="FromRightToLeft"}(n||(n={}));const l={verticalAttachEdge:r.Bottom,horizontalAttachEdge:s.Left,verticalDropDirection:o.FromTopToBottom,horizontalDropDirection:n.FromLeftToRight,verticalMargin:0,horizontalMargin:0,matchButtonAndListboxWidths:!1};function c(e,t){return i=>{var c,d;const{contentWidth:u,contentHeight:h,availableHeight:p}=i,g=(0,a.ensureNotNull)(e).getBoundingClientRect(),{horizontalAttachEdge:m=l.horizontalAttachEdge,horizontalDropDirection:_=l.horizontalDropDirection,horizontalMargin:b=l.horizontalMargin,verticalMargin:v=l.verticalMargin,matchButtonAndListboxWidths:y=l.matchButtonAndListboxWidths}=t;let f=null!==(c=t.verticalAttachEdge)&&void 0!==c?c:l.verticalAttachEdge,k=null!==(d=t.verticalDropDirection)&&void 0!==d?d:l.verticalDropDirection;f===r.AutoStrict&&(p<g.y+g.height+v+h?(f=r.Top,k=o.FromBottomToTop):(f=r.Bottom,k=o.FromTopToBottom));const P=f===r.Top?-1*v:v,S=m===s.Right?g.right:g.left,C=f===r.Top?g.top:g.bottom,w={x:S-(_===n.FromRightToLeft?u:0)+b,y:C-(k===o.FromBottomToTop?h:0)+P};return y&&(w.overrideWidth=g.width),w}}},155352:(e,t,i)=>{"use strict";i.d(t,{DEFAULT_TOOL_WIDGET_BUTTON_THEME:()=>a,ToolWidgetButton:()=>l});var r=i(50959),s=i(497754),o=i(72571),n=i(638177);const a=n,l=r.forwardRef(((e,t)=>{const{tag:i="div",icon:a,endIcon:l,isActive:c,isOpened:d,isDisabled:u,isGrouped:h,isHovered:p,isClicked:g,onClick:m,text:_,textBeforeIcon:b,title:v,theme:y=n,className:f,forceInteractive:k,inactive:P,"data-name":S,"data-tooltip":C,...w}=e,B=s(f,y.button,(v||C)&&"apply-common-tooltip",{[y.isActive]:c,[y.isOpened]:d,[y.isInteractive]:(k||Boolean(m))&&!u&&!P,[y.isDisabled]:Boolean(u||P),[y.isGrouped]:h,[y.hover]:p,[y.clicked]:g}),T=a&&("string"==typeof a?r.createElement(o.Icon,{className:y.icon,icon:a}):r.cloneElement(a,{className:s(y.icon,a.props.className)}));return"button"===i?r.createElement("button",{...w,ref:t,type:"button",className:s(B,y.accessible),disabled:u&&!P,onClick:m,title:v,"data-name":S,"data-tooltip":C},b&&_&&r.createElement("div",{className:s("js-button-text",y.text)},_),T,!b&&_&&r.createElement("div",{className:s("js-button-text",y.text)},_)):r.createElement("div",{...w,ref:t,"data-role":"button",className:B,onClick:u?void 0:m,title:v,"data-name":S,"data-tooltip":C},b&&_&&r.createElement("div",{className:s("js-button-text",y.text)},_),T,!b&&_&&r.createElement("div",{className:s("js-button-text",y.text)},_),l&&r.createElement(o.Icon,{icon:l,className:n.endIcon}))}))},511349:(e,t,i)=>{"use strict";i.d(t,{ToolWidgetIconButton:()=>a});var r=i(50959),s=i(497754),o=i(155352),n=i(852495)
;const a=r.forwardRef((function(e,t){const{className:i,id:a,...l}=e;return r.createElement(o.ToolWidgetButton,{id:a,"data-name":a,...l,ref:t,className:s(i,n.button)})}))},679458:(e,t,i)=>{"use strict";i.d(t,{DEFAULT_TOOL_WIDGET_MENU_THEME:()=>_,ToolWidgetMenu:()=>v});var r=i(50959),s=i(497754),o=i(930202),n=i(624216),a=i(515783),l=i(800417),c=i(163694),d=i(759339),u=i(162458),h=i(930052),p=i(440891),g=i(111706),m=i(194878);const _=m;var b;!function(e){e[e.Vertical=2]="Vertical",e[e.Horizontal=0]="Horizontal"}(b||(b={}));class v extends r.PureComponent{constructor(e){super(e),this._wrapperRef=null,this._controller=r.createRef(),this._onPopupCloseOnClick=e=>{"keyboard"===e.detail.clickType&&this.focus()},this._handleMenuFocus=e=>{var t,i;e.relatedTarget===this._wrapperRef&&this.setState((e=>({...e,isOpenedByButton:!0}))),null===(i=(t=this.props).onMenuFocus)||void 0===i||i.call(t,e)},this._handleWrapperRef=e=>{this._wrapperRef=e,this.props.reference&&this.props.reference(e)},this._handleOpen=()=>{var e,t,i;"div"!==this.props.tag&&(this.setState((e=>({...e,isOpenedByButton:!1}))),null===(t=null===(e=this.props.menuReference)||void 0===e?void 0:e.current)||void 0===t||t.addEventListener("popup-menu-close-event",this._onPopupCloseOnClick),null===(i=this._controller.current)||void 0===i||i.focus())},this._handleClick=e=>{(p.enabled("skip_event_target_check")||e.target instanceof Node)&&e.currentTarget.contains(e.target)&&(this._handleToggleDropdown(void 0,(0,g.isKeyboardClick)(e)),this.props.onClick&&this.props.onClick(e,!this.state.isOpened))},this._handleToggleDropdown=(e,t=!1)=>{const{onClose:i,onOpen:r}=this.props,{isOpened:s}=this.state,o="boolean"==typeof e?e:!s;this.setState({isOpened:o,shouldReturnFocus:!!o&&t}),o&&r&&r(),!o&&i&&i()},this._handleClose=()=>{this.close()},this._handleKeyDown=e=>{var t;const{orientation:i="horizontal"}=this.props;if(e.defaultPrevented)return;if(!(e.target instanceof Node))return;const r=(0,o.hashFromEvent)(e);if(e.currentTarget.contains(e.target))switch(r){case 40:if("div"===this.props.tag||"horizontal"!==i)return;if(this.state.isOpened)return;e.preventDefault(),this._handleToggleDropdown(!0,!0);break;case 27:if(!this.state.isOpened||!this.props.closeOnEsc)return;e.preventDefault(),e.stopPropagation(),this._handleToggleDropdown(!1)}else{if("div"===this.props.tag)return;switch(r){case 27:{e.preventDefault();const{shouldReturnFocus:i,isOpenedByButton:r}=this.state;this._handleToggleDropdown(!1),i&&r&&(null===(t=this._wrapperRef)||void 0===t||t.focus());break}}}},this.state={isOpened:!1,shouldReturnFocus:!1,isOpenedByButton:!1}}render(){const{tag:e="div",id:t,arrow:i,content:o,isDisabled:n,isDrawer:c,isShowTooltip:d,title:u,className:p,hotKey:g,theme:m,drawerBreakpoint:_,tabIndex:b,isClicked:v}=this.props,{isOpened:f}=this.state,k=s(p,m.button,{"apply-common-tooltip":d||!n,[m.isDisabled]:n,[m.isOpened]:f,[m.clicked]:v}),P=y(o)?o({isOpened:f}):o;return"button"===e?r.createElement("button",{type:"button",id:t,className:s(k,m.accessible),disabled:n,onClick:this._handleClick,title:u,
"data-tooltip-hotkey":g,ref:this._handleWrapperRef,onKeyDown:this._handleKeyDown,tabIndex:b,...(0,l.filterDataProps)(this.props),...(0,l.filterAriaProps)(this.props)},P,i&&r.createElement("div",{className:m.arrow},r.createElement("div",{className:m.arrowWrap},r.createElement(a.ToolWidgetCaret,{dropped:f}))),this.state.isOpened&&(_?r.createElement(h.MatchMedia,{rule:_},(e=>this._renderContent(e))):this._renderContent(c))):r.createElement("div",{id:t,className:k,onClick:n?void 0:this._handleClick,title:u,"data-tooltip-hotkey":g,ref:this._handleWrapperRef,"data-role":"button",tabIndex:b,onKeyDown:this._handleKeyDown,...(0,l.filterDataProps)(this.props)},P,i&&r.createElement("div",{className:m.arrow},r.createElement("div",{className:m.arrowWrap},r.createElement(a.ToolWidgetCaret,{dropped:f}))),this.state.isOpened&&this._renderContent(c))}close(){var e,t;null===(t=null===(e=this.props.menuReference)||void 0===e?void 0:e.current)||void 0===t||t.removeEventListener("popup-menu-close-event",this._onPopupCloseOnClick),this._handleToggleDropdown(!1)}focus(){var e;null===(e=this._wrapperRef)||void 0===e||e.focus()}update(){null!==this._controller.current&&this._controller.current.update()}_renderContent(e){const{menuDataName:t,minWidth:i,menuClassName:s,maxHeight:o,drawerPosition:a="Bottom",children:l}=this.props,{isOpened:h}=this.state,p={horizontalMargin:this.props.horizontalMargin||0,verticalMargin:this.props.verticalMargin||2,verticalAttachEdge:this.props.verticalAttachEdge,horizontalAttachEdge:this.props.horizontalAttachEdge,verticalDropDirection:this.props.verticalDropDirection,horizontalDropDirection:this.props.horizontalDropDirection,matchButtonAndListboxWidths:this.props.matchButtonAndListboxWidths},g=Boolean(h&&e&&a),m=y(l)?l({isDrawer:g}):l;return g?r.createElement(c.DrawerManager,null,r.createElement(d.Drawer,{reference:this.props.drawerReference,onClose:this._handleClose,position:a,"data-name":t},m)):r.createElement(n.PopupMenu,{reference:this.props.menuReference,controller:this._controller,closeOnClickOutside:this.props.closeOnClickOutside,doNotCloseOn:this,isOpened:h,minWidth:i,onClose:this._handleClose,position:(0,u.getPopupPositioner)(this._wrapperRef,p),className:s,maxHeight:o,"data-name":t,tabIndex:"div"!==this.props.tag?-1:void 0,onOpen:this._handleOpen,onKeyDown:this.props.onMenuKeyDown,onFocus:this._handleMenuFocus},m)}}function y(e){return"function"==typeof e}v.defaultProps={arrow:!0,closeOnClickOutside:!0,theme:m}},790606:(e,t,i)=>{"use strict";i.d(t,{reactLoaderRendererCreator:()=>n});var r=i(904237),s=i(50959),o=i(976920);function n(e,t){return(i,n)=>function(e,t,i,n){const a=document.createElement("span"),l=(0,r.createRoot)(a);function c(e){a.classList.toggle(o.blockHidden,!e)}c(!1);const{className:d}=null!=n?n:{};return d&&a.classList.add(d),l.render((0,s.createElement)(t,i)),e.appendChild(a),{toggleVisibility:c,destroy:function(){l.unmount()}}}(i,e,t,n)}},614588:(e,t,i)=>{"use strict";i.d(t,{createPointsLoaderRenderer:()=>s});var r=i(234404);const s=(0,
i(790606).reactLoaderRendererCreator)(r.Loader,{staticPosition:!0,size:"small"})},126373:(e,t,i)=>{"use strict";i.d(t,{trackingModeIsAvailable:()=>r});const r=i(601227).CheckMobile.any()},628640:(e,t,i)=>{"use strict";i.d(t,{TerminalDropdown:()=>A});var r=i(50959),s=i(609838),o=i(497754),n=i.n(o),a=i(601227),l=i(72571),c=i(679458),d=i(155352),u=i(192063),h=i(669874);const p=r.lazy((async()=>({default:(await Promise.all([i.e(1419),i.e(7528),i.e(6625),i.e(3930),i.e(7001),i.e(7811),i.e(412),i.e(55),i.e(8073),i.e(8065),i.e(6665),i.e(6955),i.e(5391),i.e(9216),i.e(2985)]).then(i.bind(i,224511))).ExportDataDialogImpl})));function g(e){return r.createElement(r.Suspense,{fallback:null},r.createElement(p,{...e}))}var m=i(661851),_=i(379266),b=i(624216),v=i(759339),y=i(924910),f=i(972535),k=i(823030),P=i(522224),S=i(730743);var C=i(930052),w=i(808667),B=i(379978);function T(e){return r.createElement(C.MatchMedia,{rule:"screen and (max-width: 430px)"},(t=>t||e.forceUseDrawer?r.createElement(O,{...e}):r.createElement(D,{...e})))}function E(e){const{toolboxLabel:t,...i}=e;return r.createElement(u.PopupMenuItem,{toolbox:r.createElement(r.Fragment,null,t&&r.createElement("span",{className:w.toolboxLabel},t),r.createElement(l.Icon,{className:w.icon,icon:B})),suppressToolboxClick:!1,dontClosePopup:!0,...i})}function O(e){const{children:t,className:i,drawerClassName:s,menuItemTheme:o,label:n,icon:a,labelClassName:l,toolboxLabel:c}=e,[d,u]=(0,r.useState)(!1);return r.createElement(r.Fragment,null,r.createElement(E,{theme:o,label:n,toolboxLabel:c,icon:a,labelClassName:l,className:i,onClick:function(){u(!d)}}),d&&r.createElement(v.Drawer,{className:s,position:"Bottom",onClose:function(){u(!1)}},t))}function D(e){const{children:t,className:i,menuClassName:s,menuItemTheme:o,label:n,icon:a,labelClassName:l,toolboxLabel:c}=e,d=(0,r.useRef)((0,y.randomHash)()),u=(0,r.useRef)(null),{isMenuOpened:h,onTriggerClick:p,onTriggerMouseOver:g,onMenuClose:m,getPosition:_,onMenuMouseOver:v}=function(e,t,i={}){const s=r.useContext(k.SubmenuContext);r.useEffect((()=>null==s?void 0:s.registerSubmenu(e,a)),[e]);const o=Boolean((null==s?void 0:s.current)===e);return{isMenuOpened:o,onTriggerClick:function(){(f.mobiletouch||i.forceOpenOnClick)&&(null==s||s.setCurrent(o?null:e))},onMenuClose:function(){null==s||s.setCurrent(null)},getPosition:function(e){return(0,S.calcSubMenuPos)(e.contentWidth,t.current)},onMenuMouseOver:n,onTriggerMouseOver:n};function n(t){!f.mobiletouch&&(0,P.hoverMouseEventFilter)(t)&&(null==s||s.setCurrent(e))}function a(e){var i;return Boolean(null===(i=t.current)||void 0===i?void 0:i.contains(e))}}(d.current,u);return r.createElement(r.Fragment,null,r.createElement(E,{theme:o,label:n,toolboxLabel:c,icon:a,labelClassName:l,className:i,onClick:p,onMouseOver:g,reference:u,isHovered:h}),r.createElement(b.PopupMenu,{className:s,position:_,onClose:m,isOpened:h,doNotCloseOn:u.current,onMouseOver:v},t))}var I=i(634937);function x(e){
const{labelClassName:t,summaryFieldsVisibilityInfo$:o,summaryFieldToggler:n,initialSummaryFieldsVisibilityInfo:l}=e,c=(0,m.useObservable)(o,l);return 0===c.size?r.createElement(r.Fragment,null):r.createElement(T,{label:s.t(null,void 0,i(370559)),labelClassName:t,forceUseDrawer:a.CheckMobile.any()},[...c.values()].map((e=>r.createElement(_.PopupMenuItemToggle,{key:e.id,className:I.toggle,label:r.createElement("span",{className:I.label},e.id),isChecked:e.visible,onClick:()=>n(e.id)}))))}var M=i(844972),N=i(48008);function A(e){const{dataExportController:t,initialSummaryFieldsVisibilityInfo:o,summaryFieldToggler:p,summaryFieldsVisibilityInfo$:m,iconSize:_}=e,[b,v]=function(e){const{dataExportController:t,trackEvent:i}=e,[s,o]=(0,r.useState)(!1);return void 0===t?[()=>{},null]:[()=>o(!0),r.createElement(g,{isOpened:s,onClose:()=>o(!1),trackEvent:i,dataExportController:t})]}({dataExportController:t});return r.createElement(r.Fragment,null,r.createElement(c.ToolWidgetMenu,{arrow:!1,isDrawer:a.CheckMobile.any(),className:M.dropdownButton,content:r.createElement(d.ToolWidgetButton,{title:s.t(null,void 0,i(437117)),icon:r.createElement(l.Icon,{className:n()("big"===_&&M.bigIcon),icon:N})}),"data-name":"terminal-dropdown"},r.createElement(x,{labelClassName:M.label,summaryFieldToggler:p,summaryFieldsVisibilityInfo$:m,initialSummaryFieldsVisibilityInfo:o}),null!==v&&r.createElement(u.PopupMenuItem,{labelClassName:M.label,label:(0,h.appendEllipsis)(s.t(null,void 0,i(778837))),onClick:b})),v)}},628370:(e,t,i)=>{"use strict";i.d(t,{makeAccountManagerHeaderDropdownsProps:()=>g});var r=i(275734),s=i(757604),o=i(650151),n=i(391431),a=i(480802),l=i(752275),c=i(937778),d=i(621575);const u=(0,c.getLogger)("Trading.DataExport");class h{constructor(e,t){this._prefix=t,this._getDataExporters=e}tabs(){return[...this._getDataExporters()].map((([e,t])=>({value:e,content:t.title})))}async exportData(e){const{exporters:t,title:i}=(0,o.ensureDefined)(this._getDataExporters().get(e),"data exporter");try{const e=await Promise.all(t.map((({exportData:e})=>e())));e.forEach(((r,s)=>{const o=t[s].name,n=void 0===o||""===o?`${(0,a.default)(i)}${e.length>1?`-${s+1}`:""}`:(0,a.default)(o);let c="";if(0!==r.length){const e=[p(Object.keys(r[0]))];for(const t of r)e.push(p(Object.values(t)));c=e.join("\n")}(0,l.saveTextFile)(`${(0,a.default)(this._prefix)}-${n}-${(new Date).toISOString()}.csv`,c,"text/csv")}))}catch(e){u.logError((0,d.getLoggerMessage)(e))}}}function p(e){return e.map((e=>"number"==typeof e?e:(0,l.escapeCSVValue)(e))).join(",")}async function g(e,t,i,a){const l=(await e.brokersMetainfo()).filter((e=>!e.configFlags.isSuspended)),c=Promise.resolve(void 0),d=(0,o.ensureNotNull)(e.activeBroker()),u=await c,p=await d.accountsMetainfo(),g=d.accountManagerInfo();if(0===p.length)return;const m=p.map((e=>{var t;return{id:e.id,name:e.name,currency:""===e.currency?void 0:null!==(t=e.currency)&&void 0!==t?t:void 0,isDefault:e.isDefault,label:e.label,labelLink:e.labelLink,labelTooltipText:e.labelTooltipText,selectAccount:async()=>{
e.id!==d.currentAccount()&&d.setCurrentAccount(e.id)}}})),_=e=>(0,o.ensureDefined)(m.find((t=>t.id===e))),b=(0,r.fromEventPattern)((e=>d.currentAccountUpdate.subscribe(null,e)),(e=>d.currentAccountUpdate.unsubscribe(null,e)),_).pipe((0,s.startWith)(_(d.currentAccount()))),v=d.metainfo(),y=void 0!==u?(0,n.brokersListFromPlans)(l,u):void 0,f=void 0!==y?{title:g.accountTitle,brokerName:v.title,brokerId:v.id,logo:v.logoMiniUrl,logoBlack:v.logoMiniBlackUrl,actions:d.buttonDropdownActions(),trading:e,brokers:y,mode:i,isBeta:v.isBeta,realtimeDataPermissionsConfig:v.realtimeDataPermissionsToggleConfig}:void 0,k={dataExportController:void 0!==a?new h(a,v.title):void 0,initialSummaryFieldsVisibilityInfo:t.fieldsVisibilityInfo(),summaryFieldsVisibilityInfo$:t.fieldsVisibilityInfo$,summaryFieldToggler:t.toggleField};return{brokerDropdownProps:f,accountDropdownProps:{currentAccount$:b,accountsList:m,removeMargins:void 0===f,trackEvent:e.trackEvent,showErrorNotification:e.showErrorNotification,mode:i,createAccount:d.config.supportCreateAccount?d.createAccount:void 0,deleteAccount:d.config.supportDeleteAccount?d.deleteAccount:void 0,resetAccount:d.config.supportResetAccount?d.resetAccount:void 0,changeAccountSettings:d.config.supportChangeAccountSettings?d.changeAccountSettings:void 0,accountSettingsInfo:d.config.supportCreateAccount||d.config.supportResetAccount||d.config.supportChangeAccountSettings?d.accountSettingsInfo:void 0,accountHintOptions:g.accountHintOptions},commonDropdownProps:k}}},332510:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SummaryFieldsVisibilityManager:()=>s});var r=i(947488);class s{constructor(e,t){var i;this.toggleField=e=>{var t;const i=this._fieldsVisibilityInfo$.getValue(),r=new Map(i),s=r.get(e);void 0!==s&&(s.visible=!s.visible,this._fieldsVisibilityInfo$.next(r),null===(t=this._settingsGetter())||void 0===t||t.setSummaryFieldsVisibilityInfo(r))},this._settingsGetter=t;const s=null===(i=this._settingsGetter())||void 0===i?void 0:i.summaryFieldsVisibilityInfo();this._fieldsVisibilityInfo$=new r.BehaviorSubject(new Map(e.map((({text:e,isDefault:t})=>{var i,r,o;return[e,{id:e,visible:null===(o=null!==(r=null===(i=null==s?void 0:s.get(e))||void 0===i?void 0:i.visible)&&void 0!==r?r:t)||void 0===o||o}]})))),this.fieldsVisibilityInfo$=this._fieldsVisibilityInfo$.asObservable()}fieldsVisibilityInfo(){return this._fieldsVisibilityInfo$.getValue()}}},80118:(e,t,i)=>{"use strict";i.d(t,{pipsToPrice:()=>a,pipsToRiskInCurrency:()=>l,pipsToRiskInPercent:()=>c,priceToPips:()=>s,riskInCurrencyToPips:()=>o,riskInPercentToPips:()=>n});var r=i(960521);function s(e,t,i,s){return(0,r.Big)(e).minus(t).div(s).div(i).toNumber()}function o(e,t,i,s,o){const n=(0,r.Big)(i).mul(t).mul(o||1);if(n.eq(0))return 0;const a=(0,r.Big)(e).div(n).mul(s).toNumber();return Math.floor(a)}function n(e,t,i,s,o,n){const a=(0,r.Big)(s).mul(t).mul(n||1).mul(100);if(a.eq(0))return 0;const l=(0,r.Big)(e).mul(i).div(a).mul(o).toNumber();return Math.floor(l)}function a(e,t,i,s){return(0,r.Big)(i).mul(e).mul(s).plus(t).toNumber()}function l(e,t,i,s,o){
return(0,r.Big)(e).mul(i).mul(t).mul(o||1).div(s).toNumber()}function c(e,t,i,s,o,n){return i?(0,r.Big)(e).mul(s).mul(t).mul(n||1).mul(100).div(i).div(o).toNumber():0}},904664:(e,t,i)=>{"use strict";i.d(t,{BracketType:()=>s.BracketType,OrderOrPositionMessageType:()=>s.OrderOrPositionMessageType});i(46415);var r,s=i(599016);!function(e){e.Date="date",e.DateOrDateTime="dateOrDateTime",e.Default="default",e.Fixed="fixed",e.FixedInCurrency="fixedInCurrency",e.VariablePrecision="variablePrecision",e.FormatQuantity="formatQuantity",e.FormatPrice="formatPrice",e.FormatPriceForexSup="formatPriceForexSup",e.FormatPriceInCurrency="formatPriceInCurrency",e.IntegerSeparated="integerSeparated",e.LocalDate="localDate",e.LocalDateOrDateTime="localDateOrDateTime",e.Percentage="percentage",e.Pips="pips",e.Profit="profit",e.ProfitInInstrumentCurrency="profitInInstrumentCurrency",e.Side="side",e.PositionSide="positionSide",e.Status="status",e.Symbol="symbol",e.Text="text",e.Type="type",e.MarginPercent="marginPercent",e.Empty="empty"}(r||(r={}))},642659:(e,t,i)=>{"use strict";i.d(t,{BrokerService:()=>s});var r=i(650151);class s{constructor(e){this._activeBroker=null,this._trading=e,this._trading.onConnectionStatusChange.subscribe(this,this._onStatusChange),this._onStatusChange(this._trading.connectStatus())}activeBroker(){return this._activeBroker}trading(){return this._trading}_stopService(){this.stopService(),(0,r.ensureNotNull)(this._activeBroker).currentAccountUpdate.unsubscribeAll(this)}_startService(){this.startService(),(0,r.ensureNotNull)(this._activeBroker).currentAccountUpdate.subscribe(this,this._onCurrentAccountUpdate)}_onStatusChange(e){const t=this._trading.activeBroker();this._activeBroker===t&&1===e||(null!==this._activeBroker&&(this._stopService(),this._activeBroker=null),null!==t&&1===e&&(this._activeBroker=t,this._startService(),this._lastAccountId=t.currentAccount()))}_onCurrentAccountUpdate(){const e=(0,r.ensureNotNull)(this._activeBroker);this._lastAccountId!==e.currentAccount()&&(this.stopService(),this.startService(),this._lastAccountId=e.currentAccount())}}},269338:(e,t,i)=>{"use strict";i.r(t),i.d(t,{addBroker:()=>Ne,brokersList:()=>Ae,createBrokerConnection:()=>Ve,getBrokerMetainfo:()=>Re});var r=i(609838),s=i(116193),o=i(61121),n=i(586639),a=i(275734),l=i(440891),c=i(599016),d=i(41899),u=i(329452),h=i(650151);class p{constructor(e){this._objects={},this._started=!1,this._isObjectsRequestActual=!1,this._ordersPromise=null,this._getter=e,this.updateDelegate=new u.Delegate,this.partialUpdateDelegate=new u.Delegate}start(){this._started||(this._started=!0,this._ordersPromise=this._requestObjects())}stop(){this._objects={},this._started=!1,this._ordersPromise=null,this._isObjectsRequestActual=!1}update(e,t){this._started&&(this._isObjectsRequestActual?this._isObjectsRequestActual=!1:(this._objects[e.id]=e,this._onObjectUpdated(e,t)))}partialUpdate(e,t){if(!this._started)return;if(this._isObjectsRequestActual)return void(this._isObjectsRequestActual=!1);let i,r;(0,d.isObject)(e)?(i=e.id,r=e):(i=e,r=(0,h.ensure)(t))
;const s=this._objects[i];s&&(Object.assign(s,r),this.partialUpdateDelegate.fire(s,r))}fullUpdate(){this._started&&(this._isObjectsRequestActual?this._isObjectsRequestActual=!1:this._ordersPromise=this._requestObjects())}getObjects(){return this._ordersPromise||Promise.resolve(Object.values(this._objects))}_onObjectUpdated(e,t){this.updateDelegate.fire(e,t)}_onAllObjectsUpdated(){this._objectsCache().forEach((e=>this.updateDelegate.fire(e,!0)))}_objectsCache(){return Object.values(this._objects)}async _requestObjects(){let e=[];do{this._isObjectsRequestActual=!0,e=await this._getter()}while(!this._isObjectsRequestActual);var t;return this._objects=(t="id",e.reduce(((e,i)=>(e[i[t]]=i,e)),{})),this._ordersPromise=null,this._isObjectsRequestActual=!1,this._onAllObjectsUpdated(),e}}var g=i(937778),m=i(684416);class _ extends p{constructor(e,t){super(e),this._brokerConfigGetter=t}_onObjectUpdated(e,t){this._patchIndividualPositions(this._objectsCache().filter((t=>t.symbol===e.symbol&&0!==t.qty)),e,t),super._onObjectUpdated(e,t)}_onAllObjectsUpdated(){this._patchIndividualPositions(this._objectsCache().filter((e=>0!==e.qty))),super._onAllObjectsUpdated()}_patchIndividualPositions(e,t,i){const r=this._brokerConfigGetter();let s;s=r.requiresFIFOCloseIndividualPositions?r.fifoOnlyForSameQty?y:v:b;const o=s(e);for(const e of o)t!==e&&super._onObjectUpdated(e,i)}}function b(e){const t=[];for(const i of e)i.canBeClosed||(i.canBeClosed=!0,t.push(i));return t}function v(e){const t={};for(const i of e){let e=t[i.symbol];void 0===e&&(e={oldest:null,all:[]},t[i.symbol]=e),(null===e.oldest||e.oldest.date>i.date)&&(e.oldest=i),e.all.push(i)}const i=[];for(const e of Object.keys(t)){const r=(0,h.ensureDefined)(t[e]);for(const e of r.all){const t=r.oldest===e,s=t!==e.canBeClosed;e.canBeClosed=t,s&&i.push(e)}}return i}function y(e){const t={};for(const i of e){let e=t[i.symbol];void 0===e&&(e={},t[i.symbol]=e);let r=e[i.qty];void 0===r&&(r={oldest:null,all:[]},e[i.qty]=r),(null===r.oldest||r.oldest.date>i.date)&&(r.oldest=i),r.all.push(i)}const i=[];for(const e of Object.keys(t)){const r=(0,h.ensureDefined)(t[e]);for(const e of Object.keys(r)){const t=(0,h.ensureDefined)(r[e]);for(const e of t.all){const r=t.oldest===e,s=r!==e.canBeClosed;e.canBeClosed=r,s&&i.push(e)}}}return i}const f=(0,g.getLogger)("Trading.Migrations");var k=i(621575),P=i(662605),S=i(229753),C=i(924910),w=i(391431),B=i(806188),T=i(145367),E=i(328810);function O(e,t,i){const r={symbol:t.symbol,type:2,side:1===t.side?-1:1,qty:Math.abs(e),seenPrice:null,isClose:!0};return void 0===(null==i?void 0:i.bid)||void 0===(null==i?void 0:i.ask)?r:{...r,currentQuotes:{bid:i.bid,ask:i.ask}}}class D{constructor(){this._validators=new Map}add(e,t){this._validators.set(t,e)}validate(e){const t={};let i=!0;for(const[r,s]of this._validators.entries()){const o=s.validate(e);o.isValid||(i=!1,t[r]=o.error)}return i?{isValid:i}:{isValid:i,errors:t}}}class I{constructor(e,t,i,r=[]){this._status=T.PlaceOrEditContextStatus.Undefined,this._onStatusChange=new u.Delegate,
this._onDataChange=new u.Delegate,this._errors={},this._isValidationEnabled=t,this._isDisposable=i,this._source=e,this._validator=new D;for(const{validator:e,validatorName:t}of r)this._validator.add(e,t)}onReady(){return this._onReady}source(){return this._source}data(){return this._orderData}async setData(e,t){this._orderData=await this._processOrderData(e),this._assertOrderIsValid(),this._source=t,this._onDataChange.fire()}status(){return this._status}errors(){return this._errors}onStatusChange(){return this._onStatusChange}onDataChange(){return this._onDataChange}async send(e){try{if(this._status===T.PlaceOrEditContextStatus.Error){const e=Object.values(this._errors)[0];return this._processError(e instanceof Error?e:new Error(e)),!1}if(this._status!==T.PlaceOrEditContextStatus.Undefined)return!1;this._setStatus(T.PlaceOrEditContextStatus.Loading),await this._onReady;const t=await this._processSend(e),i=t?T.PlaceOrEditContextStatus.Undefined:T.PlaceOrEditContextStatus.Error;return this._setStatus(i),t}finally{this._isDisposable&&this.destroy()}}destroy(){this._setStatus(T.PlaceOrEditContextStatus.Destroyed)}async preview(){return this._status===T.PlaceOrEditContextStatus.Error?{sections:[]}:(await this._onReady,this._preview(this._orderData))}_assertOrderIsValid(){const{isValid:e,errors:t}=this._validate();e?(this._errors={},this._setStatus(T.PlaceOrEditContextStatus.Undefined)):(this._errors=t,this._setStatus(T.PlaceOrEditContextStatus.Error))}_setStatus(e){this._status!==e&&(this._status=e,this._onStatusChange.fire())}_validate(){return this._isValidationEnabled?this._validator.validate(this._orderData):{isValid:!0}}}var x=i(477071),M=i(14654),N=i(961942);class A{constructor(e){this._stopLimitPercentPriceRuleCheckers=[],this.validate=e=>{const{type:t,side:s,stopPrice:o,limitPrice:n}=e,a=2===this._priceType;if(2===t||a&&1===t||!a&&3===t)return{isValid:!0};const l=a?o:n;if(void 0===l)return{isValid:!1,error:r.t(null,void 0,i(845542))};const c=(0,w.getPriceStep)({price:l,priceType:this._priceType,minTick:this._minTick,variableMinTickData:this._variableMinTickData,limitPriceStep:this._limitPriceStep,stopPriceStep:this._stopPriceStep}),d=(0,w.roundToStepRequired)({priceType:this._priceType,minTick:this._minTick,limitPriceStep:this._limitPriceStep,stopPriceStep:this._stopPriceStep}),u=(0,w.getQuotePrice)(this._getQuotes(),s),h=(0,x.validatePrice)({price:l,askOrBid:u,orderType:t,side:s,priceType:this._priceType,isForex:"forex"===this._symbolType,formatter:this._formatter,isStatusEditing:this._isStatusEditing,stopLimitPercentPriceRuleCheckers:this._stopLimitPercentPriceRuleCheckers,supportStopOrdersInBothDirections:this._supportStopOrdersInBothDirections,supportStopLimitOrdersInBothDirections:this._supportStopLimitOrdersInBothDirections,supportStrictCheckingLimitOrderPrice:this._supportStrictCheckingLimitOrderPrice,step:c,roundedToStep:d}),p=1===s?"Buy":"Sell",g=1===this._priceType?"Limit":"Stop";return h.res?{isValid:!1,error:new N.UserFriendlyError({userFriendlyMessage:h.msg,
detailedErrorMessage:`${h.msg}: side = ${p}, askOrBid = ${u}, price = ${l}, priceType = ${g}`})}:{isValid:!0}};const{priceType:t,quotesGetter:s,formatter:o,instrumentInfo:n,validationRules:a,isStatusEditing:l,supportStopOrdersInBothDirections:c,supportStopLimitOrdersInBothDirections:d,supportStrictCheckingLimitOrderPrice:u}=e;this._priceType=t,this._getQuotes=s,this._formatter=o,this._isStatusEditing=l,this._supportStopOrdersInBothDirections=Boolean(c),this._supportStopLimitOrdersInBothDirections=Boolean(d),this._supportStrictCheckingLimitOrderPrice=Boolean(u),this._symbolType=n.type||"",this._minTick=n.minTick,this._limitPriceStep=n.limitPriceStep,this._stopPriceStep=n.stopPriceStep,this._variableMinTickData=n.variableMinTick?(0,M.makeVariableMinTickData)(this._minTick,n.variableMinTick):void 0;for(const e of a)this._stopLimitPercentPriceRuleCheckers.push((0,x.makeStopLimitPercentPriceRuleChecker)(e.options.min,e.options.max))}}var L=i(499665);class V{constructor(e){this._quantityMetainfo=e}validate(e){const t=(0,L.checkQtyError)(this._quantityMetainfo,e.qty,!0);return t.res?{isValid:!1,error:t.msg}:{isValid:!0}}}var R=i(960521),F=i(797358);class W{constructor(e){const{instrumentInfo:t,quotesGetter:i,baseCurrencyCryptoBalanceGetter:r,quoteCurrencyCryptoBalanceGetter:s}=e;this._quantityMetainfo=t.qty,this._baseCurrency=t.baseCurrency,this._quoteCurrency=t.quoteCurrency,this._getQuotes=i,this._getBaseCurrencyCryptoBalance=r,this._getQuoteCurrencyCryptoBalance=s}validate(e){const t=(0,L.checkQtyError)(this._quantityMetainfo,e.qty,!0);if(t.res)return{isValid:!1,error:t.msg};const s=(0,w.getOrderPrice)(e,this._getQuotes()),o=e.hasOwnProperty("id");if(void 0===s)return{isValid:!1,error:r.t(null,void 0,i(845542))};const n=(0,w.getCryptoBalanceValue)({balance:this._getBaseCurrencyCryptoBalance(),side:e.side,isExistingOrder:o,qty:e.qty,orderPrice:s}),a=(0,w.getCryptoBalanceValue)({balance:this._getQuoteCurrencyCryptoBalance(),side:e.side,isExistingOrder:o,qty:e.qty,orderPrice:s}),l=(0,F.validateBalance)({side:e.side,baseValue:e.qty,baseBalanceValue:n,baseCurrency:this._baseCurrency,quoteValue:(0,R.Big)(e.qty).mul(s).toNumber(),quoteBalanceValue:a,quoteCurrency:this._quoteCurrency});return l.res?{isValid:!1,error:l.msg}:{isValid:!0}}}var q=i(904664),U=i(464051),z=i(80118);class ${constructor(e){this._bracketPercentPriceRuleCheckers=[];const{bracketType:t,priceType:i,parentType:r,quotesGetter:s,formatter:o,isStatusEditing:n,instrumentInfo:a,validationRules:l}=e;if(this._bracketType=t,this._priceType=i,this._parentType=r,this._getQuotes=s,this._formatter=o,this._isStatusEditing=n,this._pipSize=a.pipSize,this._priceStep=(0,w.getPriceStep)({priceType:i,minTick:a.minTick||a.pipSize,limitPriceStep:a.limitPriceStep,stopPriceStep:a.stopPriceStep}),this._roundToStepRequired=(0,w.roundToStepRequired)({priceType:i,minTick:a.minTick||a.pipSize,limitPriceStep:a.limitPriceStep,stopPriceStep:a.stopPriceStep}),void 0!==l)for(const e of l)this._bracketPercentPriceRuleCheckers.push((0,
U.makeBracketPercentPriceRuleChecker)(e.options.min,e.options.max))}validate(e){const{side:t,takeProfit:s,stopLoss:o,trailingStopPips:n,guaranteedStop:a}=e;if(this._bracketType===q.BracketType.TakeProfit&&void 0===s||this._bracketType===q.BracketType.StopLoss&&void 0===o||this._bracketType===q.BracketType.TrailingStop&&void 0===n||this._bracketType===q.BracketType.GuaranteedStop&&void 0===a)return{isValid:!0};const l=(0,w.getOrderPrice)(e,this._getQuotes());if(void 0===l)return{isValid:!1,error:r.t(null,void 0,i(675236))};const c=(this._bracketType!==q.BracketType.TakeProfit?-1:1)*t,d=this._getPrice(e,l,c),u=this._getPips(e,l,c),h=(0,U.checkBracketError)({quotes:this._getQuotes(),side:t,price:d,pips:u,priceType:this._priceType,priceStep:this._priceStep,parentPrice:l,parentType:this._parentType,bracketType:this._bracketType,isStatusEditing:this._isStatusEditing,isEnabled:!0,bracketPercentPriceRuleCheckers:this._bracketPercentPriceRuleCheckers,priceFormatter:this._formatter,isRoundToPriceStep:this._roundToStepRequired});return h.res?{isValid:!1,error:h.msg}:{isValid:!0}}_getPrice(e,t,i){var r,s,o;switch(this._bracketType){case q.BracketType.TakeProfit:return null!==(r=e.takeProfit)&&void 0!==r?r:null;case q.BracketType.StopLoss:return null!==(s=e.stopLoss)&&void 0!==s?s:null;case q.BracketType.TrailingStop:return void 0===e.trailingStopPips?null:(0,z.pipsToPrice)(e.trailingStopPips,t,i,this._pipSize);case q.BracketType.GuaranteedStop:return null!==(o=e.guaranteedStop)&&void 0!==o?o:null;default:return null}}_getPips(e,t,i){var r;switch(this._bracketType){case q.BracketType.TakeProfit:return void 0===e.takeProfit?null:(0,z.priceToPips)(e.takeProfit,t,i,this._pipSize);case q.BracketType.StopLoss:return void 0===e.stopLoss?null:(0,z.priceToPips)(e.stopLoss,t,i,this._pipSize);case q.BracketType.TrailingStop:return null!==(r=e.trailingStopPips)&&void 0!==r?r:null;case q.BracketType.GuaranteedStop:return void 0===e.guaranteedStop?null:(0,z.priceToPips)(e.guaranteedStop,t,i,this._pipSize);default:return null}}}class Q{constructor(e){const{orderDialogOptions:t}=e;this._orderDialogOptions=t}validate(e){var t;const{customFields:s,type:o}=e;if(void 0===(null===(t=this._orderDialogOptions)||void 0===t?void 0:t.customFields)||0===this._orderDialogOptions.customFields.length)return{isValid:!0};const n=[];return this._orderDialogOptions.customFields.forEach((e=>{void 0===(null==s?void 0:s[e.id])&&(0,E.isSupportedField)(e,o)&&n.push(e.title)})),0===n.length?{isValid:!0}:{isValid:!1,error:r.t(null,void 0,i(811195)).format({customFields:n.join(", ")})}}}var H=i(193080);const j="promise rejected by time-out";function G(e,t){let i;const r=(0,H.createDeferredPromise)();return{subscription:e.subscribe((e=>{var s;r.resolve(),i=e,null===(s=null==t?void 0:t.onValueChange)||void 0===s||s.call(t)})),getter:()=>i,ready:(null==t?void 0:t.timeout)?(0,m.makeTimeLimited)(r.promise,t.timeout,j).catch((e=>{if(e!==j)throw e;void 0!==(null==t?void 0:t.timeoutValue)&&(i=t.timeoutValue)})):r.promise}}class K extends I{constructor(e){
const{orderData:t,source:i,instrumentInfo:r,quotes$:s,configFlags:o,formatter:n,tpValidationRules:a,slValidationRules:l,guaranteedStopValidationRules:d,isValidationEnabled:u,isDisposable:h,orderDialogOptions:p,callbacks:g,limitOrderRules:m,stopOrderRules:_,isStatusEditing:b,baseCurrencyCryptoBalance$:v,quoteCurrencyCryptoBalance$:y}=e,f={onValueChange:()=>{}},k={...f,timeout:2e3,timeoutValue:null},{subscription:P,getter:S,ready:C}=G(s,f),{subscription:w,getter:B,ready:T}=G(v,k),{subscription:E,getter:O,ready:D}=G(y,k),I=o.supportCryptoExchangeOrderTicket||o.supportSymbolSpecificCryptoOrderTicket&&"crypto"===r.type?new W({instrumentInfo:r,quotesGetter:S,baseCurrencyCryptoBalanceGetter:B,quoteCurrencyCryptoBalanceGetter:O}):new V(r.qty);super(i,u,h,[{validator:I,validatorName:"qty"},{validator:new A({priceType:2,quotesGetter:S,formatter:n,instrumentInfo:r,validationRules:_,isStatusEditing:b,supportStopOrdersInBothDirections:o.supportStopOrdersInBothDirections,supportStopLimitOrdersInBothDirections:o.supportStopLimitOrdersInBothDirections}),validatorName:"stopPrice"},{validator:new A({priceType:1,quotesGetter:S,formatter:n,instrumentInfo:r,validationRules:m,isStatusEditing:b,supportStopOrdersInBothDirections:o.supportStopOrdersInBothDirections,supportStopLimitOrdersInBothDirections:o.supportStopLimitOrdersInBothDirections,supportStrictCheckingLimitOrderPrice:o.supportStrictCheckingLimitOrderPrice}),validatorName:"limitPrice"},{validator:new Q({orderDialogOptions:p}),validatorName:"customFields"},{validator:new $({bracketType:c.BracketType.TakeProfit,priceType:1,parentType:1,quotesGetter:S,formatter:n,isStatusEditing:b,instrumentInfo:r,validationRules:a}),validatorName:"takeProfit"},{validator:new $({bracketType:c.BracketType.StopLoss,priceType:2,parentType:1,quotesGetter:S,isStatusEditing:b,formatter:n,instrumentInfo:r,validationRules:l}),validatorName:"stopLoss"},{validator:new $({bracketType:c.BracketType.TrailingStop,priceType:2,parentType:1,quotesGetter:S,formatter:n,isStatusEditing:b,instrumentInfo:r,validationRules:l}),validatorName:"trailingStopPips"},{validator:new $({bracketType:c.BracketType.GuaranteedStop,priceType:2,parentType:1,quotesGetter:S,isStatusEditing:b,formatter:n,instrumentInfo:r,validationRules:d}),validatorName:"guaranteedStop"}]),this._quotesSubscription=P,this._quoteCurrencyCryptoBalanceSubscription=E,this._baseCurrencyCryptoBalanceSubscription=w,this._createInitialPreOrder=g.createInitialPreOrder,this._placeOrder=g.placeOrder,this._previewOrder=g.previewOrder,this._handleError=g.handleError,this._onReady=Promise.all([C,T,D]).then((()=>this.setData(t,i))).then((()=>{f.onValueChange=()=>this._assertOrderIsValid()}))}externalContext(){return{type:T.PlaceOrEditContextType.PlaceOrder,source:()=>this.source(),data:()=>this.data(),preview:()=>this.preview(),send:()=>this.send(),status:()=>this.status(),errors:()=>this.errors()}}destroy(){super.destroy(),this._quotesSubscription.unsubscribe(),this._quoteCurrencyCryptoBalanceSubscription.unsubscribe(),
this._baseCurrencyCryptoBalanceSubscription.unsubscribe()}_processSend(e){return this._placeOrder(this._orderData,e)}_processError(e){this._handleError(e)}_processOrderData(e){return this._createInitialPreOrder(e)}_preview(e){return this._previewOrder(e)}}var Z,J,X=i(822914),Y=i(46415);class ee extends I{constructor(e){const{orderData:t,source:i,callbacks:r,isDisposable:s}=e;super(i,!1,s),this._modifyOrder=r.modifyOrder,this._metainfo=r.metainfo,this._symbolInfo=r.symbolInfo,this._orderById=r.orderById,this._previewOrder=r.previewOrder,this._handleError=r.handleError,this._onReady=this.setData(t,i)}externalContext(){return{type:T.PlaceOrEditContextType.EditOrder,source:()=>this.source(),data:()=>this.data(),send:()=>this.send(),status:()=>this.status(),errors:()=>this.errors(),preview:()=>this.preview()}}async _processOrderData(e){if(!this._metainfo().configFlags.supportModifyTrailingStop){const t=await this._orderById(e.id);e.hasTrailingStopBracket=void 0!==t&&void 0!==t.trailingStopPips}const{limitPriceStep:t,stopPriceStep:i}=await this._symbolInfo(e.symbol);if(e.limitPrice=void 0!==t&&void 0!==e.limitPrice?(0,k.roundToStepByPriceTypeAndSide)(e.limitPrice,t,1,e.side):e.limitPrice,e.stopPrice=void 0!==i&&void 0!==e.stopPrice?(0,k.roundToStepByPriceTypeAndSide)(e.stopPrice,i,2,e.side):e.stopPrice,void 0!==e.parentId&&!l.enabled("always_pass_called_order_to_modify")){let t;try{t=await this._orderById(e.parentId)}catch(e){(0,k.getLoggerMessage)(e)}if(void 0!==t&&(0,w.isOrderActive)(t.status)){const i=(0,X.default)(t);return void 0!==e.limitPrice&&(i.takeProfit=e.limitPrice),void 0!==e.stopPrice&&(e.stopType===Y.StopType.TrailingStop&&void 0!==e.trailingStopPips?(i.trailingStopPips=e.trailingStopPips,delete i.stopLoss):(i.stopLoss=e.stopPrice,delete i.trailingStopPips)),i}}return e}_processSend(e){return this._modifyOrder(this._orderData,e)}_processError(e){this._handleError(e)}_preview(e){return this._previewOrder({...e,seenPrice:null})}_configureValidator(){}}!function(e){e[e.ConnectingTimeLimit=6e4]="ConnectingTimeLimit",e[e.OAuthConnectingTimeLimit=3e5]="OAuthConnectingTimeLimit",e[e.ResolveTimeLimit=1e4]="ResolveTimeLimit",e[e.PositionReverseTimeLimit=3e4]="PositionReverseTimeLimit",e[e.PositionCloseTimeLimit=3e4]="PositionCloseTimeLimit",e[e.ModifyTimeLimit=3e4]="ModifyTimeLimit"}(Z||(Z={})),function(e){e[e.Unknown=0]="Unknown",e[e.BrokerRealtimeProvider=1]="BrokerRealtimeProvider",e[e.Broker=2]="Broker"}(J||(J={}));const te=(0,g.getLogger)("Trading.BrokerConnectionAdapter"),ie=r.t(null,void 0,i(834737)),re=r.t(null,void 0,i(628412));function se(e){(0,h.assert)("object"!=typeof e,"Expected not an object")}const oe=[1,2,3,4];class ne{constructor({brokerMetainfo:e,brokerConnection:t,host:s,brokerRealtimeAdapter:o,tradingStat:n,tradingSettingsStorageGetter:a,brokerPlan:l}){this.connectionStatusUpdate=new u.Delegate,this.executionUpdate=new u.Delegate,this.tradingOperationFinished=new u.Delegate,this.currentAccountUpdate=new u.Delegate,this._brokerPlan=null,this._subscriptions={},this._lastFireResult={},
this._fakeDOMSubscriptions={},this._formattersCache={},this._spreadFormattersCache={},this._quantityFormattersCache={},this._individualPositionsCache=null,this._fakePositionUpdateDelegate=null,this._realtimeSubscriptionState=[],this._loggedInManually=!1,this._pendingSubscriptions=[],this._sessionId=(0,C.guid)(),this.createAccount=e=>{if(this.config.supportCreateAccount&&this._brokerConnection.createAccount)return this._brokerConnection.createAccount(e);throw new Error("Method createAccount is not implemented")},this.accountSettingsInfo=e=>{if((this.config.supportCreateAccount||this.config.supportResetAccount||this.config.supportChangeAccountSettings)&&this._brokerConnection.accountSettingsInfo)return this._brokerConnection.accountSettingsInfo(e);throw new Error("Method accountSettingsInfo is not implemented")},this.resetAccount=e=>{if(this.config.supportResetAccount&&this._brokerConnection.resetAccount)return this._brokerConnection.resetAccount(e);throw new Error("Method resetAccount is not implemented")},this.changeAccountSettings=e=>{if(this.config.supportChangeAccountSettings&&this._brokerConnection.changeAccountSettings)return this._brokerConnection.changeAccountSettings(e);throw new Error("Method changeAccountSettings is not implemented")},this.deleteAccount=e=>{if(this.config.supportDeleteAccount&&this._brokerConnection.deleteAccount)return this._brokerConnection.deleteAccount(e);throw new Error("Method deleteAccount is not implemented")},this.leverageInfo=e=>{if(this.config.supportLeverage&&this._brokerConnection.leverageInfo)return this._brokerConnection.leverageInfo(e);throw new Error("Method leverage is not implemented")},this.setLeverage=e=>{if(this.config.supportLeverage&&this._brokerConnection.setLeverage)return this._brokerConnection.setLeverage(e);throw new Error("Method setLeverage is not implemented")},this.previewLeverage=e=>{if(this.config.supportLeverage&&this._brokerConnection.previewLeverage)return this._brokerConnection.previewLeverage(e);throw new Error("Method previewLeverage is not implemented")},this.maintenanceStatus=async()=>{try{return void 0!==this._brokerConnection.maintenanceStatus?await this._brokerConnection.maintenanceStatus():{isMaintenance:!1}}catch(e){return this._brokerLogger.logError(`Failed to fetch maintenance status: ${(0,k.getLoggerMessage)(e)}`),{isMaintenance:!0,message:r.t(null,{replace:{brokerName:this._brokerMetainfo.title}},i(136106))}}},this._handleStatusChange=e=>{var t;1!==e&&(null===(t=this._placeOrderContextWithMetaInfo)||void 0===t||t.context.destroy())},this.config=Object.assign({},e.configFlags),this._brokerMetainfo=this._patchMetainfo(e),this._brokerPlan=l||null,this._brokerConnection=t,this._host=s,this._tradingStat=n,this._getTradingSettingsStorage=a,this._brokerLogger=(0,g.getLogger)("Trading."+this._brokerMetainfo.id+".Connection"),s.setBrokerConnectionAdapter(this),this._initializeConnectProtection(),this._positionsCache=t.positions?new p((()=>t.positions?t.positions():Promise.resolve([]))):null,
this._individualPositionsCache=t.individualPositions?new _((()=>t.individualPositions?t.individualPositions():Promise.resolve([])),(()=>this.config)):null,this._ordersCache=new p((()=>t.orders()));const c=e=>{1===e?(null!==this._positionsCache&&this._positionsCache.start(),this._ordersCache.start(),this._individualPositionsCache&&this._individualPositionsCache.start()):(null!==this._positionsCache&&this._positionsCache.stop(),this._ordersCache.stop(),this._individualPositionsCache&&this._individualPositionsCache.stop())};this.connectionStatusUpdate.subscribe(null,c),c(this.connectionStatus()),this.connectionStatusUpdate.subscribe(null,this._handleStatusChange),this._originalDOMSubscriptionMethods={subscribeDOM:t.subscribeDOM,unsubscribeDOM:t.unsubscribeDOM},this._patchBrokerSubscribeUnsubscribeDOMMethods(),this.connectionStatusUpdate.subscribe(null,(e=>{1===e&&this._patchBrokerSubscribeUnsubscribeDOMMethods()})),e.configFlags.supportPositions||(this._fakePositionUpdateDelegate=new u.Delegate),this._brokerRealtimeAdapter=o}tryRestoreSession(){if(this._brokerConnection.tryRestoreSession)return this._brokerConnection.tryRestoreSession()}get orderUpdate(){return this._ordersCache.updateDelegate}get positionUpdate(){return null===this._fakePositionUpdateDelegate?(0,h.ensure)(this._positionsCache).updateDelegate:this._fakePositionUpdateDelegate}get individualPositionUpdate(){return(0,h.ensure)(this._individualPositionsCache).updateDelegate}get orderPartialUpdate(){return this._ordersCache.partialUpdateDelegate}get positionPartialUpdate(){return null===this._fakePositionUpdateDelegate?(0,h.ensure)(this._positionsCache).partialUpdateDelegate:this._fakePositionUpdateDelegate}get individualPositionPartialUpdate(){return(0,h.ensure)(this._individualPositionsCache).partialUpdateDelegate}onOrderUpdate(e){this._ordersCache.update(e)}onOrderPartialUpdate(e,t){this._ordersCache.partialUpdate(e,t)}onPositionUpdate(e,t){if((0,h.assert)(!!this.config.supportPositions,"Broker doesn`t support positions"),0===e.qty){const t=this._lastFireResult[e.id];t&&delete t.PL}(0,h.ensure)(this._positionsCache).update(e,t)}onPositionPartialUpdate(e,t){(0,h.assert)(!!this.config.supportPositions,"Broker doesn`t support positions"),(0,h.ensure)(this._positionsCache).partialUpdate(e,t)}onIndividualPositionUpdate(e,t){if((0,h.assert)(!!this.config.supportPositionNetting,"Broker doesn`t support individual positions"),0===e.qty){const t=this._lastFireResult[e.symbol];t&&delete t.IndividualPositionPL}(0,h.ensure)(this._individualPositionsCache).update(e,t)}onIndividualPositionPartialUpdate(e,t){(0,h.ensure)(this._individualPositionsCache).partialUpdate(e,t)}onCurrentAccountChanged(){null!==this._positionsCache&&this._positionsCache.fullUpdate(),this._ordersCache.fullUpdate(),this._individualPositionsCache&&this._individualPositionsCache.fullUpdate();const e=this.currentAccount();this.currentAccountUpdate.fire(e)}patchConfig(e){var t
;!(t=e).hasOwnProperty("supportBrackets")||t.hasOwnProperty("supportOrderBrackets")||t.hasOwnProperty("supportPositionBrackets")||(f.logWarn("supportBrackets is deprecated. Use supportOrderBrackets and supportPositionBrackets instead."),t.supportOrderBrackets=t.supportBrackets,t.supportPositionBrackets=t.supportBrackets),t.hasOwnProperty("supportModifyOrder")&&(f.logWarn("supportModifyOrder is deprecated. Use supportModifyOrderPrice, supportEditAmount and supportModifyBrackets instead."),t.supportModifyOrderPrice=t.supportModifyOrder,t.supportEditAmount=t.supportModifyOrder,t.supportModifyBrackets=t.supportModifyOrder),Object.assign(this.config,e),Object.assign(this._brokerMetainfo.configFlags,e),this._brokerMetainfo=this._patchMetainfo(this._brokerMetainfo),this._updateConfigDependentProperties()}async getOrderDialogOptions(e){if(void 0!==this._brokerConnection.getOrderDialogOptions)try{return await this._brokerConnection.getOrderDialogOptions(e)}catch(e){return void this._brokerLogger.logError(`Failed to fetch options for the order dialog: ${(0,k.getLoggerMessage)(e)}`)}}getPositionDialogOptions(){return void 0!==this._brokerConnection.getPositionDialogOptions?this._brokerConnection.getPositionDialogOptions():void 0}async getSymbolSpecificTradingOptions(e){var t,i;try{const{allowedDurations:r,allowedOrderTypes:s}=await this.symbolInfo(e),{supportOrderBrackets:o,supportPositionBrackets:n,supportIndividualPositionBrackets:a,supportReversePosition:l,supportModifyBrackets:c,supportAddBracketsToExistingOrder:d}=this._brokerMetainfo.configFlags;return{allowedDurations:r,allowedOrderTypes:s,supportOrderBrackets:o,supportPositionBrackets:n,supportIndividualPositionBrackets:a,supportReversePosition:l,supportModifyBrackets:c,supportAddBracketsToExistingOrder:d,...await(null===(i=(t=this._brokerConnection).getSymbolSpecificTradingOptions)||void 0===i?void 0:i.call(t,e))}}catch(e){return void this._brokerLogger.logWarn((0,k.getLoggerMessage)(e))}}getValidationRules(e){return void 0!==this._brokerConnection.getValidationRules?this._brokerConnection.getValidationRules(e):void 0}chartContextMenuActions(e,t){return this._brokerConnection.chartContextMenuActions(e,t)}buttonDropdownActions(){return this._host.buttonDropdownActions()}connectionStatus(){if(this._brokerConnection.connectionStatus){const e=this._brokerConnection.connectionStatus();if(function(e){return oe.includes(e)}(e))return e;throw new Error("Method connectionStatus is not properly implemented - Invalid returned value")}throw new Error("Method connectionStatus is not properly implemented")}isConnected(){return 1===this._brokerConnection.connectionStatus()}signIn(e,t,i,r){return this._brokerLogger.logNormal(`Try to login with username: ${e}`),this._loggedInManually=!0,this._brokerConnection.signIn(e,t,i,r)}loggedInManually(){return this._loggedInManually}disconnect(e=!1){try{return this._brokerConnection.disconnect(e)}catch(e){te.logWarn("Failed to disconnect")}}currentAccount(){return this._brokerConnection.currentAccount?this._brokerConnection.currentAccount():""}
currentAccountType(){return this._brokerConnection.currentAccountType?this._brokerConnection.currentAccountType():void 0}checkUserHasLiveAccount(){return void 0!==this._brokerConnection.checkUserHasLiveAccount?this._brokerConnection.checkUserHasLiveAccount():this.currentAccountType()===c.AccountType.Live}metainfo(){return this._brokerMetainfo}brokerPlan(){return this._brokerPlan}bro(){return this._brokerConnection}fireSubscription(e,t,i,r){if(void 0===this._lastFireResult[t]&&(this._lastFireResult[t]={Realtime:null,PL:null,Equity:null,DOM:null,IndividualPositionPL:null,PipValue:null,MarginAvailable:null,CryptoBalance:null}),(0,h.ensure)(this._lastFireResult[t])[e]={data:i,time:Date.now()},void 0===this._subscriptions[t])return;const s=(0,h.ensure)(this._subscriptions[t]);(0,h.ensure)(s[e]).forEach((e=>e(t,i,r)))}positions(e){return this.config.supportPositions?(this._makeSureBrokerIsConnected(),this._positions().then((t=>t.filter((t=>void 0===e||t.symbol===e))))):Promise.resolve([])}disconnectWarningMessage(){return this._brokerConnection.disconnectWarningMessage?this._brokerConnection.disconnectWarningMessage():null}connectWarningMessage(){return this._brokerConnection.connectWarningMessage?this._brokerConnection.connectWarningMessage():null}individualPositions(e){return this._makeSureBrokerIsConnected(),(0,h.assert)(!!this.config.supportPositionNetting,"Broker doesn`t support individual positions"),this._individualPositions().then((t=>t.filter((t=>void 0===e||t.symbol===e))))}positionById(e){return this._brokerConnection.positionById?this._brokerConnection.positionById(e):this.positions().then((t=>t.find((t=>t.id===e))))}individualPositionById(e){return(0,h.assert)(!!this.config.supportPositionNetting,"Broker doesn`t support individual positions"),this.individualPositions().then((t=>t.find((t=>t.id===e))))}orders(e){return this._makeSureBrokerIsConnected(),this._orders().then((t=>t.filter((t=>void 0===e||t.symbol===e))))}ordersHistory(){return this._makeSureBrokerIsConnected(),this.config.supportOrdersHistory&&this._brokerConnection.ordersHistory?this._brokerConnection.ordersHistory():Promise.resolve([])}async executions(e){return this.config.supportExecutions?(this._makeSureBrokerIsConnected(),this._brokerConnection.executions(e)):[]}async allExecutions(){return void 0===this._brokerConnection.allExecutions?[]:this._brokerConnection.allExecutions()}orderById(e){return this._makeSureBrokerIsConnected(),this._brokerConnection.orders().then((t=>t.find((t=>t.id===e))))}accountManagerInfo(){return this._brokerConnection.accountManagerInfo()}isTradable(e){return this._makeSureBrokerIsConnected(),this._brokerConnection.isTradable(e).then((t=>("object"!=typeof t&&(t={tradable:t}),t.tradable||void 0!==t.reason||(t.reason=(0,k.makeNonTradableSymbolText)((0,P.htmlEscape)(e),this._brokerMetainfo.title)),t)))}formatter(e,t=!0){return this._makeSureBrokerIsConnected(),this._formattersCache[e]||(this._formattersCache[e]=this._brokerConnection.formatter&&this._brokerConnection.formatter(e,t)||this._host.defaultFormatter(e,t)),(0,
m.makeTimeLimited)(this._formattersCache[e],1e4,"formatter not received")}spreadFormatter(e){return this._makeSureBrokerIsConnected(),this._spreadFormattersCache[e]||(this._spreadFormattersCache[e]=this._brokerConnection.spreadFormatter&&this._brokerConnection.spreadFormatter(e)||this._host.defaultFormatter(e,!1)),(0,m.makeTimeLimited)(this._spreadFormattersCache[e],1e4,"spreadFormatter not received")}quantityFormatter(e){return this._makeSureBrokerIsConnected(),this._quantityFormattersCache[e]||(this._quantityFormattersCache[e]=this._brokerConnection.quantityFormatter&&this._brokerConnection.quantityFormatter(e)||this._host.quantityFormatter()),(0,m.makeTimeLimited)(this._quantityFormattersCache[e],1e4,"quantityFormatter not received")}async createInitialPreOrder(e){const[t,i]=await Promise.all([this.getOrderDialogOptions(e.symbol),this.symbolInfo(e.symbol)]);return this._createInitialPreOrder(e,i,t)}async createPlaceOrderContext(e){var t;const{order:i,source:r,isDisposable:s,isValidationEnabled:o}=e;if(s)return this._createPlaceOrderContext(e);const n=this._placeOrderContextWithMetaInfo;if(void 0!==n&&n.context.status()!==T.PlaceOrEditContextStatus.Destroyed&&n.context.data().symbol===i.symbol&&n.isValidationEnabled===o)return await n.context.setData(i,r),n.context;null===(t=this._placeOrderContextWithMetaInfo)||void 0===t||t.context.destroy();const a=await this._createPlaceOrderContext(e);return n===this._placeOrderContextWithMetaInfo&&(this._placeOrderContextWithMetaInfo={context:a,isValidationEnabled:o}),a}async createEditOrderContext(e){const{order:t,source:i,isDisposable:r,isValidationEnabled:s}=e;if(r)return this._createEditOrderContext(e);const o=this._editOrderContextWithMetaInfo;if(void 0!==o&&o.context.status()!==T.PlaceOrEditContextStatus.Destroyed&&o.context.data().id===t.id&&o.isValidationEnabled===s)return await o.context.setData(t,i),o.context;const n=await this._createEditOrderContext(e);return o===this._editOrderContextWithMetaInfo&&(this._editOrderContextWithMetaInfo={context:n,isValidationEnabled:s}),n}placeOrder(e,t){return this._placeOrder(e,t)}previewOrder(e){return this._previewOrder(e)}modifyOrder(e,t){return this._modifyOrder(e,t)}cancelOrder(e){return se(e),this._makeSureBrokerIsConnected(),this.processErrors(this._brokerConnection.cancelOrder(e),!0,r.t(null,void 0,i(919116)))}cancelOrders(e,t,s){return this._makeSureBrokerIsConnected(),this._brokerConnection.cancelOrders?this.processErrors(this._brokerConnection.cancelOrders(e,t,s),!0,r.t(null,void 0,i(759469))):this.processErrors(Promise.reject("`cancelOrders` method is not implemented in your broker."),!1)}async closePosition(e,t){let i;se(e),this._makeSureBrokerIsConnected(),(0,h.assert)(void 0===t||!!this.config.supportPartialClosePosition,"Broker doesn`t support partial position closing");const r=new Promise((async(r,s)=>{try{const s=await this._positionCopyById(e);i=e=>{void 0!==s&&e.id===s.id&&e.symbol===s.symbol&&e.qty!==s.qty&&(this.positionUpdate.unsubscribe(this,i),r(!0))},this.positionUpdate.subscribe(this,i),
await this._closePosition(e,t)}catch(e){s(e)}}));return(0,m.makeTimeLimited)(r,3e4,"Position closing timeout").catch((e=>(this._brokerLogger.logError(`${ie}: ${(0,k.getLoggerMessage)(e)}`),this.positionUpdate.unsubscribe(this,i),!1)))}async closeIndividualPosition(e,t){var s;se(e),this._makeSureBrokerIsConnected(),(0,h.assert)(!!this.config.supportPositionNetting,"Broker doesn`t support individual positions"),(0,h.assert)(void 0===t||null!==(s=this.config.supportPartialCloseIndividualPosition)&&void 0!==s&&s,"Broker doesn`t support partial individual position closing");const o=(0,h.ensureDefined)(await this.individualPositionById(e));if(0===o.qty)return this._host.showNotification(r.t(null,void 0,i(139924)),r.t(null,void 0,i(445863)),0),!1;if(void 0===t||t<=Math.abs(o.qty)){if(this._brokerConnection.closeIndividualPosition){const i=O(null!=t?t:Math.abs(o.qty),o);return this.processErrors(this._brokerConnection.closeIndividualPosition(e,t),!0,ie,(()=>(0,h.ensureNotNull)(this._tradingStat).trackOrderPlaced({order:i})))}throw new Error("Method closeIndividualPosition is not implemented")}return this._host.showNotification(r.t(null,void 0,i(139924)),r.t(null,void 0,i(819189)),0),!1}reversePosition(e){if(se(e),this._makeSureBrokerIsConnected(),this.config.supportMultiposition&&!this.config.supportNativeReversePosition)throw new Error("Cannot reverse position on multiposition account");let t;const i=new Promise((async(i,r)=>{try{const r=await this._positionCopyById(e);t=e=>{void 0!==r&&e.symbol===r.symbol&&e.side!==r.side&&(this.positionUpdate.unsubscribe(this,t),i(!0))},this.positionUpdate.subscribe(this,t),await this._reversePosition(e)}catch(e){r(e)}}));return(0,m.makeTimeLimited)(i,3e4,"Position reversing timeout").catch((e=>(this._brokerLogger.logError(`${re}: ${(0,k.getLoggerMessage)(e)}`),this.positionUpdate.unsubscribe(this,t),!1)))}editPositionBrackets(e,t,s){if(this._makeSureBrokerIsConnected(),this._brokerConnection.editPositionBrackets)return this.processErrors(this._brokerConnection.editPositionBrackets(e,t,s),!0,r.t(null,void 0,i(209877)));throw new Error("Method editPositionBrackets is not implemented")}editIndividualPositionBrackets(e,t){if(this._makeSureBrokerIsConnected(),(0,h.assert)(!!this.config.supportIndividualPositionBrackets,"Broker doesn`t support brackets on individual positions"),this._brokerConnection.editIndividualPositionBrackets)return this.processErrors(this._brokerConnection.editIndividualPositionBrackets(e,t),!0,r.t(null,void 0,i(209877)));throw new Error("Method editIndividualPositionBrackets is not implemented")}async subscribeRealtime(e,t){this._makeSureBrokerIsConnected();const i={symbol:e,listener:t,provider:0};this._realtimeSubscriptionState.push(i);const r=await this.symbolInfo(e),s=this._realtimeSubscriptionState.findIndex((i=>i.symbol===e&&i.listener===t));if(-1!==s)return void 0!==r.hasQuotes&&!1===r.hasQuotes?(this._realtimeSubscriptionState[s].provider=1,(0,h.ensure)(this._brokerRealtimeAdapter).subscribeRealtime(e,t)):(this._realtimeSubscriptionState[s].provider=2,
this._addSubscription("Realtime",e,t))}async quotesSnapshot(e){let t,i;const r=(e,s)=>{i=s,(s.ask||s.bid)&&(this.unsubscribeRealtime(e,r),null==t||t(s))},s=new Promise((i=>{t=i,this.subscribeRealtime(e,r)}));try{return await(0,m.makeTimeLimited)(s,1e4,"quotesSnapshot not received")}catch(t){if(this.unsubscribeRealtime(e,r),void 0!==i)return i;throw t}}subscribeDOM(e,t){return this._makeSureBrokerIsConnected(),this._addSubscription("DOM",e,t)}subscribePipValue(e,t){return this._makeSureBrokerIsConnected(),this._addSubscription("PipValue",e,t)}subscribePL(e,t){this._makeSureBrokerIsConnected(),this._addSubscription("PL",e,t)}subscribeIndividualPositionPL(e,t){return this._makeSureBrokerIsConnected(),this._addSubscription("IndividualPositionPL",e,t)}subscribeCryptoBalance(e,t){return this._makeSureBrokerIsConnected(),this._addSubscription("CryptoBalance",e,t)}subscribeEquity(e){return this._makeSureBrokerIsConnected(),this._addSubscription("Equity","Equity",e)}subscribeMarginAvailable(e){return this._makeSureBrokerIsConnected(),this._addSubscription("MarginAvailable","MarginAvailable",e)}unsubscribeRealtime(e,t){const i=this._realtimeSubscriptionState.findIndex((i=>i.symbol===e&&i.listener===t));-1!==i&&(1===this._realtimeSubscriptionState[i].provider?(0,h.ensure)(this._brokerRealtimeAdapter).unsubscribeRealtime(e,t):this._removeSubscription("Realtime",e,t),this._realtimeSubscriptionState.splice(i,1))}unsubscribeDOM(e,t){this._removeSubscription("DOM",e,t)}unsubscribePipValue(e,t){this._removeSubscription("PipValue",e,t)}unsubscribePL(e,t){this._removeSubscription("PL",e,t)}unsubscribeIndividualPositionPL(e,t){this._removeSubscription("IndividualPositionPL",e,t)}unsubscribeCryptoBalance(e,t){this._removeSubscription("CryptoBalance",e,t)}unsubscribeEquity(e){this._removeSubscription("Equity","Equity",e)}unsubscribeMarginAvailable(e){this._removeSubscription("MarginAvailable","MarginAvailable",e)}async accountMetainfo(){const e=await this.accountsMetainfo(),t=this.currentAccount(),i=e.find((e=>e.id===t));if(void 0===i)throw new Error("accountMetainfo not received");return i}accountsMetainfo(){return(0,m.makeTimeLimited)(this._brokerConnection.accountsMetainfo(),1e4,"accountsMetainfo not received")}setCurrentAccount(e){if(void 0===this._brokerConnection.setCurrentAccount)throw new Error(`${this._brokerMetainfo.title} doesn't support sub-accounts`);this._brokerConnection.setCurrentAccount(e)}symbolInfo(e){return(0,m.makeTimeLimited)(this._brokerConnection.symbolInfo(e),1e4,"symbolInfo not received")}async getPositionCurrency(e){try{const t=await this._brokerConnection.symbolInfo(e);if(this._brokerMetainfo.configFlags.positionPLInInstrumentCurrency)return t.currency;const i=await this.accountMetainfo();return(0,w.getCurrency)(i,!0)}catch(e){return void te.logError(e)}}sessionId(){return this._sessionId}bugReportInfo(){function e(e){return JSON.parse(JSON.stringify(e))}function t(e){if("object"!=typeof e)return e;if((0,d.isArray)(e))return e.map(t);const i={};for(const t in e)"object"!=typeof e[t]&&(i[t]=e[t]);return i}
return Promise.all([this.orders(),this.positions(),this.config.supportPositionNetting?this.individualPositions():Promise.resolve([])]).then((i=>({activeBroker:this.metainfo().title,orders:t(e(i[0])),positions:t(e(i[1])),individualPositions:t(e(i[2])),silentOrdersPlacement:this._host.silentOrdersPlacement().value(),floatingPanel:(0,h.ensureNotNull)(this._host.sellBuyButtonsVisibility()).value(),account:this.currentAccount(),accountType:this.currentAccountType(),lastUpdates:this._lastFireResult,time:Date.now(),brokerSpecific:this._brokerConnection.bugReportInfo?this._brokerConnection.bugReportInfo():null,sessionId:this._sessionId,deviceId:getDeviceId()})))}processErrors(e,t,i,r){if(!(0,d.isPromise)(e))throw new Error("Broker incorrectly implements API, should return Promise");return e.then((e=>r&&r(e))).then((e=>"boolean"!=typeof e||e)).catch((e=>((0,o.isAbortError)((0,k.getErrorCauses)(e)[0])||(t&&l.enabled("trading_notifications")?this._showErrorNotification({error:e,notificationTitle:i}):te.logWarn(e)),Promise.resolve(!1)))).then((e=>(this.tradingOperationFinished.fire(e),e)))}setDurations(e){this._brokerMetainfo.durations=e.slice()}setSymbolSearchId(e){this._brokerMetainfo.backendBrokerName=e}getRealtimeDataCheckParams(){return this._brokerConnection.getRealtimeDataCheckParams?this._brokerConnection.getRealtimeDataCheckParams():{}}getVerifyLiveAccountParams(){if(void 0===this._brokerConnection.getVerifyLiveAccountParams)throw new Error(`Method getVerifyLiveAccountParams for broker ${this._brokerMetainfo.id} is not implemented`);return this._brokerConnection.getVerifyLiveAccountParams()}unhideSymbolSearchGroups(){return this._brokerConnection.unhideSymbolSearchGroups?this._brokerConnection.unhideSymbolSearchGroups():[]}destroy(){void 0!==this._brokerConnection.destroy&&this._brokerConnection.destroy()}currentBroker(){return this._brokerMetainfo.id}_showErrorNotification(e){var t;const{error:s,notificationTitle:o,showErrorNotificationEnding:n=!0}=e;let a="";"string"==typeof s?a=s:"object"==typeof s&&null!==s&&"message"in s&&"string"==typeof s.message&&(a=(0,P.removeTags)(s.message)),0!==a.length&&(a=(0,w.addAsciiDotIfTextDoesNotEndWithSentenceEndingMark)(a)+" "),n&&(a+=null!==(t=this._brokerMetainfo.customErrorNotificationEnding)&&void 0!==t?t:r.t(null,void 0,i(926986))),this._host.showNotification(o||"",a.trim(),0)}_makeContextErrorHandler(e){return l.enabled("trading_notifications")?t=>{t instanceof Error&&this._brokerLogger.logNormal(`Failed to validate context: ${(0,k.getLoggerMessage)(t)}`),this._showErrorNotification({error:t,notificationTitle:e,showErrorNotificationEnding:!1})}:e=>te.logWarn((0,k.getErrorMessage)(e))}async _createEditOrderContext(e){const{order:t,source:s,isDisposable:o=!1}=e,n=new ee({orderData:t,source:s,isDisposable:o,callbacks:{modifyOrder:this._modifyOrder.bind(this),metainfo:this.metainfo.bind(this),symbolInfo:this.symbolInfo.bind(this),orderById:this.orderById.bind(this),previewOrder:this._previewOrder.bind(this),handleError:this._makeContextErrorHandler(r.t(null,void 0,i(663504)))}})
;return await n.onReady(),n}async _createPlaceOrderContext(e){var t,s;const{order:o,source:l,isDisposable:c=!1,isValidationEnabled:d=!0}=e,[u,h,p]=await Promise.all([this.symbolInfo(o.symbol),this.formatter(o.symbol),this.getOrderDialogOptions(o.symbol)]),{configFlags:g,orderRules:m=[]}=this.metainfo(),_=g.supportBalances&&u.baseCurrency?this._cryptoBalanceObservable(u.baseCurrency):(0,n.of)(null),b=g.supportBalances&&u.quoteCurrency?this._cryptoBalanceObservable(u.quoteCurrency):(0,n.of)(null),v=(0,B.extractTakeProfitValidationRules)(this,o.symbol),y=(0,B.extractStopLossValidationRules)(this,o.symbol),f=(0,B.extractGuaranteedStopValidationRules)(this,o.symbol),k=m.filter(B.isLimitPercentValidationRule),P=m.filter(B.isStopPercentValidationRule);g.supportStopOrdersInBothDirections&&g.supportStopLimitOrdersInBothDirections||(k.push(...null!==(t=(0,B.extractLimitValidationRules)(this,o.symbol))&&void 0!==t?t:[]),P.push(...null!==(s=(0,B.extractStopValidationRules)(this,o.symbol))&&void 0!==s?s:[]));const S=(0,a.fromEventPattern)((e=>this.subscribeRealtime(o.symbol,e)),(e=>this.unsubscribeRealtime(o.symbol,e)),((e,t)=>t)),C=new K({orderData:o,source:l,instrumentInfo:u,quotes$:S,configFlags:g,formatter:h,isValidationEnabled:d,isDisposable:c,orderDialogOptions:p,tpValidationRules:v,slValidationRules:y,guaranteedStopValidationRules:f,limitOrderRules:k,stopOrderRules:P,isStatusEditing:!1,baseCurrencyCryptoBalance$:_,quoteCurrencyCryptoBalance$:b,callbacks:{createInitialPreOrder:async e=>this._createInitialPreOrder(e,u,p),placeOrder:(e,t)=>this._placeOrder(e,t),previewOrder:e=>this._previewOrder(e),handleError:this._makeContextErrorHandler(r.t(null,void 0,i(74390)))}});return await C.onReady(),C}_createInitialPreOrder(e,t,i){var r,s,o;if(void 0===e.duration){const{durations:i}=this.metainfo(),n=(0,w.getOrderDuration)({orderDuration:void 0,orderType:e.type,savedDuration:null!==(o=null===(s=null===(r=this._getTradingSettingsStorage)||void 0===r?void 0:r.call(this))||void 0===s?void 0:s.duration(e.symbol,e.type))&&void 0!==o?o:null,orderDurations:i,symbolDurations:t.allowedDurations});null!==n&&(e.duration=n)}if(void 0===e.customFields){const t=this._getSavedCustomFields(e.symbol,e.type,i);void 0!==t&&(e.customFields=t)}return e}_getSavedCustomFields(e,t,i){var r,s;const o=null!==(s=null===(r=this._getTradingSettingsStorage)||void 0===r?void 0:r.call(this))&&void 0!==s?s:void 0;if(void 0===o||void 0===(null==i?void 0:i.customFields)||0===i.customFields.length)return;const n=(0,E.filterAllowedCustomFields)(t,i.customFields).map((e=>e.id)),a=o.customFields(e,t,n),l=(0,w.adjustSavedCustomFieldsValues)(a,i);return 0!==Object.keys(l).length?l:void 0}_placeOrder(e,t){return this._makeSureBrokerIsConnected(),this.processErrors(this._brokerConnection.placeOrder(e,t),!0,r.t(null,void 0,i(74390)),(t=>{(0,h.ensureNotNull)(this._tradingStat).trackOrderPlaced({order:{...e,id:t.orderId},label:t.label,source:e.source}),this._host.trackEvent("","SilentMode",this._host.silentOrdersPlacement().value()?"On":"Off")}))}async _modifyOrder(e,t){
this._makeSureBrokerIsConnected();const s=new Set((await this._orders()).map((({id:e})=>e)));s.delete(e.id);return await this.processErrors(this._brokerConnection.modifyOrder(e,t),!0,r.t(null,void 0,i(663504)),(()=>(0,h.ensureNotNull)(this._tradingStat).trackOrderModified(e)))&&this._waitForOrderModification(e,s)}_previewOrder(e){if(!this._brokerConnection.previewOrder)throw new Error("Order preview is not supported");return this._brokerConnection.previewOrder(e)}_initializeConnectProtection(){let e=null;this.connectionStatusUpdate.subscribe(null,(t=>{if(e&&(clearTimeout(e),e=null),2===t){const t=(0,w.isOAuthAuthType)(this.config.authorizationType)?3e5:6e4;e=setTimeout((()=>{this._host.selectBroker(),this._host.showNotification(r.t(null,void 0,i(369635)),r.t(null,void 0,i(949880)))}),t)}}))}_fakeSubscribeDOM(e){this._fakeDOMSubscriptions[e]=(e,t)=>{const i=t.ask||t.trade,r=t.bid||t.trade,s={snapshot:!0,asks:i?[{price:i,volume:t.ask_size||1/0}]:[],bids:r?[{price:r,volume:t.bid_size||1/0}]:[]};this._host.domUpdate(e,s)},this.subscribeRealtime(e,this._fakeDOMSubscriptions[e])}_fakeUnsubscribeDOM(e){this.unsubscribeRealtime(e,this._fakeDOMSubscriptions[e])}_isMaintenance(){return isFeatureEnabled((0,w.makeMaintananceFeatureToggleName)(this._brokerMetainfo.id))}_isBrokerSideMaintenance(){return isFeatureEnabled((0,w.makeBrokerSideMaintananceFeatureToggleName)(this._brokerMetainfo.id))}async _positionCopyById(e){const t=await this.positionById(e);return void 0!==t?(0,s.default)(t):void 0}_patchBrokerSubscribeUnsubscribeDOMMethods(){const e=!this._brokerMetainfo.configFlags.supportLevel2Data;this._brokerConnection.subscribeDOM=e?e=>{this._fakeSubscribeDOM(e)}:this._originalDOMSubscriptionMethods.subscribeDOM,this._brokerConnection.unsubscribeDOM=e?e=>{this._fakeUnsubscribeDOM(e)}:this._originalDOMSubscriptionMethods.unsubscribeDOM}_patchMetainfo(e){const t=(0,S.deepCopy)(e);return t.configFlags.supportNativeReversePosition=!this.config.supportMultiposition||this.config.supportNativeReversePosition,t.configFlags.supportClosePosition=!0,t.configFlags.supportPLUpdate=!0,t}_addSubscription(e,t,i){this._pendingSubscriptions.push({brokerMethodName:e,symbol:t,listener:i});const r=this._lastFireResult[t];if(void 0!==r&&void 0!==r[e]&&null!==r[e]&&i(t,r[e].data),!this._removePendingSubscription({brokerMethodName:e,symbol:t,listener:i}))return;void 0===this._subscriptions[t]&&(this._subscriptions[t]={Realtime:[],PL:[],Equity:[],DOM:[],IndividualPositionPL:[],PipValue:[],MarginAvailable:[],CryptoBalance:[]});const s=(0,h.ensure)(this._subscriptions[t]),o=s[e].length>0;if(s[e].push(i),!o&&(s[e].length>0||"CryptoBalance"===e)){const i="subscribe"+e;this._brokerConnection[i]&&this._brokerConnection[i](t)}}_removePendingSubscription(e){const t=this._pendingSubscriptions.findIndex((t=>t.symbol===e.symbol&&t.brokerMethodName===e.brokerMethodName&&t.listener===e.listener));return-1!==t&&(this._pendingSubscriptions.splice(t,1),!0)}_removeSubscription(e,t,i){if(this._removePendingSubscription({brokerMethodName:e,symbol:t,listener:i}))return
;if(void 0===this._subscriptions[t])return;const r=(0,h.ensure)(this._subscriptions[t]),s=r[e].indexOf(i);if(s>-1&&r[e].splice(s,1),0===r[e].length){const i="unsubscribe"+e;this._brokerConnection[i]&&this._brokerConnection[i](t)}}_positions(){return this._positionsCache?this._positionsCache.getObjects():Promise.resolve([])}_individualPositions(){return this._individualPositionsCache?this._individualPositionsCache.getObjects():Promise.resolve([])}_orders(){return this._ordersCache.getObjects()}_makeSureBrokerIsConnected(){(0,h.assert)(1===this.connectionStatus(),"Broker is not connected")}async _placeReversePositionOrder(e){const t=await this.quotesSnapshot(e.symbol),i=O(2*e.qty,e,t);return this._placeOrder(i)}async _closePosition(e,t){const s=(0,h.ensureDefined)(await this.positionById(e));if(!(0,w.checkIsExistingPosition)(s)){const e=r.t(null,void 0,i(445863));throw this._host.showNotification(ie,e,0),new Error(e)}if(!(void 0===t||t<=Math.abs(s.qty))){const e=r.t(null,void 0,i(819189));throw this._host.showNotification(ie,e,0),new Error(e)}{const i=await this.quotesSnapshot(s.symbol),r=O(null!=t?t:Math.abs(s.qty),s,i);if(this.config.supportClosePosition&&this._brokerConnection.closePosition){if(!await this.processErrors(this._brokerConnection.closePosition(e,t),!0,ie,(()=>(0,h.ensureNotNull)(this._tradingStat).trackOrderPlaced({order:r}))))throw new Error(ie)}else{if(!await this.processErrors(this._brokerConnection.placeOrder(r),!0,ie,(()=>(0,h.ensureNotNull)(this._tradingStat).trackOrderPlaced({order:r}))))throw new Error(ie)}}}async _reversePosition(e){const t=(0,h.ensureDefined)(await this.positionById(e));if(0===t.qty){const e=r.t(null,void 0,i(887411));throw this._host.showNotification(re,e,0),new Error(e)}this.config.supportNativeReversePosition&&this._brokerConnection.reversePosition?await this.processErrors(this._brokerConnection.reversePosition(e),!0,re):await this.processErrors(this._placeReversePositionOrder(t),!0,re,(()=>(0,h.ensureNotNull)(this._tradingStat).trackOrderPlaced()))}async _waitForOrderModification(e,t){return new Promise((async i=>{const r=()=>{i(!0),o(),clearTimeout(n)},s=t=>{this._areOrdersEqual(t,e)&&r()},o=()=>this.orderUpdate.unsubscribe(this,s),n=setTimeout((()=>{i(!1),this._brokerLogger.logError("Failed to modify order: timeout waiting for new order"),o()}),3e4);this.orderUpdate.subscribe(this,s);for(const i of await this._orders())if(!t.has(i.id)&&this._areOrdersEqual(e,i))return void r()}))}_areOrdersEqual(e,t){const{checkBracketsAfterOrderModification:i}=this._brokerMetainfo.configFlags;return function(e,t){return e.type===t.type&&e.qty===t.qty&&e.limitPrice===t.limitPrice&&e.stopPrice===t.stopPrice}(e,t)&&(!i||function(e,t){return e.stopLoss===t.stopLoss&&e.takeProfit===t.takeProfit&&e.trailingStopPips===t.trailingStopPips&&e.guaranteedStop===t.guaranteedStop}(e,t))}_updateConfigDependentProperties(){var e,t;const{supportPositions:i}=this._brokerMetainfo.configFlags;i?(null===(e=this._fakePositionUpdateDelegate)||void 0===e||e.destroy(),
this._fakePositionUpdateDelegate=null):null!==(t=this._fakePositionUpdateDelegate)&&void 0!==t||(this._fakePositionUpdateDelegate=new u.Delegate)}_cryptoBalanceObservable(e){return(0,a.fromEventPattern)((t=>this.subscribeCryptoBalance(e,t)),(t=>this.unsubscribeCryptoBalance(e,t)),((e,t)=>t))}}var ae=i(870122),le=i.n(ae),ce=i(240534),de=i(834002),ue=i(563223),he=i(167543),pe=i(563870),ge=i(172912),me=i(153055),_e=i(537008),be=i(220858),ve=i(151121),ye=i(605962),fe=i(646323);class ke{constructor(e,t,i,r){this._lastPL=0,this._isActive=!1,this._realtimeUpdate=(e,t)=>{this._realtimeData=t,this._updatePL()},this._symbol=e.symbol,this._adapter=i,this._onPlUpdate=t,this._side=e.side,this._qty=e.qty,this._avgPrice=e.avgPrice||e.price,this._instrumentInfo=r,this.positionUpdate(e)}positionUpdate(e){this._avgPrice=e.avgPrice||e.price,this._qty=e.qty,this._side=e.side,this._updatePL()}lastPL(){return this._lastPL}start(){this._isActive||(this._adapter.subscribeRealtime(this._symbol,this._realtimeUpdate),this._isActive=!0)}stop(){this._isActive&&(this._adapter.unsubscribeRealtime(this._symbol,this._realtimeUpdate),this._isActive=!1)}_updatePL(){var e;if(!this._realtimeData||void 0===this._realtimeData.bid||void 0===this._realtimeData.ask)return;const t=Number(new R.Big(1===this._side?this._realtimeData.bid:this._realtimeData.ask).minus(Math.abs(this._avgPrice)).mul(1===this._side?1:-1).mul(this._qty).mul(null!==(e=this._instrumentInfo.lotSize)&&void 0!==e?e:1).div(this._instrumentInfo.pipSize).mul(this._instrumentInfo.pipValue));this._lastPL=t,this._onPlUpdate(t)}}new Set(["type","typespecs","pricescale","minmov","fractional"]);function Pe(e,t){return(0,pe.getQuoteSessionInstance)("full").snapshot(e)}function Se(e){return"error"===e.status}class Ce{constructor(e,t,i,r){var s;this._setDefaultDropdownActionsBound=this._setDefaultDropdownActions.bind(this),this._qtyChangedSubscriptions=new Map,this.checkRealtimeDataPermissions=e=>(0,h.ensureNotNull)(this._trading,"Trading in realtime data permission checker").checkRealtimeDataPermissions(e),this.serverLogger=()=>this._serverLogger,this.orderPartialUpdate=(e,t)=>{this._adapter.onOrderPartialUpdate(e,t)},this.positionPartialUpdate=(e,t)=>{this._adapter.onPositionPartialUpdate(e,t)},this.individualPositionPartialUpdate=(e,t)=>{this._adapter.onIndividualPositionPartialUpdate(e,t)},this.createMapperAsync=(e,t)=>({tvToBroker:async e=>e,brokerToTv:async e=>e}),this.createMapperSync=(e,t)=>{let i=null;{const e=Promise.resolve();i={ready:()=>e,tvToBroker:e=>e,brokerToTv:e=>e}}return i},this._trading=e,this._metainfo=t,this._serverLogger=null!==i?this._makeServerLoggerWithFilledInfo(i):null,this._setDefaultDropdownActionsBound=this._setDefaultDropdownActions.bind(this),this._defaultDropdownActions=!0,this._credentialsStorage=r,this._setDefaultDropdownActions(),null!==this._trading&&(null===(s=this.sellBuyButtonsVisibility())||void 0===s||s.subscribe(this._setDefaultDropdownActionsBound),(0,h.ensureNotNull)(this.orderPanelVisibility()).subscribe(this._setDefaultDropdownActionsBound),(0,
h.ensureNotNull)(this.domPanelVisibility()).subscribe(this._setDefaultDropdownActionsBound))}createPLEmitter(e,t,i){return new ke(e,t,this._adapter,i)}getLogger(e){const t=`Trading.${this._metainfo.id}`;if(void 0===e)return(0,g.getLogger)(t);const{brokerSubsystemId:i,metainfo:r}=e,s=void 0!==i?`.${i}`:"";return(0,g.getLogger)(`${t}${s}`,r)}translate(e){return e}setBrokerConnectionAdapter(e){this._adapter=e}patchConfig(e){this._adapter.patchConfig(e)}showOrderDialog(e,t){return(0,h.ensureNotNull)(this._trading).orderViewController().showOrderView({order:e,focus:t})}showPositionBracketsDialog(e,t,i){return(0,h.ensureNotNull)(this._trading).orderViewController().showPositionView(e,t,i)}showCancelOrderDialog(e,t){return ve.ConfirmOrderCancelDialog.get().open(e).then((e=>{e&&this._adapter.processErrors(t(),!0,r.t(null,void 0,i(919116)))}))}showCancelMultipleOrdersDialog(e,t,s,o){return ve.ConfirmOrderCancelDialog.get().multiple(e,t,s).then((e=>{e&&this._adapter.processErrors(o(),!0,r.t(null,void 0,i(759469)))}))}showCancelBracketsDialog(e,t){return ye.ConfirmBracketsCancelDialog.get().open(e).then((e=>{e&&this._adapter.processErrors(t(),!0,r.t(null,void 0,i(83683)))}))}showCancelMultipleBracketsDialog(e,t){return ye.ConfirmBracketsCancelDialog.get().multiple(e).then((e=>{e&&this._adapter.processErrors(t(),!0,r.t(null,void 0,i(83683)))}))}showReversePositionDialog(e,t){return(0,fe.reversePositionDialog)({positionId:e,showErrorNotification:(0,h.ensureNotNull)(this._trading).showErrorNotification,handler:t})}showMessageDialog(e,t,i=!1){i?(0,me.showWarning)({title:e,html:t}):(0,me.showWarning)({title:e,text:t})}showConfirmDialog(e,t,i,r,s){return(0,_e.showConfirmDialog)({title:e,content:t,mainButtonText:i,cancelButtonText:r,showDisableConfirmationsCheckbox:s})}showSimpleConfirmDialog(e,t,i,r,s){return(0,be.showSimpleConfirmDialog)({title:e,text:Array.isArray(t)?t.join(" "):t,mainButtonText:i,mainButtonIntent:"primary",cancelButtonText:r,showDisableConfirmationsCheckbox:s})}showSimpleConfirmDialogAndRespectAbort(e,t,i,r,s,o){return(0,be.showSimpleConfirmDialog)({title:e,text:Array.isArray(t)?t.join(" "):t,abortSignal:i,mainButtonText:r,mainButtonIntent:"primary",cancelButtonText:s,showDisableConfirmationsCheckbox:o})}setDurations(e){this._adapter.setDurations(e)}setSymbolSearchId(e){this._adapter.setSymbolSearchId(e)}activateBottomWidget(){return null!==this._trading?(console.warn('"activateBottomWidget" is now deprecated. Please use "setAccountManagerVisibilityMode" instead '),this._trading.toggleTradingWidget()):Promise.reject("Activate bottom widget failed: trading is not defined")}getAccountManagerVisibilityMode(){if(null===this._trading)throw new Error("Unable to interact with the account manager: trading is not defined");return this._trading.getAccountManagerVisibilityMode()}setAccountManagerVisibilityMode(e){if(null===this._trading)throw new Error("Unable to interact with the account manager: trading is not defined");this._trading.setAccountManagerVisibilityMode(e)}bottomWidgetMode(){
if(null===this._trading)throw new Error("Unable to provide bottom widget mode: trading is not defined");return this._trading.bottomWidgetBarMode()}trackEvent(e,t,i){null!==this._trading&&this._trading.trackEvent(e,t,i)}defaultFormatter(e,t){return(0,pe.getQuoteSessionInstance)("simple").formatter(e,t)}numericFormatter(e){return Promise.resolve(new ue.NumericFormatter({precision:e}))}quantityFormatter(e){return Promise.resolve(new he.QuantityFormatter(e))}selectBroker(){null!==this._trading&&this._trading.selectBroker(null)}showTradingProperties(){null!==this._trading&&this._trading.showTradingProperties()}async getSymbolTypespecs(e){var t;const i=await Pe(e);return"values"in i?Se(i)||void 0===i.values.typespecs?[]:i.values.typespecs:null!==(t=i.typespecs)&&void 0!==t?t:[]}async getSymbolType(e){var t;const i=await Pe(e);return"values"in i?Se(i)?"undefined":i.values.type:null!==(t=i.type)&&void 0!==t?t:"undefined"}async getSymbolMinTick(e){const t=await Pe(e);return"values"in t?Se(t)||void 0===t.values.minmov||void 0===t.values.pricescale?1:(0,R.Big)(t.values.minmov).div(t.values.pricescale).toNumber():(0,R.Big)(t.minmov).div(t.pricescale).toNumber()}silentOrdersPlacement(){return(0,h.ensureNotNull)(this._trading).noConfirmEnabled}sellBuyButtonsVisibility(){return null!==this._trading&&l.enabled("buy_sell_buttons")?this._trading.showSellBuyButtons:null}domPanelVisibility(){return null!==this._trading?this._trading.domPanelVisibility():null}orderPanelVisibility(){return null!==this._trading?this._trading.orderPanelVisibility():null}showPricesWithZeroVolume(){return(0,h.ensureNotNull)(this._trading).showPricesWith().zeroVolume}showNotification(e,t,i=0){null!==this._trading&&(0===i?this._trading.showErrorNotification(e,t):this._trading.showSuccessNotification(e,t))}async getOrderTicketSetting(e){return(await this._getOrderTicketSettings())[e]}async setOrderTicketSetting(e,t){const i={...await this._getOrderTicketSettings(),[e]:t};(await(0,h.ensureNotNull)(this._trading).findOrCreateOrderViewController()).setOrderTicketSetting(i)}connectionStatusUpdate(e,t){this._adapter.connectionStatusUpdate.fire(e,t),1===e&&this._setDefaultDropdownActions()}orderUpdate(e){this._adapter.onOrderUpdate(e)}positionUpdate(e,t){this._adapter.onPositionUpdate(e,t)}individualPositionUpdate(e,t){this._adapter.onIndividualPositionUpdate(e,t)}executionUpdate(e){this._adapter.executionUpdate.fire(e)}currentAccountUpdate(){this._adapter.onCurrentAccountChanged()}realtimeUpdate(e,t){this._adapter.fireSubscription("Realtime",e,t)}domUpdate(e,t){this._adapter.fireSubscription("DOM",e,t)}pipValueUpdate(e,t){this._adapter.fireSubscription("PipValue",e,t)}setQty(e,t){(0,h.ensureNotNull)(this._trading).getQtySuggester().setQty(e,t)}getQty(e){return(0,h.ensureNotNull)(this._trading).getQtySuggester().getQty(e)}subscribeSuggestedQtyChange(e,t){var i;const r=null!==(i=this._qtyChangedSubscriptions.get(e))&&void 0!==i?i:new Map;if(r.has(t))return;this._qtyChangedSubscriptions.has(e)||this._qtyChangedSubscriptions.set(e,r);const s=(0,
h.ensureNotNull)(this._trading).getQtySuggester().suggestedQtyChanged(e);r.set(t,s.subscribe(t))}unsubscribeSuggestedQtyChange(e,t){const i=this._qtyChangedSubscriptions.get(e);if(void 0===i)return;const r=i.get(t);void 0!==r&&(r.unsubscribe(),i.delete(t),0===i.size&&this._qtyChangedSubscriptions.delete(e))}plUpdate(e,t){this._adapter.fireSubscription("PL",e,t)}individualPositionPLUpdate(e,t){this._adapter.fireSubscription("IndividualPositionPL",e,t)}equityUpdate(e){this._adapter.fireSubscription("Equity","Equity",e)}marginAvailableUpdate(e){this._adapter.fireSubscription("MarginAvailable","MarginAvailable",e)}cryptoBalanceUpdate(e,t){this._adapter.fireSubscription("CryptoBalance",e,t)}setButtonDropdownActions(e){var t;null!==this._trading&&this._defaultDropdownActions&&(this._defaultDropdownActions=!1,null===(t=this.sellBuyButtonsVisibility())||void 0===t||t.unsubscribe(this._setDefaultDropdownActionsBound),(0,h.ensureNotNull)(this.orderPanelVisibility()).unsubscribe(this._setDefaultDropdownActionsBound),(0,h.ensureNotNull)(this.domPanelVisibility()).unsubscribe(this._setDefaultDropdownActionsBound)),this._buttonDropdownActions=e}buttonDropdownActions(){return this._buttonDropdownActions}defaultContextMenuActions(...e){return null!==this._trading?this._trading.defaultContextMenuActions(...e):Promise.resolve([])}defaultDropdownMenuActions(e){return null!==this._trading?this._trading.defaultDropdownMenuActions(e):[]}get factory(){return{createDelegate:()=>new u.Delegate,createWatchedValue:e=>new ce.WatchedValue(e),createPriceFormatter:(e,t,i,r,s)=>new ge.PriceFormatter({priceScale:e,minMove:t,fractional:i,minMove2:r,variableMinTick:s})}}get settings(){return{save:(e,t)=>le().setJSON(`${this._metainfo.id}.${e}`,t),load:(e,t)=>le().getJSON(`${this._metainfo.id}.${e}`,t),clear:(e,t)=>le().remove(`${this._metainfo.id}.${e}`,t)}}get credentialsStorage(){return this._credentialsStorage}convertTimezone(e,t,i){const r=de.get_timezone(t),s=de.get_timezone(i),o=de.cal_to_utc(r,e);return de.utc_to_cal(s,o)}language(){return window.language}getUserSpecificHash(){return window.user.private_channel||""}migrateFXCMCFDSettings(){le().remove("fxcm_cfd")}async isFractional(e){var t;const i=await Pe(e);return"values"in i?!Se(i)&&void 0!==i.values.fractional&&i.values.fractional:null!==(t=i.fractional)&&void 0!==t&&t}_makeServerLoggerWithFilledInfo(e){return{log:t=>e.log({...this._makeServerLoggerEventAdditionalInfo(),...t}),debounceLog:(t,i,r)=>e.debounceLog({...this._makeServerLoggerEventAdditionalInfo(),...t},i,r)}}_makeServerLoggerEventAdditionalInfo(){return{accountType:this._adapter.currentAccountType(),brokerId:this._adapter.metainfo().id,sessionId:this._adapter.sessionId(),deviceId:getDeviceId(),ref:location.href,online:navigator.onLine,platform:getPlatform()}}_setDefaultDropdownActions(){null!==this._trading&&this._defaultDropdownActions&&(this._buttonDropdownActions=this.defaultDropdownMenuActions())}async _getOrderTicketSettings(){return(await(0,
h.ensureNotNull)(this._trading).findOrCreateOrderViewController()).orderTicketSettings()}}var we=i(17317);const Be=(0,g.getLogger)("Trading.EncryptedWebStorage");class Te{constructor({prefix:e,storageName:t,storage:i,cryptographer:r}){this._transientStorage={},this._handleStorageStateChange=e=>{const{key:t,storageArea:i}=e;i===this._persistentStorage&&this._storageName===t&&this._decryptStorage()},this._storageName=t,this._prefix=null==e?void 0:e.toLowerCase(),this._persistentStorage=i,this._cryptographer=r,this._decryptStorage=(0,we.sequentialize)(this._decryptStorage),window.addEventListener("storage",this._handleStorageStateChange)}async setItem(e,t){const i=this._addPrefix(e);this._transientStorage[i]=JSON.stringify(t);try{await this._encryptStorageAndSave()}catch(e){Be.logError(`Unable to save value using key ${i}: ${(0,k.getLoggerMessage)(e)}`)}}getItem(e,t=null){const i=this._transientStorage[this._addPrefix(e)];if(void 0===i)return t;if("string"!=typeof i)return i;try{return JSON.parse(i)}catch(e){return i}}async removeItem(e){delete this._transientStorage[this._addPrefix(e)],await this._encryptStorageAndSave()}destroy(){window.removeEventListener("storage",this._handleStorageStateChange)}static async create(e,t,i,r){const s=new Te({prefix:e,storageName:t,storage:i,cryptographer:r});return await s._decryptStorage(),s}_addPrefix(e){return void 0!==this._prefix?`${this._prefix}.${e}`:e}async _decryptStorage(){const e=this._persistentStorage.getItem(this._storageName);if(null===e)return void(this._transientStorage={});const t=await this._cryptographer.decrypt(e);if(null===t)return this._persistentStorage.removeItem(this._storageName),void(this._transientStorage={});try{this._transientStorage=JSON.parse(t)}catch(e){this._transientStorage={}}}async _encryptStorageAndSave(){const e=await this._cryptographer.encrypt(JSON.stringify(this._transientStorage));this._persistentStorage.setItem(this._storageName,e)}}const Ee="credentials-storage";class Oe{constructor(e,t,i){this._rememberCredentials=e,this._encryptedLocalStorage=t,this._encryptedSessionStorage=i}async save(e,t){this._currentEncryptedStorage().setItem(e,t)}load(e,t){return this._currentEncryptedStorage().getItem(e,t)}async clear(e){this._currentEncryptedStorage().removeItem(e)}destroy(){this._encryptedLocalStorage.destroy(),this._encryptedSessionStorage.destroy()}static async create(e,t,i){const r=await Te.create(e,Ee,localStorage,i),s=await Te.create(e,Ee,sessionStorage,i);return new Oe(t,r,s)}_currentEncryptedStorage(){return this._rememberCredentials.value()?this._encryptedLocalStorage:this._encryptedSessionStorage}}var De=i(203953);const Ie={isSuspended:!1,supportDemoLiveSwitcher:!0,supportModifyOrderPrice:!0,supportEditAmount:!0,supportModifyBrackets:!0,supportMarketBrackets:!0,supportMarketOrders:!0,supportStopOrders:!0,supportLimitOrders:!0,supportLeverageButton:!0,supportStopLimitOrders:!1,supportPositions:!0,supportDOM:!0,supportModifyTrailingStop:!0,supportAddBracketsToExistingOrder:!0,supportVerifyLiveAccount:!0,supportReversePosition:!0,
showNotificationsLog:!0,supportPLUpdate:!0,supportTwoFactorAuthorization:!1,supportDisplayBrokerNameInSymbolSearch:!0,supportCurrencyInOrderPreview:!0,supportRiskControlsAndInfo:!0,supportCreateAccount:!1,supportDeleteAccount:!1,checkBracketsAfterOrderModification:!0,supportStrictCheckingLimitOrderPrice:!1,supportOrdersHistory:!1,supportOrderBrackets:!1,supportPositionBrackets:!1,supportMultiposition:!1,supportClosePosition:!1,supportPartialClosePosition:!1,supportNativeReversePosition:!1,supportTrailingStop:!1,supportStopOrdersInBothDirections:!1,supportStopLimitOrdersInBothDirections:!1,supportModifyDuration:!1,supportCryptoExchangeOrderTicket:!1,supportPlaceOrderPreview:!1,supportModifyOrderPreview:!1,showQuantityInsteadOfAmount:!1,supportBalances:!1,supportExecutions:!1,supportLeverage:!1,supportLevel2Data:!1,supportTrackLatency:!1,supportPositionNetting:!1,supportIndividualPositionBrackets:!1,supportPartialCloseIndividualPosition:!1,supportGuaranteedStop:!1,supportPartialOrderExecution:!1,supportDigitalSignature:!1,supportLogout:!1,supportCustomAccountSummaryRow:!1,supportPositionCustomFields:!1,supportOrderCustomFields:!1,supportOrderHistoryCustomFields:!1,supportCryptoBrackets:!1,supportCloseIndividualPosition:!1,supportSymbolSearch:!1,supportMargin:!1,calculatePLUsingLast:!1,closePositionCancelsOrders:!1,supportOnlyPairPositionBrackets:!1,supportConfirmations:!1,positionPLInInstrumentCurrency:!1,supportCancellingBothBracketsOnly:!1,supportUnformattedAvgFillPrice:!1,forceLogoutAfterUnauthorizedResponse:!1,forceLogoutAfterTooManyRequestsResponse:!1,useJsonContentType:!1};class xe{constructor(e,t){this._settingsKey=`trading.${e}.rememberCredentials`,this._trackEvent=t;const i=le().getBool(this._settingsKey);void 0!==i&&(localStorage.setItem(this._settingsKey,JSON.stringify(i)),le().remove(this._settingsKey))}value(){const e=localStorage.getItem(this._settingsKey);return null===e||Boolean(JSON.parse(e))}setValue(e){var t;null===(t=this._trackEvent)||void 0===t||t.call(this,"Don't remember me",String(!e)),localStorage.setItem(this._settingsKey,JSON.stringify(e))}}const Me=[];function Ne(e,t){var i;e.configFlags=(i=e.configFlags,Object.assign({},Ie,i)),Me.push({metainfo:e,createBrokerFunction:t})}function Ae(){return Me.map((e=>e.metainfo))}let Le;async function Ve(e,t,i,r,s){const o=Me.filter((e=>e.metainfo.id===t))[0];let n;if(null===r){const i=await Oe.create(t,new xe(t),Le),r=s=>{(null==s?void 0:s.metainfo().id)!==t&&(null==e||e.onBrokerChange.unsubscribe(null,r),i.destroy())};null==e||e.onBrokerChange.subscribe(null,r),n=i}else n=r;const a=new Ce(e,o.metainfo,i,n);try{const t=await o.createBrokerFunction(a,null==e?void 0:e.brokerTelemetry),i=new De.BrokerRealtimeAdapter(o.metainfo.id);return new ne({brokerMetainfo:o.metainfo,brokerConnection:t,host:a,brokerRealtimeAdapter:i,tradingStat:e&&e.tradingStat(),tradingSettingsStorageGetter:e&&e.getBrokerTradingSettingsStorage,brokerPlan:s})}catch(e){return Promise.reject(`${t} broker creation error: ${(0,k.getLoggerMessage)(e)}`)}}function Re(e){
return Ae().filter((t=>t.id===e))[0]}Le={encrypt:async e=>e,decrypt:async e=>e}},804748:(e,t,i)=>{"use strict";i.d(t,{DialogVisibility:()=>o});var r=i(947488),s=i(218286);class o{constructor(){this._value$=new r.BehaviorSubject({isVisible:!1}),this.value$=this._value$.asObservable().pipe((0,s.distinctUntilChanged)(((e,t)=>e.isVisible===t.isVisible&&e.isFullScreen===t.isFullScreen)))}getValue(){return this._value$.getValue()}setValue(e){this._value$.next(e)}}},188412:(e,t,i)=>{"use strict";i.d(t,{DisabledConfirmations:()=>u});var r=i(870122),s=i.n(r),o=i(855385),n=i.n(o),a=i(148296);const l=/[0-9]+([\.,][0-9]+)*([\.,][0-9]+)?|\.[0-9]+/gm,c=/[A-Z]+/gm,d=a.settingsKeys.DISABLED_CONFIRMATIONS;class u{add(e){const t=this._getAll(),i=this._makeMessageHash(e);t.add(i),s().setJSON(d,Array.from(t))}has(e){const t=this._getAll(),i=this._makeMessageHash(e);return t.has(i)}clear(){s().remove(d)}_getAll(){return new Set(s().getJSON(d))}_makeMessageHash(e){const t=e.replace(l,"").replace(c,"");return i=n()(t),btoa(String.fromCharCode.apply(null,new Uint8Array(i)));var i}}},641116:(e,t,i)=>{"use strict";function r(e){return"string"==typeof e?e:Array.isArray(e)?e.join(""):void 0}i.d(t,{makeConfirmation:()=>r})},537008:(e,t,i)=>{"use strict";i.d(t,{showConfirmDialog:()=>a});var r=i(609838),s=i(641116),o=i(188412),n=i(61121);async function a(e){const{title:t,content:a,mainButtonText:l,cancelButtonText:c,showDisableConfirmationsCheckbox:d,onOpen:u,onClose:h,abortSignal:p}=e,g=new o.DisabledConfirmations,m=(0,s.makeConfirmation)(a);if(d&&void 0!==m&&g.has(m))return!0;const{ConfirmDialogRenderer:_}=await Promise.all([i.e(5735),i.e(6625),i.e(4392),i.e(6665),i.e(8722),i.e(7092),i.e(8548),i.e(2691),i.e(3566)]).then(i.bind(i,852070)),b=new _(g),v={title:t,message:a,closeButton:null!=c?c:r.t(null,void 0,i(38733)),confirmButton:null!=l?l:r.t(null,void 0,i(955512)),showDisableConfirmationsCheckbox:d,onOpen:u,onClose:h,abortSignal:p};try{return(await b.open(v)).status}catch(e){if((0,n.isAbortError)(e))return!1;throw e}}},220858:(e,t,i)=>{"use strict";i.d(t,{showSimpleConfirmDialog:()=>o});var r=i(61121),s=i(188412);async function o(e){const{showDisableConfirmationsCheckbox:t,text:o,onConfirm:n,onClose:a,onCancel:l,abortSignal:c}=e,d=new s.DisabledConfirmations;if(t&&d.has(o))return Promise.resolve(!0);if(null==c?void 0:c.aborted)return Promise.resolve(!1);const[{showSimpleDialog:u},{SimpleConfirmDialog:h}]=await Promise.all([Promise.all([i.e(5735),i.e(6625),i.e(4392),i.e(6665),i.e(8722),i.e(7092),i.e(8548),i.e(2691),i.e(3566)]).then(i.bind(i,480994)),Promise.all([i.e(5735),i.e(6625),i.e(4392),i.e(6665),i.e(8722),i.e(7092),i.e(8548),i.e(2691),i.e(3566)]).then(i.bind(i,714062))]);return new Promise(((t,i)=>{if(null==c?void 0:c.aborted)return void i((0,r.createAbortError)());const s=u({...e,disabledConfirmations:d,onConfirm:e=>{t(!0),void 0!==n&&n(),e.dialogClose()},onClose:()=>{t(!1),void 0!==a&&a()},onCancel:e=>{t(!1),void 0!==l&&l(e),e.dialogClose()}},h);null==c||c.addEventListener("abort",(()=>{s(),i((0,r.createAbortError)())}),{once:!0})}))}},
605962:(e,t,i)=>{"use strict";i.d(t,{ConfirmBracketsCancelDialog:()=>o});var r=i(609838),s=i(220858);const o={get(){return this},open:(e,t)=>(0,s.showSimpleConfirmDialog)({title:r.t(null,void 0,i(937129)),text:r.t(null,void 0,i(970322)).replace("{orderId}",""!==e?e+" ":""),mainButtonIntent:"primary",abortSignal:t}),multiple:(e,t)=>(0,s.showSimpleConfirmDialog)({title:r.t(null,void 0,i(937129)),text:r.t(null,void 0,i(569850)).replace("{orderId}",""!==e?e+" ":""),mainButtonIntent:"primary",abortSignal:t})}},151121:(e,t,i)=>{"use strict";i.d(t,{ConfirmOrderCancelDialog:()=>n});i(68212);var r=i(609838),s=i(220858),o=i(391431);const n={get(){return this},open:(e,t)=>(0,s.showSimpleConfirmDialog)({title:r.t(null,void 0,i(719634)),text:r.t(null,void 0,i(223615)).replace("{orderId}",e),mainButtonIntent:"primary",abortSignal:t}),multiple(e,t,n,a){let l=(0,o.getSymbolNameOverFullname)(e);if(void 0!==t){l=`${l} ${1===t?r.t(null,void 0,i(846369)):r.t(null,void 0,i(424426))}`}return(0,s.showSimpleConfirmDialog)({title:r.t(null,void 0,i(719634)),text:r.t(null,void 0,i(333739)).replace("{qty}",String(n)).replace("{side}",l),mainButtonIntent:"primary",abortSignal:a})}}},646323:(e,t,i)=>{"use strict";i.d(t,{reversePositionDialog:()=>n});var r=i(609838),s=i(220858),o=i(391431);async function n(e){const{positionId:t,showErrorNotification:n,handler:a,closePositionCancelsOrders:l,abortSignal:c}=e,d=(0,o.getSymbolNameOverFullname)(t);if(!await(0,s.showSimpleConfirmDialog)({title:r.t(null,void 0,i(178170)).replace("{positionId}",d),text:r.t(null,void 0,i(431110)).replace("{positionId}",d)+(l?" "+r.t(null,void 0,i(352355)):""),mainButtonText:r.t(null,void 0,i(360196)),mainButtonIntent:"primary",cancelButtonText:r.t(null,void 0,i(904543)),showBackdrop:!0,abortSignal:c}))return!1;try{return await a()}catch(e){return n(r.t(null,void 0,i(628412)),function(e){let t="";null!==e&&"object"==typeof e&&e.message?t=e.message:"string"==typeof e&&(t=e);return t}(e)),!1}}},97518:(e,t,i)=>{"use strict";i.d(t,{HeaderContainer:()=>K,mountHeader:()=>Z,unmountHeader:()=>J});var r,s=i(50959),o=i(632227),n=i(32133),a=i(72571),l=i(661851),c=i(609838),d=i(930052),u=i(679458),h=i(511349),p=i(996038),g=i(497754),m=i.n(g),_=i(671129),b=i(650733),v=i(403933),y=i(162458),f=i(662605),k=i(512646),P=i(552828),S=i(586619);!function(e){e[e.Delayed=0]="Delayed",e[e.DelayedWithOffer=1]="DelayedWithOffer",e[e.Bats=2]="Bats"}(r||(r={}));const C=c.t(null,void 0,i(28117)),w=c.t(null,void 0,i(668510)),B=c.t(null,void 0,i(295271)),T={0:k,1:k,2:P},E={0:S.delayedDataIcon,1:S.delayedDataIcon,2:S.batsQuotesIcon},O={0:S.delayedDataTitleColor,1:S.delayedDataTitleColor,2:S.batsQuotesTitleColor};function D(e){const{statusType:t,symbol:i,onClick:r}=e;return s.createElement(s.Fragment,null)}function I(){return s.createElement(s.Fragment,null,C)}function x(e){const{symbol:t}=e,i=useIsRealTimeAvailable(t)?w:B;return s.createElement(s.Fragment,null,i)}function M(e){
const{symbol:t}=e,[i,r]=t.split(":"),o=b.batsToRealtimeHtml1.replace("{symbolName}",r).replace("{exchange}",b.notAccurateCboeTooltip),n=b.batsToRealtimeHtml2WithExchange.replace("{exchange}",i);return s.createElement(s.Fragment,null,`${o} ${n}`)}function N(e){const{statusType:t,symbol:i}=e;switch(t){case 0:return s.createElement(I,null);case 1:return s.createElement(x,{symbol:i});case 2:return s.createElement(M,{symbol:i});default:return s.createElement(s.Fragment,null)}}function A(e){return s.createElement("span",{className:S.text},s.createElement(N,{...e}))}function L(e){const{statusType:t,symbol:r}=e;if(!r)return s.createElement(s.Fragment,null);const o=(0,s.useRef)(null),n=(0,_.useMatchMedia)(v.TradingLayoutBreakpoint.Mobile),l=function(e,t){switch(e){case 0:case 1:return c.t(null,void 0,i(759158));case 2:{const[e]=t.split(":");return(0,f.htmlEscape)(b.exchangeByOriginalExchangeTooltip).format({exchange:e,originalExchange:b.notAccurateCboeTooltip})}default:return""}}(t,r);return s.createElement(u.ToolWidgetMenu,{ref:o,arrow:!1,content:s.createElement(a.Icon,{icon:T[t]}),className:m()(S.icon,S.button,E[t]),title:l,isDrawer:n,horizontalAttachEdge:y.HorizontalAttachEdge.Right,horizontalDropDirection:y.HorizontalDropDirection.FromRightToLeft,onClick:e=>{e.stopPropagation()}},s.createElement("div",{className:S.wrapper},s.createElement(a.Icon,{icon:T[t],className:m()(S.icon,E[t])}),s.createElement("div",{className:S.infoContainer},s.createElement("span",{className:S.title,style:{color:O[t]}},l),s.createElement(A,{statusType:t,symbol:r}),s.createElement(D,{statusType:t,symbol:r,onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.close()}}))))}var V=i(363111),R=i(763281),F=i(643959),W=i(513729),q=i(29834),U=i(137456);function z(e){const{settingsItems:t,title:r,description:o,symbol:n,hasDelayedWarning:l,hasBatsQuotes:g,informerMessage:m,brokerId:_,back:b,close:v,orderPresets:y,isTradable:f}=e;let k;l&&(k={statusType:"Paper"===_?1:0,symbol:n}),g&&(k={statusType:2,symbol:n});const P=(0,s.useContext)(R.WidgetContext).mode===V.OrderEditorDisplayMode.Popup?{"data-dragg-area":!0}:{};return s.createElement("div",{className:U.header},void 0!==b&&s.createElement(h.ToolWidgetIconButton,{title:c.t(null,void 0,i(139403)),onClick:b,className:U.button,"data-name":"button-back",icon:F}),s.createElement("div",{className:U.wrapper,...P},s.createElement("span",{className:U.text},r,o&&`, ${o}`),(void 0!==m||void 0!==k)&&s.createElement("div",{className:U.statusLine},void 0!==m&&s.createElement(TradingInformer,{informerMessage:m}),void 0!==k&&s.createElement(L,{...k}))),void 0!==y&&f&&s.createElement(OrderPresetsMenu,{presets:y,onPresetSave:()=>{}}),0!==s.Children.count(t)&&s.createElement(d.MatchMedia,{rule:p.DialogBreakpoints.TabletSmall},(e=>s.createElement(u.ToolWidgetMenu,{className:U.settingsButton,content:s.createElement(a.Icon,{icon:q}),menuClassName:U.settingsPopupMenu,children:t,isDrawer:e,title:c.t(null,void 0,i(232514)),arrow:!1,closeOnClickOutside:!0,"data-name":"order-ticket-settings"
}))),void 0!==v&&s.createElement(h.ToolWidgetIconButton,{title:c.t(null,{context:"action"},i(433334)),onClick:v,className:U.button,"data-name":"button-close",icon:W}))}var $=i(379266),Q=i(192063),H=i(527500);function j(e){const{label:t,value$:i,dataName:r,onClick:o}=e,n=(0,l.useObservable)(i);return s.createElement($.PopupMenuItemToggle,{"data-name":r,labelClassName:H.checkBoxWrapper,label:t,isChecked:!!n,onClick:o})}function G(e){const{onIcon:t,offIcon:i,onLabel:r,offLabel:o,value$:n,dataName:c,onClick:d}=e,u=(0,l.useObservable)(n);return s.createElement(Q.PopupMenuItem,{onClick:d,"data-name":c,label:s.createElement("div",{className:H.toggleContentWrapper},s.createElement(a.Icon,{icon:u?t:i}),s.createElement("span",null,u?r:o))})}function K(e){const{title$:t,description$:i,backFunction$:r,closeFunction$:o,informerMessage$:a,symbol$:c,hasBatsQuotes$:d,hasDelayedQuotes$:u,isTradable$:h,settings$:p,brokerId$:g,orderPresets$:m}=e,_=(0,l.useObservable)(t),b=(0,l.useObservable)(i),v=(0,l.useObservable)(r),y=(0,l.useObservable)(o),f=(0,l.useObservable)(c),k=(0,l.useObservable)(d),P=(0,l.useObservable)(u),S=(0,l.useObservable)(h),C=((0,l.useObservable)(a),(0,l.useObservable)(g)),w=(0,l.useObservable)(m),B=(0,l.useObservable)(p),T=(0,s.useMemo)((()=>void 0!==B&&S?B.map((e=>0===e.settingType?s.createElement(j,{key:e.label,...e}):s.createElement(G,{key:e.onLabel,...e}))):null),[B,S]),E=(0,s.useMemo)((()=>void 0!==y?()=>{(0,n.trackEvent)("GUI","Close Order Panel from panel"),y()}:void 0),[y]);return s.createElement(z,{title:_||"",description:b,symbol:null!=f?f:"",settingsItems:T,brokerId:C,hasDelayedWarning:P,hasBatsQuotes:k,isTradable:S,informerMessage:void 0,back:v,close:E,orderPresets:w})}function Z(e,t){o.render(s.createElement(K,{...t}),e)}function J(e){o.unmountComponentAtNode(e)}},416570:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TradingNotificationsHandler:()=>b});var r,s=i(609838),o=i(12481),n=i(650151),a=(i(68212),i(642659)),l=i(440891),c=i(229753),d=i(70870),u=i(621575),h=i(391431);!function(e){e[e.Placed=0]="Placed",e[e.Cancelled=1]="Cancelled",e[e.Rejected=2]="Rejected",e[e.PartiallyExecuted=3]="PartiallyExecuted",e[e.Modified=4]="Modified",e[e.Executed=5]="Executed"}(r||(r={}));const p=["qty","stopPrice","limitPrice","status","filledQty","stopType"];function g(e,t,i){if(void 0===e||void 0===t)return!1;const r=i.indexOf(".");if(-1!==r){const s=i.substring(0,r);return g(e[s],t[s],i.substring(r+1))}return e[i]===t[i]}function m(e,t){return e.enabled.value()&&(t.soundPath=e.path.value()),t}function _(e){return 6===e||3===e}class b extends a.BrokerService{constructor(e){super(e),this._orders=[],this._playSound=(0,o.default)(this._playSoundImpl,50),d.enableAlertSoundsForMobile()}startService(){const e=(0,n.ensure)(this.activeBroker());e.orders().then((e=>this._orders=(0,c.deepCopy)(e))),e.orderUpdate.subscribe(this,this._orderUpdate),this._shouldHidePriceInOrderExecutedNotifications=e.metainfo().configFlags.showAvgFillPriceColumnAsLastFillPrice}stopService(){(0,
n.ensure)(this.activeBroker()).orderUpdate.unsubscribe(this,this._orderUpdate)}_showNotification(e,t,i){l.enabled("trading_notifications")&&("error"===i?this.trading().showErrorNotification(e,t):this.trading().showSuccessNotification(e,t))}_formatter(e){return(0,n.ensureNotNull)(this.activeBroker()).formatter(e,!0)}_checkOrderModified(e,t){const i=this.activeBroker(),r=i&&i.metainfo().customNotificationFields||[],s=p.concat(r);let o=!1;return s.forEach((i=>{o||g(e,t,i)||(o=!0)})),o}_generateNotificationsInfo(e,t){const r=[],o=e.statusMessage?": "+e.statusMessage:"",n=(1===e.side?s.t(null,void 0,i(103051)):s.t(null,void 0,i(627093))).toUpperCase();const a=this.trading().orderExecutedSoundParams;return t?(this._checkOrderModified(e,t)&&(1===e.status?r.push({text:s.t(null,void 0,i(542451)),notificationType:1}):5===e.status?r.push({text:s.t(null,void 0,i(218136))+o,type:"error",notificationType:2}):2===e.status?r.push(m(a,{side:n,text:s.t(null,void 0,i(749720)),notificationType:5})):t.filledQty!==e.filledQty?r.push(m(a,{side:n,text:s.t(null,void 0,i(61143)),notificationType:3})):_(e.status)&&r.push({text:s.t(null,void 0,i(163889)),notificationType:4})),Object.assign(t,e)):_(e.status)?(this._orders.push(e),r.push({text:s.t(null,void 0,i(20705)),notificationType:0}),this.trading().trackEvent("","Order placed symbol",e.symbol)):1===e.status?r.push({text:s.t(null,void 0,i(542451)),notificationType:1}):5===e.status?(this._orders.push(e),r.push({text:s.t(null,void 0,i(218136))+o,type:"error",notificationType:2})):2===e.status&&(this._orders.push(e),r.push({text:s.t(null,void 0,i(20705)),notificationType:0},m(a,{side:n,text:s.t(null,void 0,i(749720)),emptyOrderType:!0,notificationType:5})),this.trading().trackEvent("","Order placed symbol",e.symbol)),r}_orderUpdate(e,t){const r=(0,c.deepCopy)(e),o=this._orders.find((e=>e.id===r.id));if(t)return void(void 0===o&&this._orders.push(r));if(o&&(0,u.isFinalOrderStatus)(o.status))return;const n=this._generateNotificationsInfo(r,o);0!==n.length&&this._formatter(r.symbol).then((e=>{const t=(0,u.sideToText)(r.side,!0),o=r.qty,a=void 0!==r.filledQty&&r.filledQty>0?r.filledQty:void 0;let l="",c="";switch(r.type){case 2:l=r.avgPrice?" ("+(0,u.orderTypeToText)({orderType:r.type})+")":"",c=r.avgPrice?e.format(r.avgPrice):(0,u.orderTypeToText)({orderType:r.type});break;case 4:l=" "+s.t(null,void 0,i(968681)).format({price:e.format(r.stopPrice)}),c=e.format(r.avgPrice||r.limitPrice);break;default:l=" ("+(0,u.orderTypeToText)({orderType:r.type})+")",c=e.format(r.avgPrice||r.limitPrice||r.stopPrice)}const d=void 0!==r.message?`${r.message.text.charAt(0).toUpperCase()}${r.message.text.substring(1)}`:"";n.forEach((({text:e,type:n,side:u,emptyOrderType:h,soundPath:p,notificationType:g})=>{const m=3===g&&void 0!==a?a:o;let _=Math.abs(m)+" "+this._getCurrentSymbolName(r);(!this._shouldHidePriceInOrderExecutedNotifications||5!==g&&3!==g)&&(_+=" "+s.t(null,void 0,i(137673))+" "+c);const b=`${s.t(null,void 0,i(512686))} ${r.id} ${e}`,v=`${u||t} ${_} ${h?"":l}\n${d}`;void 0!==p&&this._playSound(p),
this._showNotification(b,v,n)}))}))}_getCurrentSymbolName(e){const t=e.brokerSymbol||e.symbol;return(0,h.getSymbolNameOverFullname)(t)}_playSoundImpl(e){if(this._playingSound){if(this._playingSound===e)return;d.stop(this._playingSound)}this._playingSound=e,d.play(e),d.onStopped(e,(()=>{delete this._playingSound}))}}},567704:(e,t,i)=>{"use strict";i.d(t,{alignQuotesToMinTick:()=>B,calculatePipValue:()=>f,calculateUsedMargin:()=>k,calculatedMarginRatio:()=>P,checkPriceByOrderType:()=>T,comparator:()=>b,convertToBaseMonetaryUnit:()=>D,displayedLeverage:()=>y,formatInfoValue:()=>S,formatRiskReward:()=>w,makeSubjectFromWatchedValue:()=>_,prepareCalculatorEventText:()=>E,prepareTradableSolution:()=>O,shouldShowTotal:()=>v});var r=i(609838),s=i(688401),o=i(947488),n=i(960521),a=i(41899),l=i(391431),c=i(251940),d=i(600297),u=i(14654),h=i(341086),p=i(50771),g=i(848062),m=i(863582);function _(e){const t=new o.BehaviorSubject(e.value()),i=e=>{t.next(e)};return e.subscribe(i),{subject:t,unsubscribe:()=>e.unsubscribe(i)}}function b(e,t){return(0,a.deepEquals)(e,t)[0]}function v(e){return void 0!==e&&Boolean(e.showTotal)}function y(e,t){if(void 0!==e)return e;if(void 0!==t){const e=Math.round(1/t);return String(e)+":1"}return null}function f(e,t,i){return null!==e?(void 0!==i?e*i:e)*t:0}function k(e,t){return void 0!==t?e*t:0}function P(e,t){const i=0!==t?100*e/t:0;return i>100?100:i}function S(e){const t=(0,h.numberFormattersParsersChain)({chain:[(0,p.prohibitNanOnParseStep)(),(0,g.fixedNumberMagnitudeStep)({decimalPlaces:2}),(0,m.signumStep)({negativeSign:m.longMinusSign})]});return Number.isInteger(e)||e>=1?t.format(e):function(e){if(Number.isInteger(e))return e+"";return e<1?function(e){const t=(e+"").split(".")[1]||"";let i=t.length;for(let e=0;e<t.length;e++)if("0"!==t[e]){i=e+1;break}return e.toFixed(i)}(e):e.toFixed(2)}(e)}const C=(0,c.getVolumeFormatter)(2);function w(e,t){return null!==e&&null!==t&&e/t>0?C.format(e/t):""}function B(e,t,i){const r=Object.assign({},e);return["trade","ask","bid"].forEach((e=>{const s=r[e];if(void 0!==s){const o=(0,u.getMinTick)({minTick:t,price:s,variableMinTickData:i});r[e]=(0,l.alignToMinTick)(s,o)}})),r}function T(e,t,i){return 4===e?null===t||null===i:3===e?null===i:null===t}function E(e,t){switch(t){case d.ButtonType.IncDec:return e<0?"-":"+";case d.ButtonType.PlusValue:return String(e);case d.ButtonType.Clear:return"Clear";default:return"Default"}}async function O(e,t){if(void 0!==e.solutions){if("changeSymbol"in e.solutions){const t=e.solutions.changeSymbol;return{title:r.t(null,void 0,i(531410)),apply:()=>s.linking.setSymbolAndLogInitiator(t,"order ticket")}}if("changeAccount"in e.solutions){const s=e.solutions.changeAccount,o=(await t.accountsMetainfo()).filter((e=>e.id===s))[0].name;return{title:r.t(null,void 0,i(704707)).replace("{accountName}",o),apply:()=>t.setCurrentAccount(s)}}if("openUrl"in e.solutions){const t=e.solutions.openUrl.url;return{title:e.solutions.openUrl.text,apply:()=>window.open(t,"_blank")}}}}function D(e,t){return void 0===t?e:(0,n.Big)(e).div(t).toNumber()}
},145367:(e,t,i)=>{"use strict";var r,s;function o(e){return(null==e?void 0:e.type)===s.PlaceOrder}i.d(t,{PlaceOrEditContextStatus:()=>r,PlaceOrEditContextType:()=>s,isContextPlaceOrderContext:()=>o}),function(e){e[e.Undefined=0]="Undefined",e[e.Loading=1]="Loading",e[e.Error=2]="Error",e[e.Destroyed=3]="Destroyed"}(r||(r={})),function(e){e[e.PlaceOrder=0]="PlaceOrder",e[e.EditOrder=1]="EditOrder",e[e.EditPosition=2]="EditPosition",e[e.EditIndividualPosition=3]="EditIndividualPosition"}(s||(s={}))},470692:(e,t,i)=>{"use strict";i.d(t,{OrdersService:()=>g,cropOrderData:()=>p,getOrderPriceByType:()=>h,isBracketOrderRawData:()=>u});var r=i(650151),s=i(329452),o=i(41899),n=i(937778),a=i(642659),l=i(391431),c=i(735248);const d=(0,n.getLogger)("Trading.OrderService");function u(e){return"parentId"in e&&void 0!==e.parentId&&"parentType"in e&&void 0!==e.parentType}function h(e){let t;return 1===e.type&&(t=e.limitPrice),3!==e.type&&4!==e.type||(t=e.stopPrice),null!=t?t:NaN}function p(e){return{id:e.id,parentId:e.parentId,parentType:e.parentType,symbol:e.symbol,type:e.type,side:e.side,avgPrice:e.avgPrice,limitPrice:e.limitPrice,stopPrice:e.stopPrice,price:e.price,stopLoss:e.stopLoss,trailingStopPips:e.trailingStopPips,stopType:e.stopType,takeProfit:e.takeProfit,status:e.status,qty:e.qty}}class g extends a.BrokerService{constructor(){super(...arguments),this._existingOrdersIds=new Set,this._activeOrders=new Map,this._activeOrderUpdate=new s.Delegate,this._activeOrdersRemoved=new s.Delegate,this._ordersRejected=new s.Delegate}destroy(){this.stopService()}async getCurrency(){const e=(0,r.ensureNotNull)(this.activeBroker()),t=await e.accountMetainfo();return(0,l.getCurrency)(t,!0)||"USD"}orders(){return(0,r.ensureNotNull)(this.activeBroker()).orders()}find(e){return this._activeOrders.get(e)||null}activeOrders(){return Array.from(this._activeOrders.values())}activeOrdersUpdated(){return this._activeOrderUpdate}activeOrdersRemoved(){return this._activeOrdersRemoved}orderRejected(){return this._ordersRejected}stopService(){this._clearOrders();(0,r.ensureNotNull)(this.activeBroker()).orderUpdate.unsubscribeAll(this)}startService(){this._clearOrders(),this._requestOrders()}_clearOrders(){const e=Array.from(this._activeOrders.keys());this._activeOrders.clear(),this._existingOrdersIds.clear(),e.length>0&&d.logNormal(`All orders removed, id's: ${e}`),this._activeOrdersRemoved.fire(e)}async _requestOrders(){const e=this.activeBroker();if(!e)return;const t=await e.orders();for(const e of t)this._addActiveOrder(e);e.orderUpdate.unsubscribeAll(this),e.orderUpdate.subscribe(this,this._addActiveOrder)}_addActiveOrder(e){this._logOrderUpdate(e);const t=e.id,i=this._activeOrders.has(t),r=5===e.status,s=6!==e.status&&3!==e.status,n=2===e.type;if(i){if(s||n)return this._activeOrders.delete(t),void this._activeOrdersRemoved.fire([t])}else{if(n||s&&!r)return;if(r)return void this._ordersRejected.fire(h(e))}const a=this._getOrderData(e);(0,o.isNumber)(a.price)&&(this._activeOrders.set(t,a),this._activeOrderUpdate.fire(a))}_logOrderUpdate(e){
const t=e.id;let i="update";this._existingOrdersIds.has(t)||(i="add",this._existingOrdersIds.add(t)),function(e,t){t(JSON.stringify(p(e)))}(e,(e=>{d.logNormal(`Order ${i}: ${e}`)}))}_getOrderData(e){const t=h(e);(0,o.isNumber)(t)||d.logError(`order ${e.id} price is not defined`);const i=(0,r.ensureNotNull)(this.activeBroker()).metainfo().configFlags;return(0,o.merge)((0,o.clone)(e),{price:t,considerFilledQty:!0,supportModify:(0,l.isModifyOrderSupported)(e,i),supportMove:(0,l.isMoveOrderSupported)(e,i),supportCancel:!0,supportModifyOrderPrice:Boolean(i.supportModifyOrderPrice),supportTrailingStop:(0,c.checkTrailingStopAvailability)(i),supportGuaranteedStop:(0,c.checkGuaranteedStopAvailability)(i)})}}},936145:(e,t,i)=>{"use strict";i.d(t,{PositionsService:()=>p,PositionsUpdateType:()=>u,cropPositionData:()=>h});var r=i(650151),s=i(329452),o=i(41899),n=i(937778),a=i(642659),l=i(735248);const c=(0,n.getLogger)("Trading.PositionService");var d,u;function h(e){const t=e;return{id:t.id,symbol:t.symbol,side:t.side,avgPrice:t.avgPrice,pl:t.pl,price:t.price,qtyBySide:t.qtyBySide,stopType:t.stopType,takeProfit:t.takeProfit,stopLoss:t.stopLoss,trailingStopPips:t.trailingStopPips}}!function(e){e[e.IndividualPosition=0]="IndividualPosition",e[e.Position=1]="Position"}(d||(d={})),function(e){e[e.Full=0]="Full",e[e.Partial=1]="Partial"}(u||(u={}));class p extends a.BrokerService{constructor(){super(...arguments),this._existingPositionIds=new Set,this._positions=new Map,this._positionUpdate=new s.Delegate,this._positionsRemoved=new s.Delegate,this._displayMode=1,this._updatePositionPLHandler=this._updatePositionPL.bind(this)}destroy(){this.stopService()}positions(){return Array.from(this._positions.values())}find(e){return this._positions.get(e)||null}async realIdFromBroker(e){const t=(0,r.ensureNotNull)(this.activeBroker());if(1===this._displayMode){const i=await t.positionById(e);if(void 0!==i)return i.id}else{const i=await t.individualPositionById(e);if(void 0!==i)return i.id}return null}positionUpdate(){return this._positionUpdate}positionsRemoved(){return this._positionsRemoved}isDisplayModeIndividualPositions(){return 0===this._displayMode}async getCurrency(e){return await(0,r.ensureNotNull)(this.activeBroker()).getPositionCurrency(e)||""}supportBrackets(e){return Boolean(this.isDisplayModeIndividualPositions()?e.supportIndividualPositionBrackets:e.supportPositionBrackets)}supportReverse(e){return Boolean(!this.isDisplayModeIndividualPositions()&&e.supportReversePosition)}stopService(){this._clearPositions();const e=(0,r.ensureNotNull)(this.activeBroker());this.isDisplayModeIndividualPositions()?e.individualPositionUpdate.unsubscribeAll(this):e.positionUpdate.unsubscribeAll(this)}startService(){this._clearPositions(),this._displayMode=function(e){if(null===e)return 1;const t=e.metainfo().configFlags;return t.supportPositionNetting?t.supportPositionBrackets?1:t.supportCloseIndividualPosition?0:1:1}(this.activeBroker()),this._requestPositions()}_clearPositions(){const e=(0,
r.ensureNotNull)(this.activeBroker()),t=Array.from(this._positions.keys());for(const i of t)this.isDisplayModeIndividualPositions()?e.unsubscribeIndividualPositionPL(i,this._updatePositionPLHandler):e.unsubscribePL(i,this._updatePositionPLHandler);this._positions.clear(),this._existingPositionIds.clear(),t.length>0&&c.logNormal(`All positions removed, id's: ${t}`),this._positionsRemoved.fire(t)}async _requestPositions(){const e=this.activeBroker();if(!e)return;const t=this.isDisplayModeIndividualPositions(),i=await(t?e.individualPositions():e.positions());for(const e of i)this._addPosition(e);t?e.individualPositionUpdate.subscribe(this,this._addPosition):e.positionUpdate.subscribe(this,this._addPosition)}_addPosition(e){const t=e.id,i=this._positions.has(t),s=(0,r.ensureNotNull)(this.activeBroker()),o=this.isDisplayModeIndividualPositions();if(!e.qty)return i&&(o?s.unsubscribeIndividualPositionPL(t,this._updatePositionPLHandler):s.unsubscribePL(t,this._updatePositionPLHandler),this._positions.delete(t),this._positionsRemoved.fire([t])),void this._logPositionUpdate(e,!0);const n=this._getPositionData(e),a=this._updateType(n);this._logPositionUpdate(n,a===u.Full),this._positions.set(t,n),this._firePositionUpdate(n,a),i||(o?s.subscribeIndividualPositionPL(t,this._updatePositionPLHandler):s.subscribePL(t,this._updatePositionPLHandler))}_updatePositionPL(e,t){const i=(0,r.ensureDefined)(this._positions.get(e));i.pl=(0,o.isNumber)(t)?t:null,this._firePositionUpdate(i,u.Partial)}_getPositionData(e){var t,i;const s=(0,r.ensureNotNull)(this.activeBroker()).metainfo().configFlags,o=this._positions.get(e.id),n=this.isDisplayModeIndividualPositions(),a=Boolean(n?s.supportIndividualPositionBrackets:s.supportPositionBrackets);let c,d=!1,u=null;if(n){const t=e;c=t.price,d=Boolean(t.canBeClosed)}else{const r=e;c=r.avgPrice,u=null!==(i=null!==(t=r.pl)&&void 0!==t?t:null==o?void 0:o.pl)&&void 0!==i?i:null}return{...e,pl:u,plBasedOnLast:s.calculatePLUsingLast||!1,price:Math.abs((0,r.ensureDefined)(c)),qtyBySide:Math.abs(e.qty)*(1===e.side?1:-1),supportClose:Boolean(n?s.supportCloseIndividualPosition&&d:s.supportClosePosition),supportReverse:Boolean(!n&&s.supportReversePosition),supportBrackets:a,supportOnlyPairBrackets:Boolean(s.supportOnlyPairPositionBrackets),supportTrailingStop:(0,l.checkTrailingStopAvailability)(s),supportGuaranteedStop:(0,l.checkGuaranteedStopAvailability)(s)}}_firePositionUpdate(e,t){this._positionUpdate.fire({data:e,type:t})}_updateType(e){const t=this._positions.get(e.id);if(void 0===t)return u.Full;for(const i of Object.keys(t)){const r=i;if("pl"!==r&&"unrealizedPl"!==r&&t[r]!==e[r])return u.Full}return u.Partial}_logPositionUpdate(e,t){if(!t)return;const i=e.id;let r="update";this._existingPositionIds.has(i)||(r="add",this._existingPositionIds.add(i)),function(e,t){t(JSON.stringify(h(e)))}(e,(e=>{c.logNormal(`Position  ${r}: ${e}`)}))}}},735248:(e,t,i)=>{"use strict";function r(e){return Boolean(e.supportTrailingStop&&e.supportAddBracketsToExistingOrder)}function s(e){
return Boolean(e.supportGuaranteedStop&&e.supportAddBracketsToExistingOrder)}var o;function n(e,t,i=!0){switch(function(e,t=!0){const i=null!=e?e:0,r=t?Math.round(100*i)/100:i;return r>0?"positive":r<0?"negative":"neutral"}(t,i)){case"negative":return e.negativePlColor;case"positive":return e.positivePlColor;default:return e.text.textColor}}i.d(t,{checkGuaranteedStopAvailability:()=>s,checkTrailingStopAvailability:()=>r,profitLossTextColor:()=>n}),function(e){e.Positive="positive",e.Negative="negative",e.Neutral="neutral"}(o||(o={}))},403933:(e,t,i)=>{"use strict";i.d(t,{TradingLayoutBreakpoint:()=>s});var r=i(33335);const s={Mobile:r.mobile}},328810:(e,t,i)=>{"use strict";i.d(t,{createCustomFieldModels:()=>a,filterAllowedCustomFields:()=>l,isSupportedField:()=>n});var r=i(947488),s=i(329452);var o=i(586639);function n(e,t){return void 0===e.supportedOrderTypes||e.supportedOrderTypes.includes(t)}function a(e){const{modifyMode:t,alwaysShowAttachedErrors$:i,currentOrderType:n,existedValues:a,tradingDialogCustomFields:c}=e;if(void 0===c||!Array.isArray(c)||0===c.length)return[];return(null!==n?l(n,c):c).map((e=>{if("TextField"===e.inputType)return function({customField:e,existedValues:t,modifyMode:i}){let o;const n=null==t?void 0:t[e.id];try{o=JSON.parse(n)}catch(e){o=n}const a=new r.BehaviorSubject(null!=o?o:e.value),l=new r.BehaviorSubject(!0),c=new r.BehaviorSubject(void 0),d=e.validator,u=void 0!==d?e=>{const t=d(e);l.next(t.valid),c.next(t.valid?void 0:t.errorMessage)}:void 0,h=void 0!==u?a.subscribe(u):void 0;return{id:e.id,type:e.inputType,inputType:e.maskWithAsterisk?"password":"text",placeholder:e.placeHolder||"",title:e.title||"",text$:a.asObservable(),getText:a.getValue.bind(a),setText:a.next.bind(a),onControlFocused:new s.Delegate,errorMessage$:c,isValid:()=>l.getValue(),destroy:()=>null==h?void 0:h.unsubscribe(),disabled:i&&e.preventModify}}({customField:e,existedValues:a,modifyMode:t});if("TextWithCheckBox"===e.inputType)return function({customField:e,existedValues:t}){var i,o;let n;const a=null==t?void 0:t[e.id];try{n=JSON.parse(a)}catch(e){n=a}const l=new r.BehaviorSubject(null!==(i=null==n?void 0:n.text)&&void 0!==i?i:e.value.text),c=new r.BehaviorSubject(null!==(o=null==n?void 0:n.checked)&&void 0!==o?o:e.value.checked),d=new r.BehaviorSubject(!0),u=new r.BehaviorSubject(void 0),h=e.validator,p=void 0!==h?e=>{const t=h(e);d.next(t.valid),u.next(t.valid?void 0:t.errorMessage)}:void 0,g=void 0!==p?l.subscribe(p):void 0;return{id:e.id,type:e.inputType,inputType:e.customInfo.asterix?"password":"text",placeholder:e.placeHolder||"",title:e.title||"",checkboxTitle:e.customInfo.checkboxTitle,text$:l.asObservable(),getText:l.getValue.bind(l),setText:l.next.bind(l),checked$:c.asObservable(),getChecked:c.getValue.bind(c),setChecked:c.next.bind(c),onControlFocused:new s.Delegate,errorMessage$:u,isValid:()=>d.getValue(),destroy:()=>null==g?void 0:g.unsubscribe()}}({customField:e,existedValues:a});if("Checkbox"===e.inputType)return function({customField:e,modifyMode:t,existedValues:i}){let n
;const a=null==i?void 0:i[e.id];try{n=JSON.parse(a)}catch(e){n=a}const l=new r.BehaviorSubject(null!=n?n:e.value);return{id:e.id,type:e.inputType,title:e.title,help:e.help,checked$:l.asObservable(),getChecked:l.getValue.bind(l),setChecked:l.next.bind(l),onControlFocused:new s.Delegate,disabled:t&&!e.supportModify,saveToSettings:e.saveToSettings,errorMessage$:(0,o.of)(void 0),isValid:()=>!0,destroy:()=>{}}}({customField:e,modifyMode:t,existedValues:a});if("ComboBox"===e.inputType&&Array.isArray(e.items))return function({customField:e,modifyMode:t,alwaysShowAttachedErrors$:i,existedValues:n}){let a=e.items[0];if(n&&e.id in n){const t=n[e.id],i=e.items.find((e=>e.value===t));void 0!==i&&(a=i)}else e.forceUserEnterInitialValue&&!t&&(a=void 0);const l=new r.BehaviorSubject(null==a?void 0:a.value);return{id:e.id,type:e.inputType,title:e.title,items:e.preventModify&&t&&a?[a]:e.items,selectedItem$:l.asObservable(),getSelectedItem:l.getValue.bind(l),setSelectedItem:l.next.bind(l),onControlFocused:new s.Delegate,saveToSettings:e.saveToSettings,alwaysShowAttachedErrors$:i,errorMessage$:(0,o.of)(void 0),isValid:()=>!0,destroy:()=>{}}}({customField:e,modifyMode:t,alwaysShowAttachedErrors$:i,existedValues:a});throw Error("Unknown inputType")}))}function l(e,t){return t.filter((t=>n(t,e)))}},141385:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Trading:()=>Hi,TradingActionName:()=>Fi,showSellBuyButtonsDefault:()=>zi});var r=i(650151),s=i(609838),o=i(688401),n=i(870122),a=i(376202),l=i(180185),c=i(70870),d=i(150335),u=i(947488),h=i(323002),p=i(997345),g=i(586639),m=i(275734),_=i(757604),b=i(958261),v=i(114501),y=i(839874),f=i(196573),k=i(423869),P=i(599016),S=i(391431),C=i(501329),w=i(46415),B=i(14654),T=i(621575),E=i(937778),O=i(669874),D=i(17317),I=i(440891),x=i(416637),M=i(658895),N=i(240534),A=i(329452),L=i(951827);var V=i(61121),R=i(804748),F=i(932100),W=i(269338),q=i(148296),U=i(203953),z=i(684416);const $=(0,E.getLogger)("Trading.RealtimeProvider");class Q{constructor(e){this._results={},this._getter=e}get(e){return this._results[e]||(this._results[e]=this._getter(e)),this._results[e]}}class H{constructor(e){this._stopped=!1,this._subscribed=!1,this._provider=null,this._formatters=null;const{symbol:t,callback:i,providersCache:r,formattersCache:s,subscriptionType:o,actualSymbolGetter:n}=e;this._symbol=t,this._subscriptionType=o,this._callback=i,this._providersCache=r,this._formattersCache=s,this._getActualSymbol=n,"Realtime"===this._subscriptionType?this._handler=(e,t)=>{this._stopped||i(e,t,this._formatters)}:this._handler=(e,t)=>{this._stopped||i(e,t)},this._start().catch((e=>{}))}symbol(){return this._symbol}type(){return this._subscriptionType}callback(){return this._callback}destroy(){this._ensureNotStopped(),this._subscribed&&void 0!==this._actualSymbol&&("Realtime"===this._subscriptionType?(0,r.ensureNotNull)(this._provider).unsubscribeRealtime(this._actualSymbol,this._handler):(0,r.ensureNotNull)(this._provider).unsubscribeDOM(this._actualSymbol,this._handler)),this._stopped=!0}async _start(){
const{symbol:e}=await this._getActualSymbol(this._symbol);this._ensureNotStopped(),this._provider=await this._providersCache.get(e),this._ensureNotStopped(),this._formatters=await this._formattersCache.get(e),(0,r.ensure)(this._formatters),this._ensureNotStopped(),this._actualSymbol=e,this._subscribed=!0,"Realtime"===this._subscriptionType?this._provider.subscribeRealtime(e,this._handler):this._provider.subscribeDOM(e,this._handler)}_ensureNotStopped(){(0,r.assert)(!this._stopped,"Should not be stopped")}}class j{constructor(e,t,i,r){this.onStatusChanged=new A.Delegate,this._subscriptions=[],this._currentBroker=null,this._activeBrokerGetter=e,this._actualSymbolGetter=r,t.subscribe(this,this._connectionStatusChanged),i.subscribe(this,this._connectionStatusChanged),this._tvProvider=new U.BrokerRealtimeAdapter("RealtimeProvider"),this._connectionStatusChanged()}isTradable(e){return this._tradableCache.get(e)}subscribeRealtime(e,t){this._subscriptions.some((i=>i.symbol()===e&&i.callback()===t&&"Realtime"===i.type()))||this._subscriptions.push(new H({symbol:e,callback:t,providersCache:this._providersCache,formattersCache:this._formattersCache,subscriptionType:"Realtime",actualSymbolGetter:this._actualSymbolGetter}))}unsubscribeRealtime(e,t){const i=this._subscriptions.findIndex((i=>i.symbol()===e&&i.callback()===t&&"Realtime"===i.type()));if(-1===i)return;this._subscriptions[i].destroy(),this._subscriptions.splice(i,1)}subscribeDOM(e,t){this._subscriptions.some((i=>i.symbol()===e&&i.callback()===t&&"DOM"===i.type()))||this._subscriptions.push(new H({symbol:e,callback:t,providersCache:this._providersCache,formattersCache:this._formattersCache,subscriptionType:"DOM",actualSymbolGetter:this._actualSymbolGetter}))}unsubscribeDOM(e,t){const i=this._subscriptions.findIndex((i=>i.symbol()===e&&i.callback()===t&&"DOM"===i.type()));if(-1===i)return void $.logWarn("Subscription not found");this._subscriptions[i].destroy(),this._subscriptions.splice(i,1)}formatter(e){return this._formattersCache.get(e).then((e=>e.formatter))}spreadFormatter(e){return this._formattersCache.get(e).then((e=>e.spreadFormatter))}quantityFormatter(e){return this._formattersCache.get(e).then((e=>e.quantityFormatter))}symbolInfo(e){if(!e){const e={minTick:NaN,qty:{min:NaN,max:NaN,step:NaN},pipValue:NaN,pipSize:NaN,description:"no symbol"};return Promise.resolve(e)}return this._providersCache.get(e).then((t=>t!==this._tvProvider?t.symbolInfo(e).then((t=>t||this._tvProvider.symbolInfo(e))).catch((t=>this._tvProvider.symbolInfo(e))):this._tvProvider.symbolInfo(e)))}quotesSnapshot(e){return this._providersCache.get(e).then((t=>t.quotesSnapshot(e)))}activeBroker(){return null!==this._currentBroker&&this._currentBroker!==this._tvProvider?this._currentBroker:null}_isTradable(e){if(null===this._currentBroker||this._currentBroker===this._tvProvider)return Promise.resolve({tradable:!1});try{return(0,z.makeTimeLimited)(this._currentBroker.isTradable(e),6e4,"isTradable Promise Timeout").catch((()=>Promise.resolve({tradable:!1})))}catch(e){return Promise.resolve({
tradable:!1})}}_haveRealtime(e){return this._tradableCache.get(e)||Promise.resolve(null===this._currentBroker)}_connectionStatusChanged(){const e=this._activeBrokerGetter(),t=this._currentBroker,i=e&&1===e.connectionStatus()?e:null;if(this._createCaches(),t!==i){const e=this._subscriptions.map((e=>({symbol:e.symbol(),callback:e.callback(),type:e.type()})));this._unsubscribeAll(),this._currentBroker=i,this._subscribeAll(e),this.onStatusChanged.fire()}}_createCaches(){this._providersCache=new Q((e=>this._provider(e))),this._tradableCache=new Q((e=>this._isTradable(e))),this._formattersCache=new Q((e=>this._providersCache.get(e).then((t=>Promise.all([t.formatter(e,!1),t.spreadFormatter(e),t.quantityFormatter(e)]))).then((([e,t,i])=>({formatter:e,spreadFormatter:t,quantityFormatter:i})))))}_provider(e){return I.enabled("enable_dom_data_for_untradable_symbols")?Promise.resolve(this._currentBroker||this._tvProvider):this._haveRealtime(e).then((e=>e.tradable&&this._currentBroker&&1===this._currentBroker.connectionStatus()?this._currentBroker:this._tvProvider))}_unsubscribeAll(){this._subscriptions.forEach((e=>{e.destroy()})),this._subscriptions=[]}_subscribeAll(e){e.forEach((e=>{this._subscriptions.push(new H({symbol:e.symbol,callback:e.callback,providersCache:this._providersCache,formattersCache:this._formattersCache,subscriptionType:e.type,actualSymbolGetter:this._actualSymbolGetter}))}))}}var G,K=i(642659);!function(e){e.Placed="Placed",e.Rejected="Rejected",e.Executed="Executed",e.Canceled="Canceled",e.Modified="Modified"}(G||(G={}));const Z=["Placed","Executed","Canceled","Rejected"];class J extends K.BrokerService{constructor(e){super(e),this._userId=(window.user.id||"").toString(),this._trackedOrderIdsByEventNameMap=new Map,window.loginStateChange&&window.loginStateChange.subscribe(this,this._onLoginStateChange),this._initTrackedOrderIdsByEventNameMap()}trackOrderPlaced(e){this._trackOrderEvent("Placed",e)}trackOrderModified(e){this._trackOrderEvent("Modified",{order:e})}startService(){const e=(0,r.ensure)(this.activeBroker(),"activeBroker() at TradingStat startService");this._lastBrokerId!==e.metainfo().id&&this._resetTrackedOrderIdsByEventNameMap(),e.orderUpdate.subscribe(this,this._orderUpdate),this._trackTradingBrokerConnnected()}stopService(){(0,r.ensure)(this.activeBroker()).orderUpdate.unsubscribe(this,this._orderUpdate)}_orderUpdate(e,t){t||(5===e.status?this._trackOrderEvent("Rejected",{order:e}):2===e.status?this._trackOrderEvent("Executed",{order:e}):1===e.status&&this._trackOrderEvent("Canceled",{order:e}))}_shouldSkipTrackEventByOrderId(e,t){var i;return!!(null===(i=this._trackedOrderIdsByEventNameMap.get(t))||void 0===i?void 0:i.has(e))}async _trackOrderEvent(e,t){var i,r;const s=this.trading().linking().value(),o=this.activeBroker(),n=null==t?void 0:t.order;if(void 0===n||null===o)return;if(void 0!==n.id&&Z.includes(e)){if(this._shouldSkipTrackEventByOrderId(n.id,e))return;null===(i=this._trackedOrderIdsByEventNameMap.get(e))||void 0===i||i.add(n.id)}
const a=await o.symbolInfo(n.symbol),l=n.qty*(a.lotSize||1),c="Placed"===e&&void 0!==s.continuous&&s.symbol===n.symbol?"continuous":a.type,d={amount:l,orderId:n.id,instrumentType:c,eventName:"Order "+e,userId:this._userId,symbol:n.symbol,currency:null!==(r=a.currency)&&void 0!==r?r:null,label:null==t?void 0:t.label,source:n.source};this._trackTradingOrder(d)}_trackTradingOrder(e){const t=this.activeBroker();if(!t)throw new Error("no active broker")}_trackTradingBrokerConnnected(){const e=this.activeBroker();null!==e&&e.metainfo().id;if(!e)throw new Error("no active broker")}_onLoginStateChange(){this._userId=(window.user.id||"").toString()}_initTrackedOrderIdsByEventNameMap(){for(const e of Z)this._trackedOrderIdsByEventNameMap.set(e,new Set)}_resetTrackedOrderIdsByEventNameMap(){this._trackedOrderIdsByEventNameMap.clear(),this._initTrackedOrderIdsByEventNameMap()}}var X=i(863697),Y=i(106056),ee=i(32133);function te(e="default"){switch(e){case"danger":return X.ToastIntent.Danger;case"attention":return X.ToastIntent.Warning;case"success":return X.ToastIntent.Success;default:return X.ToastIntent.Default}}class ie{constructor(e){this._chartWidgetCollection=e}showTradingProperties(){this._chartWidgetCollection.activeChartWidget.value().showGeneralChartProperties(L.TabNames.trading)}async closeAllNotifications(){const e=await this._chartWidgetCollection.getToasts();null!==e&&e.reset()}async showNotification(e,t,i,r){const s=await this._chartWidgetCollection.getToasts();if(null===s)return;let o="";"string"==typeof t&&(o=t),s.showSimpleToast({text:o,time:r,title:e,intent:te(i),priority:Y.ToastPriority.Low})}showMaintenance(e){0}showBrokerSideMaintenance(e){0}trackEvent(e,t,i){!async function(e,t,i){(0,ee.trackEvent)(e,t,i)}(e,t,i)}showReplayConfirmationDialog(){return Promise.resolve()}reconnectChartApi(e){0}setBroker(e){const t=(null==e?void 0:e.metainfo().backendBrokerName)||(null==e?void 0:e.metainfo().id.toLowerCase())||"";this._chartWidgetCollection.setBroker(t)}}var re=i(822914),se=(i(68212),i(537008));async function oe(e){const{showErrorNotification:t,handler:r,message:o,onOpen:n,onClose:a,abortSignal:l}=e;if(!await(0,se.showConfirmDialog)({title:s.t(null,void 0,i(383236)),content:o,mainButtonText:s.t(null,void 0,i(383236)),cancelButtonText:s.t(null,void 0,i(904543)),onOpen:n,onClose:a,abortSignal:l,showErrorNotification:t}))return!1;try{return await r()}catch(e){return t(s.t(null,void 0,i(139924)),function(e){let t="";null!==e&&"object"==typeof e&&e.message?t=e.message:"string"==typeof e&&(t=e);return t}(e)),!1}}var ne=i(646323),ae=i(151121),le=i(605962);i(567704),i(627687),i(816105);async function ce(e,t,r,o){const n=await async function(e,t){const{PartiallyClosingDialogRenderer:r}=await i.e(3168).then(i.bind(i,796737)),s=new r;return new Promise(((i,r)=>{(null==t?void 0:t.aborted)?i({status:!1}):(s.open({...e,dialogActionHandler:i}),null==t||t.addEventListener("abort",(()=>{s.close(),i({status:!1})}),{once:!0}))}))}(e,o);if(!n.status)return!1;try{return await t(n.qty)}catch(e){
return r(s.t(null,void 0,i(139924)),function(e){let t="";null!==e&&"object"==typeof e&&e.message?t=e.message:"string"==typeof e&&(t=e);return t}(e)),!1}}var de=i(220858);const ue={async show(e){const t=s.t(null,{replace:{symbol:e}},i(227617)),r=s.t(null,{replace:{symbol:e}},i(182914));return(0,de.showSimpleConfirmDialog)({title:r,text:t})}},he={async show(e){const t=s.t(null,{replace:{symbol:e}},i(156910)),r=s.t(null,{replace:{symbol:e}},i(830538));return(0,de.showSimpleConfirmDialog)({title:r,text:t})}};var pe=i(50959);function ge(e){const{symbol:t,side:r,qty:o,price:n,id:a,closePositionCancelsOrders:l}=e;return pe.createElement(pe.Fragment,null,pe.createElement("div",null,void 0!==a?s.t(null,void 0,i(792417)).replace("{id}",a):s.t(null,void 0,i(267539))),pe.createElement("div",null,pe.createElement("b",null,t)),pe.createElement("div",null,pe.createElement("b",null,`${r} ${o} @ ${n}`)),pe.createElement("div",null,l&&` ${s.t(null,void 0,i(178224))}`))}var me=i(961942);const _e=(0,E.getLogger)("Trading.BrokerCommandsUI"),be={symbol:1,qty:1,side:1,type:1,seenPrice:1};class ve{constructor({activeBroker:e,guiAccessor:t,noConfirmEnabled:i,orderViewController:r,showErrorNotification:s,trackEvent:o,tradingLinking:n,abortSignalGetter:a}){this._closePositionDialogVisibility=new R.DialogVisibility,this._isClosePositionDialogLoading=!1,this._isCloseIndividualPositionDialogLoading=!1,this._onClosePositionDialogOpen=e=>{this._closePositionDialogVisibility.setValue({isVisible:!0,isFullScreen:e})},this._onClosePositionDialogClose=()=>{this._closePositionDialogVisibility.setValue({isVisible:!1})},this._tradingLinking=n,this._activeBroker=e,this._guiAccessor=t,this._orderViewController=r,this._showErrorNotification=s,this._noConfirmEnabled=i,this._trackEvent=o,this._getAbortSignal=a,this.closePositionDialogVisibility=this._closePositionDialogVisibility.value$}async placeOrder(e,t,i,r){const s=t&&this._noConfirmEnabled.value(),o=this._guiAccessor&&s?this._guiAccessor.showReplayConfirmationDialog():Promise.resolve(!1);try{await o}catch(e){Promise.resolve(!1)}const n=await this._activeBroker.isTradable(e.symbol);if(s&&n.tradable&&function(e){for(const t in be)if(!(t in e))return!1;return!0}(e)){return(await this._activeBroker.createPlaceOrderContext({order:e,source:"instant",isValidationEnabled:!1,isDisposable:!0})).send()}{const t=this._activeBroker.metainfo();if(t.customUI&&void 0!==t.customUI.showOrderDialog)return t.customUI.showOrderDialog(e)}return this._orderViewController().then((t=>this._activeBroker?t.showOrderView({order:e,focus:r,forceOrderDialog:i}):Promise.reject("Broker connection adapter is null")))}async modifyOrder(e,t,i,r){if(t&&this._noConfirmEnabled.value()&&1===e.parentType){return(await this._activeBroker.createEditOrderContext({order:e,source:"instant",isDisposable:!0})).send()}return this._modifyOrder(e,t,i,r)}async closePosition(e){var t,i;if(this._makeSureBrokerIsConnected(),this._isClosePositionDialogLoading)return!1;let r,s;this._isClosePositionDialogLoading=!0;try{
if(r=await this._activeBroker.positionById(e),void 0===r)return!1;const{tradable:t}=await this._activeBroker.isTradable(r.symbol);if(await this._assertPositionExistsAndNotClosed(r.id),!t)return this._closePositionForNonTradableSymbol(r);if(this._noConfirmEnabled.value())return this._activeBroker.closePosition(e);s=await this._obtainPositionClosingData(r)}finally{this._isClosePositionDialogLoading=!1}if(void 0===s)return!1;const{supportPartialClosePosition:o,...n}=s,a=this._activeBroker.metainfo();if(void 0!==(null===(t=a.customUI)||void 0===t?void 0:t.showClosePositionDialog))return null===(i=a.customUI)||void 0===i?void 0:i.showClosePositionDialog(r);if(o){const t=t=>(t!==(null==r?void 0:r.qty)?this._trackEvent("","Close Position Dialog","partial"):this._trackEvent("","Close Position Dialog","full"),this._activeBroker.closePosition(e,t));return ce({...n,positionOrIndividualPosition:r,onOpen:this._onClosePositionDialogOpen,onClose:this._onClosePositionDialogClose},t,this._showErrorNotification,this._getAbortSignal())}{const t=()=>this._activeBroker.closePosition(e);return oe({showErrorNotification:this._showErrorNotification,handler:t,message:s.message,onOpen:this._onClosePositionDialogOpen,onClose:this._onClosePositionDialogClose,abortSignal:this._getAbortSignal()})}}async closeIndividualPosition(e){if(this._makeSureBrokerIsConnected(),(0,r.assert)(!!this._activeBroker.config.supportPositionNetting,"Broker doesn`t support individual positions"),this._noConfirmEnabled.value())return this._activeBroker.closeIndividualPosition(e);{if(this._isCloseIndividualPositionDialogLoading)return!1;const t=await this._obtainIndividualPositionClosingData(e);if(void 0===t)return!1;const{supportPartialCloseIndividualPosition:i,individualPosition:r,...s}=t;if(i){const t=async t=>(t!==r.qty?this._trackEvent("","Close Individual Position Dialog","partial"):this._trackEvent("","Close Individual Position Dialog","full"),this._activeBroker.closeIndividualPosition(e,t));return ce({...s,positionOrIndividualPosition:r,onOpen:this._onClosePositionDialogOpen,onClose:this._onClosePositionDialogClose},t,this._showErrorNotification,this._getAbortSignal())}return oe({showErrorNotification:this._showErrorNotification,handler:()=>this._activeBroker.closeIndividualPosition(e),message:t.message,onOpen:this._onClosePositionDialogOpen,onClose:this._onClosePositionDialogClose,abortSignal:this._getAbortSignal()})}}editPositionBrackets(e,t,i,s){return this._makeSureBrokerIsConnected(),(0,r.assert)(!!this._activeBroker.config.supportPositionBrackets,"Broker doesn`t support brackets on positions"),s&&this._noConfirmEnabled.value()?this._activeBroker.editPositionBrackets(e,null!=t?t:{}):this._activeBroker.positionById(e).then((e=>this._activeBroker?this._showPositionDialog((0,r.ensureDefined)(e),t,i):Promise.reject("Broker connection adapter is null")))}editIndividualPositionBrackets(e,t,i,s){
return s&&this._noConfirmEnabled.value()?this._activeBroker.editIndividualPositionBrackets(e,null!=t?t:{}):this._activeBroker.individualPositionById(e).then((e=>this._activeBroker?this._showIndividualPositionDialog((0,r.ensureDefined)(e),t,i):Promise.reject("Broker connection adapter is null")))}reversePosition(e){return this._makeSureBrokerIsConnected(),this._activeBroker.metainfo().configFlags.supportMultiposition&&!this._activeBroker.config.supportNativeReversePosition?Promise.reject("Cannot reverse position on multiposition acount"):this._noConfirmEnabled.value()?this._activeBroker.reversePosition(e):this._activeBroker.positionById(e).then((t=>{if(!this._activeBroker)return Promise.reject("Broker connection adapter is null");const i=this._activeBroker.reversePosition.bind(this._activeBroker,e);return(0,ne.reversePositionDialog)({positionId:e,showErrorNotification:this._showErrorNotification,handler:i,closePositionCancelsOrders:this._activeBroker.config.closePositionCancelsOrders,abortSignal:this._getAbortSignal()})}))}async cancelOrder(e){var t,i;this._makeSureBrokerIsConnected();const r=await this._activeBroker.orderById(e);if(void 0===r)return Promise.reject("Failed to find order");const{tradable:s}=await this._activeBroker.isTradable(r.symbol);if(await this._assertOrderExistsAndNotCanceled(r.id),!s)return this._cancelOrderForNonTradableSymbol(r.symbol,r.id);if(this._noConfirmEnabled.value())return this._activeBroker.cancelOrder(e);{const s=this._activeBroker.cancelOrder.bind(this._activeBroker,e),o=this._activeBroker.metainfo();if(void 0!==(null===(t=o.customUI)||void 0===t?void 0:t.showCancelOrderDialog))return null===(i=o.customUI)||void 0===i?void 0:i.showCancelOrderDialog(r);if(r.parentId){const e=(await this._activeBroker.orders()).filter((e=>e.refNumber===r.refNumber));return o.configFlags.supportCancellingBothBracketsOnly&&e.length>1?this._showCancelMultipleBracketsDialog(r.parentId,s):this._showCancelBracketsDialog(r.id,s)}return this._showCancelOrderDialog(r.id,s)}}cancelOrders(e,t){return this._makeSureBrokerIsConnected(),this._activeBroker.orders().then((i=>{if(!this._activeBroker)return Promise.reject("Broker connection adapter is null");const r=i.filter((i=>i.symbol===e&&(!t||i.side===t)&&function(e){return 4===e.status||3===e.status||6===e.status}(i)));if(!r.length)return Promise.resolve(!1);if(1===r.length)return this.cancelOrder(r[0].id);const s=r.map((e=>e.id));if(this._noConfirmEnabled.value())return this._activeBroker.cancelOrders(e,t,s);{const i=this._activeBroker.cancelOrders.bind(this._activeBroker);return this._showCancelMultipleOrdersDialog(e,t,s,i)}}))}async _modifyOrder(e,t,r,o){var n;const a=this._activeBroker.metainfo();if(this._makeSureBrokerIsConnected(),e.flags&&e.flags.trailingStop)return _e.logError("Attempt to modify trailing stop loss order"+e.id),this._showErrorNotification(s.t(null,void 0,i(500864)),s.t(null,void 0,i(908940))),Promise.resolve(!1);await this._setSymbol(e.symbol);const l=await this._activeBroker.symbolInfo(e.symbol)
;if(e.limitPrice=void 0!==l.limitPriceStep&&void 0!==e.limitPrice?(0,T.roundToStepByPriceTypeAndSide)(e.limitPrice,l.limitPriceStep,1,e.side):e.limitPrice,e.stopPrice=void 0!==l.stopPriceStep&&void 0!==e.stopPrice?(0,T.roundToStepByPriceTypeAndSide)(e.stopPrice,l.stopPriceStep,2,e.side):e.stopPrice,!a.configFlags.supportModifyTrailingStop){const t=await this._activeBroker.orderById(e.id);e.hasTrailingStopBracket=void 0!==(null==t?void 0:t.trailingStopPips)}const c=t&&this._noConfirmEnabled.value();let d=r||(1===e.type?1:2);if(e.parentId&&!I.enabled("always_pass_called_order_to_modify")){const t=await this._getParentOrderOrPosition(e);if(void 0!==t){d=r||(1===e.type?3:4);const i={takeProfit:e.limitPrice||t.takeProfit,trailingStopPips:e.trailingStopPips||t.trailingStopPips,stopLoss:e.stopPrice||t.stopLoss,guaranteedStop:null!==(n=e.guaranteedStop)&&void 0!==n?n:t.guaranteedStop};if(3===e.parentType)return c?this._activeBroker.editIndividualPositionBrackets(t.id,i):this._showIndividualPositionDialog(t,i,d);if(2===e.parentType&&e.qty===Math.abs(t.qty))return c?this._activeBroker.editPositionBrackets(t.id,i):this._showPositionDialog(t,i,d);1===e.parentType&&(0,S.isOrderActive)(t.status)&&((e=(0,re.default)(t)).takeProfit=i.takeProfit,e.trailingStopPips=i.trailingStopPips,e.stopLoss=i.stopLoss,e.guaranteedStop=i.guaranteedStop,e.hasTrailingStopBracket=void 0!==t.trailingStopPips)}}return c?this._activeBroker.modifyOrder(e):a.customUI&&void 0!==a.customUI.showOrderDialog?a.customUI.showOrderDialog(e,d):this._orderViewController().then((t=>this._activeBroker?t.showOrderView({order:e,focus:d,forceOrderDialog:o}):Promise.reject("Broker connection adapter is null")))}async _setSymbol(e){this._tradingLinking.value().symbol!==e&&await this._tradingLinking.setSymbol(e)}_makeSureBrokerIsConnected(){(0,r.assert)(1===this._activeBroker.connectionStatus(),"Broker is not connected")}async _showPositionDialog(e,t={},r){await this._setSymbol(e.symbol);const o=await this._activeBroker.isTradable(e.symbol);if(!o.tradable){const t=void 0!==o.reason?o.reason:(0,T.makeNonTradableSymbolText)(e.symbol,this._activeBroker.metainfo().title);return this._showErrorNotification(s.t(null,void 0,i(734567)),t),Promise.resolve(!1)}{const i=this._activeBroker.metainfo();if(i.customUI&&void 0!==i.customUI.showPositionDialog)return i.customUI.showPositionDialog(e,{stopLoss:t.stopLoss||e.stopLoss,takeProfit:t.takeProfit||e.takeProfit},r)}return this._orderViewController().then((i=>this._activeBroker?i.showPositionView(e,{stopLoss:t.stopLoss,takeProfit:t.takeProfit,trailingStopPips:t.trailingStopPips,guaranteedStop:t.guaranteedStop},r||e.limitPrice&&3||e.stopPrice&&4):Promise.reject("Broker connection adapter is null")))}async _showIndividualPositionDialog(e,t={},i){await this._setSymbol(e.symbol);{const r=this._activeBroker.metainfo();if(r.customUI&&void 0!==r.customUI.showPositionDialog)return r.customUI.showPositionDialog(e,{stopLoss:t.stopLoss||e.stopLoss,takeProfit:t.takeProfit||e.takeProfit},i)}
return this._orderViewController().then((r=>this._activeBroker?r.showIndividualPositionView(e,{stopLoss:t.stopLoss,takeProfit:t.takeProfit,trailingStopPips:t.trailingStopPips,guaranteedStop:t.guaranteedStop},i||e.limitPrice&&3||e.stopPrice&&4):Promise.reject("Broker connection adapter is null")))}_isMaintenance(){return isFeatureEnabled((0,S.makeMaintananceFeatureToggleName)(this._activeBroker.metainfo().id))}_isBrokerSideMaintenance(){return isFeatureEnabled((0,S.makeBrokerSideMaintananceFeatureToggleName)(this._activeBroker.metainfo().id))}_showCancelOrderDialog(e,t){return ae.ConfirmOrderCancelDialog.get().open(e,this._getAbortSignal()).then((i=>i?t(e):Promise.resolve(!1)))}_showCancelMultipleOrdersDialog(e,t,i,r){const s=i.length;return ae.ConfirmOrderCancelDialog.get().multiple(e,t,s,this._getAbortSignal()).then((s=>s?r(e,t,i):Promise.resolve(!1)))}async _showCancelBracketsDialog(e,t){return le.ConfirmBracketsCancelDialog.get().open(e,this._getAbortSignal()).then((i=>i?t(e):Promise.resolve(!1)))}_showCancelMultipleBracketsDialog(e,t){return le.ConfirmBracketsCancelDialog.get().multiple(e,this._getAbortSignal()).then((i=>i?t(e):Promise.resolve(!1)))}async _obtainPositionClosingData(e){try{const{supportLots:t,qtyStep:r,uiQtyStep:o,minQty:n,qtyLabel:a,qtyFormatter:l,priceFormatter:c}=await this._obtainPositionOrIndividualPositionClosingCommonData(e),d=this._activeBroker.metainfo().configFlags.supportPartialClosePosition,u=ge({symbol:(0,S.getSymbolNameOverFullname)(e.symbol),side:1===e.side?s.t(null,void 0,i(728257)):s.t(null,void 0,i(13009)),qty:l.format(e.qty),price:c.format(e.avgPrice),closePositionCancelsOrders:this._activeBroker.config.closePositionCancelsOrders});return{position:e,supportLots:t,qtyStep:r,uiQtyStep:o,minQty:n,qtyLabel:a,supportPartialClosePosition:d,qtyFormatter:l,message:u}}catch(e){return}}async _obtainIndividualPositionClosingData(e){try{this._isCloseIndividualPositionDialogLoading=!0;const t=(0,r.ensureDefined)(await this._activeBroker.individualPositionById(e)),{supportLots:o,qtyStep:n,uiQtyStep:a,minQty:l,qtyLabel:c,qtyFormatter:d,priceFormatter:u}=await this._obtainPositionOrIndividualPositionClosingCommonData(t),h=this._activeBroker.metainfo().configFlags.supportPartialCloseIndividualPosition,p=ge({symbol:(0,S.getSymbolNameOverFullname)(t.symbol),side:1===t.side?s.t(null,void 0,i(728257)):s.t(null,void 0,i(13009)),qty:d.format(t.qty),price:u.format(t.price),id:e,closePositionCancelsOrders:this._activeBroker.config.closePositionCancelsOrders});return this._isCloseIndividualPositionDialogLoading=!1,{individualPosition:t,supportLots:o,qtyStep:n,uiQtyStep:a,minQty:l,qtyLabel:c,supportPartialCloseIndividualPosition:h,qtyFormatter:d,message:p}}catch(e){return void(this._isCloseIndividualPositionDialogLoading=!1)}}async _obtainPositionOrIndividualPositionClosingCommonData(e){const t=await this._activeBroker.symbolInfo(e.symbol),i=void 0!==t.lotSize,r=t.qty.step,s=t.qty.uiStep,o=t.qty.min,n=t.units;return{supportLots:i,qtyStep:r,uiQtyStep:s,minQty:o,
qtyFormatter:await this._activeBroker.quantityFormatter(e.symbol),priceFormatter:await this._activeBroker.formatter(e.symbol,!1),qtyLabel:n}}async _closePositionForNonTradableSymbol(e){const{supportClosePositionForNonTradableSymbol:t,supportClosePosition:r}=this._activeBroker.metainfo().configFlags;if(!t||!r){const t=s.t(null,{replace:{symbol:e.symbol}},i(466690));return this._showErrorNotification(t,s.t(null,void 0,i(495610))),!1}return!!await ue.show(e.symbol)&&this._activeBroker.closePosition(e.id)}async _cancelOrderForNonTradableSymbol(e,t){if(!this._activeBroker.metainfo().configFlags.supportCancelOrderForNonTradableSymbol){const t=s.t(null,{replace:{symbol:e}},i(947962));return this._showErrorNotification(t,s.t(null,void 0,i(746562))),!1}return!!await he.show(e)&&this._activeBroker.cancelOrder(t)}async _assertPositionExistsAndNotClosed(e){const t=await this._activeBroker.positionById(e);if(!(0,S.checkIsExistingPosition)(t))throw new me.UserFriendlyError({userFriendlyMessage:s.t(null,{replace:{positionId:e}},i(526672)),detailedErrorMessage:`Position ${e} doesn't exist or has already been closed`})}async _getParentOrderOrPosition(e){try{return 1===e.parentType?await this._activeBroker.orderById(e.parentId):2===e.parentType?await this._activeBroker.positionById(e.parentId):3===e.parentType?await this._activeBroker.individualPositionById(e.parentId):void 0}catch(e){return}}async _assertOrderExistsAndNotCanceled(e){const t=await this._activeBroker.orderById(e);if(void 0===t||1===t.status)throw new me.UserFriendlyError({userFriendlyMessage:s.t(null,{replace:{orderId:e}},i(733144)),detailedErrorMessage:`Order ${e} doesn't exist or has already been canceled`})}}class ye{constructor(e){this._domPanel=null;const{resizerBridge:t,closeFn:i,trading:r,qtySuggester:s,tradingLinking:o,headerState:n,isLoading:a}=e;this._resizerBridge=t,this._trading=r,this._qtySuggester=s,this._tradingLinking=o,this._headerState=n,this._isLoading=a,this._getDOMPanel=(0,D.sequentialize)(this._getDOMPanel),this._close=()=>{this.unmount(),i()}}centerDOM(){var e;null===(e=this._domPanel)||void 0===e||e.centerDOM()}mount(){return this._getDOMPanel().then((e=>{e.setVisibility(!0)}))}unmount(){this._getDOMPanel().then((e=>{e.setVisibility(!1)}))}headerStateValue(){return this._headerState}async _getDOMPanel(){if(null!==this._domPanel)return this._domPanel;const{DOMPanel:e}=await Promise.all([i.e(2273),i.e(6625),i.e(4392),i.e(8077),i.e(4447),i.e(8065),i.e(4593),i.e(6955),i.e(1259),i.e(1020),i.e(2829),i.e(101),i.e(7199),i.e(5581),i.e(5588),i.e(7125),i.e(5260),i.e(3427),i.e(158),i.e(4627)]).then(i.bind(i,812983)),t=this._domPanel=new e(this._trading,this._resizerBridge,this._qtySuggester,this._tradingLinking,this._headerState,this._isLoading);return t.setCloseHandler(this._close),t}}class fe{constructor(e){this._headerState=e}mount(){return Promise.resolve()}unmount(){}headerStateValue(){return this._headerState}}var ke,Pe,Se,Ce,we=i(97518),Be=i(632227),Te=i(497754),Ee=i.n(Te),Oe=i(997180),De=i.n(Oe);function Ie(e){
const{className:t,type:i="secondary",size:r="small",orientation:s="horizontal"}=e,o=Te(t,De().divider,De()[`size-${r}`],De()[`type-${i}`],De()[`orientation-${s}`]);return pe.createElement("hr",{className:o,"aria-orientation":s})}!function(e){e.XSmall="xsmall",e.Small="small",e.Medium="medium",e.Large="large",e.XLarge="xlarge",e.XXLarge="xxlarge"}(ke||(ke={})),function(e){e.Primary="primary",e.Secondary="secondary"}(Pe||(Pe={})),function(e){e.Horizontal="horizontal",e.Vertical="vertical"}(Se||(Se={})),function(e){e.XSmall="xsmall",e.Small="small",e.Medium="medium"}(Ce||(Ce={}));const xe=(0,pe.createContext)("xsmall");var Me=i(273388),Ne=i(72571),Ae=i(197464);function Le(e){const{startIcon:t,endSlot:i,children:r,title:s}=e;return pe.createElement(pe.Fragment,null,t&&pe.createElement(Ne.Icon,{icon:t,className:Ae["start-icon-wrap"],"aria-hidden":!0}),r&&pe.createElement("span",{title:s,className:Ee()(Ae.content,s?"apply-common-tooltip":"apply-overflow-tooltip")},r),i)}const Ve=(0,pe.forwardRef)(((e,t)=>{const{id:i,active:r,startIcon:s,children:o,endSlot:n,className:a,title:l,...c}=e,d=(0,pe.useContext)(xe);return pe.createElement("button",{...c,id:i,ref:t,className:Ee()(Ae["light-tab-button"],Ae[d],r&&Ae.selected,a)},pe.createElement(Le,{startIcon:s,endSlot:n,title:l},o))}));Ve.displayName="LightTabBaseButton";const Re=(0,pe.forwardRef)(((e,t)=>{const{item:i,highlighted:r,handleItemRef:s,onClick:o,...n}=e,a=(0,pe.useCallback)((()=>{o&&o(i)}),[o,i]),l=(0,pe.useCallback)((e=>{s&&s(i,e),(0,Me.isomorphicRef)(t)(e)}),[i,s,t]);return pe.createElement(Ve,{...n,id:i.id,title:i.title,onClick:a,ref:l,startIcon:i.startIcon,endSlot:i.endSlot},i.children)}));Re.displayName="LightTabButton";var Fe=i(897107),We=i(298563),qe=i(995283);function Ue(e){const{items:t,isRtl:i,classNameWrap:r,className:s,style:o,"data-name":n="light-tabs-buttons",size:a="xsmall"}=e,{getBindings:l,scrollWrapBinding:c,tablistBinding:d,handleActivate:u}=(0,We.useTabsMainHandlers)(Fe.TabNames.LightButtonTabs,e,{isRtl:i});return pe.createElement(xe.Provider,{value:a},pe.createElement("div",{...c,"data-name":n,className:r,style:o},pe.createElement("div",{...d,className:Ee()(qe["light-tabs"],qe[a],s)},t.map(((e,t)=>pe.createElement(Re,{...l(e),key:e.id,item:e,onClick:()=>u(e),"data-name":`light-tab-${t}`}))))))}var ze=i(661851),$e=i(431520),Qe=i(264946);function He(e){const{items:t,activeTabId:i,isVisible$:r,onSelect:s}=e,o=(0,ze.useObservable)(r),n=(0,pe.useCallback)((e=>e.id===i),[i]),a=(0,pe.useCallback)((e=>{const t=e.id;s(t),(0,ee.trackEvent)("GUI",t===F.TradingPage.OrderPanel?"Select Order Tab":"Select DOM Tab")}),[s]);return o?pe.createElement(pe.Fragment,null,pe.createElement(Ue,{id:"trading-panel-page-tabs",classNameWrap:Qe.tabs,items:t,isRtl:$e.isRtl,isActive:n,onActivate:a}),pe.createElement(Ie,{className:Qe.divider,size:"xsmall"})):pe.createElement(pe.Fragment,null)}var je=i(28033),Ge=i(637079);class Ke{constructor(e,t){this.isOpened=new N.WatchedValue(!1),this.isOpeningAvailable=new N.WatchedValue(!1),this.isLoading=new N.WatchedValue(!1),
this._showOrderPanelOnStart=I.enabled("show_order_panel_on_start"),this._orderPanelEnabled=I.enabled("order_panel"),this._domPanelEnabled=(0,je.checkIsDOMAvailable)(),this._isPanelCanBeOpened=this._domPanelEnabled||this._orderPanelEnabled,this._pageTabs=null,this._pages={},this._panelWidth=F.minPanelWidth,this.setPage=e=>{this.isOpened.value()&&this.activePage.value()!==e&&this._pages[this.activePage.value()]&&this._pages[this.activePage.value()].unmount(),this.activePage.setValue(e),n.setValue(q.settingsKeys.TRADING_PANEL_ACTIVE_PAGE,e)},this.openPage=e=>{this.setPage(e),this.open()},this.open=()=>{const e=this._pages[this.activePage.value()];if(this.isOpeningAvailable.value()&&e){this._togglePanel(!0),this.isOpened.setValue(!0);const r=e.headerStateValue();(0,we.mountHeader)(this._header,r),null!==this._tabsConfig&&null!==this._pageTabs&&(t=this._pageTabs,i={items:this._tabsConfig.items,activeTabId:this.activePage.value(),isVisible$:r.backFunction$.pipe((0,p.map)((e=>void 0===e))),onSelect:this._tabsConfig.onSelect},Be.render(pe.createElement(He,{...i}),t)),e.mount()}var t,i},this.close=()=>{this.isOpened.setValue(!1),this._pages[this.activePage.value()]&&this._pages[this.activePage.value()].unmount(),(0,we.unmountHeader)(this._header),this._togglePanel(!1)},this._onLayoutResizeHandleMousedown=e=>{if(e.defaultPrevented||!e.cancelable)return;e.preventDefault();const t=Math.max(this._resizerBridge.width.value(),0);let i;i="touches"in e?e.touches[0].clientX:e.clientX;const r=e=>{let r;e.preventDefault(),r="touches"in e?e.touches[0].clientX:e.clientX;let s=t-(r-i);s<F.minPanelWidth?s=F.minPanelWidth:s>F.maxPanelWidth&&(s=F.maxPanelWidth),this._requestWidth(s)},s=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("touchmove",r),document.removeEventListener("mouseup",s),document.removeEventListener("touchend",s),n.setValue(q.settingsKeys.PANEL_WIDTH,this._panelWidth)};document.addEventListener("mousemove",r),document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("mouseup",s),document.addEventListener("touchend",s,{passive:!1})};let i=n.getValue(q.settingsKeys.TRADING_PANEL_ACTIVE_PAGE,this._orderPanelEnabled?F.TradingPage.OrderPanel:F.TradingPage.DOMPanel);i!==F.TradingPage.DOMPanel||this._domPanelEnabled||(i=F.TradingPage.OrderPanel),i!==F.TradingPage.OrderPanel||this._orderPanelEnabled||(i=F.TradingPage.DOMPanel),this.activePage=new N.WatchedValue(i);{const e=n.getBool(q.settingsKeys.TRADING_PANEL_OPENED,this._showOrderPanelOnStart);this.isOpened.setValue(e&&this._isPanelCanBeOpened)}this._tabsConfig=t,this._resizerBridge=e,this._rootContainer=this._resizerBridge.container.value(),this._rootContainer.classList.add(Ge.rootContainer),this._rootContainer.classList.toggle(Ge.hidden,!this.isOpened.value()),this.container=document.createElement("div"),this.container.classList.add(Ge["trading-panel-content"],"trading-panel-content"),this._header=document.createElement("div"),this._header.classList.add(Ge["trading-panel-header"]),this._rootContainer.appendChild(this._header),
null!==this._tabsConfig&&(this._pageTabs=document.createElement("div"),this._pageTabs.classList.add(Ge["trading-panel-tabs"]),this._rootContainer.appendChild(this._pageTabs)),this._rootContainer.appendChild(this.container),this._addSpinner(),this._addResizeHandler(),this._subscribeVisibility(),this.isLoading.subscribe(this._setLoading.bind(this))}addPage(e,t){this._pages[e]=t}isPageOpened(e){return this.isOpened.value()&&this.activePage.value()===e}_setLoading(e){e?(this._header.style.display="none",null!==this._pageTabs&&(this._pageTabs.style.display="none"),this.container.style.visibility="hidden",this.container.style.opacity="0",this._rootContainer.appendChild(this._spinnerContainer)):(this._header.style.removeProperty("display"),null!==this._pageTabs&&this._pageTabs.style.removeProperty("display"),this.container.style.removeProperty("visibility"),this.container.style.removeProperty("opacity"),this._rootContainer.contains(this._spinnerContainer)&&this._rootContainer.removeChild(this._spinnerContainer))}_addSpinner(){this._spinnerContainer=document.createElement("div"),this._spinnerContainer.classList.add(Ge["trading-panel-spinner"]),i.e(7102).then(i.bind(i,974063)).then((e=>{e.render(this._spinnerContainer)}))}_addResizeHandler(){this._handle=document.createElement("div"),this._handle.classList.add(Ge["trading-panel-handle"]),this._rootContainer.appendChild(this._handle),this._handle.addEventListener("mousedown",this._onLayoutResizeHandleMousedown,{passive:!1}),this._handle.addEventListener("touchstart",this._onLayoutResizeHandleMousedown,{passive:!1}),this._panelWidth=n.getInt(q.settingsKeys.PANEL_WIDTH)||F.minPanelWidth}_togglePanel(e){this._resizerBridge.negotiateWidth(e?this._panelWidth:0),this._resizerBridge.negotiateHeight(e?F.panelHeight:0),this._rootContainer.classList.toggle(Ge.hidden,!e),n.setValue(q.settingsKeys.TRADING_PANEL_OPENED,e)}_updateOpeningAvailability(){const e="visible"!==document.visibilityState||this._resizerBridge.visible.value();this.isOpeningAvailable.setValue(Boolean(e&&this._isPanelCanBeOpened&&this._resizerBridge.availHeight.value()>=F.panelHeight&&this._resizerBridge.availWidth.value()>=this._panelWidth))}_subscribeVisibility(){this._updateOpeningAvailability(),this._resizerBridge.visible.subscribe((()=>{this._updateOpeningAvailability()})),this._resizerBridge.availHeight.subscribe((()=>{this._updateOpeningAvailability()})),this._resizerBridge.availWidth.subscribe((()=>{this._updateOpeningAvailability()}))}_requestWidth(e){this._canResizeWidth(e)&&this._resizerBridge.width.value()!==e&&(this._resizerBridge.negotiateWidth([{min:F.minPanelWidth,max:e}]),this._panelWidth=e)}_canResizeWidth(e){return e+45<=this._resizerBridge.availWidth.value()}}var Ze=i(989175);const Je=(0,E.getLogger)("Chart.PointsetManager");let Xe=0;class Ye{constructor(e,t,i,r,s){this._currentPointsetId=null,this._onUpdate=new A.Delegate,this._requestPoints=[],this._gateway=e,this._pointsetSuffix=t,this._isGatewayConnected=this._gateway.isConnected().spawn(),
this._isGatewayConnected.subscribe(this._updateByGatewayConnection.bind(this)),this._addPoints(i,r,s)}onUpdate(){return this._onUpdate}destroy(){this._isGatewayConnected.value()&&null!==this._currentPointsetId&&this._gateway.removePointset(this._currentPointsetId),this._requestPoints=[],this._currentPointsetId=null,this._isGatewayConnected.destroy()}_updateByGatewayConnection(e){e||(this._currentPointsetId=null,this._requestPoints=[])}_addPoints(e,t,i){var s,o;this._isGatewayConnected.value()&&((0,r.assert)(e.length>0,"Can't possible create point set for empty array of time points"),this._requestPoints=e.map((e=>[e.time_t,e.offset])),this._currentPointsetId=(s=this._pointsetSuffix,o=++Xe,`pointset_${s}_${o}`),this._gateway.createPointset(this._currentPointsetId,"turnaround",t,(0,Ze.getServerInterval)(i),this._requestPoints,this._onMessage.bind(this)))}_onMessage(e){switch(e.method){case"pointset_error":Je.logNormal(`Pointset error with id ${e.params[0]} turnaround ${e.params[1]}`);break;case"data_update":{const t=[];for(const i of e.params.plots)t.push({time_t:this._requestPoints[i.index][0],index:i.value[0],barTime:i.value[1]});this._onUpdate.fire(t);break}}}}var et=i(976418),tt=i(658098);function it(e){const t=e.mainSeries().data().first();return null===t?null:t.value[0]}async function rt(e,t,r){const[s,o,n]=await Promise.all([Promise.all([i.e(882),i.e(5546),i.e(3519),i.e(2650)]).then(i.bind(i,755962)),Promise.all([i.e(882),i.e(5546),i.e(3519),i.e(2650)]).then(i.bind(i,808779)),Promise.all([i.e(882),i.e(5546),i.e(3519),i.e(2650)]).then(i.bind(i,933417))]);e.addCustomSource("executions",((e,i)=>{const a=i.mainSeries(),l=a.dataEvents(),c=(0,tt.createPrimitivePropertyFromWatchedValue)(i.isInReplay().weakReference()),d=(0,et.createPrimitivePropertyFromGetterAndSubscription)((()=>a.isConvertedToOtherCurrency()||a.isConvertedToOtherUnit()),a.symbolResolved()),u={arrowVisibility:(0,et.combineProperty)(((e,t,i)=>i&&!t),c.ownership(),d.ownership(),i.properties().childs().tradingProperties.childs().showExecutions.weakReference()),labelVisibility:i.properties().childs().tradingProperties.childs().showExecutionsLabels},h=function(e,t,i){return r=>{const s=i.seriesSource().symbolInstanceId(),o=i.interval();return null===s?null:new Ye(e,t,r,s,o)}}(i.chartApi(),"executions",a),p=(0,et.createWVFromGetterAndSubscription)(it.bind(null,i),l.barReceived()),g=new s.ExecutionsService(t,l,function(e){return()=>{const t=e.symbolInfo();return null!==t?t.pro_name||t.full_name:e.proSymbol()}}(a)),m=new o.ExecutionsPointsManager(g,h,p);return new n.ExecutionsSource(e,i,u,r,m)}))}var st=i(936145),ot=i(470692),nt=i(759333),at=i(172912),lt=i(41899);const ct=s.t(null,void 0,i(99234)),dt=s.t(null,void 0,i(527953)),ut=s.t(null,void 0,i(556445)),ht=s.t(null,void 0,i(44402)),pt=s.t(null,void 0,i(606569)),gt=s.t(null,void 0,i(659707)),mt=s.t(null,void 0,i(316183)),_t=s.t(null,void 0,i(598721)),bt=I.enabled("broker_button");class vt{
constructor({dataEvents:e,getSymbolName:t,isNonTradableInstrument:i,qtySuggester:r,tradingCommands:s,settings:o,isInReplay:n,hibernated:a}){this.ask=new N.WatchedValue(null),this.askTooltip=new N.WatchedValue(ct),this.bid=new N.WatchedValue(null),this.bidTooltip=new N.WatchedValue(dt),this.spread=new N.WatchedValue(null),this.spreadTooltip=new N.WatchedValue(gt),this.qty=new N.WatchedValue(null),this.qtyTooltip=new N.WatchedValue(""),this.brokerIconVisible=new N.WatchedValue(!1),this.brokerIconLoading=new N.WatchedValue(!1),this.brokerIconUrl=new N.WatchedValue(null),this.isQtyVisible=new N.WatchedValue(!1),this.hasAskBidAdditionalPrecision=new N.WatchedValue(!1),this.canTrade=new N.WatchedValue(!0),this._globalVisibility=null,this._isSymbolTradableResult=new nt.WatchedObject(null),this._formatter=null,this._spreadFormatter=null,this._symbol=null,this._abortController=new AbortController,this.setQty=e=>{this.qty.setValue(String(e))},this._createTradedSymbol=()=>{var e;const t=this._getSymbolName();null===(e=this._symbolChangeSubscription)||void 0===e||e.unsubscribe(),this._clearTradedSymbol(),t.length>0&&this._initTradedSymbol(t)},this._onSuggestedQtyChange=e=>{this._lastSuggestedQty=e,this.setQty(e)},this._updateIsSymbolTradable=async e=>{if(null===this._symbol)return void this._isSymbolTradableResult.setValue(null);const t=await this._realtimeProvider.isTradable(this._symbol);(null==e?void 0:e.aborted)||this._isSymbolTradableResult.setValue((0,lt.clone)(t))},this._updateIsSymbolTradable=(0,V.respectLatest)(this._updateIsSymbolTradable);const{noConfirmEnabled:l,showSellBuyButtons:c,themeName:d}=o;this._isInstantMode=l,this._dataEvents=e,this._getSymbolName=t,this._qtySuggester=r,this._realtimeProvider=s.realtimeProvider,this._onNeedSelectBroker=s.onNeedSelectBroker,this._toggleTradingWidget=s.toggleTradingWidget,this._toggleTradingPanelPopup=s.toggleTradingPanelPopup,this._brokerCommandsUI=s.brokerCommandsUI,this._makeActualTradingSymbolObservable=s.makeActualSymbolObservable,this._updateRealtimeDataHandler=this._updateRealtimeData.bind(this),this._isBrokerConnected=(0,et.createWVFromGetterAndSubscription)((()=>null!==this._realtimeProvider.activeBroker()),this._realtimeProvider.onStatusChanged),this._isBrokerConnected.subscribe(this._updateQtyTooltip.bind(this),{callWithLast:!0}),this._isBrokerConnected.subscribe(this._updateBrokerIcon.bind(this)),this._isBrokerConnected.subscribe(this._createTradedSymbol),this._isBrokerConnecting=(0,et.createWVFromGetterAndSubscription)((()=>2===s.brokerConnectionStatus()),s.onBrokerConnectionStatusChange),this._isBrokerConnecting.subscribe(this._updateBrokerIcon.bind(this)),this.visible=new N.WatchedValue(!1),this._enabled=(0,M.combine)(((e,t)=>e&&!t),this.visible.weakReference(),a.ownership()),this._enabled.subscribe(this._toggleState.bind(this),{callWithLast:!0}),this._showSellBuyButtons=c,this._isInReplay=n,this._isNonTradableInstrument=i,this._showSellBuyButtons.subscribe(this._updateVisibility.bind(this)),this._isInReplay.subscribe(this._updateVisibility.bind(this)),
this._isNonTradableInstrument.subscribe(this._updateVisibility.bind(this)),this._updateVisibility(),this._themeName=d,this._themeName.subscribe(this._updateBrokerIcon.bind(this),{callWithLast:!0}),this._tradePossibilityComputedWV=(0,M.combine)((()=>({})),this._isBrokerConnected.weakReference(),this._isSymbolTradableResult.weakReference(),this.ask.weakReference(),this.bid.weakReference()),this._tradePossibilityComputedWV.subscribe(this._updateTradePossibilityAndTooltip.bind(this),{callWithLast:!0}),this._isQtyVisibleComputedWV=(0,M.combine)((()=>({})),this.canTrade.weakReference(),this._isInstantMode.weakReference()),this._isQtyVisibleComputedWV.subscribe(this._updateIsQtyVisible.bind(this),{callWithLast:!0})}destroy(){var e;this._abortController.abort(),this._stop(),this._isBrokerConnected.destroy(),this._showSellBuyButtons.release(),this._isInReplay.release(),this._isNonTradableInstrument.release(),null===(e=this._globalVisibility)||void 0===e||e.release(),this._isInstantMode.release(),this._tradePossibilityComputedWV.destroy(),this._isQtyVisibleComputedWV.destroy(),this._themeName.release(),this._isBrokerConnecting.destroy(),this._enabled.destroy()}setGlobalVisibility(e){(0,r.assert)(null===this._globalVisibility,"GlobalVisibility can be set only once"),this._globalVisibility=e,this._globalVisibility.subscribe(this._updateVisibility.bind(this),{callWithLast:!0})}async tryToPlaceSellOrder(){await this._tryToPlaceOrder(parseFloat((0,r.ensureNotNull)(this.bid.value())),-1)}async tryToPlaceBuyOrder(){await this._tryToPlaceOrder(parseFloat((0,r.ensureNotNull)(this.ask.value())),1)}async getQtyInfo(){return null!==this._symbol&&this.canTrade.value()?(await this._realtimeProvider.symbolInfo(this._symbol)).qty:null}applyQty(){if(null===this._symbol||!this.canTrade.value())return;const e=this.qty.value(),t=null!==e?Number(e):null;null!==t&&this._qtySuggester.setQty(this._symbol,t),void 0!==this._lastSuggestedQty&&t!==this._lastSuggestedQty&&this.qty.setValue(String(this._lastSuggestedQty))}canShowMobileTrading(){var e;return!(null===(e=window.TradingView.bottomWidgetBar)||void 0===e?void 0:e.isVisible().value())}_updateVisibility(){const e=(null===this._globalVisibility||this._globalVisibility.value())&&this._showSellBuyButtons.value()&&!this._isInReplay.value()&&!this._isNonTradableInstrument.value();this.visible.setValue(e)}async _tryToPlaceOrder(e,t){var i,s;if(null===this._realtimeProvider.activeBroker())return this.canShowMobileTrading()?this._toggleTradingPanelPopup():await this._toggleTradingWidget(),void this._onNeedSelectBroker.fire();const o=Number(this.qty.value())||1,n=this._isMarketOrderSupported()?2:1,a=1===t?null===(i=this._currentQuotes)||void 0===i?void 0:i.ask:null===(s=this._currentQuotes)||void 0===s?void 0:s.bid,l={symbol:(0,r.ensureNotNull)(this._symbol),qty:o,side:t,type:n,seenPrice:null!=a?a:null,currentQuotes:this._currentQuotes};1===n&&(l.limitPrice=e),await(0,r.ensureNotNull)(this._brokerCommandsUI()).placeOrder(l,!0)}_toggleState(e){e?this._start():this._stop()}_start(){
this._dataEvents.symbolResolved().subscribe(this,this._createTradedSymbol),this._dataEvents.symbolError().subscribe(this,this._createTradedSymbol),this._createTradedSymbol()}_stop(){var e;null===(e=this._symbolChangeSubscription)||void 0===e||e.unsubscribe(),this._clearTradedSymbol(),this._symbol=null,this._dataEvents.symbolResolved().unsubscribeAll(this),this._dataEvents.symbolError().unsubscribeAll(this)}_initTradedSymbol(e){this._symbol=e,this._updateIsSymbolTradable(this._abortController.signal),this._realtimeProvider.subscribeRealtime(this._symbol,this._updateRealtimeDataHandler),this._resubscribeQtySuggester()}_clearTradedSymbol(){var e;this._currentQuotes=void 0,this.ask.setValue(null),this.bid.setValue(null),this.spread.setValue(null),this.qty.setValue(null),null!==this._symbol&&(this._realtimeProvider.unsubscribeRealtime(this._symbol,this._updateRealtimeDataHandler),null===(e=this._qtySuggesterSubscription)||void 0===e||e.unsubscribe(),this._symbol=null,this._updateIsSymbolTradable(this._abortController.signal))}async _resubscribeQtySuggester(){var e;const t=this._symbol;if(null===t)return;null===(e=this._qtySuggesterSubscription)||void 0===e||e.unsubscribe();const i=this._suggestedQtyPromise=this._qtySuggester.getQty(t),r=await i;i===this._suggestedQtyPromise&&t===this._symbol&&(this._lastSuggestedQty=r,this.setQty(r),this._qtySuggesterSubscription=this._qtySuggester.suggestedQtyChanged(t).subscribe(this._onSuggestedQtyChange))}_isMarketOrderSupported(){const e=this._realtimeProvider.activeBroker();return null===e||Boolean(e.metainfo().configFlags.supportMarketOrders)}_updateTradePossibilityAndTooltip(){this._updateCanTrade(),this._updateSellBuyTooltip()}_updateCanTrade(){const e=this._isSymbolTradableResult.value(),t=this._isBrokerConnected.value()&&null!==e&&e.tradable;this.canTrade.setValue(t)}_updateSellBuyTooltip(){var e,t;const i=this._getNonTradedTooltip();this.askTooltip.setValue(null!==(e=null!=i?i:this._getAskTooltip())&&void 0!==e?e:ct),this.bidTooltip.setValue(null!==(t=null!=i?i:this._getBidTooltip())&&void 0!==t?t:dt)}_getNonTradedTooltip(){const e=this._isSymbolTradableResult.value();if(this._isBrokerConnected.value()&&null!==e&&!e.tradable)return void 0!==e.solutions?"":void 0!==e.shortReason&&""!==e.shortReason?e.shortReason:ut}_getAskTooltip(){return null===this.ask.value()?pt:void 0}_getBidTooltip(){return null===this.bid.value()?ht:void 0}_updateRealtimeData(e,t,i){this._formatter=i.formatter,this._spreadFormatter=i.spreadFormatter;const r=t.ask,s=t.bid,o=(0,d.isNumber)(r),n=(0,d.isNumber)(s),a=o?this._formatter.format(r):null,l=n?this._formatter.format(s):null;this.ask.setValue(a),this.bid.setValue(l),o&&n&&(this._currentQuotes={ask:r,bid:s});const c=t.spread||(0,d.isNumber)(r)&&(0,d.isNumber)(s)&&r-s||0,u=(0,d.isNumber)(t.spread)?this._spreadFormatter:this._formatter;this.spread.setValue(u.format(c));let h=!1;(0,at.isFormatterHasForexAdditionalPrecision)(this._formatter)&&(h=this._formatter.hasForexAdditionalPrecision()),this.hasAskBidAdditionalPrecision.setValue(h)}
_updateIsQtyVisible(){const e=this._isInstantMode.value()&&this.canTrade.value();this.isQtyVisible.setValue(e)}_updateQtyTooltip(){this.qtyTooltip.setValue(this._getQtyTooltip())}_getQtyTooltip(){const e=this._realtimeProvider.activeBroker();return null!==e&&e.metainfo().configFlags.showQuantityInsteadOfAmount?_t:mt}_updateBrokerIcon(){if(!bt)return;let e;const t=this._realtimeProvider.activeBroker();if(null!==t){const i=t.metainfo();e="dark"===this._themeName.value()&&i.logoMiniBlackUrl?i.logoMiniBlackUrl:i.logoMiniUrl}this.brokerIconVisible.setValue(this._isBrokerConnected.value()),this.brokerIconLoading.setValue(this._isBrokerConnecting.value()),this.brokerIconUrl.setValue(e||null)}}var yt=i(540873),ft=i(343370),kt=i(72304),Pt=i(162458),St=i(614588),Ct=i(672511);const wt=(0,i(790606).reactLoaderRendererCreator)(Ct.Spinner,{size:"xxsmall"});var Bt=i(126373),Tt=i(344557);var Et=i(190787),Ot=i(891751),Dt=i(976920),It=i(806345),xt=i(829883);const Mt=parseInt(It["css-value-padding"]);var Nt;!function(e){e.BidAskDefaultText="...",e.TrackEventOrigin="Sell/Buy Buttons"}(Nt||(Nt={}));function At(e,t,i,s){let o=e.querySelector(`.${s}`);if(!i)return null!==o&&o.remove(),void(0,Et.updateTextNode)(e,t);null===o&&(o=document.createElement("span"),o.classList.add(s),e.appendChild(o)),(0,Et.updateTextNode)((0,r.ensureNotNull)(o),t.slice(-1)),(0,Et.updateTextNode)(e,t.slice(0,-1))}var Lt,Vt;!function(e){e[e.Hidden=0]="Hidden",e[e.Column=1]="Column",e[e.Row=2]="Row"}(Lt||(Lt={})),function(e){e[e.Width=567]="Width",e[e.Height=440]="Height"}(Vt||(Vt={}));class Rt{constructor({model:e,highButtonsMode:t,trackEvent:i,toggleMinimizeBottomWidgetBar:r}){this.element=document.createElement("div"),this._buttonsWrapperEl=document.createElement("div"),this._informerWrapperEl=null,this._sellButtonEl=document.createElement("div"),this._sellButtonTextEl=document.createElement("span"),this._buyButtonEl=document.createElement("div"),this._buyButtonTextEl=document.createElement("span"),this._spreadQtyWrapper=document.createElement("div"),this._spreadEl=document.createElement("div"),this._qtyEl=document.createElement("div"),this._qtyTextEl=document.createElement("span"),this._brokerButtonEl=document.createElement("div"),this._brokerIconWrapEl=document.createElement("div"),this._isCalcOpened=!1,this._calcContainer=document.createElement("div"),this._sellLoader=(0,St.createPointsLoaderRenderer)(this._sellButtonEl,{className:Ot.loader}),this._buyLoader=(0,St.createPointsLoaderRenderer)(this._buyButtonEl,{className:Ot.loader}),this._brokerLoader=wt(this._brokerButtonEl,{className:Ot.circleLoader}),this._windowResizeHandlerThrottle=(0,ft.default)(this._windowResizeHandler.bind(this),100),this._isHiddenByViewport=!1,this._mode=2,this._height=new N.WatchedValue(0),this._resizeObserver=null,this._cachedBreakPoints={},this._parentWidth=0,this._getCurrentQty=()=>{const e=this._qty.value();return null!==e?Number(e):null},this._model=e,this._toggleMinimizeBottomWidgetBar=r,this._ask=this._model.ask.spawn(),this._ask.subscribe(this._updateBuyButton.bind(this)),
this._bid=this._model.bid.spawn(),this._bid.subscribe(this._updateSellButton.bind(this)),this._spread=this._model.spread.spawn(),this._spread.subscribe(this._updateSpread.bind(this)),this._qty=this._model.qty.spawn(),this._qty.subscribe(this._updateQty.bind(this)),this._brokerIconVisible=this._model.brokerIconVisible.spawn(),this._brokerIconVisible.subscribe(this._updateBrokerIconImage.bind(this)),this._brokerIconLoading=this._model.brokerIconLoading.spawn(),this._brokerIconLoading.subscribe(this._updateBrokerIconImage.bind(this)),this._brokerIconUrl=this._model.brokerIconUrl.spawn(),this._brokerIconUrl.subscribe(this._updateBrokerIconImage.bind(this),{callWithLast:!0}),this._trackEvent=i,this._render(),this._askTooltip=this._model.askTooltip.spawn(),this._askTooltip.subscribe(this._updateButtonTooltip.bind(this,this._buyButtonEl),{callWithLast:!0}),this._bidTooltip=this._model.bidTooltip.spawn(),this._bidTooltip.subscribe(this._updateButtonTooltip.bind(this,this._sellButtonEl),{callWithLast:!0}),this._spreadTooltip=this._model.spreadTooltip.spawn(),this._spreadTooltip.subscribe(this._updateButtonTooltip.bind(this,this._spreadEl),{callWithLast:!0}),this._qtyTooltip=this._model.qtyTooltip.spawn(),this._qtyTooltip.subscribe(this._updateButtonTooltip.bind(this,this._qtyEl),{callWithLast:!0}),this._canTrade=this._model.canTrade.spawn(),this._canTrade.subscribe(this._updateBgButtonsMode.bind(this),{callWithLast:!0}),this._isVisible=this._model.visible.spawn(),this._isVisible.subscribe(this._updateVisibility.bind(this),{callWithLast:!0}),this._isQtyVisible=this._model.isQtyVisible.spawn(),this._isQtyVisible.subscribe(this._updateQtyVisibility.bind(this),{callWithLast:!0}),this._isLastDigitSup=this._model.hasAskBidAdditionalPrecision.spawn(),this._isLastDigitSup.subscribe(this._updateLastDigitSup.bind(this)),this._highButtonsMode=t.spawn(),this._highButtonsMode.subscribe(this._updateHighButtonsMode.bind(this),{callWithLast:!0}),this._sellButtonHandler=this._onSellButton.bind(this),this._buyButtonHandler=this._onBuyButton.bind(this),this._qtyHandler=this._toggleCalcVisibility.bind(this),this._brokerButtonHandler=this._onBrokerButton.bind(this),this._sellButtonEl.addEventListener("click",this._sellButtonHandler),this._buyButtonEl.addEventListener("click",this._buyButtonHandler),this._qtyEl.addEventListener("click",this._qtyHandler),this._brokerButtonEl.addEventListener("click",this._brokerButtonHandler),window.addEventListener("resize",this._windowResizeHandlerThrottle),this._windowResizeHandler()}destroy(){var e;this._ask.destroy(),this._askTooltip.destroy(),this._bid.destroy(),this._bidTooltip.destroy(),this._spread.destroy(),this._spreadTooltip.destroy(),this._qty.destroy(),this._qtyTooltip.destroy(),this._isVisible.destroy(),this._isQtyVisible.destroy(),this._isLastDigitSup.destroy(),this._highButtonsMode.destroy(),this._canTrade.destroy(),this._brokerIconUrl.destroy(),this._sellLoader.destroy(),this._buyLoader.destroy(),this._brokerLoader.destroy(),this._sellButtonEl.removeEventListener("click",this._sellButtonHandler),
this._buyButtonEl.removeEventListener("click",this._buyButtonHandler),this._qtyEl.removeEventListener("click",this._qtyHandler),this._brokerButtonEl.removeEventListener("click",this._brokerButtonHandler),null===(e=this._resizeObserver)||void 0===e||e.disconnect(),this._resizeObserver=null,this.element.remove(),delete this.element,window.removeEventListener("resize",this._windowResizeHandlerThrottle)}updateModeByWidth(e){var t;const i=this._cachedBreakPoints[0],r=this._cachedBreakPoints[1];this._mode=void 0!==i&&e<i?0:void 0!==r&&e<r?1:2,this._parentWidth=e;const s=1===this._mode;this._buttonsWrapperEl.classList.toggle(Ot.column,s),null===(t=this._informerWrapperEl)||void 0===t||t.classList.toggle(Ot.column,s),this._updateVisibility()}height(){return this._height}renderTo(e,t){void 0!==t?e.insertBefore(this.element,t):e.appendChild(this.element),null===this._resizeObserver&&(this._resizeObserver=new ResizeObserver(this._updateBreakPointsAndSize.bind(this))),this._resizeObserver.unobserve(this.element),this._resizeObserver.observe(this.element)}isHiddenByViewport(){return this._isHiddenByViewport}_render(){const e=this._bid.value()||"...";this._sellButtonTextEl.appendChild(document.createTextNode(e)),this._sellButtonTextEl.classList.add(Ot.buttonText),this._sellButtonEl.append(this._sellButtonTextEl),this._sellButtonEl.classList.add("apply-common-tooltip",Ot.button,Ot.sellButton);const t=this._spread.value()||"";this._spreadEl.appendChild(document.createTextNode(String(t))),this._spreadEl.classList.add("apply-common-tooltip",Ot.spread);const i=this._qty.value()||"";this._qtyTextEl.appendChild(document.createTextNode(i)),this._qtyEl.append(this._qtyTextEl),this._qtyEl.setAttribute("data-name","qtyEl"),this._qtyEl.classList.add("apply-common-tooltip",Ot.button,Ot.qty),this._spreadQtyWrapper.classList.add(Ot.spreadQtyWrapper),this._spreadQtyWrapper.appendChild(this._spreadEl),this._spreadQtyWrapper.appendChild(this._qtyEl);const r=this._ask.value()||"...";this._buyButtonTextEl.appendChild(document.createTextNode(String(r))),this._buyButtonTextEl.classList.add(Ot.buttonText),this._buyButtonEl.append(this._buyButtonTextEl),this._buyButtonEl.classList.add("apply-common-tooltip",Ot.button,Ot.buyButton),this._brokerButtonEl.appendChild(this._brokerIconWrapEl),this._brokerIconWrapEl.classList.add(Ot.brokerButtonIconWrap),this._brokerButtonEl.classList.add(Ot.brokerButton),this._buttonsWrapperEl.appendChild(this._sellButtonEl),this._buttonsWrapperEl.appendChild(this._spreadQtyWrapper),this._buttonsWrapperEl.appendChild(this._buyButtonEl),this._buttonsWrapperEl.appendChild(this._brokerButtonEl),this._buttonsWrapperEl.classList.add(Ot.buttonsWrapper),this._buttonsWrapperEl.classList.toggle(Ot.touchMode,Bt.trackingModeIsAvailable),this._buttonsWrapperEl.classList.toggle(Ot.notAvailableOnMobile,false),this.element.appendChild(this._buttonsWrapperEl),this._initTradingInformer(),this.element.classList.add(Ot.container)}_initTradingInformer(){0}_updateBreakPointsAndSize(e){const t=e[0],i=2*Mt
;2===this._mode&&(this._cachedBreakPoints[1]=Math.round(t.contentRect.width)+i),1===this._mode&&(this._cachedBreakPoints[0]=Math.round(t.contentRect.width)+i),this.updateModeByWidth(this._parentWidth);const r=t.contentRect.height>0?Math.round(t.contentRect.height)+i:0;this._height.setValue(r)}_updateBrokerIconImage(){const e=this._brokerIconLoading.value(),t=!this._brokerIconVisible.value()&&!e;if(this._brokerButtonEl.classList.toggle(Dt.blockHidden,t),t)return;if(this._toggleLoaderVisibility(this._brokerButtonEl,this._brokerLoader,e),e)return void(this._brokerIconWrapEl.innerHTML="");const i=this._brokerIconUrl.value(),r=null===i;this._brokerIconWrapEl.innerHTML=r?xt:`<image src="${i}" alt="Account Manager" />`,this._brokerButtonEl.classList.toggle(Ot.brokerButtonDefault,r)}async _onSellButton(){if(null===this._bid.value())return;const e=this._highButtonsMode.value();this._trackEvent("Sell/Buy Buttons","Sell",e?"Instant":"Not Instant"),e&&this._canTrade.value()&&this._toggleLoaderVisibility(this._sellButtonEl,this._sellLoader,!0),await this._model.tryToPlaceSellOrder(),e&&this._canTrade.value()&&setTimeout((()=>this._toggleLoaderVisibility(this._sellButtonEl,this._sellLoader,!1)),300)}async _onBuyButton(){if(null===this._ask.value())return;const e=this._highButtonsMode.value();this._trackEvent("Sell/Buy Buttons","Buy",e?"Instant":"Not Instant"),e&&this._canTrade.value()&&this._toggleLoaderVisibility(this._buyButtonEl,this._buyLoader,!0),await this._model.tryToPlaceBuyOrder(),e&&this._canTrade.value()&&setTimeout((()=>this._toggleLoaderVisibility(this._buyButtonEl,this._buyLoader,!1)),300)}_onBrokerButton(){this._model.canShowMobileTrading()?async function(){(await(0,Tt.waitTradingService)()).tradingPanelPopup.show()}():this._toggleMinimizeBottomWidgetBar()}_toggleLoaderVisibility(e,t,i){e.classList.toggle(Ot.loading,i),t.toggleVisibility(i)}_updateBuyButton(e){const t=null!==e&&this._isLastDigitSup.value();At(this._buyButtonTextEl,`${e||"..."}`,t,Ot.lastCharSup)}_updateSellButton(e){const t=null!==e&&this._isLastDigitSup.value();At(this._sellButtonTextEl,`${e||"..."}`,t,Ot.lastCharSup)}_updateSpread(e){const t=`${e||""}`;(0,Et.updateTextNode)(this._spreadEl,t),this._updateVisibilityForSpreadQtyWrapper()}_updateQty(e){let t=`${e||""}`;!this._isCalcOpened&&t.length>0&&(t=(0,x.abbreviatedNumber)(Number(t))),(0,Et.updateTextNode)(this._qtyTextEl,t)}_updateHighButtonsMode(e){this._buttonsWrapperEl.classList.toggle(Ot.highButtons,e)}_updateBgButtonsMode(e){var t;this._buttonsWrapperEl.classList.toggle(Ot.withoutBg,!e),null===(t=this._informerWrapperEl)||void 0===t||t.classList.toggle(Dt.blockHidden,!e)}_updateVisibilityForSpreadQtyWrapper(){const e=!this._isQtyVisible.value()&&null===this._spread.value();this._spreadQtyWrapper.classList.toggle(Dt.blockHidden,e)}_updateQtyVisibility(e){this._qtyEl.classList.toggle(Dt.blockHidden,!e),this._spreadQtyWrapper.classList.toggle(Ot.withoutQty,!e),this._updateVisibilityForSpreadQtyWrapper()}_updateVisibility(){var e
;const t=this._isVisible.value()&&0!==this._mode&&!this._isHiddenByViewport;this._buttonsWrapperEl.classList.toggle(Dt.blockHidden,!t),null===(e=this._informerWrapperEl)||void 0===e||e.classList.toggle(Dt.blockHidden,!t||!this._canTrade.value())}_updateLastDigitSup(){this._updateBuyButton(this._ask.value()),this._updateSellButton(this._bid.value())}_updateButtonTooltip(e,t){if(""===t)return(0,kt.setTooltipData)(e,"text",t),void e.removeAttribute("title");e.setAttribute("title",t)}_toggleCalcVisibility(){this._isCalcOpened=!this._isCalcOpened,this._renderCalc()}_closeCalc(){this._isCalcOpened=!1,this._updateQty(this._qty.value()),this._model.applyQty(),this._renderCalc()}_renderCalc(){Promise.all([i.e(4114),i.e(6625),i.e(4392),i.e(4447),i.e(4593),i.e(7199),i.e(9222),i.e(7125),i.e(3809)]).then(i.bind(i,713191)).then((async e=>{const t=await this._model.getQtyInfo();null!==t&&e.render(this._isCalcOpened,this._calcContainer,{...t,withInput:!0,valueGetter:this._getCurrentQty,position:this._getCalcPosition(),targetEl:this._qtyEl,onClose:this._closeCalc.bind(this),onValueChange:this._model.setQty,trackEventTarget:"Sell/Buy Buttons",trackEvent:this._trackEvent})}))}_getCalcPosition(){return(0,Pt.getPopupPositioner)(this._qtyEl,{horizontalAttachEdge:Pt.HorizontalAttachEdge.Left,horizontalDropDirection:Pt.HorizontalDropDirection.FromLeftToRight})}_windowResizeHandler(){false!==this._isHiddenByViewport&&(this._isHiddenByViewport=false,this._updateVisibility())}}const Ft=s.t(null,void 0,i(411258));class Wt{constructor(e,t,i,r,s,o,n,a){const{showSellBuyButtons:l,noConfirmEnabled:c,themeName:d}=o;this._showSellBuyButtons=l,this._isNonTradableInstrument=i,this._isInReplay=n,this._trackEvent=s.trackEvent,this._model=new vt({dataEvents:e,getSymbolName:t,isNonTradableInstrument:i.spawnOwnership(),qtySuggester:r,tradingCommands:s,settings:{noConfirmEnabled:c,themeName:d,showSellBuyButtons:l.spawnOwnership()},isInReplay:n.spawnOwnership(),hibernated:a}),this._renderer=new Rt({model:this._model,highButtonsMode:c.spawnOwnership(),trackEvent:s.trackEvent,toggleMinimizeBottomWidgetBar:s.toggleMinimizeBottomWidgetBar})}destroy(){this._model.destroy(),this._renderer.destroy(),this._isNonTradableInstrument.release(),this._isInReplay.release(),this._showSellBuyButtons.release()}renderTo(e,t){this._renderer.renderTo(e,t)}setGlobalVisibility(e){this._model.setGlobalVisibility(e)}visibility(){return this._model.visible}updateWidgetModeBySize(e){this._renderer.updateModeByWidth(e.width)}contextMenuActions(){if(this._renderer.isHiddenByViewport())return[];return[new yt.Action({actionId:"Trading.SellBuyButtonsToggleVisibility",options:{checkable:!0,checked:this._showSellBuyButtons.value(),label:Ft,disabled:this._isInReplay.value()||this._isNonTradableInstrument.value(),onExecute:()=>{const e=!this._showSellBuyButtons.value();this._showSellBuyButtons.setValue(e),this._trackEvent("SellBuyButtonsWidget context menu","Show Sell/Buy Button",e?"Check":"Uncheck")}}})]}height(){return this._renderer.height()}}var qt=i(960990);function Ut(e){
return pe.createElement("span",{className:qt.separator})}var zt=i(628640),$t=i(739390),Qt=i(995553),Ht=i(533408),jt=i(641901);const Gt=pe.forwardRef(((e,t)=>pe.createElement("div",{ref:t,className:jt.popupWrapper},e.children)));var Kt=i(753327);const Zt=(()=>{let e,t,r,s=null,o=null;return async(n,a,l,c)=>{const d=null==n?void 0:n.currentAccount();if(null===s||o!==n||e!==d||r!==c){null==t||t.remove();const{AccountManager:u}=await Promise.all([i.e(6416),i.e(3060),i.e(2603),i.e(5514),i.e(7399),i.e(2248),i.e(7769),i.e(4403),i.e(8077),i.e(5666),i.e(1729),i.e(7090),i.e(7530),i.e(7902),i.e(3493),i.e(889),i.e(7561),i.e(2829),i.e(4482),i.e(801),i.e(872),i.e(3251),i.e(5267),i.e(6227),i.e(4811),i.e(5476),i.e(6534),i.e(4226),i.e(8354)]).then(i.bind(i,597903)),h={container:a,visible:new N.WatchedValue(!0)};s=a,o=n,e=d,r=c,t=await u.create({broker:n,bridge:h,mode:0,overlapManager:l,summaryFieldsVisibilityManager:c})}else a.appendChild(s)}})(),Jt=new N.WatchedValue(null);function Xt(e){const{broker:t,summaryFieldsVisibilityManager:i}=e,r=(0,pe.useRef)(null),s=(0,pe.useContext)(Kt.SlotContext);return(0,pe.useEffect)((()=>{Jt.setValue(s)}),[s]),(0,pe.useEffect)((()=>{null!==r.current&&Zt(t,r.current,Jt.readonly(),i)}),[]),pe.createElement(Gt,{ref:r})}var Yt=i(132455),ei=i(628370),ti=i(332510),ii=i(651674),ri=i(820669);const si=s.t(null,void 0,i(276495));class oi extends Qt.DialogRenderer{constructor(e){super(),this._title=si,this._isSubscribed=!1,this._showSeparator=!0,this._handleClose=()=>{var e;null===(e=this._rootInstance)||void 0===e||e.unmount(),this._rootInstance=null,this._setVisibility(!1)},this._trading=e}visible(){return this._visibility.spawn().readonly()}show(){this._isSubscribed||(this._isSubscribed=!0,this._onStatusChange(this._trading.connectStatus()),this._trading.onConnectionStatusChange.subscribe(this,this._onStatusChange)),this._setVisibility(!0),this._renderComponent()}hide(){this._handleClose()}_onStatusChange(e,t){var i,r;null===(i=this._trading.activeBroker())||void 0===i||i.currentAccountUpdate.unsubscribe(this,this._renderAccountManager),this._connectStatus!==e&&(this._connectStatus=e,this._additionalHeaderElement=void 0,window.navigator.onLine?2!==e&&(null==t?void 0:t.disconnectType)!==P.DisconnectType.Offline&&3!==e&&4!==e?1===e&&(null===(r=this._trading.activeBroker())||void 0===r||r.currentAccountUpdate.subscribe(this,this._renderAccountManager),this._renderAccountManager()):this._renderSpinner():this._renderOfflineScreen())}_renderComponent(){const e=pe.createElement(Ht.AdaptivePopupDialog,{dataName:"trading-dialog",isOpened:this.visible().value(),onClose:this._handleClose,showSeparator:this._showSeparator,fullScreen:!0,draggable:!1,title:this._title,render:()=>this._content,additionalHeaderElement:this._additionalHeaderElement,additionalElementPos:"after",headerClassName:ri.header});this._rootInstance?this._rootInstance.render(e):this._rootInstance=(0,ii.createReactRoot)(e,this._container)}_renderSpinner(){this._showSeparator=!0,this._title=si,
this._changeDialogContent(pe.createElement(Yt.Spinner,null))}_renderOfflineScreen(){this._title=si,this._changeDialogContent(pe.createElement($t.OfflineScreen,null))}async _renderBrokerSelectScreen(){0}async _renderAccountManager(){const e=(0,r.ensureNotNull)(this._trading.activeBroker()).accountManagerInfo().summary,t=new ti.SummaryFieldsVisibilityManager(e,this._trading.getBrokerTradingSettingsStorage),s=await(0,ei.makeAccountManagerHeaderDropdownsProps)(this._trading,t,0);if(this._showSeparator=!1,this._title=si,void 0!==s){const{AccountManagerHeaderDropdowns:e}=await Promise.all([i.e(6416),i.e(3060),i.e(2603),i.e(5514),i.e(7399),i.e(2248),i.e(7769),i.e(4403),i.e(8077),i.e(5666),i.e(1729),i.e(7090),i.e(7530),i.e(7902),i.e(3493),i.e(889),i.e(7561),i.e(2829),i.e(4482),i.e(801),i.e(872),i.e(3251),i.e(5267),i.e(6227),i.e(4811),i.e(5476),i.e(6534),i.e(4226),i.e(8354)]).then(i.bind(i,70587));this._title=pe.createElement(e,{...s});{const e={...s.commonDropdownProps,iconSize:"big"};this._additionalHeaderElement=pe.createElement("span",{className:ri.moreButton},pe.createElement(zt.TerminalDropdown,{...e}),pe.createElement(Ut,null))}}this._content=pe.createElement(Xt,{broker:this._trading.activeBroker(),summaryFieldsVisibilityManager:t}),this._renderComponent()}_changeDialogContent(e){this._content=pe.createElement(Gt,null,e),this._renderComponent()}}var ni,ai=i(188412),li=i(601227);async function ci(e,t){localStorage.setItem(e,t)}!function(e){e.get=async function(){return li.CheckMobile.any()||await async function(){const e=n.getValue(q.settingsKeys.ACTIVE_BROKER);if(n.remove(q.settingsKeys.ACTIVE_BROKER,{forceFlush:!0}),void 0===e)return;await ci(q.settingsKeys.ACTIVE_BROKER,e)}(),async function(e){return localStorage.getItem(e);const t=localStorage.getItem(e);if(null===t)return null;const i=await userSpecificDecrypt(t);null===i&&localStorage.removeItem(e);return i}(q.settingsKeys.ACTIVE_BROKER)},e.set=async function(e){await ci(q.settingsKeys.ACTIVE_BROKER,e)},e.clear=function(){n.remove(q.settingsKeys.ACTIVE_BROKER,{forceFlush:!0}),localStorage.removeItem(q.settingsKeys.ACTIVE_BROKER)}}(ni||(ni={}));var di=i(960521),ui=i.n(di),hi=i(749401),pi=i(265728),gi=i(233064),mi=i(218286),_i=i(169977),bi=i(482165),vi=i(312694),yi=i(822960),fi=i(499665);class ki{constructor(e){this._rawAndFilteredQtyMap=new Map,this._qtyInfo=new Map;const{symbolInfoGetter:t,onResetNeeded:i,qtySettingsStorageGetter:r}=e;this._getQtySettingsStorage=r,this._getSymbolInfo=t,i.subscribe(this,this._reset)}async getQty(e){return(0,hi.firstValueFrom)(this._getRawAndFilteredQty(e).filteredQty$)}setQty(e,t){this._getRawAndFilteredQty(e).rawQty$.next(t)}suggestedQtyChanged(e){return this._getRawAndFilteredQty(e).filteredQty$}_getRawAndFilteredQty(e){var t;return null!==(t=this._rawAndFilteredQtyMap.get(e))&&void 0!==t?t:this._makeRawAndFilteredQty(e)}_makeRawAndFilteredQty(e){const t=new pi.ReplaySubject(1),i=this._getQtySettingsStorage(),r=this._getInitialQty(e).pipe((0,gi.switchMap)((e=>t.pipe((0,_.startWith)(e)))),(0,mi.distinctUntilChanged)(),(0,
_i.filter)((t=>this._isQtyCorrect(e,t))),(0,bi.tap)((t=>null==i?void 0:i.setSymbolQty(e,t))),(0,vi.share)({connector:()=>new pi.ReplaySubject(1),resetOnRefCountZero:!1})),s={rawQty$:t,filteredQty$:r};return this._rawAndFilteredQtyMap.set(e,s),s}_isQtyCorrect(e,t){const i=(0,r.ensureDefined)(this._qtyInfo.get(e));return!(0,fi.checkQtyError)(i,t,!0).res}_getInitialQty(e){return(0,y.from)(this._getSymbolInfo(e)).pipe((0,p.map)((({qty:t})=>{var i;this._qtyInfo.set(e,t);const r=null===(i=this._getQtySettingsStorage())||void 0===i?void 0:i.symbolQty(e),s=t.default||t.min;return void 0!==r&&r>0?(o=(0,yi.clamp)(r,t.min,t.max),n=t.min,a=t.step,ui()(o).minus(n).div(a).round(0,1).mul(a).plus(n).toNumber()):s;var o,n,a})))}_reset(){this._rawAndFilteredQtyMap.forEach((({rawQty$:e})=>e.complete())),this._rawAndFilteredQtyMap.clear(),this._qtyInfo.clear()}}var Pi=i(316230);class Si{constructor(){this._context=null,this._onContextChanged=new A.Delegate,this._contextChange=()=>{this._onContextChanged.fire(this.context())}}context(){var e,t;return null!==(t=null===(e=this._context)||void 0===e?void 0:e.externalContext())&&void 0!==t?t:null}setContext(e){var t,i;this._isEqualContexts(e)||(this._clearSubscription(),this._context=e,null===(t=this._context)||void 0===t||t.onStatusChange().subscribe(this,this._contextChange),null===(i=this._context)||void 0===i||i.onDataChange().subscribe(this,this._contextChange),this._contextChange())}onContextChanged(){return this._onContextChanged}clear(){this.setContext(null)}_clearSubscription(){var e,t;null===(e=this._context)||void 0===e||e.onDataChange().unsubscribeAll(this),null===(t=this._context)||void 0===t||t.onStatusChange().unsubscribeAll(this)}_isEqualContexts(e){var t;return null===this._context||null===e?this._context===e:(null===(t=this.context())||void 0===t?void 0:t.type)===(null==e?void 0:e.externalContext().type)&&(this._context.status()===e.status()&&(0,Pi.default)(this._context.errors(),e.errors())&&(0,Pi.default)(this._context.data(),e.data()))}}var Ci=i(173587);const wi=(0,E.getLogger)("Trading Linking");class Bi{constructor(e){this._onSymbolChange=e=>{this._processSymbol(null,e)},this._processSymbol=async(e,t)=>{if(void 0===this._continuousFrontContractExtractor)return void this._value.next({symbol:t});const i=this._continuousFrontContractExtractor.makeValueObservable(t).subscribe((e=>this._value.next(e)));null==e||e.addEventListener("abort",(()=>i.unsubscribe()),{once:!0})},this._getCurrentProSymbol=()=>{var e;return null!==(e=this._source.ensuredProSymbol.value())&&void 0!==e?e:this._source.proSymbol.value()};const{source:t,getContinuousFrontContractExtractor:i}=e;this._source=t,this._getContinuousFrontContractExtractor=i;const r=this._getCurrentProSymbol();this._value=new u.BehaviorSubject({symbol:r});void 0!==(this._continuousFrontContractExtractor=i())&&this._onSymbolChange(r),this._processSymbol=(0,V.respectLatest)(this._processSymbol),t.ensuredProSymbol.subscribe(this._onSymbolChange)}reset(){
this._continuousFrontContractExtractor=this._getContinuousFrontContractExtractor(),this._onSymbolChange(this._getCurrentProSymbol())}value(){return this._value.getValue()}async setSymbol(e){const t=this.value(),r=t=>t.continuous===e||void 0===t.continuous&&t.symbol===e;if(r(t))return;const o=(0,hi.firstValueFrom)(this._value.pipe((0,Ci.skip)(1),(0,_i.filter)((t=>{const i=r(t);return i||wi.logWarn(`Waiting for symbol ${e}, but got ${t.continuous||t.symbol}`),i}))));this._source.setSymbolAndLogInitiator(e,"trading linking"),await(0,z.makeTimeLimited)(o,3e4,s.t(null,{replace:{symbol:e,actualSymbol:this.value().continuous||this.value().symbol}},i(992655)))}valueObservable(){return this._value.asObservable()}}class Ti{constructor(){this._title$=new u.BehaviorSubject(""),this._description$=new u.BehaviorSubject(void 0),this._symbol$=new u.BehaviorSubject(""),this._hasBatsQuotes$=new u.BehaviorSubject(!1),this._hasDelayedQuotes$=new u.BehaviorSubject(!1),this._isTradable$=new u.BehaviorSubject(!1),this._backFunction$=new u.BehaviorSubject(void 0),this._closeFunction$=new u.BehaviorSubject(void 0),this._informerMessage$=new u.BehaviorSubject(void 0),this._brokerId$=new u.BehaviorSubject(void 0),this._settings$=new u.BehaviorSubject(void 0),this._orderPresets$=new u.BehaviorSubject(void 0),this.title$=this._title$.asObservable(),this.description$=this._description$.asObservable(),this.symbol$=this._symbol$.asObservable(),this.hasBatsQuotes$=this._hasBatsQuotes$.asObservable(),this.hasDelayedQuotes$=this._hasDelayedQuotes$.asObservable(),this.isTradable$=this._isTradable$.asObservable(),this.backFunction$=this._backFunction$.asObservable(),this.closeFunction$=this._closeFunction$.asObservable(),this.informerMessage$=this._informerMessage$.asObservable(),this.settings$=this._settings$.asObservable(),this.brokerId$=this._brokerId$.asObservable(),this.orderPresets$=this._orderPresets$.asObservable()}setTitle(e){this._title$.next(e)}setDescription(e){this._description$.next(e)}setSymbol(e){this._symbol$.next(e)}setHasBatsQuotes(e){this._hasBatsQuotes$.next(e)}setHasDelayedQuotes(e){this._hasDelayedQuotes$.next(e)}setIsTradable(e){this._isTradable$.next(e)}setBackFunction(e){this._backFunction$.next(e)}setCloseFunction(e){this._closeFunction$.next(e)}setInformerMessage(e){this._informerMessage$.next(e)}setSettings(e){this._settings$.next(e)}setBrokerId(e){this._brokerId$.next(e)}setOrderPresets(e){this._orderPresets$.next(e)}}var Ei=i(930202),Oi=i(725784),Di=i(72693);function Ii(e){const{children:t,tooltipText:i,tooltipHotKey:r}=e;return pe.createElement("span",{className:Ee()("apply-common-tooltip",Di.content),"data-tooltip-hotkey":r,title:i},pe.createElement("span",{className:Di.contentInner},t))}const xi=(0,Oi.hotKeySerialize)({keys:[(0,Ei.humanReadableModifiers)(Ei.Modifiers.Shift,!1),"T"],text:"{0} + {1}"}),Mi=(0,Oi.hotKeySerialize)({keys:[(0,Ei.humanReadableModifiers)(Ei.Modifiers.Shift,!1),"D"],text:"{0} + {1}"});var Ni;!function(e){e.Qty="qty",e.StopLoss="stopLoss",e.TakeProfit="takeProfit",e.Duration="duration",
e.DurationDatetime="durationDatetime",e.CustomFields="customFields",e.TableColumnsOrder="tableColumnsOrder",e.SummaryFields="summaryFields",e.OrderType="orderType",e.LastUsedQuantityType="lastUsedQuantityType",e.OrderSizeCalculatorQuantityType="orderSizeCalculatorQuantityType",e.OrderSizeCalculatorValue="orderSizeCalculatorValue"}(Ni||(Ni={}));class Ai{constructor(e){this._transientStorage={},this._persistentStorageKey=`trading.${e}`;const t=n.getJSON(this._persistentStorageKey,{});delete t.orderTicketQuantity,this._transientStorage=t}setTakeProfitPips(e,t,i){this._setPips("takeProfit",e,t,i)}takeProfitPips(e){return this._getSectionValue("takeProfit",e)}setStopLossPips(e,t,i){this._setPips("stopLoss",e,t,i)}stopLossPips(e){return this._getSectionValue("stopLoss",e)}setDuration(e,t,i){const r=this.duration(e,t);null!==i&&void 0!==r&&r.type===i.type&&r.datetime===i.datetime||null===i&&void 0===r||(this._setDuration(e,t,i),this._syncStorage())}duration(e,t){var i;return this._migrateDuration(e,t),null===(i=this._getSectionValue("duration",e))||void 0===i?void 0:i[t]}setSymbolQty(e,t){this._getOrCreateSection("qty")[e]=t,this._syncStorage()}symbolQty(e){return this._getSectionValue("qty",e)}setCustomFields(e,t,i){var r,s,o;const n=this._getOrCreateSection("customFields");null!==(r=n[e])&&void 0!==r||(n[e]={}),null!==(s=(o=n[e])[t])&&void 0!==s||(o[t]={});const a=n[e][t];for(const[e,t]of Object.entries(i))"string"==typeof t&&""!==t||"boolean"==typeof t||"boolean"==typeof t.checked&&"string"==typeof t.text?a[e]=t:delete a[e];0===Object.keys(a).length&&delete n[e][t],0===Object.keys(n[e]).length&&delete n[e],this._syncStorage()}customFields(e,t,i){this._migrateCustomFields(e,t,i);const r={},s=this._transientStorage.customFields;if(void 0===s||void 0===s[e])return r;const o=s[e][t];return void 0===o||i.forEach((e=>{const t=o[e];""!==t&&void 0!==t&&(r[e]=t)})),r}orderType(e){return this._getSectionValue("orderType",e)}setOrderType(e,t){this._getOrCreateSection("orderType")[e]=t,this._syncStorage()}setTableColumnsOrder(e,t){this._getOrCreateSection("tableColumnsOrder")[e]=t,this._syncStorage()}tableColumnsOrder(e){return this._getSectionValue("tableColumnsOrder",e)}setOrderSizeCalculatorQuantityType(e,t){null===t?this._removeValue("orderSizeCalculatorQuantityType",e):this._getOrCreateSection("orderSizeCalculatorQuantityType")[e]=t,this._syncStorage()}orderSizeCalculatorQuantityType(e){return this._getSectionValue("orderSizeCalculatorQuantityType",e)}setOrderSizeCalculatorValue(e,t){this._getOrCreateSection("orderSizeCalculatorValue")[e]=t,this._syncStorage()}orderSizeCalculatorValue(e){return this._getSectionValue("orderSizeCalculatorValue",e)}setLastUsedQuantityType(e,t){null===t?this._removeValue("lastUsedQuantityType",e):this._getOrCreateSection("lastUsedQuantityType")[e]=t,this._syncStorage()}lastUsedQuantityType(e){return this._getSectionValue("lastUsedQuantityType",e)}summaryFieldsVisibilityInfo(){const e=new Map,t=this._transientStorage.summaryFields;if(void 0===t)return e;for(const[i,r]of Object.entries(t))e.set(i,{
id:i,visible:r});return e}setSummaryFieldsVisibilityInfo(e){e.forEach((({id:e,visible:t})=>{this._getOrCreateSection("summaryFields")[e]=t})),this._syncStorage()}_getOrCreateSection(e){return e in this._transientStorage||(this._transientStorage[e]={}),this._transientStorage[e]}_getSectionValue(e,t){const i=this._transientStorage[e];return void 0!==i?i[t]:void 0}_removeValue(e,t){const i=this._transientStorage[e];void 0!==i&&(delete i[t],0===Object.keys(i).length&&delete this._transientStorage[e])}_setPips(e,t,i,r){const s=this._getSectionValue(e,t);if(!(void 0!==s&&s===i||void 0===s&&i===r)){if(void 0!==s&&i===r)this._removeValue(e,t);else{this._getOrCreateSection(e)[t]=i}this._syncStorage()}}_setDuration(e,t,i){var r;const s=this._getOrCreateSection("duration");if(null===i){if(void 0===s[e])return;return delete s[e][t],void(0===Object.keys(s[e]).length&&delete s[e])}null!==(r=s[e])&&void 0!==r||(s[e]={}),s[e][t]=i}_migrateCustomFields(e,t,i){const r={},s=this._transientStorage.customFields;void 0===s||"object"==typeof s&&void 0!==s[e]||(i.forEach((t=>{const i=s[`${e}.${t}`];""!==i&&void 0!==i&&(r[t]=i,this._removeValue("customFields",`${e}.${t}`))})),this.setCustomFields(e,t,r))}_migrateDuration(e,t){const i=this._getSectionValue("duration",e);if("string"!=typeof i)return;const r={type:i},s=this._getSectionValue("durationDatetime",e);"number"==typeof s&&(r.datetime=s,this._removeValue("durationDatetime",e)),this._removeValue("duration",e),this._setDuration(e,t,r),this._syncStorage()}_syncStorage(){n.setJSON(this._persistentStorageKey,this._transientStorage)}}const Li=(0,E.getLogger)("Trading.Core"),Vi={1:"Connected",2:"Connecting",3:"Disconnected",4:"Error"};var Ri,Fi;!function(e){e.Desktop="showSellBuyButtons",e.Mobile="showSellBuyButtonsMobile"}(Ri||(Ri={})),function(e){e.NewOrder="trade-new-order",e.Properties="trade-properties"}(Fi||(Fi={}));const Wi="alert/alarm_clock";function qi(e){return(0,c.alertSounds)().some((t=>e===t.path))}const Ui=I.enabled("buy_sell_buttons"),zi=!0,$i=(window.TRADING_SERVER_LOGGER_URL,"Shortcut"),Qi={0:"success",1:"danger",2:"info"};class Hi{constructor(e,t){this.accountType=new N.WatchedValue,this.onBrokerChange=new A.Delegate,this.onBrokerLoading=new A.Delegate,this.onConnectionStatusChange=new A.Delegate,this.onNewNotification=new A.Delegate,this.onNeedSelectBroker=new A.Delegate,this.onNotificationsChanged=new A.Delegate,this.showTradedSources=new N.WatchedValue(!0),this.showSellBuyButtons=new N.WatchedValue,this.noConfirmEnabled=new N.WatchedValue,this.showOnlyRejectionNotifications=new N.WatchedValue,this.showPricesWithZeroVolume=new N.WatchedValue,this.showSpread=new N.WatchedValue,this.orderExecutedSoundParams=function(){const e=qi(Wi)?Wi:(0,c.alertSounds)()[0].path;return{enabled:new N.WatchedValue(!1),path:new N.WatchedValue(e)}}(),this._activeBroker=null,this._orderViewController=null,this._orderControllerPromise=null,this._brokerCommandsUI=null,this._showPricesWithZeroVolume=new N.WatchedValue,this._showSpread=new N.WatchedValue,
this._closePositionDialogVisibility=new R.DialogVisibility,this._orderDialogVisibility=new R.DialogVisibility,this._loginDialogVisibility=new R.DialogVisibility,this._tradingPanelPopupVisibility=new R.DialogVisibility,this._tradingSettingsStorage=null,this._offlineListener=this._offlineHandler.bind(this),this._onlineListener=this._onlineHandler.bind(this),this._notifications=[],this._account=null,this._domPanelVisibility=new N.WatchedValue(!1),this._orderPanelVisibility=new N.WatchedValue(!1),this._pipValueType$=new u.BehaviorSubject(P.PipValueType.None),this._switchingBroker=!1,this._isDOMAvailable=(0,je.checkIsDOMAvailable)(),this._isReconnectNeeded=!1,this._accountVerificationPromise=null,this._chartWidgetCollection=null,this._tradedItemsChartCollectionFacadePromise=null,this._tradeNowBrokerId=null,this.getBrokerTradingSettingsStorage=()=>this._tradingSettingsStorage,this.trackEvent=(e,t,i)=>{const r=e?`[${e}] ${t}`:t;if(this._gui()){const e=this._activeBroker?this._activeBroker.metainfo().id+" Trading":"Trading No Broker",t=this._activeBroker?this._activeBroker.currentAccountType():void 0;this._gui().trackEvent(e,r,i||t)}},this.showErrorNotification=(e,t,i=25e3)=>{this._showNotification(e,t,1,i),I.enabled("show_trading_notifications_history")&&this._addNotificationRow(e,t,1),this._log(e,t)},this.setDOMPanelVisibility=(e,t=!0)=>{e&&t&&!this._makeSureCanTrade()||(e?this.tradingPanel.openPage(F.TradingPage.DOMPanel):this.tradingPanel.close())},this.setOrderPanelVisibility=async(e,t=!0)=>{if(e&&t&&!this._makeSureCanTrade())return;const{openPanel:i,closePanel:r}=await this._getOrderViewController();e?await i():await r()},this.getTradeNowBrokerId=()=>this._tradeNowBrokerId,this.clearTradeNowBrokerId=()=>{this._tradeNowBrokerId=null},this.checkRealtimeDataPermissions=async e=>{const t=(0,r.ensureNotNull)(this._activeBroker),{id:i,altBrokerId:s}=t.metainfo();await checkRealtimeDataSubscription(i,null!=e?e:t.getRealtimeDataCheckParams(),s)&&this._guiAccessor.reconnectChartApi(!0)},this.toggleTradingPanelVisibility=async()=>{const e=this._orderDialogVisibility.getValue().isVisible,t=this.tradingPanel.isOpened.value();e&&this._isDOMAvailable?this.setDOMPanelVisibility(!t):this._updateTradingPanelVisibility({isOpened:!t})},this._handleVisibilityChange=()=>{null!==this._activeBroker&&this._activeBroker.metainfo().configFlags.usesWSConnection&&"visible"!==document.visibilityState&&(this._isReconnectNeeded=!0,this._selectBrokerInternal({brokerId:null,isUserAction:!1,keepSessionAlive:!1,disconnectInfo:{disconnectType:P.DisconnectType.BrokenConnection}}).then((()=>{if(this._isReconnectNeeded)return this._tryReconnectLastBroker()})))},this._tryReconnectLastBroker=async()=>{if(this._isReconnectNeeded){if("hidden"===document.visibilityState)return window.addEventListener("visibilitychange",this._tryReconnectLastBroker,{once:!0});this._isReconnectNeeded=!1,await this._selectLastBroker()}},this._onCurrentAccountUpdate=()=>{const e=(0,r.ensureNotNull)(this._activeBroker).currentAccount()
;this._account!==e&&(this._tradedContextLinking.clear(),this._account=e,this.onNotificationsChanged.fire(this.getNotifications()))},this._onFullScreenDialogOpen=()=>{this._guiAccessor.closeAllNotifications()},this._setPipValueType=async()=>{const{symbol:e}=this._linking.value(),{type:t}=await this._realtimeProvider.symbolInfo(e),i="forex"===t?P.PipValueType.Pips:P.PipValueType.Ticks;this._pipValueType$.next(i)},this._trackNonTradableSymbol=async()=>{var e;if(1===(null===(e=this._activeBroker)||void 0===e?void 0:e.connectionStatus())){const{symbol:e}=this._linking.value();if(void 0===e)return;const t=await this._activeBroker.isTradable(e);t&&!t.tradable&&this.trackEvent("Symbol is not tradable",e)}},this._onBrokerChanged=e=>{if(null===e)return void(this._tradingSettingsStorage=null);const t=e.metainfo();this._tradingSettingsStorage=new Ai(t.id)},this._tradeNow=async()=>{if(void 0!==window.TradingView.bottomWidgetBar&&null!==this._tradeNowBrokerId)try{await window.TradingView.bottomWidgetBar.toggleWidget("paper_trading",!0)}catch(e){this._tradingWizard.drawAttention()}},this._updateTradingPanelVisibility=e=>{const{isOpeningAvailable:t=this.tradingPanel.isOpeningAvailable.value(),isOpened:i=this.tradingPanel.isOpened.value(),activePage:r=this.tradingPanel.activePage.value(),shouldCanTrade:s}=e,o=t&&i;r===F.TradingPage.OrderPanel?this.setOrderPanelVisibility(o,s):this.setDOMPanelVisibility(o,s)},this._toggleTradingPanelPage=e=>{e!==this.tradingPanel.activePage.value()&&(e===F.TradingPage.OrderPanel&&this.setOrderPanelVisibility(!0),e===F.TradingPage.DOMPanel&&this.setDOMPanelVisibility(!0))},this._onLinkingSymbolChange=e=>{var t;e.symbol!==(null===(t=this._tradedContextLinking.context())||void 0===t?void 0:t.data().symbol)&&this._tradedContextLinking.clear()},this._linking=new Bi({source:o.linking,getContinuousFrontContractExtractor:()=>this._continuousFrontContractExtractor}),this._abortController=new AbortController,this._setPipValueType=(0,D.sequentialize)(this._setPipValueType),this._selectBrokerInternal=(0,D.sequentialize)(this._selectBroker),void 0!==navigator.locks&&(this._selectBrokerInternal=e=>navigator.locks.request(`select-broker-${e.brokerId}`,{ifAvailable:!0},(t=>this._selectBroker({...e,hasConcurrentSession:null===t})))),this._showSellBuyButtonsKey=this._makeShowSellBuyButtonsKey(),this._realtimeProvider=new j((()=>this.activeBroker()),this.onBrokerChange,this.onConnectionStatusChange,(e=>this.getActualSymbol(e))),this._positionService=new st.PositionsService(this),this._ordersService=new ot.OrdersService(this),this._tradingStat=new J(this),this._serverLogger=null,this._tradedContextLinking=new Si,this.onBrokerChange.subscribe(this,this._onBrokerChanged),this.tradingPanelPopup=new oi(this),this.tradingPanelPopup.visible().subscribe((e=>{e?(this._tradingPanelPopupVisibility.setValue({isVisible:e,isFullScreen:!0}),this._onFullScreenDialogOpen()):this._tradingPanelPopupVisibility.setValue({isVisible:e})}));const i=this._makeTradingPanelTabsConfig();this.tradingPanel=new Ke(e,i);this._qtySuggester=new ki({
onResetNeeded:this.onConnectionStatusChange,symbolInfoGetter:e=>this._realtimeProvider.symbolInfo(e),qtySettingsStorageGetter:()=>this._tradingSettingsStorage}),this._qtySuggesterWithOrderSizeCalculatorResetting={getQty:this._qtySuggester.getQty.bind(this._qtySuggester),suggestedQtyChanged:this._qtySuggester.suggestedQtyChanged.bind(this._qtySuggester),setQty:this._qtySuggester.setQty.bind(this._qtySuggester)},this._domPanelPage=new ye({resizerBridge:e,closeFn:()=>this.tradingPanel.close(),trading:this,qtySuggester:this._qtySuggesterWithOrderSizeCalculatorResetting,tradingLinking:this._linking,headerState:new Ti,isLoading:this.tradingPanel.isLoading}),this.tradingPanel.addPage(F.TradingPage.DOMPanel,this._domPanelPage),this._orderPanelHeaderState=new Ti;const s=new fe(this._orderPanelHeaderState);this.tradingPanel.addPage(F.TradingPage.OrderPanel,s),this._updateTradingPanelVisibility({shouldCanTrade:!1}),this.tradingPanel.isOpeningAvailable.subscribe((async e=>{this._updateTradingPanelVisibility({isOpeningAvailable:e})})),this._domPanelVisibility.setValue(this.tradingPanel.isPageOpened(F.TradingPage.DOMPanel)),this._orderPanelVisibility.setValue(this.tradingPanel.isPageOpened(F.TradingPage.OrderPanel)),(0,M.combine)((()=>({})),this.tradingPanel.activePage.weakReference(),this.tradingPanel.isOpened.weakReference()).subscribe((()=>{this._domPanelVisibility.setValue(this.tradingPanel.isPageOpened(F.TradingPage.DOMPanel)),this._orderPanelVisibility.setValue(this.tradingPanel.isPageOpened(F.TradingPage.OrderPanel))})),this.closePositionDialogVisibility=this._closePositionDialogVisibility.value$,this.orderDialogVisibility=this._orderDialogVisibility.value$,this.loginDialogVisibility=this._loginDialogVisibility.value$,this.possibleFullScreenDialogsVisibility=(0,h.merge)(this.closePositionDialogVisibility.pipe((0,p.map)((e=>({...e,name:"close-position-dialog"})))),this.orderDialogVisibility.pipe((0,p.map)((e=>({...e,name:"order-dialog"})))),this.loginDialogVisibility.pipe((0,p.map)((e=>({...e,name:"login-dialog"})))),this._tradingPanelPopupVisibility.value$.pipe((0,p.map)((e=>({...e,name:"trading-panel-popup"}))))),this._linking.valueObservable().subscribe(this._onLinkingSymbolChange)}setChartWidgetCollection(e){(0,r.assert)(null===this._chartWidgetCollection,"ChartWidgetCollection can be set only once"),this._chartWidgetCollection=e,this._guiAccessor=new ie(e),this._loadState(),n.onSync.subscribe(this,this._loadState);const t=()=>{this._save()};this.showSellBuyButtons.subscribe(t),this.noConfirmEnabled.subscribe(t),this.showOnlyRejectionNotifications.subscribe(t),this._showPricesWithZeroVolume.subscribe(t),this._showSpread.subscribe(t),this.orderExecutedSoundParams.enabled.subscribe(t),this.orderExecutedSoundParams.path.subscribe(t),window.addEventListener("offline",this._offlineListener),window.addEventListener("online",this._onlineListener),this.bindShortcuts(),this._tradedItemsChartCollectionFacadePromise=this._createTradedItemsChartCollectionFacade(e),this._registerCustomSources(e),this._registerCustomWidgets(e)}
showPricesWith(){return{zeroVolume:this._showPricesWithZeroVolume,spread:this._showSpread}}domPanelVisibility(){return this._domPanelVisibility}orderPanelVisibility(){return this._orderPanelVisibility}getAccountManagerVisibilityMode(){if(!window.TradingView.bottomWidgetBar)throw new Error("Unable to provide bottom widget visibility mode: bottomWidgetBar undefined");return window.TradingView.bottomWidgetBar.mode()}setAccountManagerVisibilityMode(e){if(!window.TradingView.bottomWidgetBar)throw new Error("Unable to provide bottom widget visibility mode: bottomWidgetBar undefined");window.TradingView.bottomWidgetBar.setMode(e)}realtimeProvider(){return this._realtimeProvider}toggleTradingPanelPopup(){this.tradingPanelPopup.visible().value()?this.tradingPanelPopup.hide():this.tradingPanelPopup.show()}toggleTradingWidget(){return window.TradingView.bottomWidgetBar?window.TradingView.bottomWidgetBar.activateTradingTab():Promise.resolve()}toggleMinimizeBottomWidgetBar(){if(window.TradingView.bottomWidgetBar)return window.TradingView.bottomWidgetBar.toggleMinimize()}bottomWidgetBarMode(){if(!window.TradingView.bottomWidgetBar)throw new Error("Unable to provide bottom widget mode: bottomWidgetBar undefined");return window.TradingView.bottomWidgetBar.mode()}tradingWizard(){return this._tradingWizard}showTradingProperties(){this._gui()&&this._gui().showTradingProperties()}linking(){return this._linking}async brokersMetainfo(){return await this._brokersRegistrationPromise,W.brokersList()}brokersList(){return getBrokersList()}brokersPlans(){return this._getBrokersPlans()}activeBroker(){return this._activeBroker}brokerCommandsUI(){return this._brokerCommandsUI}async selectBroker(e,t){await this._selectBrokerInternal({brokerId:e,isUserAction:!0,keepSessionAlive:t})}async pickDefaultBroker(){if(this._activeBroker)return;let e=null;const t=(await this.brokersMetainfo()).filter((e=>!e.configFlags.isSuspended));if(1===t.length)e=t[0].id;else{const i=await ni.get();i&&t.some((e=>e.id===i))&&(e=i)}e&&this._selectBrokerInternal({brokerId:e,isUserAction:!1})}async makeNewOrderContextMenuAction(e,t,r){const o=await this._qtySuggester.getQty(e);return{name:"trade-new-order",action:()=>{const{symbol:i}=this._linking.value();i!==e&&this._linking.setSymbol(e),this.trackEvent(t,"New Order"),this._checkAndOpenOrderDialog({symbol:e,qty:o,limitPrice:r,stopPrice:r})},text:(0,O.appendEllipsis)(s.t(null,void 0,i(767325))),statName:"NewOrder",shortcutHint:(0,l.humanReadableHash)(a.Modifiers.Shift+84)}}async defaultContextMenuActions(e,{onlyMainActions:t=!1,gaOrigin:r="Chart Context Menu",hideNotExecutableAction:o=!1}={}){const{symbol:n}=await this.getActualSymbol(e.symbol),a=(await Promise.all([this._makeSubActions(n,e,r,o),this.makeNewOrderContextMenuAction(n,r,e.value||void 0)])).flat();return!t&&I.enabled("property_pages")&&(a.push({separator:!0}),a.push({name:"trade-properties",action:()=>{this.trackEvent(r,"Trading Properties"),this.showTradingProperties()},text:(0,O.appendEllipsis)(s.t(null,void 0,i(881352))),iconId:"Settings",
statName:"Properties"})),a}defaultDropdownMenuActions(e){const t="Bottom Panel Dropdown",r=[],o=this.activeBroker(),n=e||{tradingProperties:!0,restoreConfirmations:o&&o.metainfo().configFlags.supportConfirmations};return I.enabled("property_pages")||(n.tradingProperties=!1),n.tradingProperties&&r.push({action:()=>{this.showTradingProperties(),this.trackEvent(t,"Trading Properties")},text:(0,O.appendEllipsis)(s.t(null,void 0,i(881352))),iconId:"Settings"}),n.restoreConfirmations&&r.push({action:()=>{this._showRestoreConfirmations(),this.trackEvent(t,"Restore confirmations")},text:(0,O.appendEllipsis)(s.t(null,void 0,i(18240)))}),r}chartContextMenuActions(e,t){return(this._activeBroker&&1===this._activeBroker.connectionStatus()?this._activeBroker.chartContextMenuActions(e,t):this.defaultContextMenuActions(e,t)).then((e=>(0,S.convertActionDescriptionsToActions)(e)))}connectStatus(){return this._activeBroker?this._activeBroker.connectionStatus():3}bindShortcuts(){if(this._hotkeys)return;this._hotkeys=a.createGroup({desc:"Trading"});const e=async(e,t,i)=>{const{symbol:r}=this._linking.value(),s={qty:await this._qtySuggester.getQty(r),side:e,symbol:r,type:t,seenPrice:null};if(void 0!==i){const{limitPrice:e,stopPrice:r}=i;switch(t){case 1:s.limitPrice=e;break;case 3:s.stopPrice=r;break;case 4:s.limitPrice=e,s.stopPrice=r}}const o=(0,T.sideToText)(s.side),n=(0,T.orderTypeToText)({orderType:s.type});this.trackEvent($i,`${o} ${n}`,this._getInstantTradingEventLabel()),this._checkAndPlaceOrder(s)};this._hotkeys.add({desc:"Buy",hotkey:a.Modifiers.Shift+66,handler:()=>e(1,2)}),this._hotkeys.add({desc:"Sell",hotkey:a.Modifiers.Shift+83,handler:()=>e(-1,2)}),this._hotkeys.add({desc:"Buy limit",hotkey:a.Modifiers.Shift+a.Modifiers.Alt+66,handler:async()=>{const t=(await this._realtimeProvider.quotesSnapshot(this._linking.value().symbol)).ask;e(1,1,{limitPrice:t})}}),this._hotkeys.add({desc:"Sell limit",hotkey:a.Modifiers.Shift+a.Modifiers.Alt+83,handler:async()=>{const t=(await this._realtimeProvider.quotesSnapshot(this._linking.value().symbol)).bid;e(-1,1,{limitPrice:t})}});if(I.enabled("order_panel")&&this._hotkeys.add({desc:"Open/close Order Panel",hotkey:a.Modifiers.Shift+84,handler:()=>{if(!this.tradingPanel.isOpeningAvailable.value())return;const e=this.tradingPanel.isOpened.value()&&this.tradingPanel.activePage.value()===F.TradingPage.OrderPanel;this.trackEvent($i,e?"Close OT":"Open OT",this._getInstantTradingEventLabel()),this.setOrderPanelVisibility(!e)}}),this._isDOMAvailable){this._hotkeys.add({desc:"Open/close DOM",hotkey:a.Modifiers.Shift+68,handler:()=>{if(!this.tradingPanel.isOpeningAvailable.value())return;const e=this.tradingPanel.isOpened.value()&&this.tradingPanel.activePage.value()===F.TradingPage.DOMPanel;this.trackEvent($i,e?"Close DOM":"Open DOM",this._getInstantTradingEventLabel()),this.setDOMPanelVisibility(!e)}});{let e;const t=t=>{void 0!==this._hotkeys&&(t&&void 0===e?e=this._hotkeys.add({desc:"Manual DOM centering",hotkey:a.Modifiers.Shift+a.Modifiers.Alt+67,handler:()=>{this._domPanelPage.centerDOM(),
this.trackEvent($i,"Center DOM",this._getInstantTradingEventLabel())}}):t||void 0===e||(this._hotkeys.remove(e),e=void 0))};t(this._domPanelVisibility.value()),this._domPanelVisibility.subscribe(t)}}}formatter(e){return this.realtimeProvider().formatter(e)}showSuccessNotification(e,t,i=1e4){this.showOnlyRejectionNotifications.value()||this._showNotification(e,t,0,i),I.enabled("show_trading_notifications_history")&&this._addNotificationRow(e,t,0),this._log(e,t)}getNotifications(){return this._notifications.filter((e=>e.account===this._account&&e.broker===(this._activeBroker?this._activeBroker.metainfo().id:null)))}orderViewController(){return(0,r.ensureNotNull)(this._orderViewController)}findOrCreateOrderViewController(){return this._getOrderViewController()}tradingStat(){return this._tradingStat}async verifyBrokerLiveAccount(){return this._verifyLiveAccount(),null!==this._accountVerificationPromise?this._accountVerificationPromise:Promise.reject("Account verification is not needed")}pipValueType(){return this._pipValueType$.asObservable()}tradedItemsChartCollectionFacade(){return(0,r.ensureNotNull)(this._tradedItemsChartCollectionFacadePromise)}async removeRealtimeDataPermissions(){await removeRealtimeDataSubscription((0,r.ensureNotNull)(this._activeBroker).metainfo().id)&&this._guiAccessor.reconnectChartApi(!0)}makeActualSymbolObservable(e){var t,i;return null!==(i=null===(t=this._continuousFrontContractExtractor)||void 0===t?void 0:t.makeValueObservable(e))&&void 0!==i?i:(0,g.of)({symbol:e})}async getActualSymbol(e){return void 0===this._continuousFrontContractExtractor?{symbol:e}:this._continuousFrontContractExtractor.makeValue(e)}getQtySuggester(){return this._qtySuggester}showOrderToast(e){}clearTradedContextLinking(){null!==this._tradedContextLinking.context()&&this._tradedContextLinking.clear()}_getInstantTradingEventLabel(){return this.noConfirmEnabled.value()?"Instant":"Not Instant"}async _getOrderViewController(){return null!==this._orderViewController?this._orderViewController:(await this._createOrderController(),this._getOrderViewController())}async _getPaperCompetitions(){return getPaperCompetitions().catch((()=>[]))}async _getActivePaperCompetitionsIdsSinceTimestamp(e){const t=await this._getPaperCompetitions(),i=window.ChartApiInstance.serverTime(),r=t.flatMap((t=>{const r=new Date(t.properties.startTime).getTime(),s=new Date(t.properties.registrationEndTime).getTime();return e>r||i<r||i>s?[]:t.id}));return new Set(r)}async _showPaperCompetitionStartedDialogIfNeeded(){}async _selectBroker(e){var t,r;const{brokerId:o,isUserAction:n,keepSessionAlive:a=!1,disconnectInfo:l,hasConcurrentSession:c}=e;if(this._switchingBroker)return void Li.logWarn(`Broker is already selected, but a new broker id: ${o} was received.`);if(o!==(this._activeBroker?this._activeBroker.metainfo().id:null)){if(null===(t=this._linkingSubscription)||void 0===t||t.unsubscribe(),this._destroyContinuousFrontContractTrading(),this._activeBroker){
const e=this._isReconnectNeeded?null:this._activeBroker.disconnectWarningMessage(),t=()=>this._showReviewDialogIfNeeded(3,{disconnectType:P.DisconnectType.LogOut}),r=()=>{t(),this._logOut(n,a,l)};if(null!==e&&window.is_authenticated&&navigator.onLine){if(!await(0,de.showSimpleConfirmDialog)({title:s.t(null,void 0,i(672122)),text:e,mainButtonText:s.t(null,void 0,i(732114)),mainButtonIntent:"danger",cancelButtonText:s.t(null,void 0,i(904543)),onConfirm:r,onCancel:()=>{t()}}))return}else r()}if(null!=o){let e;this._tradeNowBrokerId=null,this._switchingBroker=!0;try{const t=await W.createBrokerConnection(this,o,this._serverLogger,null,e),{isMaintenance:i,message:r}=await t.maintenanceStatus();if(i){if(!await this._showBrokerSideMaintenanceWarning(t.metainfo().id,r))return this._switchingBroker=!1,void t.disconnect(!0)}0,await this._initBroker(t,a)}catch(e){this._switchingBroker=!1,Li.logError((0,T.getLoggerMessage)(e))}}else n&&setTimeout((()=>{ni.clear()})),this.onBrokerChange.fire(null),null===(r=this._closePositionDialogVisibilitySubscription)||void 0===r||r.unsubscribe(),this._brokerCommandsUI=null}else Li.logWarn(`${o} is already selected.`)}_destroyContinuousFrontContractTrading(){}async _initContinuousFrontContractTrading(){}_makeTradingPanelTabsConfig(){return function(e){const{onSelect:t,orderPanelAvailable:r,domPanelAvailable:o}=e;return r&&o?{items:[{id:F.TradingPage.OrderPanel,children:pe.createElement(Ii,{tooltipText:s.t(null,void 0,i(823887)),tooltipHotKey:xi},s.t(null,void 0,i(512686)))},{id:F.TradingPage.DOMPanel,children:pe.createElement(Ii,{tooltipText:s.t(null,void 0,i(611638)),tooltipHotKey:Mi},s.t(null,void 0,i(611638)))}],onSelect:t}:null}({onSelect:this._toggleTradingPanelPage,orderPanelAvailable:I.enabled("order_panel"),domPanelAvailable:this._isDOMAvailable})}_makeBrokerDependantWarningMessageObservable(e){let t,i=async(t,i)=>{const{tradable:r}=await(0,V.respectAbort)(t,e.isTradable(i));return r};i=(0,V.respectLatest)(i);try{t=e.currentAccount()}catch(e){}const r=(0,m.fromEventPattern)((t=>e.currentAccountUpdate.subscribe(null,t)),(t=>e.currentAccountUpdate.unsubscribe(null,t))).pipe((0,_.startWith)(t)),s=(0,m.fromEventPattern)((t=>e.connectionStatusUpdate.subscribe(null,t)),(t=>e.connectionStatusUpdate.unsubscribe(null,t))).pipe((0,_.startWith)(e.connectionStatus()));return(0,b.combineLatest)({value:this._linking.valueObservable(),currentAccountUpdate:r,connectionStatusUpdate:s}).pipe((0,v.mergeMap)((({value:e})=>(0,b.combineLatest)({isTradable:(0,y.from)(i(null,e.symbol)).pipe((0,_.startWith)(!1),(0,f.catchError)((()=>k.EMPTY))),value:(0,g.of)(e)}))),(0,p.map)((e=>e.isTradable?e.value.warning:void 0)))}async _initBroker(e,t){this._activeBroker=e,this._activeBroker.connectionStatusUpdate.subscribe(this,this._connectionListener),this._activeBroker.currentAccountUpdate.subscribe(this,this._onCurrentAccountUpdate),this._realtimeProvider.onStatusChanged.subscribe(null,this._setPipValueType),this._realtimeProvider.onStatusChanged.subscribe(null,this._trackNonTradableSymbol),
await this._initContinuousFrontContractTrading(),this._linkingSubscription=this._linking.valueObservable().subscribe((()=>{this._setPipValueType(),this._trackNonTradableSymbol()})),this._brokerCommandsUI=new ve({activeBroker:this._activeBroker,guiAccessor:this._guiAccessor,noConfirmEnabled:this.noConfirmEnabled,orderViewController:this._getOrderViewController.bind(this),showErrorNotification:this.showErrorNotification.bind(this),trackEvent:this.trackEvent,tradingLinking:this._linking,abortSignalGetter:()=>this._abortController.signal}),this._closePositionDialogVisibilitySubscription=this._brokerCommandsUI.closePositionDialogVisibility.subscribe(this._makeDialogVisibilityHandler(this._closePositionDialogVisibility)),this._activeBroker.tryRestoreSession(),await ni.set(this._activeBroker.metainfo().id),this.onBrokerChange.fire(this._activeBroker),this._getOrderViewController(),this._updateConnectionStatus(this.connectStatus()),this._switchingBroker=!1}async _showBrokerSideMaintenanceWarning(e,t){return(0,de.showSimpleConfirmDialog)({title:s.t(null,{replace:{brokerId:e}},i(637161)),text:null!=t?t:s.t(null,void 0,i(943288)),cancelButtonText:s.t(null,void 0,i(904543)),mainButtonIntent:"primary",mainButtonText:s.t(null,void 0,i(116056)),showBackdrop:!0})}_makeDialogVisibilityHandler(e){return t=>{e.setValue(t),t.isFullScreen&&this._onFullScreenDialogOpen()}}_gui(){return this._guiAccessor}_addNotificationRow(e,t,i){const r={id:this._notifications.length,account:this._account,broker:this._activeBroker?this._activeBroker.metainfo().id:null,time:new Date,title:e,text:t,type:Qi[i]};this._notifications.push(r),this.onNewNotification.fire(r)}_offlineHandler(){this._selectBrokerInternal({brokerId:null,isUserAction:!1,keepSessionAlive:!1,disconnectInfo:{disconnectType:P.DisconnectType.Offline}}),Li.logNormal("The connection to the Internet was interrupted")}async _onlineHandler(){await this._selectLastBroker()&&Li.logNormal("The connection to the Internet was restored")}_showNotification(e,t,i,r){var s;null===(s=this._gui())||void 0===s||s.showNotification(e,t,Qi[i],r)}_hideAllNotifications(){}_showReviewDialogIfNeeded(e,t){if(null===this._activeBroker)return;this._activeBroker}_connectionListener(e,t){const i=this.connectStatus();this._showReviewDialogIfNeeded(e,t);const r=this._isReconnectNeeded=(null==t?void 0:t.disconnectType)===P.DisconnectType.BrokenConnection;3!==e||(null==t?void 0:t.disconnectType)!==P.DisconnectType.LogOut&&!this._isReconnectNeeded||this._selectBrokerInternal({brokerId:null,isUserAction:!1,keepSessionAlive:!1,disconnectInfo:t}).then((()=>{if(this._isReconnectNeeded)return this._tryReconnectLastBroker()})),(null==t?void 0:t.disconnectType)===P.DisconnectType.CancelAuthorization&&this.trackEvent("Signin","OAuth popup closed","By user"),(null==t?void 0:t.disconnectType)===P.DisconnectType.TimeOutForAuthorization&&this.trackEvent("Signin","OAuth popup closed","By timeout"),this._updateConnectionStatus(i,!r,t)}async _selectLastBroker(){const e=await ni.get();return null!==e&&(await this._selectBrokerInternal({
brokerId:e,isUserAction:!1}),!0)}_updateOrderPanelSpinnerState(){const e=this._orderViewController,t=2===this.connectStatus(),i=null!==e&&e.stateChanging.value();this.tradingPanel.isLoading.setValue(t||i)}_showConnectWarningMessage(e){var t,r;const o=null!==(t=e.title)&&void 0!==t?t:s.t(null,void 0,i(166231)),n=e.message;e.displayType===w.ConnectWarningMessageDisplayType.PopUp&&(0,de.showSimpleConfirmDialog)({title:o,text:n,mainButtonText:s.t(null,void 0,i(819295)),mainButtonIntent:"primary",checkboxLabel:s.t(null,void 0,i(127328)),showDisableConfirmationsCheckbox:null===(r=e.skippable)||void 0===r||r,showCancelButton:!1}),e.displayType===w.ConnectWarningMessageDisplayType.Notification&&(this._showNotification(o,n,2,1e4),I.enabled("show_trading_notifications_history")&&this._addNotificationRow(o,n,2))}async _updateConnectionStatus(e,t=!0,i){var r;this._updateOrderPanelSpinnerState(),this.onConnectionStatusChange.fire(e,i),this._log("Connection status",Vi[e]);this._activeBroker;if(this._abortController.abort(),this._abortController=new AbortController,3!==e&&4!==e||this._hideAllNotifications(),t){const e=null===(r=this._activeBroker)||void 0===r?void 0:r.metainfo().id;void 0!==e?await ni.set(e):ni.clear()}null!==this._activeBroker?(3!==e&&4!==e||this._updateTradingPanelVisibility({isOpened:!1}),1===e?(this._account=this._activeBroker.currentAccount(),this._guiAccessor.setBroker(this._activeBroker)):this._tradedContextLinking.clear()):(this._accountVerificationPromise=null,this._updateTradingPanelVisibility({isOpened:!1}),this._guiAccessor.setBroker(null),this._tradedContextLinking.clear())}async _checkOrRemoveRealtimeDataIfNeeded(e){if(!e.configFlags.supportRealtimeDataCheck)return;const{realtimeDataPermissionsToggleConfig:t}=e;if(void 0===t)return void this.checkRealtimeDataPermissions();const r=`${q.settingsKeys.REALTIME_DATA_ACCEPTED}.${e.id}`;switch(n.getValue(r)){case"true":return void this.checkRealtimeDataPermissions();case"false":return void this.removeRealtimeDataPermissions();default:const e=await showSimpleConfirmDialogWithSolutionLink({title:t.enableRealtimeDataPermissionsTitleText,text:t.enableRealtimeDataPermissionsToggleText,mainButtonText:s.t(null,void 0,i(605954)),cancelButtonText:s.t(null,void 0,i(612869)),showCloseButton:!1,closeOnOutsideClick:!1,mainButtonIntent:"primary",closeOnEscapePress:!1,solutionId:t.solutionId,showBackdrop:!0,closeOnBackDropClick:!1});e?await this.checkRealtimeDataPermissions():await this.removeRealtimeDataPermissions(),n.setValue(r,e)}}_verifyLiveAccount(){(0,r.ensureNotNull)(this._activeBroker)}_save(){const e=n.getJSON(q.settingsKeys.PROPERTIES,{});n.setJSON(q.settingsKeys.PROPERTIES,{...e,[this._showSellBuyButtonsKey]:+!!this.showSellBuyButtons.value(),noConfirmEnabled:+!!this.noConfirmEnabled.value(),qweqrq:+!!this.showOnlyRejectionNotifications.value(),showPricesWithZeroVolume:+!!this._showPricesWithZeroVolume.value(),showSpread:+!!this._showSpread.value(),orderExecutedSoundParams:JSON.stringify({enabled:+!!this.orderExecutedSoundParams.enabled.value(),
name:this.orderExecutedSoundParams.path.value()})})}_loadState(){const e=n.getJSON(q.settingsKeys.PROPERTIES,{}),t=e[this._showSellBuyButtonsKey];if(this.showSellBuyButtons.setValue(void 0!==t?!!t:zi),this.noConfirmEnabled.setValue(!!e.noConfirmEnabled),this.showOnlyRejectionNotifications.setValue(!!e.qweqrq),this._showPricesWithZeroVolume.setValue(!e.hasOwnProperty("showPricesWithZeroVolume")||Boolean(e.showPricesWithZeroVolume)),this._showSpread.setValue(!e.hasOwnProperty("showSpread")||Boolean(e.showSpread)),e.hasOwnProperty("orderExecutedSoundParams")){const t=JSON.parse(e.orderExecutedSoundParams);this.orderExecutedSoundParams.enabled.setValue(!!t.enabled),this.orderExecutedSoundParams.path.setValue(qi(t.name)?t.name:this.orderExecutedSoundParams.path.value())}}_makeShowSellBuyButtonsKey(){return"showSellBuyButtons"}_log(e,t){Li.logNormal(`${this._activeBroker?this._activeBroker.metainfo().id+" Trading: ":""}${e} - ${t}`)}_makeSureCanTrade(){const e=this.activeBroker(),t=this.brokerCommandsUI();return e&&t?1===e.connectionStatus()||(this.toggleTradingWidget(),!1):(this.toggleTradingWidget().then((()=>this.onNeedSelectBroker.fire())),!1)}_checkAndPlaceOrder(e,t=!0){this._makeSureCanTrade()&&(0,r.ensureNotNull)(this.brokerCommandsUI()).placeOrder(e,t)}_checkAndOpenOrderDialog(e){this._makeSureCanTrade()&&(0,r.ensureNotNull)(this.brokerCommandsUI()).placeOrder(e)}_makeSubAction({symbol:e,side:t,orderType:r,orderPrices:o,currentQuotes:n,qty:a,gaOrigin:l}){const c=1===t?"Trading.Buy":"Trading.Sell",d=1===t?"Buy":"Sell",u=1===r?"Limit":3===r?"Stop":"StopLimit",h=function(e){return"altPrice"in e&&"formattedAltPrice"in e}(o),p=(0,S.safeSplitSymbol)(e)[1],g=d+u,m={BuyLimit:s.t(null,void 0,i(913571)).format({symbol:p,qty:(0,x.abbreviatedNumber)(a),value:o.formattedPrice}),SellStop:s.t(null,void 0,i(219027)).format({symbol:p,qty:(0,x.abbreviatedNumber)(a),value:o.formattedPrice}),SellLimit:s.t(null,void 0,i(132521)).format({symbol:p,qty:(0,x.abbreviatedNumber)(a),value:o.formattedPrice}),BuyStop:s.t(null,void 0,i(253107)).format({symbol:p,qty:(0,x.abbreviatedNumber)(a),value:o.formattedPrice})};return h&&(m.SellStopLimit=s.t(null,void 0,i(873554)).format({symbol:p,qty:(0,x.abbreviatedNumber)(a),value:o.formattedPrice,altValue:o.formattedAltPrice}),m.BuyStopLimit=s.t(null,void 0,i(278673)).format({symbol:p,qty:(0,x.abbreviatedNumber)(a),value:o.formattedPrice,altValue:o.formattedAltPrice})),{name:`trade-${d}-${u}`.toLowerCase(),action:()=>{this.trackEvent(l,`${d} ${u}`);const i=1===r?"limitPrice":"stopPrice",s=1===t?null==n?void 0:n.ask:null==n?void 0:n.bid,c={qty:a,side:t,symbol:e,type:r,seenPrice:null!=s?s:null,currentQuotes:n};null!==o.price&&(c[i]=o.price),4===r&&h&&(c.limitPrice=o.altPrice),this._checkAndPlaceOrder(c)},iconId:c,text:m[g],statName:g}}_createOrderController(){return null===this._orderControllerPromise&&(this._orderControllerPromise=Promise.all([i.e(4210),i.e(660)]).then(i.bind(i,163300)).then((({OrderViewController:e})=>new e({tradingCommands:{onNeedSelectBroker:this.onNeedSelectBroker,
realtimeProvider:this.realtimeProvider(),pipValueType$:this.pipValueType(),trackEvent:this.trackEvent,toggleTradingWidget:this.toggleTradingWidget.bind(this),toggleTradingPanelPopup:this.toggleTradingPanelPopup.bind(this),showErrorNotification:this.showErrorNotification.bind(this),getTradingSettingsStorage:()=>this._tradingSettingsStorage},tradingPanelCommands:{container:this.tradingPanel.container,isOpened:this.tradingPanel.isOpened,isOpeningAvailable:this.tradingPanel.isOpeningAvailable,activePage:this.tradingPanel.activePage,close:this.tradingPanel.close.bind(this.tradingPanel),openPage:this.tradingPanel.openPage.bind(this.tradingPanel)},qtySuggester:this._qtySuggester,tradingLinking:this._linking,orderViewHeaderState:this._orderPanelHeaderState,tradedContextLinking:void 0}))).then((e=>{this._orderControllerPromise=null,this._orderViewController=e,this._orderViewController.stateChanging.subscribe((()=>this._updateOrderPanelSpinnerState())),this._orderViewController.dialogVisibility.subscribe(this._makeDialogVisibilityHandler(this._orderDialogVisibility))}))),this._orderControllerPromise}async _registerCustomSources(e){!async function(e,t){const r=await Promise.all([i.e(882),i.e(5546),i.e(3519),i.e(2650)]).then(i.bind(i,586679));e.addCustomSource("bidask",((i,s)=>new r.BidAsk(i,s,t.realtimeProvider(),(()=>{e.activeChartWidget.value().showGeneralChartProperties(L.TabNames.scales)}))))}(e,this),rt(e,this,this.showTradedSources);new((await Promise.all([i.e(6424),i.e(5546),i.e(3519),i.e(1652)]).then(i.bind(i,727495))).TradedSourcesManager)(this._ordersService,this._positionService,e,{activeTradedLinking:this._tradedContextLinking,showTradedSources:this.showTradedSources,realtimeProvider:this._realtimeProvider,qtySuggester:this._qtySuggesterWithOrderSizeCalculatorResetting,brokerCommandsUI:this.brokerCommandsUI.bind(this),trackEvent:this.trackEvent,pipValueType$:this.pipValueType(),makeActualSymbolObservable:this.makeActualSymbolObservable.bind(this),getSymbolSpecificTradingOptions:e=>(0,r.ensureNotNull)(this._activeBroker).getSymbolSpecificTradingOptions(e)})}_registerCustomWidgets(e){Ui&&function(e,t,i){e.addCustomWidgetToLegend(((e,r)=>{const s=e.mainSeries(),o=(0,et.createWVFromGetterAndSubscriptions)((()=>{var e;return s.isFailed()||"economic"===(null===(e=s.symbolInfo())||void 0===e?void 0:e.type)}),[s.dataEvents().symbolResolved(),s.dataEvents().symbolError(),s.dataEvents().unsupportedResolutionRequested()]);return new Wt(s.dataEvents(),function(e){return()=>{const t=e.symbolInfo();return null!==t?t.pro_name||t.full_name||t.name||"":e.proSymbol()}}(s),o.ownership(),i,{onNeedSelectBroker:t.onNeedSelectBroker,realtimeProvider:t.realtimeProvider(),onBrokerConnectionStatusChange:t.onConnectionStatusChange,brokerConnectionStatus:t.connectStatus.bind(t),trackEvent:t.trackEvent,toggleTradingWidget:t.toggleTradingWidget.bind(t),toggleTradingPanelPopup:t.toggleTradingPanelPopup.bind(t),brokerCommandsUI:t.brokerCommandsUI.bind(t),toggleMinimizeBottomWidgetBar:()=>t.toggleMinimizeBottomWidgetBar(),
makeActualSymbolObservable:t.makeActualSymbolObservable.bind(t)},{showSellBuyButtons:t.showSellBuyButtons.spawnOwnership(),noConfirmEnabled:t.noConfirmEnabled.spawnOwnership(),themeName:r.ownership()},e.isInReplay().weakReference(),e.collapsed().spawnOwnership())}),{block:0,position:0})}(e,this,this._qtySuggesterWithOrderSizeCalculatorResetting)}async _makeSubActions(e,t,i,r=!1){if(null===t.value||(0,d.isNaN)(t.value))return[];const s=this.activeBroker();let o,n,a,l,c,u,h,p,g,m,_,b,v,y=null===s,f=null===s,k=!r&&null===s,P=!r&&null!==s,w=!r&&null===s;null!==s&&1===s.connectionStatus()&&(v=await s.isTradable(e));const[E,O,D,{ask:I,bid:x},M]=await Promise.all([this._qtySuggester.getQty(e),this._realtimeProvider.symbolInfo(e),this._realtimeProvider.formatter(e),this._realtimeProvider.quotesSnapshot(e),null==s?void 0:s.getSymbolSpecificTradingOptions(e)]);if(void 0===I||void 0===x||t.value<I&&t.value>x)return[];const N=O.variableMinTick?(0,B.makeVariableMinTickData)(O.minTick,O.variableMinTick):void 0,A=e=>(0,B.getMinTick)({minTick:O.minTick,price:e,variableMinTickData:N});if(null!==s&&v&&v.tradable){const e=s.metainfo().configFlags,i=(0,C.alignToStep)(t.value,A(t.value));o=i,a=i,l=i,n=i,c=l+A(l),u=n-A(n),y=Boolean(e.supportLimitOrders&&(0,S.isOrderTypeAllowed)(1,null==M?void 0:M.allowedOrderTypes)),f=Boolean(e.supportStopOrders&&(0,S.isOrderTypeAllowed)(3,null==M?void 0:M.allowedOrderTypes)),w=Boolean(e.supportStopLimitOrders&&(0,S.isOrderTypeAllowed)(4,null==M?void 0:M.allowedOrderTypes)),k=Boolean(e.supportStopOrdersInBothDirectionsInUI),P=Boolean(e.supportStopLimitOrdersInBothDirections),void 0!==O.limitPriceStep&&(o=(0,T.roundToStepByPriceTypeAndSide)(t.value,O.limitPriceStep,1,1),a=(0,T.roundToStepByPriceTypeAndSide)(t.value,O.limitPriceStep,1,-1),c=(0,T.roundToStepByPriceTypeAndSide)(t.value+A(t.value),O.limitPriceStep,1,1),u=(0,T.roundToStepByPriceTypeAndSide)(t.value-A(t.value),O.limitPriceStep,1,-1)),void 0!==O.stopPriceStep&&(l=(0,T.roundToStepByPriceTypeAndSide)(t.value,O.stopPriceStep,2,1),n=(0,T.roundToStepByPriceTypeAndSide)(t.value,O.stopPriceStep,2,-1)),h=D.format(o),p=D.format(n),g=D.format(a),m=D.format(l),_=D.format(c),b=D.format(u)}else o=a=l=n=t.value,h=p=g=m=t.formattedValue,c=l+A(l),u=n-A(n),_=D.format(c),b=D.format(u);const L={ask:I,bid:x},V=(x+I)/2,R=[];if(t.value<=V){if(y){const t={price:o,formattedPrice:h};R.push(this._makeSubAction({symbol:e,side:1,orderType:1,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:L}))}if(k){const t={price:l,formattedPrice:m};R.push(this._makeSubAction({symbol:e,side:1,orderType:3,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:L}))}if(f||k){const t={price:n,formattedPrice:p};R.push(this._makeSubAction({symbol:e,side:-1,orderType:3,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:L}))}if(w){const t={symbol:e,side:-1,orderType:4,orderPrices:{price:n,formattedPrice:p,altPrice:u,formattedAltPrice:b},qty:E,gaOrigin:i,currentQuotes:L};R.push(this._makeSubAction(t)),P&&R.push(this._makeSubAction({...t,side:1}))}}else{if(y){const t={price:a,formattedPrice:g}
;R.push(this._makeSubAction({symbol:e,side:-1,orderType:1,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:L}))}if(k){const t={price:n,formattedPrice:p};R.push(this._makeSubAction({symbol:e,side:-1,orderType:3,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:L}))}if(f||k){const t={price:l,formattedPrice:m};R.push(this._makeSubAction({symbol:e,side:1,orderType:3,orderPrices:t,qty:E,gaOrigin:i,currentQuotes:L}))}if(w){const t={symbol:e,side:1,orderType:4,orderPrices:{price:l,formattedPrice:m,altPrice:c,formattedAltPrice:_},qty:E,gaOrigin:i,currentQuotes:L};R.push(this._makeSubAction(t)),P&&R.push(this._makeSubAction({...t,side:-1}))}}return R}_initPaidBrokersByUserRegion(){this._brokersPlansPromise=Promise.resolve([])}async _getBrokersPlans(){let e=[];try{if(e=await this._brokersPlansPromise,!Array.isArray(e))throw new Error("Request result is not valid")}catch(e){Li.logError(`Failed to fetch broker list by user region: ${e.message}`)}return e}async _showRestoreConfirmations(){const e=await(0,de.showSimpleConfirmDialog)({title:s.t(null,void 0,i(18240)),text:s.t(null,void 0,i(492299)),mainButtonIntent:"primary"});null!==this._activeBroker&&e&&(new ai.DisabledConfirmations).clear()}_logOut(e,t,i){const s=(0,r.ensureNotNull)(this._activeBroker);s.connectionStatusUpdate.unsubscribe(this,this._connectionListener),s.currentAccountUpdate.unsubscribe(this,this._onCurrentAccountUpdate),this._realtimeProvider.onStatusChanged.unsubscribe(null,this._setPipValueType),this._realtimeProvider.onStatusChanged.unsubscribe(null,this._trackNonTradableSymbol),s.disconnect(t||!e),s.destroy(),this._activeBroker=null,this._updateConnectionStatus(3,e,i)}async _createTradedItemsChartCollectionFacade(e){return new((await Promise.all([i.e(882),i.e(5546),i.e(3519),i.e(2650)]).then(i.bind(i,913793))).TradedItemsChartCollectionFacade)(e)}_tradeNowInit(){const e=new URL(decodeURIComponent(window.location.href)),t=e.searchParams.get("trade-now");e.searchParams.delete("trade-now"),window.history.replaceState(null,document.title,e.toString()),null===t||isMobileTradingAvailable()||(this._tradeNowBrokerId=t,ni.clear())}}},499665:(e,t,i)=>{"use strict";i.d(t,{checkQtyError:()=>l});var r=i(609838),s=i(960521),o=i.n(s);const n={min:r.t(null,void 0,i(96248)),max:r.t(null,void 0,i(59195)),step:r.t(null,void 0,i(456697))},a=r.t(null,void 0,i(784830));function l(e,t,i=!1){if(null===t)return{res:!0,msg:a};const r=e.step,s=e.min,l=e.max;if(t<s)return{res:!0,msg:n.min.format({min:s.toString()})};if(t>l)return{res:!0,msg:n.max.format({max:l.toString()})};const c=new(o())(t).minus(s).mod(r);return i&&!c.eq(0)?{res:!0,msg:n.step.format({step:r.toString()})}:{res:!1}}},797358:(e,t,i)=>{"use strict";i.d(t,{validateBalance:()=>a});var r=i(609838);const s=r.t(null,void 0,i(880452));function o(e,t){return r.t(null,{replace:{amount:String(e),currency:t}},i(544668))}function n(e,t,i){return null===e||null===t||e<=t?{res:!1}:{res:!0,msg:0!==t&&void 0!==i?`${s} ${o(t,i)}`:s}}function a(e){
const{side:t,baseValue:i,baseBalanceValue:r,baseCurrency:s,quoteValue:o,quoteBalanceValue:a,quoteCurrency:l}=e;return-1===t?n(i,r,s):n(o,a,l)}},464051:(e,t,i)=>{"use strict";i.d(t,{checkBracketError:()=>h,makeBracketPercentPriceRuleChecker:()=>d});var r=i(609838),s=i(960521),o=i.n(s),n=i(599016),a=i(391431),l=i(621575);const c={orderStopLoss:{long:r.t(null,void 0,i(91189)),short:r.t(null,void 0,i(753689))},orderTakeProfit:{long:r.t(null,void 0,i(327163)),short:r.t(null,void 0,i(482810))},positionStopLoss:{long:e=>r.t(null,{replace:{value:e}},i(833928)),short:e=>r.t(null,{replace:{value:e}},i(547602))},positionTakeProfit:{long:e=>r.t(null,{replace:{value:e}},i(345417)),short:e=>r.t(null,{replace:{value:e}},i(442403))}};function d(e,t){let s,a,c;const d=(e,t,i,r)=>{const s=new(o())(t),n=s.mul(e).div(100);return s.minus(n.mul(i).mul(r)).toNumber()};return(o,u,h,p,g,m,_,b)=>{const v=-1===h?-1:1,y=p===n.BracketType.TakeProfit?-1:1,f=d(e,u,v,y),k=d(t,u,v,y),P=(0,l.roundToStepByPriceTypeAndSide)(f,m,g,h),S=(0,l.roundToStepByPriceTypeAndSide)(k,m,g,h);let C=Math.min(P,S),w=Math.max(P,S);_&&(void 0!==s&&void 0!==a&&c?(C=s,w=a):void 0===s&&void 0===a&&(C=Math.min(C,o),w=Math.max(w,o),s=C,a=w,c=b));if(!(o>=C&&o<=w))return{res:!0,msg:r.t(null,void 0,i(514236)).replace("{min}",C.toString()).replace("{max}",w.toString())};return(v*y==-1?P>=u&&S>=u:P<=u&&S<=u)?{res:!1}:{res:!0,msg:r.t(null,void 0,i(798702))}}}function u(e){const{side:t,price:i,priceType:r,priceStep:s,parentPrice:o,bracketType:n,isStatusEditing:a,isEnabled:l,bracketPercentPriceRuleCheckers:c}=e;for(const e of c){const c=e(i,o,t,n,r,s,a,l);if(c.res)return c}return{res:!1}}function h(e){const{quotes:t,side:s,price:o,pips:l,priceType:d,priceStep:h,parentPrice:p,parentType:g,bracketType:m,isStatusEditing:_,isEnabled:b,bracketPercentPriceRuleCheckers:v,priceFormatter:y,isRoundToPriceStep:f}=e;if(null===o||null===l)return{res:!0,msg:r.t(null,void 0,i(405196))};let k={res:!1};return k=2===g?function(e){const{quotes:t,side:s,price:o,priceType:l,priceStep:d,parentPrice:h,bracketType:p,isStatusEditing:g,isEnabled:m,bracketPercentPriceRuleCheckers:_}=e;let b={res:!1};_.length>0&&(b=u({side:s,price:o,priceType:l,priceStep:d,parentPrice:h,bracketType:p,isStatusEditing:g,isEnabled:m,bracketPercentPriceRuleCheckers:_}));const v=(p===n.BracketType.TakeProfit?-1:1)*s,y=-1===s?(0,a.getAsk)(t):(0,a.getBid)(t);if(y&&Math.sign(o-y)===v){const e=p===n.BracketType.TakeProfit?c.positionTakeProfit:c.positionStopLoss,t=-1===s?r.t(null,void 0,i(115822)):r.t(null,void 0,i(473220));b={res:!0,msg:-1===s?e.short(t):e.long(t)}}return b}({quotes:t,side:s,price:o,priceType:d,priceStep:h,parentPrice:p,bracketType:m,isStatusEditing:_,isEnabled:b,bracketPercentPriceRuleCheckers:v}):function(e){const{side:t,pips:i,price:r,priceType:s,priceStep:o,parentPrice:a,bracketType:l,isStatusEditing:d,isEnabled:h,bracketPercentPriceRuleCheckers:p}=e;let g={res:!1};if(p.length>0&&(g=u({side:t,price:r,priceType:s,priceStep:o,parentPrice:a,bracketType:l,isStatusEditing:d,isEnabled:h,bracketPercentPriceRuleCheckers:p
})),i<=0||r<=0){const e=l===n.BracketType.TakeProfit?c.orderTakeProfit:c.orderStopLoss;g={res:!0,msg:1===t?e.long:e.short}}return g}({side:s,pips:l,price:o,priceType:d,priceStep:h,parentPrice:p,bracketType:m,isStatusEditing:_,isEnabled:b,bracketPercentPriceRuleCheckers:v}),!k.res&&f&&(k=function(e,t,s){return(0,a.isMintickMultiple)(e,t)?{res:!1}:{res:!0,msg:r.t(null,void 0,i(173069)).format({minTick:s.format(t)})}}(o,h,y)),k}},477071:(e,t,i)=>{"use strict";i.d(t,{makeStopLimitPercentPriceRuleChecker:()=>u,validatePrice:()=>h});var r=i(609838),s=i(960521),o=i.n(s),n=i(391431),a=i(621575);const l=r.t(null,void 0,i(10833));function c(e,t){return o()(e).minus(t).abs().gt(o()(e).div(2))}function d(e,t,i,r){const s=new(o())(t),n=s.mul(e).div(100);return s.minus(n.mul(i).mul(r)).toNumber()}function u(e,t){let s;return o=>{const{orderPrice:n,currentPrice:l,side:c,orderType:u,priceStep:h,priceType:p,isStatusEditing:g}=o,m=-1===c?1:-1,_=3===u?1:-1,b=d(e,l,m,_),v=d(t,l,m,_),y=(0,a.roundToStepByPriceTypeAndSide)(b,h,p,c),f=(0,a.roundToStepByPriceTypeAndSide)(v,h,p,c);let k=Math.min(y,f),P=Math.max(y,f);g&&(void 0===s&&(s=n),k=Math.min(k,s),P=Math.max(P,s));return n>=k&&n<=P?{res:!1}:{res:!0,severity:"error",msg:r.t(null,void 0,i(775364)).replace("{min}",k.toString()).replace("{max}",P.toString())}}}function h(e){const{price:t,askOrBid:s,orderType:a,side:d,priceType:u,isForex:h,formatter:p,isStatusEditing:g,stopLimitPercentPriceRuleCheckers:m,supportStopOrdersInBothDirections:_,supportStopLimitOrdersInBothDirections:b,supportStrictCheckingLimitOrderPrice:v,step:y,roundedToStep:f}=e;for(const e of m){const i=e({orderPrice:t,currentPrice:s,side:d,orderType:a,priceStep:y,priceType:u,isStatusEditing:g});if(i.res)return i}if((!h||f)&&!1===(0,n.isMintickMultiple)(t,y))return{res:!0,severity:"error",msg:r.t(null,void 0,i(806280)).format({minTick:p.format(y)})};const k=t<0||o()(s).mul(100).lt(t)||function(e){const{price:t,askOrBid:i,orderType:r,side:s,isStopPrice:o,supportStopOrdersInBothDirections:n,supportStopLimitOrdersInBothDirections:a,supportStrictCheckingLimitOrderPrice:l}=e;return 1===r?1===s?t>i&&(c(i,t)||l):t<i&&(c(i,t)||l):!!(3===r&&!n||4===r&&o&&!a)&&(1===s?t<i:t>i)}({price:t,askOrBid:s,orderType:a,side:d,isStopPrice:2===u,supportStopOrdersInBothDirections:_,supportStopLimitOrdersInBothDirections:b,supportStrictCheckingLimitOrderPrice:v});return k?{res:!0,severity:"error",msg:l}:{res:!1}}},806188:(e,t,i)=>{"use strict";i.d(t,{extractGuaranteedStopValidationRules:()=>_,extractLimitValidationRules:()=>m,extractStopLossValidationRules:()=>p,extractStopValidationRules:()=>g,extractTakeProfitValidationRules:()=>h,isLimitPercentValidationRule:()=>c,isStopLimitPercentValidationRule:()=>l,isStopPercentValidationRule:()=>d});const r=["tpPercent"],s=["slPercent"],o=["stopPercent"],n=["limitPercent"],a=["gsPercent"];function l(e){return c(e)||d(e)}function c(e){return n.includes(e.id)}function d(e){return o.includes(e.id)}function u(e,t,i){var r;return null===(r=e.getValidationRules(t))||void 0===r?void 0:r.filter((e=>i.includes(e.id)))
}function h(e,t){return u(e,t,r)}function p(e,t){return u(e,t,s)}function g(e,t){return u(e,t,o)}function m(e,t){return u(e,t,n)}function _(e,t){return u(e,t,a)}},416637:(e,t,i)=>{"use strict";i.d(t,{abbreviatedNumber:()=>n});i(960521);var r=i(563223);const s=["","K","M","G","T","P"];function o(e){return e<s.length?s[e]:"e"+3*e}function n(e){if(e<1)return r.NumericFormatter.formatNoE(e);let t=0,i=+e;if(isFinite(i))for(;i>=1e3&&i%100==0;)t++,i/=1e3;return i+o(t)}},658098:(e,t,i)=>{"use strict";i.d(t,{createPrimitivePropertyFromWatchedValue:()=>s});var r=i(347542);function s(e){const t=(0,r.createPrimitiveProperty)(e.value()),i=e=>t.setValue(e);return t.destroy=()=>{e.release(),e.unsubscribe(i)},e.subscribe(i),t}},17317:(e,t,i)=>{"use strict";function r(e){let t=Promise.resolve();return function(...i){const r=t.then((()=>e.apply(this,i)));return t=r.catch((()=>{})),r}}i.d(t,{sequentialize:()=>r})},48008:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" fill-rule="evenodd" d="M3 10a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 1a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm6-1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 1a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm7-2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm1 0a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"/></svg>'},465890:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 11 9" width="11" height="9" fill="none"><path stroke="currentColor" stroke-width="2" d="M0.999878 4L3.99988 7L9.99988 1"/></svg>'},117105:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path stroke="currentColor" stroke-width="1.2" d="m1.5 1.5 21 21m0-21-21 21"/></svg>'},315130:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path stroke="currentColor" stroke-width="1.2" d="m1.5 1.5 15 15m0-15-15 15"/></svg>'},238822:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" width="14" height="14"><path stroke="currentColor" stroke-width="1.2" d="m1.5 1.5 11 11m0-11-11 11"/></svg>'},663346:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 12" width="12" height="12"><path stroke="currentColor" stroke-width="1.2" d="m1.5 1.5 9 9m0-9-9 9"/></svg>'},534983:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" width="10" height="10"><path stroke="currentColor" stroke-width="1.2" d="m1.5 1.5 7 7m0-7-7 7"/></svg>'},512646:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M7.84 13.7H5.78V4.4l2.48-.06c1.35 0 2.42.4 3.22 1.2.8.78 1.19 1.83 1.19 3.15 0 3.34-1.61 5.01-4.83 5.01zm-.41-7.85v6.35c.26.02.55.03.86.03.83 0 1.48-.3 1.95-.9.48-.6.72-1.46.72-2.54 0-2-.93-2.99-2.78-2.99-.18 0-.43.02-.75.05z"/></svg>'},552828:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M13.4 5.9c-.41 1.62-1.16 2.43-2.25 2.43-.52 0-1.25-.15-2.2-.45-.93-.3-1.58-.45-1.96-.45-.55 0-.98.3-1.27.9H4.66c.1-.67.36-1.24.76-1.71.4-.48.86-.72 1.4-.72.56 0 1.31.16 2.27.46.95.3 1.62.45 2.01.45.64 0 1.06-.3 1.27-.9h1.03zm0 3.87c-.41 1.62-1.16 2.43-2.25 2.43-.52 0-1.25-.15-2.2-.45-.93-.3-1.58-.46-1.96-.46-.55 0-.98.3-1.27.9H4.66c.1-.67.36-1.24.76-1.7.4-.48.86-.72 1.4-.72.56 0 1.31.15 2.27.46.95.3 1.62.44 2.01.44.64 0 1.06-.3 1.27-.9h1.03z"/></svg>'},100578:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 8" width="16" height="8"><path fill="currentColor" d="M0 1.475l7.396 6.04.596.485.593-.49L16 1.39 14.807 0 7.393 6.122 8.58 6.12 1.186.08z"/></svg>'},379978:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path stroke="currentColor" d="M8 5l3.5 3.5L8 12"/></svg>'},643959:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none"><path stroke="currentcolor" stroke-width="1.2" d="M17 21l-7.5-7.5L17 6"/></svg>'},513729:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none"><path stroke="currentColor" stroke-width="1.2" d="M7 6l15 15m0-15L7 21"/></svg>'},29834:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM5 14.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0zm9.5-1.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM12 14.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0zm9.5-1.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM19 14.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0z"/></svg>'},816105:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" width="72" height="72" fill="none"><g clip-path="url(#clip0)"><path fill="#363A45" fill-rule="evenodd" clip-rule="evenodd" d="M62.1259 28.2153C61.4066 28.8157 61.0001 29.7273 61.0858 30.6604C61.6716 37.0347 59.7763 44.3291 55.3181 50.8221C46.9016 63.0797 32.5383 67.839 23.2366 61.4522C13.935 55.0654 13.2174 39.9512 21.6339 27.6935C26.4984 20.6088 33.3496 16.029 40.0619 14.6585C40.9752 14.472 41.731 13.8291 42.1024 12.9741C42.485 12.0934 42.9606 11.2346 43.5313 10.4123C47.906 4.1093 56.2129 2.33004 62.0853 6.4382C67.9578 10.5464 69.172 18.9863 64.7974 25.2892C64.0194 26.4103 63.1169 27.3882 62.1259 28.2153Z"/><rect width="47.2" height="34" fill="#1E222D" stroke="#B2B5BE" stroke-width="2" rx="3.8" x="12.4004" y="16"/><path stroke="#B2B5BE" stroke-linecap="round" stroke-width="2" d="M3.59961 54H67.1996"/><path fill="#B2B5BE" fill-rule="evenodd" clip-rule="evenodd" d="M29.1178 31.1324L30.8107 32.8253L32.225 31.4111L30.5321 29.7182L32.225 28.0253L30.8107 26.6111L29.1178 28.304L27.425 26.6111L26.0107 28.0253L27.7036 29.7182L26.0107 31.4111L27.425 32.8253L29.1178 31.1324Z"/><path fill="#B2B5BE" fill-rule="evenodd" clip-rule="evenodd" d="M43.5182 31.1324L45.2111 32.8253L46.6253 31.4111L44.9325 29.7182L46.6253 28.0253L45.2111 26.6111L43.5182 28.304L41.8253 26.6111L40.4111 28.0253L42.104 29.7182L40.4111 31.4111L41.8253 32.8253L43.5182 31.1324Z"/><path stroke="#B2B5BE" stroke-width="2" d="M30.5996 38.7H40.7996"/></g></svg>'},627687:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" width="72" height="72" fill="none"><g clip-path="url(#clip0)"><path fill="#F0F3FA" fill-rule="evenodd" clip-rule="evenodd" d="M62.1259 28.2153C61.4066 28.8157 61.0001 29.7273 61.0858 30.6604C61.6716 37.0347 59.7763 44.3291 55.3181 50.8221C46.9016 63.0797 32.5383 67.839 23.2366 61.4522C13.935 55.0654 13.2174 39.9512 21.6339 27.6935C26.4984 20.6088 33.3496 16.029 40.0619 14.6585C40.9752 14.472 41.731 13.8291 42.1024 12.9741C42.485 12.0934 42.9606 11.2346 43.5313 10.4123C47.906 4.1093 56.2129 2.33004 62.0853 6.4382C67.9578 10.5464 69.172 18.9863 64.7974 25.2892C64.0194 26.4103 63.1169 27.3882 62.1259 28.2153Z"/><rect width="47.2" height="34" fill="#fff" stroke="#1E222D" stroke-width="2" rx="3.8" x="12.4004" y="16"/><path stroke="#1E222D" stroke-linecap="round" stroke-width="2" d="M3.59961 54H67.1996"/><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M29.1178 31.1324L30.8107 32.8253L32.225 31.4111L30.5321 29.7182L32.225 28.0253L30.8107 26.6111L29.1178 28.304L27.425 26.6111L26.0107 28.0253L27.7036 29.7182L26.0107 31.4111L27.425 32.8253L29.1178 31.1324Z"/><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M43.5182 31.1324L45.2111 32.8253L46.6253 31.4111L44.9325 29.7182L46.6253 28.0253L45.2111 26.6111L43.5182 28.304L41.8253 26.6111L40.4111 28.0253L42.104 29.7182L40.4111 31.4111L41.8253 32.8253L43.5182 31.1324Z"/><path stroke="#000" stroke-width="2" d="M30.5996 38.7H40.7996"/></g></svg>'},829883:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 16" width="20" height="16"><path fill="currentColor" fill-rule="evenodd" d="M7.5 2.5C7.5 1.67 8.17 1 9 1h2c.83 0 1.5.67 1.5 1.5v.15h-5V2.5zm6 0v.15H17a2.5 2.5 0 0 1 2.5 2.5v8.35A2.5 2.5 0 0 1 17 16H3a2.5 2.5 0 0 1-2.5-2.5V5.15A2.5 2.5 0 0 1 3 2.65h3.5V2.5A2.5 2.5 0 0 1 9 0h2a2.5 2.5 0 0 1 2.5 2.5zm-12 2.65c0-.83.67-1.5 1.5-1.5h14c.83 0 1.5.67 1.5 1.5v8.35c0 .83-.67 1.5-1.5 1.5H3a1.5 1.5 0 0 1-1.5-1.5V5.15zM9.25 6.5a1.75 1.75 0 1 0 0 3.5h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75h-1c0 .97.78 1.75 1.75 1.75h.25v1h1v-1h.25a1.75 1.75 0 1 0 0-3.5h-1.5a.75.75 0 0 1 0-1.5h1.5c.41 0 .75.34.75.75h1c0-.97-.78-1.75-1.75-1.75h-.25v-1h-1v1h-.25z"/></svg>'}}]);