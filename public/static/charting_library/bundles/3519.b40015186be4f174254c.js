(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[3519],{316167:(t,e,o)=>{"use strict";o.d(e,{blendColors:()=>a,generateBlendColors:()=>l});var r=o(827147),i=o(822914),s=o(724377);const a=(t,e)=>(0,s.rgbaToString)((0,s.blendRgba)((0,s.parseRgba)(t),(0,s.parseRgba)(e)));function l(t,e){const o=(0,i.default)(t),s=Object.keys(o);for(const i of s){const s=t[i];(0,r.default)(s)?o[i]=a(s,e):o[i]=l(s,e)}return o}},734602:(t,e,o)=>{"use strict";o.d(e,{useGlobalCloseOnScrollAndCustomEvents:()=>s});var r=o(50959),i=o(370981);function s(t){(0,r.useEffect)((()=>{return t=a,window.addEventListener("scroll",t),()=>window.removeEventListener("scroll",t);var t}),[]),(0,r.useEffect)((()=>{if(t.length)return function(t,e){for(const o of t)o.subscribe(null,e);return()=>{for(const o of t)o.unsubscribe(null,e)}}(t,a)}),t)}function a(){(0,i.globalCloseMenu)()}},914090:(t,e,o)=>{"use strict";o.d(e,{TooltipPopup:()=>n});var r=o(50959),i=o(624216),s=o(370981),a=o(180185),l=o(41899);const n=(0,r.forwardRef)(((t,e)=>{const{onClose:o,onForceClose:n,onClickOutside:d,className:c,...h}=t,u=(0,r.useRef)(null);(0,r.useEffect)((()=>(s.globalCloseDelegate.subscribe(null,n),()=>{s.globalCloseDelegate.unsubscribe(null,n)})),[n]);const p=(0,r.useCallback)((e=>{var o;null===(o=t.onKeyDown)||void 0===o||o.call(t,e),27===(0,a.hashFromEvent)(e)&&(e.preventDefault(),n())}),[n]),_=(0,r.useCallback)((()=>{u.current&&u.current.focus({preventScroll:!0})}),[]);return r.createElement(i.PopupMenu,{className:c,isOpened:!0,tabIndex:-1,reference:t=>{"function"==typeof e?e(t):(0,l.isObject)(e)&&(e.current=t),u.current=t},onClose:o,onClickOutside:d,onKeyDown:p,onOpen:_,...h},t.children)}));n.displayName="TooltipPopup"},33532:t=>{t.exports={title:"title-u3QJgF_p"}},722426:(t,e,o)=>{"use strict";o.d(e,{ToolWidgetMenuSummary:()=>a});var r=o(50959),i=o(497754),s=o(33532);function a(t){return r.createElement("div",{className:i(t.className,s.title)},t.children)}},796160:(t,e,o)=>{"use strict";var r;o.d(e,{TradedItemType:()=>r}),function(t){t[t.Position=0]="Position",t[t.Order=1]="Order"}(r||(r={}))},983519:(t,e,o)=>{"use strict";o.d(e,{TradedGroupBase:()=>io,isTradedGroupCustomSource:()=>Je});var r=o(822914),i=o(650151),s=o(609838),a=o(114658),l=o(934135),n=o(599016),d=o(46415),c=o(796160),h=o(482303),u=o(431635),p=o(265328),_=o(333433),y=o(440891),f=o(813108);const b=f.LineStyle.Solid,m=f.LineStyle.Dashed;var v=o(87502),C=o(980465),g=o(799839),P=o(885800),k=o(184114),T=o(898646),x=o(983706),w=o(463940),M=o(86441),S=o(374410),B=(o(161656),o(601227)),D=o(805033);function I(t){const{percentage:e,padding:o,bitmapSizeWidth:r,horizontalPixelRatio:i,anchorWidth:s,tradedGroupHorizontalAlignment:a}=t;return a===x.TradedGroupHorizontalAlignment.Center?O({padding:o,horizontalPixelRatio:i,bitmapSizeWidth:r,anchorWidth:s,tradedGroupHorizontalAlignment:a}):function(t){const{percentage:e,bitmapSizeWidth:o,anchorWidth:r,tradedGroupHorizontalAlignment:i}=t,{percentageModifier:s,alignmentModifier:a}=function(t,e){return L(e)?{percentageModifier:t,alignmentModifier:1}:{
percentageModifier:1-t,alignmentModifier:-1}}(e,i);return o*s+r*a}({percentage:e,horizontalPixelRatio:i,bitmapSizeWidth:r,anchorWidth:s,tradedGroupHorizontalAlignment:a})}function L(t){return t===x.TradedGroupHorizontalAlignment.Center||t===x.TradedGroupHorizontalAlignment.Right}function O(t){const{padding:e,bitmapSizeWidth:o,anchorWidth:r,horizontalPixelRatio:i,tradedGroupHorizontalAlignment:s}=t,a=e*i;return L(s)?a-r:o-a-r}const R=new Map([[[361,480],t=>O({padding:32,...t})],[[481,560],t=>I({padding:32,percentage:.1,...t})],[[561,960],t=>I({padding:32,percentage:.25,...t})],[[961,Number.MAX_SAFE_INTEGER],t=>I({padding:32,percentage:.5,...t})]]);function W(t,e,o,r,i,s){t.save(),t.fillStyle=s,t.fillRect(e,o,r,i),t.restore()}var A,H;!function(t){t[t.Position=0]="Position",t[t.WithBracketButtons=1]="WithBracketButtons",t[t.Projection=2]="Projection",t[t.Default=3]="Default"}(A||(A={})),function(t){t[t.BorderWidth=1]="BorderWidth",t[t.TextHorizontalPadding=7]="TextHorizontalPadding",t[t.BodyHeight=19]="BodyHeight",t[t.BodyHeightMobile=23]="BodyHeightMobile",t[t.CloseSize=7]="CloseSize",t[t.CloseHorizontalLeftPadding=8]="CloseHorizontalLeftPadding",t[t.CloseHorizontalRightPadding=8]="CloseHorizontalRightPadding",t[t.BorderRadius=4]="BorderRadius",t[t.PointRadius=2.5]="PointRadius",t[t.PointBorderWidth=1]="PointBorderWidth",t[t.ShadowAdditionalRadius=3]="ShadowAdditionalRadius",t[t.CenterBodyPercentagePadding=40]="CenterBodyPercentagePadding",t[t.RightBodyPercentagePadding=5]="RightBodyPercentagePadding",t[t.InformerWidth=18]="InformerWidth",t[t.InfrormerMargin=5]="InfrormerMargin",t[t.NotificationBackdropHeight=20]="NotificationBackdropHeight",t[t.PlusButtonOffset=20]="PlusButtonOffset",t[t.AnchorWidth=12]="AnchorWidth",t[t.AnchorShadowWidth=16]="AnchorShadowWidth",t[t.AnchorShadowBorderRadius=6]="AnchorShadowBorderRadius",t[t.AnchorInvisibleOnChartWidth=360]="AnchorInvisibleOnChartWidth"}(H||(H={}));const V=B.CheckMobile.any();function G(t){return{activeItem:t,equals:e=>!!e.activeItem&&e.activeItem.id===t.id&&e.activeItem.part===t.part}}function N(t,e,o,r,i){return s=>{s.preventDefault();const a=s.clientX-s.localX,l=s.clientY-s.localY,n=new M.Point(e+a,r+l);t((t=>t.x>e&&t.x<=e+i&&t.y>o&&t.y<=r),n)}}class q{constructor(t,e,o,r){this._height=V?23:19,this._bodyBorderRadius=4,this._font=null,this._offsets=null,this._alignedTop=null,this._wasSourceMoved=!1,this._cache=null,this._cacheWithOffset=null,this._textWidthCache=e,this._minMainTextWidthGetter=r,this._data=t,this._font=o,this._initCtx()}data(){return this._data}clearCache(){this._cache=null,this._cacheWithOffset=null}applyOffset(t){this._offsets=t}setAlignedTopCoordinate(t){this._alignedTop=t}hitTest(t,e){var o;const r=this.rectWithOffsets(e),{horizontalPixelRatio:s,verticalPixelRatio:a}=e,l=Math.round(t.x*s),n=Math.round(t.y*a),d=l>=r.left,c=l<=r.right,h=d&&c,u=n>=r.top&&n<=r.bottom,p={cursorType:S.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...G({id:this._data.id,part:9})};if(this._data.disabled)return new k.HitTestResult(k.HitTarget.Custom,p);let _={}
;if(void 0!==this._data.callbacks.onMove){const t=t=>{this._data.callbacks.onMove&&this._data.callbacks.onMove(t),this._wasSourceMoved=!0},e=()=>{this._wasSourceMoved&&this._data.callbacks.onFinishMove&&this._data.callbacks.onFinishMove(),this._wasSourceMoved=!1};_={cursorType:S.PaneCursorType.Pointer,pressedMouseMoveHandler:t,touchMoveHandler:t,mouseUpHandler:e,touchEndHandler:e,cancelMoveHandler:this._data.callbacks.onCancelMove}}const y=this._data.callbacks.onContextMenu,f=this._data.callbacks.onContextMenu,b={...p,..._,hasOwnShortcutsBehaviourFor:{shiftKey:!0},contextMenuHandler:y,touchContextMenuHandler:f};if(this._isAnchorIntersected(u,l,r))return new k.HitTestResult(k.HitTarget.Custom,{...b,..._,...G({id:this._data.id,part:8}),cursorType:S.PaneCursorType.VerticalResize});if(this._isPriceLineIntersected(l,n,e))return new k.HitTestResult(k.HitTarget.Custom,{...b,...G({id:this._data.id,part:9}),cursorType:S.PaneCursorType.VerticalResize});if(!u||!h)return null;const m=Math.round(r.body.left/s),v=Math.round(r.top/a);if(l>=r.close.left&&c&&void 0!==this._data.callbacks.onClose){const t=Math.round(r.body.right/s),e=Math.round(r.close.left/s);return new k.HitTestResult(k.HitTarget.Custom,{...b,...G({id:this._data.id,part:3}),cursorType:S.PaneCursorType.Pointer,clickHandler:this._data.callbacks.onClose,tapHandler:this._data.callbacks.onClose,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.close).title,rect:{x:e,y:v,w:t-e,h:this._height}}})}if(null===(o=this._data.callbacks)||void 0===o?void 0:o.allInteractionsHandler)return new k.HitTestResult(k.HitTarget.Custom,{...p,clickHandler:this._data.callbacks.allInteractionsHandler,tapHandler:this._data.callbacks.allInteractionsHandler,contextMenuHandler:this._data.callbacks.allInteractionsHandler,touchContextMenuHandler:this._data.callbacks.allInteractionsHandler});if(l>=r.text.left&&l<r.close.left){const t=Math.round(r.text.left/s),e=Math.round(r.bottom/a),o=Math.round(r.text.width/s);if(void 0!==this._data.callbacks.onText){const r=N(this._data.callbacks.onText,t,v,e,o),i=t=>{t.preventDefault(),!0===this._data.isTouchInteractionEnabled?r(t):this._data.callbacks.enableTouchInteraction()};return new k.HitTestResult(k.HitTarget.Custom,{...b,...G({id:this._data.id,part:2}),cursorType:S.PaneCursorType.Pointer,clickHandler:r,tapHandler:i,tooltip:{extendMargin:!0,text:this._data.text.title,rect:{x:t,y:v,w:o,h:this._height}}})}const i=Math.round(r.close.left/s);return new k.HitTestResult(k.HitTarget.Custom,{...b,...G({id:this._data.id,part:2}),tooltip:{extendMargin:!0,text:this._data.text.title,rect:{x:t,y:v,w:i-t,h:this._height}}})}const C=this._data.callbacks.onQtyModify;if(l>r.qty.left&&l<r.text.left&&void 0!==C){const t=Math.round(r.qty.left/s),e=N(C,t,v,Math.round(r.bottom/a),Math.round(r.qty.width/s)),o=t=>{t.preventDefault(),!0===this._data.isTouchInteractionEnabled?e(t):this._data.callbacks.enableTouchInteraction()},l=Math.round(r.text.left/s);return new k.HitTestResult(k.HitTarget.Custom,{...p,..._,...G({id:this._data.id,part:1}),
cursorType:S.PaneCursorType.Pointer,clickHandler:e,tapHandler:o,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.qty).title,rect:{x:t,y:v,w:l-t,h:this._height}}})}const g=!0===this._data.isTouchInteractionEnabled?this._data.callbacks.onModify:this._data.callbacks.enableTouchInteraction;if(l>r.qty.left&&l<r.text.left&&void 0!==this._data.callbacks.onModify){const t=Math.round(r.text.left/s);return new k.HitTestResult(k.HitTarget.Custom,{...b,...G({id:this._data.id,part:1}),cursorType:S.PaneCursorType.Pointer,clickHandler:this._data.callbacks.onModify,tapHandler:g,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.qty).title,rect:{x:m,y:v,w:t-m,h:this._height}}})}return void 0!==this.data().informer&&l>r.informer.left&&l<r.informer.left+r.informer.width?new k.HitTestResult(k.HitTarget.Custom,{...b,...G({id:this._data.id,part:9}),cursorType:S.PaneCursorType.Default,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.informer).title,rect:{x:r.informer.left/s,y:v,w:r.informer.width/s,h:this._height}}}):new k.HitTestResult(k.HitTarget.Custom,b)}drawBackground(t,e){!this._data.line.drawOnTop&&this._data.visible&&this._drawLine(t,e)}drawLine(t,e){this._isDataVisibleInViewport(e)&&this._data.line.drawOnTop&&this._data.visible&&this._drawLine(t,e)}drawPointOnLine(t,e,o){if(!this._isDataVisibleInViewport(e)||!this._data.point.visible||!this._data.visible)return;const r=this.rectWithOffsets(e),{horizontalPixelRatio:i,verticalPixelRatio:s}=e,a=Math.round(3*i),l=Math.max(1,Math.floor(1*i)),n=l/2,d=2.5*i+n,c=o+(n%1==0?0:.5),h=r.yMid+(n%1==0?0:.5);this._data.line.extend||this._data.bodyAlignment!==x.TradedGroupHorizontalAlignment.Left||(t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*s)),(0,T.setLineStyle)(t,this._data.line.style),(0,T.drawHorizontalLine)(t,r.yMid,c,r.left),t.restore()),t.save(),t.lineWidth=l,(0,T.setLineStyle)(t,this._data.point.borderStyle),this._data.point.shadowColor&&!this._data.disabled&&(t.fillStyle=this._data.point.shadowColor,(0,T.createCircle)(t,c,h,d+a),t.fill()),t.strokeStyle=this._data.point.borderColor,t.fillStyle=this._data.point.backgroundColor,(0,T.createCircle)(t,c,h,d),t.fill(),t.stroke(),t.restore()}draw(t,e){if(!this._data.visible)return;const o=this.rectWithOffsets(e);if(!this._isDataVisibleInViewport(e))return;const r=0!==o.qty.width,s=0!==o.text.width,a=0!==o.close.width,l=o.body.right-o.body.left,n=o.bottom-o.top,d=o.top+o.borderWidth,c=n-2*o.borderWidth,h=o.borderRadius-o.borderWidth,{verticalPixelRatio:u,horizontalPixelRatio:p}=e;void 0!==this._data.informer&&(0,D.drawExclamationIcon)({ctx:t,x:o.informer.left,y:o.yMid-9*u,horizontalPixelRatio:p,verticalPixelRatio:u}),(0,T.drawRoundRectWithInnerBorder)(t,o.body.left,o.top,l,n,this._data.borderBackgroundColor,o.borderRadius,o.borderWidth,this._data.borderColor,this._data.borderStyle);let _=o.body.left+o.borderWidth;if(r){const r=(0,i.ensureDefined)(this._data.qty);this._drawQtyWithBackground(t,e,o,!0,!a&&!s),_+=o.qty.width,
o.qty.rightDividerWidth&&(W(t,_,d,o.qty.rightDividerWidth,c,r.dividerColor),_+=o.qty.rightDividerWidth)}if(s&&(this._drawTextWithBackground(t,e,o,!r,!a),_+=o.text.width,o.text.rightDividerWidth&&(W(t,_,d,o.text.rightDividerWidth,c,this._data.text.dividerColor),_+=o.text.rightDividerWidth)),a){const r=(0,i.ensureDefined)(this._data.close),s=o.body.right-_-o.borderWidth;(0,T.drawRoundRectWithInnerBorder)(t,_,d,s,c,r.backgroundColor,[0,h,h,0]),r.active.visible&&(0,T.drawRoundRectWithInnerBorder)(t,_,d,s,c,r.active.backgroundColor,[0,h,h,0]),this._drawCloseButton(t,e,_,o.top,o.close.width,n,o.borderWidth)}this._drawAnchorPoint(t,e,o)}rect(t){return null===this._cache&&(this._cache=this._calculateCacheRect(t)),this._cache}rectWithOffsets(t){return null===this._cacheWithOffset&&(this._cacheWithOffset=this._calculateCacheRectWithOffsets(t)),this._cacheWithOffset}_calculateCacheRect(t){var e;const{horizontalPixelRatio:o,verticalPixelRatio:r,bitmapSize:i}=t,s=Math.max(1,Math.floor(1*o)),a=this._bodyBorderRadius,l=Math.max(a,Math.floor(a*o)),n=this._quantityWidth(this._ctxInternal),d=Math.round(n*o),c=this._mainTextWidth(this._ctxInternal),h=Math.round(c*o),u=this._data.callbacks.onClose?this._closeWidth():0,p=Math.round(u*o),_=this.data().isGroupInErrorState?Math.round(18*o):0;let y=0;const f=n&&(c||u),b=c&&u;y+=f&&1,y+=b&&1;const m=d+h+p+s*y+2*s;let v=Math.round(this._height*o);const C=Math.max(1,Math.floor(o));v%2!=C%2&&(v+=1);const g=Math.round(this._data.y*r),P=Math.floor(g+C/2-v/2)-Math.floor(.5*r),k=this._data.bodyAlignment===x.TradedGroupHorizontalAlignment.Center?Math.round(40*i.width/100):Math.round(this._data.rightPadding*o);let T=k;const w=this._data.bodyAlignment===x.TradedGroupHorizontalAlignment.Left;w&&(T=i.width-k-m);let M=i.width-T,S=M-m;let B=S+d+(d&&s)+(d&&s),D=B+h+(h&&s),I=S+(d&&s);const L=_+5*o;let O=I-L;w&&this.data().isGroupInErrorState&&(S+=L,B+=L,I+=L,M+=L,D+=L,O=I-L);let W=S;void 0!==this.data().informer&&(W=w?O:S-L);const A=12*o,H=function(t){const{bitmapSizeWidth:e,horizontalPixelRatio:o,anchorWidth:r,tradedGroupHorizontalAlignment:i}=t;let s;for(const t of R.keys()){if(e<t[0]*o||e>t[1]*o)continue;const a=R.get(t);if(void 0!==a){s=a({bitmapSizeWidth:e,horizontalPixelRatio:o,anchorWidth:r,tradedGroupHorizontalAlignment:i});break}}return s||function(t,e){return t/2-e}(e,r)}({bitmapSizeWidth:i.width,horizontalPixelRatio:o,anchorWidth:A,tradedGroupHorizontalAlignment:this._data.bodyAlignment});return{borderWidth:s,borderRadius:l,yMid:g,top:P,bottom:P+v,left:W,right:M,body:{left:S,right:M},qty:{width:d,left:I,rightDividerWidth:f&&(null===(e=this._data.qty)||void 0===e?void 0:e.isDividerVisible)?s:0},text:{width:h,left:B,rightDividerWidth:b?s:0},close:{width:p,left:D},informer:{width:_,left:O},anchor:{left:H,width:A}}}_calculateCacheRectWithOffsets(t){const e=this.rect(t),{left:o,right:r}=this._calcCoordinateWithOffset(e.left,e.right),{left:i,right:s}=this._calcCoordinateWithOffset(e.body.left,e.body.right);return{...e,left:o,right:r,top:this._alignedTop?this._alignedTop:e.top,
bottom:this._alignedTop?this._alignedTop+(e.bottom-e.top):e.bottom,body:{...e.body,left:i,right:s},qty:{...e.qty,left:this._calcCoordinateWithOffset(e.qty.left,e.qty.left+e.qty.width).left},text:{...e.text,left:this._calcCoordinateWithOffset(e.text.left,e.text.left+e.text.width).left},close:{...e.close,left:this._calcCoordinateWithOffset(e.close.left,e.close.left+e.close.width).left}}}_calcCoordinateWithOffset(t,e){var o,r,i,s;if(null!==this._cache){const a=null!==(r=null===(o=this._offsets)||void 0===o?void 0:o.leftmostForItemOffset)&&void 0!==r?r:null;if(null!==a){const o=t-(this._cache.left-a);return{left:o,right:o+(e-t)}}const l=null!==(s=null===(i=this._offsets)||void 0===i?void 0:i.rightmostForItemOffset)&&void 0!==s?s:null;if(null!==l){const o=e+(l-this._cache.right);return{left:o-(e-t),right:o}}}return{left:t,right:e}}_calcAllWidth(t,e,o,r,i,s){return e+o+r+i+2*s}_isDataVisibleInViewport(t){const e=Math.ceil(this._height/2);return this._data.y>=-e&&this._data.y<=t.mediaSize.height+e}_mainTextWidth(t){return this._data.text.text?this._minMainTextWidthGetter(this._data,t)+14:0}_closeWidth(){return 23}_measureTextWidth(t,e){if(!e)return 0;const o=t.font;t.font=(0,i.ensureNotNull)(this._font);const r=Math.ceil(this._textWidthCache.measureText(t,e));return t.font=o,r}_textWidth(t,e){const o=this._measureTextWidth(t,e);return o?Math.round(14+o):0}_quantityWidth(t){var e,o,r;const i=this._measureTextWidth(t,null===(e=this._data.qty)||void 0===e?void 0:e.text);return Math.round(Math.max(this._height,14+i,null!==(r=null===(o=this._data.qty)||void 0===o?void 0:o.minTextWidth)&&void 0!==r?r:0))}_drawLine(t,e){const o=this.rectWithOffsets(e),r=e.bitmapSize.width;t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*e.horizontalPixelRatio)),(0,T.setLineStyle)(t,this._data.line.style),void 0!==this._data.informer&&(0,D.drawErrorNotificationBackdrop)({ctx:t,x:0,y:o.yMid,w:e.bitmapSize.width,h:20,horizontalPixelRatio:e.horizontalPixelRatio,verticalPixelRatio:e.verticalPixelRatio}),(0,T.drawHorizontalLine)(t,o.yMid,o.body.right,r),this._data.line.extend&&(0,T.drawHorizontalLine)(t,o.yMid,0,o.body.right),t.restore()}_drawQtyBackground(t,e,o,r,s){const a=(0,i.ensureDefined)(this._data.qty),l=o.bottom-o.top,n=o.top+o.borderWidth,d=l-2*o.borderWidth,c=o.borderRadius-o.borderWidth;let h=0;s?h=r?c:[0,c,c,0]:r&&(h=[c,0,0,c]),(0,T.drawRoundRectWithInnerBorder)(t,o.qty.left,n,o.qty.width,d,a.backgroundColor,h),a.active.visible&&(0,T.drawRoundRectWithInnerBorder)(t,o.qty.left,n,o.qty.width,d,a.active.backgroundColor,h)}_drawQtyWithBackground(t,e,o,r,s){const a=(0,i.ensureDefined)(this._data.qty);this._drawQtyBackground(t,e,o,r,s);const l=(o.top+o.bottom)/2,n=o.qty.left+o.qty.width/2;this._drawText(t,e,a.text,a.textColor,n,l)}_drawTextWithBackground(t,e,o,r,s){const a=o.bottom-o.top,l=o.top+o.borderWidth,n=a-2*o.borderWidth,d=o.borderRadius-o.borderWidth;let c=0;s?c=r?d:[0,d,d,0]:r&&(c=[d,0,0,d]),(0,
T.drawRoundRectWithInnerBorder)(t,o.text.left,l,o.text.width,n,this._data.text.backgroundColor,c),this._data.text.active.visible&&(0,T.drawRoundRectWithInnerBorder)(t,o.text.left,l,o.text.width,n,this._data.text.active.backgroundColor,c);const h=o.top+a/2,u=o.text.left+o.text.width/2,p=(this._data.qty||this._data.text).text,_=this._getTextYMidCorrection(t,p)*e.verticalPixelRatio;(0,D.drawText)(t,e,this._data.text.text,u,h,_,this._data.text.textColor,(0,i.ensureNotNull)(this._font))}_drawText(t,e,o,r,s,a,l){const n=o.split("@").join("").toUpperCase(),d=this._getTextYMidCorrection(t,n)*e.verticalPixelRatio;(0,D.drawText)(t,e,o,s,a,d,r,(0,i.ensureNotNull)(this._font),l)}_drawUnderlinedText(t,e,o,r,s,a){const l=this._getTextYMidCorrection(t,o)*e.verticalPixelRatio,n=this._getTextWidth(t,o);(0,D.drawUnderlinedText)(t,e,o,s,a,l,r,(0,i.ensureNotNull)(this._font),n)}_isPriceLineIntersected(t,e,o){const r=this.rectWithOffsets(o),i=t>=r.left&&t<=r.right,s=t<o.bitmapSize.width-20*o.horizontalPixelRatio&&t>r.right;this._data.line.shouldOffsetPointerEvents&&r.left,!1!==this._data.line.extend||t>r.right||this._data.bodyAlignment===x.TradedGroupHorizontalAlignment.Left&&t<r.left&&r.left;return false}_isAnchorIntersected(t,e,o){return void 0!==this.data().anchor&&t&&e>o.anchor.left&&e<o.anchor.left+o.anchor.width}_getTextYMidCorrection(t,e){const o=t.font;t.font=(0,i.ensureNotNull)(this._font);const r=this._textWidthCache.yMidCorrection(t,e);return t.font=o,r}_getTextWidth(t,e){const o=t.font;t.font=(0,i.ensureNotNull)(this._font);const r=this._textWidthCache.getMetrics(t,e);return t.font=o,r.width}_drawCloseButton(t,e,o,r,s,a,l){const n=(0,i.ensureDefined)(this._data.close);t.save(),t.lineWidth=l,t.strokeStyle=n.iconColor,t.setLineDash([]);const d=r+a,c=Math.max(1,Math.ceil(7*e.horizontalPixelRatio)),h=Math.max(1,Math.ceil(7*e.verticalPixelRatio)),u=Math.round((s-c)/2),p=Math.round((a-h)/2);(0,T.drawPoly)(t,[new M.Point(o+u,r+p),new M.Point(o+u+c,d-p)],!0),(0,T.drawPoly)(t,[new M.Point(o+u+c,r+p),new M.Point(o+u,d-p)],!0),t.restore()}_initCtx(){const t=document.createElement("canvas");t.width=0,t.height=0,this._ctxInternal=(0,i.ensureNotNull)(t.getContext("2d"))}_drawAnchorPoint(t,e,o){const{anchor:r}=this._data,{bitmapSize:i,horizontalPixelRatio:s}=e;if(!(void 0===r||i.width<=360*s)){if(r.shadowColor){const e=16*s,i=o.anchor.left-2*s,a=Math.max(6,6*s);(0,T.drawRoundRectWithInnerBorder)(t,i,o.yMid-e/2,e,e,r.shadowColor,a,0)}(0,T.drawRoundRectWithInnerBorder)(t,o.anchor.left,o.yMid-o.anchor.width/2,o.anchor.width,o.anchor.width,r.backgroundColor,o.borderRadius,r.borderWidth,r.borderColor)}}}var E,F,z;function j(t){return t.hasOwnProperty("tp")&&t.hasOwnProperty("sl")}!function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(E||(E={})),function(t){t[t.TPSLHorizontalMarin=10]="TPSLHorizontalMarin",t[t.ConfirmHorizontalMarin=11]="ConfirmHorizontalMarin"}(F||(F={}));class Q extends q{constructor(){super(...arguments),this._wasTPMoved=!1,this._wasSLMoved=!1}hitTest(t,e){var o,r
;const{horizontalPixelRatio:s,verticalPixelRatio:a}=e,l=this.rectWithOffsets(e),n=Math.round(t.x*s),d=Math.round(t.y*a),c=n>=l.left,h=n<=l.right,u=c&&h,p=d>=l.top&&d<=l.bottom,_={cursorType:S.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...G({id:this._data.id,part:9}),contextMenuHandler:this._data.callbacks.onContextMenu,touchContextMenuHandler:this._data.callbacks.onContextMenu};if(this._data.disabled)return new k.HitTestResult(k.HitTarget.Custom,_);if(this._isAnchorIntersected(p,n,l))return super.hitTest(t,e);if(this._isPriceLineIntersected(n,d,e))return super.hitTest(t,e);if(!p||!u)return null;const y=Math.round(l.top/a),f=void 0!==this._data.callbacks.onMoveProjectionTP&&1===(null===(o=this._data.tp)||void 0===o?void 0:o.visibility);if(f&&n>=l.tp.left&&n<l.tp.left+l.tp.width){const t=Math.round(l.tp.left/s),e=Math.round(l.tp.width/s),o=t=>{this._data.callbacks.onMoveProjectionTP&&this._data.callbacks.onMoveProjectionTP(t),this._wasTPMoved=!0},r=()=>{this._wasTPMoved&&this._data.callbacks.onFinishMoveTP&&this._data.callbacks.onFinishMoveTP(),this._wasTPMoved=!1};return new k.HitTestResult(k.HitTarget.Custom,{..._,cursorType:S.PaneCursorType.Pointer,...G({id:this._data.id,part:5}),pressedMouseMoveHandler:o,touchMoveHandler:o,mouseUpHandler:r,touchEndHandler:r,cancelMoveHandler:this._data.callbacks.onCancelMove,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.tp).title,rect:{x:t,y,w:e,h:this._height}}})}const b=l.sl.left+l.sl.width,m=void 0!==this._data.callbacks.onMoveProjectionSL&&1===(null===(r=this._data.sl)||void 0===r?void 0:r.visibility);if(m&&n>=l.sl.left&&n<b){const t=Math.round(l.sl.width/s),e=Math.round(l.sl.left/s),o=Math.round(l.bottom/a),r=t=>{this._data.callbacks.onMoveProjectionSL&&this._data.callbacks.onMoveProjectionSL(t),this._wasSLMoved=!0},n=()=>{this._wasSLMoved&&this._data.callbacks.onFinishMoveSL&&this._data.callbacks.onFinishMoveSL(),this._wasSLMoved=!1};let d,c;const h=this._data.callbacks.onClickSL;if(void 0!==h){const r=r=>{const i=r.clientX-r.localX,s=r.clientY-r.localY,a=new M.Point(e+i,o+s);h((r=>r.x>e&&r.x<=e+t&&r.y>y&&r.y<=o),a)};d=r,c=t=>{t.preventDefault(),r(t)}}return new k.HitTestResult(k.HitTarget.Custom,{..._,cursorType:h?S.PaneCursorType.Default:S.PaneCursorType.Pointer,...G({id:this._data.id,part:6}),pressedMouseMoveHandler:r,touchMoveHandler:r,mouseUpHandler:n,touchEndHandler:n,clickHandler:d,tapHandler:c,cancelMoveHandler:this._data.callbacks.onCancelMove,tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.sl).title,rect:{x:e,y,w:t,h:this._height}}})}const v=b-l.body.left<0?n>=b&&n<l.body.left:n>=l.body.right&&n<l.tp.left;if((f||m)&&v)return new k.HitTestResult(k.HitTarget.Custom,_);if(this._hasConfirmButton()&&(0,i.ensureDefined)(this._data.confirm)){const t=l.confirm.left+l.confirm.width;if(n>=l.confirm.left&&n<t){let t={};if(void 0!==this._data.callbacks.onMove){const e=t=>{this._data.callbacks.onMove&&this._data.callbacks.onMove(t),this._wasSourceMoved=!0},o=()=>{
this._wasSourceMoved&&this._data.callbacks.onFinishMove&&this._data.callbacks.onFinishMove(),this._wasSourceMoved=!1};t={pressedMouseMoveHandler:e,touchMoveHandler:e,mouseUpHandler:o,touchEndHandler:o,cancelMoveHandler:this._data.callbacks.onCancelMove}}return new k.HitTestResult(k.HitTarget.Custom,{..._,...t,...G({id:this._data.id,part:7}),cursorType:S.PaneCursorType.Pointer,clickHandler:this._data.callbacks.onConfirm,tapHandler:this._data.callbacks.onConfirm})}const o=this._calcConfirmRect(e,l.borderWidth).offset;if(t-l.body.left<0?n>=t&&n<l.tp.left:n>=l.confirm.left-o&&n<l.confirm.left)return new k.HitTestResult(k.HitTarget.Custom,_)}return void 0!==this.data().informer&&n>l.informer.left&&n<l.informer.left+l.informer.width?new k.HitTestResult(k.HitTarget.Custom,{..._,cursorType:S.PaneCursorType.Default,...G({id:this._data.id,part:9}),tooltip:{extendMargin:!0,text:(0,i.ensureDefined)(this._data.informer).title,rect:{x:l.informer.left/s,y,w:l.informer.width/s,h:this._height}}}):super.hitTest(t,e)}draw(t,e){if(super.draw(t,e),!this._isDataVisibleInViewport(e)||!this._data.visible)return;const o=this.rectWithOffsets(e),r=o.bottom-o.top,s=o.yMid,{horizontalPixelRatio:a,verticalPixelRatio:l}=e;void 0!==this._data.informer&&(0,D.drawExclamationIcon)({ctx:t,x:o.informer.left,y:o.yMid-9*l,horizontalPixelRatio:a,verticalPixelRatio:l}),this._isTPSLVisible()&&(0!==o.tp.width&&1===(0,i.ensureDefined)(this._data.tp).visibility&&this._drawButton(t,e,r,o.borderRadius,s,o.tp,this._data.tp),0!==o.sl.width&&1===(0,i.ensureDefined)(this._data.sl).visibility&&this._drawButton(t,e,r,o.borderRadius,s,o.sl,this._data.sl)),this._hasConfirmButton()&&this._drawButton(t,e,r,o.borderRadius,s,o.confirm,this._data.confirm)}rect(t){return super.rect(t)}rectWithOffsets(t){return super.rectWithOffsets(t)}_calculateCacheRectWithOffsets(t){let e=super._calculateCacheRectWithOffsets(t);return e={...e,tp:{...e.tp,left:this._calcCoordinateWithOffset(e.tp.left,e.tp.left+e.tp.width).left},sl:{...e.sl,left:this._calcCoordinateWithOffset(e.sl.left,e.sl.left+e.sl.width).left}},void 0!==e.confirm&&(e.confirm={...e.confirm,left:this._calcCoordinateWithOffset(e.confirm.left,e.confirm.left+e.confirm.width).left}),e}_calculateCacheRect(t){const e=super._calculateCacheRect(t),{horizontalPixelRatio:o}=t,r=this._calcTPSLRect(t,e.borderWidth),i=this._calcConfirmRect(t,e.borderWidth);let s=0,a=0;const l=this._data.bodyAlignment===x.TradedGroupHorizontalAlignment.Left;l?(a=e.body.right+r.offset,s=a+r.tp-(r.tp>0?e.borderWidth:0)):(s=e.body.left-r.offset-r.sl,a=s-(r.tp>0?r.tp-e.borderWidth:0));let n=0;i.confirm>0&&(n=l?s+r.sl+i.offset:a-i.confirm-i.offset-e.borderWidth);let d=n||a||s||e.qty.left,c=e.right;return l&&(d=e.left,c=n>0?n+i.confirm:s+r.sl),l||void 0===this.data().informer||(d=d-e.informer.width-5*o,e.informer={width:null==e?void 0:e.informer.width,left:d}),{...e,left:d,right:c,tp:{width:r.tp,left:a},sl:{width:r.sl,left:s},confirm:{width:i.confirm,left:n}}}_drawLine(t,e){var o,r
;if(!this._data.callbacks.onFinishMoveSL&&!this._data.callbacks.onFinishMoveTP)return void super._drawLine(t,e);const i=this.rectWithOffsets(e),s=e.bitmapSize.width;if(t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*e.horizontalPixelRatio)),(0,T.setLineStyle)(t,this._data.line.style),(0,T.drawHorizontalLine)(t,i.yMid,i.body.right,s),this._data.line.extend)(0,T.drawHorizontalLine)(t,i.yMid,0,i.body.left);else{const e=1===(null===(o=this._data.tp)||void 0===o?void 0:o.visibility),s=1===(null===(r=this._data.sl)||void 0===r?void 0:r.visibility);if(e||s){const e=s?i.sl.left+i.sl.width:i.tp.left+i.tp.width;(0,T.drawHorizontalLine)(t,i.yMid,e,i.body.left)}if(this._hasConfirmButton()){const e=i.confirm.left+i.confirm.width;(0,T.drawHorizontalLine)(t,i.yMid,e,i.body.left)}}void 0!==this._data.informer&&(0,D.drawErrorNotificationBackdrop)({ctx:t,x:0,y:i.yMid,w:s,h:20,horizontalPixelRatio:e.horizontalPixelRatio,verticalPixelRatio:e.verticalPixelRatio}),t.restore()}_calcAllWidth(t,e,o,r,i,s){const a=super._calcAllWidth(t,e,o,r,i,s);if(!this._data.tp&&!this._data.sl&&!this._hasConfirmButton())return a;const l=this._calcTPSLRect(t,s),n=this._calcConfirmRect(t,s);return a+l.tp+l.sl+l.offset+n.confirm+n.offset}_calcConfirmRect(t,e){if(!this._hasConfirmButton())return{confirm:0,offset:0};const{horizontalPixelRatio:o}=t,r=2*e,s=Math.round(11*o),a=this._textWidth(this._ctxInternal,(0,i.ensureDefined)(this._data.confirm).text);return{confirm:Math.round(a*o)+(a&&r)+(a&&s),offset:Math.round(10*o)}}_calcTPSLRect(t,e){const{horizontalPixelRatio:o}=t,r=2*e,i=this._textWidth(this._ctxInternal,void 0!==this._data.tp?this._data.tp.text:""),s=Math.round(i*o)+(i&&r),a=this._textWidth(this._ctxInternal,void 0!==this._data.sl?this._data.sl.text:""),l=Math.round(a*o)+(a&&r);return{tp:s,sl:l,offset:l>0||s>0?Math.round(10*o):0}}_drawButton(t,e,o,r,i,s,a){if(void 0===a)return;const l=this.rectWithOffsets(e);(0,T.drawRoundRectWithInnerBorder)(t,s.left,l.top,s.width,o,a.backgroundColor,r),a.active.visible&&(0,T.drawRoundRectWithInnerBorder)(t,s.left,l.top,s.width,o,a.active.backgroundColor,r);const n=a.active.visible&&void 0!==a.active.borderColor?a.active.borderColor:a.borderColor;(0,T.drawRoundRectWithInnerBorder)(t,s.left,l.top,s.width,o,"transparent",r,l.borderWidth,n,a.borderStyle);const d=s.left+s.width/2;a.underlineText?this._drawUnderlinedText(t,e,a.text,a.textColor,d,i):this._drawText(t,e,a.text,a.textColor,d,i)}_isTPSLVisible(){return Boolean(this._data.tp)||Boolean(this._data.sl)}_hasConfirmButton(){return Boolean(this._data.callbacks.onConfirm&&this._data.confirm)}}class $ extends q{constructor(){super(...arguments),this._left=0}hitTest(t,e){const o=this.rectWithOffsets(e),r=Math.round(t.x*e.horizontalPixelRatio),i=Math.round(t.y*e.verticalPixelRatio),s=r>=o.left,a=r<=o.right,l=s&&a;if(!(i>=o.top&&i<=o.bottom)||!l)return null;const n={cursorType:S.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...G({id:this._data.id})}
;return this._data.disabled?new k.HitTestResult(k.HitTarget.Custom,n):new k.HitTestResult(k.HitTarget.Custom,{...n,...G({id:this._data.id,part:9})})}applyOffset(t){const e=(0,i.ensureDefined)(this._data.drawWithTPOffset?t.projItemTpLeft:this._data.drawWithSLOffset?t.projItemSlLeft:0);this._left!==e&&(this._left=e,this.clearCache()),this._offsets=t}_calculateCacheRect(t){const{horizontalPixelRatio:e}=t;let o=super._calculateCacheRect(t);const r=2*o.borderWidth,i=this._mainTextWidth(this._ctxInternal),s=this._quantityWidth(this._ctxInternal),a=Math.round(i*e+s*e)+(i&&r)+(s&&o.borderWidth),l=this._left+a;return o={...o,left:this._left,right:l,body:{...o.body,left:this._left,right:l},text:{left:this._left+o.qty.width+o.borderWidth,width:o.text.width,rightDividerWidth:0},qty:{left:this._left+o.borderWidth,width:o.qty.width-o.borderWidth,rightDividerWidth:o.qty.rightDividerWidth}},this._data.bodyAlignment!==x.TradedGroupHorizontalAlignment.Left?o:{...o,top:o.top,bottom:o.bottom,body:{left:o.body.left-o.text.width-Number(o.qty.rightDividerWidth)-o.borderWidth,right:o.qty.left+o.qty.width+o.borderWidth},text:{left:o.body.left-o.text.width-Number(o.qty.rightDividerWidth),width:o.text.width+Number(o.qty.rightDividerWidth),rightDividerWidth:o.qty.rightDividerWidth},qty:{left:o.qty.left,width:o.qty.width-Number(o.qty.rightDividerWidth),rightDividerWidth:0}}}_calcAllWidth(t,e,o,r,i,s){const a=2*s;return Math.round(o*t.horizontalPixelRatio)+(o&&a)}}!function(t){t[t.SpacingBetweenReverseLines=3]="SpacingBetweenReverseLines",t[t.ArrowHeight=9]="ArrowHeight",t[t.ArrowWidth=3]="ArrowWidth",t[t.ReverseButtonOffset=10]="ReverseButtonOffset",t[t.ArrowHorizontalPadding=9]="ArrowHorizontalPadding",t[t.BorderRadius=4]="BorderRadius"}(z||(z={}));class U extends Q{constructor(){super(...arguments),this._bodyBorderRadius=4}hitTest(t,e){const{horizontalPixelRatio:o,verticalPixelRatio:r}=e,s=this.rectWithOffsets(e),a=Math.round(t.x*o),l=Math.round(t.y*r),n=a>=s.left,d=a<=s.right,c=n&&d,h=l>=s.top&&l<=s.bottom,u=Math.round(s.top/r);if(!h||!c)return null;const p={cursorType:S.PaneCursorType.Default,hideCrosshairLinesOnHover:!0,...G({id:this._data.id,part:9})};if(this._data.disabled)return new k.HitTestResult(k.HitTarget.Custom,p);const _=this._hasReverseButton()&&(0,i.ensureDefined)(this._data.reverse);if(_&&1===_.visibility){const t=s.reverse.left+s.reverse.width;if(a>=s.reverse.left&&a<t){const t=Math.round(s.reverse.left/o),e=Math.round(s.reverse.width/o);return new k.HitTestResult(k.HitTarget.Custom,{...G({id:this._data.id,part:4}),cursorType:S.PaneCursorType.Pointer,hideCrosshairLinesOnHover:!0,contextMenuHandler:this._data.callbacks.onContextMenu,touchContextMenuHandler:this._data.callbacks.onContextMenu,clickHandler:this._data.callbacks.onReverse,tapHandler:this._data.callbacks.onReverse,tooltip:{text:_.title,rect:{x:t,y:u,w:e,h:this._height}}})}const r=this._calcReverseRect(e).offset;if(t-s.body.left<0?a>=t&&a<s.tp.left:a>=s.reverse.left-r&&a<s.reverse.left)return new k.HitTestResult(k.HitTarget.Custom,p)}return super.hitTest(t,e)}
draw(t,e){if(super.draw(t,e),!this._isReverseVisible()||!this._isDataVisibleInViewport(e)||!this._data.visible)return;const o=this.rectWithOffsets(e);this._drawReverseButton(t,e,o.reverse.left,o.top,o.reverse.width,o.bottom-o.top,o.borderWidth,o.borderRadius)}rect(t){return super.rect(t)}rectWithOffsets(t){return super.rectWithOffsets(t)}_calculateCacheRectWithOffsets(t){const e=super._calculateCacheRectWithOffsets(t);return{...e,reverse:{...e.reverse,left:this._calcCoordinateWithOffset(e.reverse.left,e.reverse.left+e.reverse.width).left}}}_calculateCacheRect(t){var e;const o=super._calculateCacheRect(t);if(!(null===(e=this._data)||void 0===e?void 0:e.callbacks.onReverse)||!this._hasReverseButton())return{...o,reverse:{width:0,left:0}};const r=this._calcReverseRect(t),i=this._data.bodyAlignment===x.TradedGroupHorizontalAlignment.Left,s=i?o.right+r.offset:o.left-r.width-r.offset,a=i?o.left:s,l=i?s+r.width:o.right;return{...o,left:a,right:l,reverse:{width:r.width,left:s}}}_calcAllWidth(t,e,o,r,i,s){var a;const l=super._calcAllWidth(t,e,o,r,i,s);if(!(null===(a=this._data)||void 0===a?void 0:a.callbacks.onReverse)||!this._hasReverseButton())return l;const n=this._calcReverseRect(t);return l+n.width+n.offset}_drawLine(t,e){var o;if(!(null===(o=this._data)||void 0===o?void 0:o.callbacks.onReverse))return void super._drawLine(t,e);const{verticalPixelRatio:r}=e,i=this.rectWithOffsets(e),s=e.bitmapSize.width,a=i.reverse.left+i.reverse.width;if(t.save(),t.strokeStyle=this._data.line.color,t.lineWidth=Math.max(1,Math.floor(this._data.line.thickness*r)),(0,T.setLineStyle)(t,this._data.line.style),(0,T.drawHorizontalLine)(t,i.yMid,i.body.right,s),this._isReverseVisible()&&(0,T.drawHorizontalLine)(t,i.yMid,a,i.body.left),this._data.line.extend){const e=this._isReverseVisible()?i.reverse.left:i.body.left;(0,T.drawHorizontalLine)(t,i.yMid,0,e)}t.restore()}_calcReverseRect(t){return{width:Math.round(29*t.horizontalPixelRatio),offset:Math.round(10*t.horizontalPixelRatio)}}_drawReverseButton(t,e,o,r,s,a,l,n){const d=(0,i.ensureDefined)(this._data.reverse),c=d.active;t.save(),(0,T.drawRoundRectWithInnerBorder)(t,o,r,s,a,d.backgroundColor,n,l,this._data.borderColor),c.visible&&(0,T.drawRoundRectWithInnerBorder)(t,o,r,s,a,c.backgroundColor,n,l,"transparent");const{horizontalPixelRatio:h,verticalPixelRatio:u}=e,p=Math.round(3*h),_=Math.round(3*h),y=Math.round(9*u),f=Math.round(o+(s-p)/2),b=Math.round(f+p),m=r+l+Math.round((a-y)/2-l),v=m+y,C=d.iconColor;t.lineWidth=l,(0,D.drawHalfArrow)(t,f,m,C,!1,y,_),(0,D.drawHalfArrow)(t,b,v,C,!0,y,_),t.restore()}_isReverseVisible(){return this._hasReverseButton()&&1===(0,i.ensureDefined)(this._data.reverse).visibility}_hasReverseButton(){return Boolean(this._data.callbacks.onReverse&&this._data.reverse)}}var Y,X;!function(t){t[t.MinOffsetForVisibleLine=12]="MinOffsetForVisibleLine"}(Y||(Y={})),function(t){t.FontWeight="normal"}(X||(X={}));class K{constructor(t,e){this._textWidthCache=new w.TextWidthCache,this._items=[],this._minMainTextWidthCache=new Map,this._itemsRectsInfoCache=null,this._font=(0,
P.makeFont)(t,g.CHART_FONT_FAMILY,"","normal"),this._tradedGroupRenderersController=e}itemRenderers(){return this._items}clearCache(){this._itemsRectsInfoCache=null,this._items.forEach((t=>t.clearCache()))}clearTextCache(){this._textWidthCache.reset()}setData(t){this._data=t}clearItems(){this._items=[]}addItem(t){const e=function(t,e,o,r){if(t.type===A.Position)return new U(t,e,o,r);if(t.type===A.WithBracketButtons)return new Q(t,e,o,r);if(t.type===A.Projection)return new $(t,e,o,r);if(t.type===A.Default)return new q(t,e,o,r);throw new Error("Unknown traded item renderer's type")}(t,this._textWidthCache,(0,i.ensureNotNull)(this._font),this._minTextWidth.bind(this));this._items.push(e)}applyHorizontalOffset(t,e){if(null!==this._itemsRectsInfoCache)return;const o=this._items.filter((t=>t.data().visible)).map((t=>t.rect(e)));if(0===o.length)return;let r,i,s=1/0,a=-1/0;for(const t of o){s=Math.min(s,t.yMid),a=Math.max(a,t.yMid);j(t)&&(r=t.tp.left,i=t.sl.left)}const{bitmapSize:l,horizontalPixelRatio:n}=e;let d,c,h=t.rightmostBorder,u=t.leftmostBorder;const p=h-u;if(this._data.horizontalAlignment===x.TradedGroupHorizontalAlignment.Left)h>l.width&&(c=Math.max(l.width-p,Math.round(12*n)));else if(u<0){const t=Math.round(12*n);d=l.width-p>t?p:l.width-t}if(void 0!==r&&void 0!==i){if(void 0!==c){const t=u-c;r-=t,i-=t}if(void 0!==d){const t=d-h;r+=t,i+=t}}void 0!==c&&(u=c),void 0!==d&&(h=d),this._itemsRectsInfoCache={rightmostBorder:h,leftmostBorder:u,leftmostForItemOffset:c,rightmostForItemOffset:d,yMin:s,yMax:a,projItemTpLeft:r,projItemSlLeft:i};for(const t of this._items)t.applyOffset(this._itemsRectsInfoCache)}hitTest(t,e){var o;if(!this._paneHasVisibleItems())return null;this._tradedGroupRenderersController.alignItems(e);for(let o=this._items.length-1;o>=0;o--){const r=this._items[o].hitTest(t,e);if(null!==r)return r}return this._data.disableTouchInteraction(),(null===(o=this._data)||void 0===o?void 0:o.disableNoOverlap)?new k.HitTestResult(k.HitTarget.MovePointBackground,{clickHandler:this._data.disableNoOverlap,tapHandler:this._data.disableNoOverlap,contextMenuHandler:this._data.disableNoOverlap,touchContextMenuHandler:this._data.disableNoOverlap}):null}drawBackground(t,e){if(this._paneHasVisibleItems()){this._tradedGroupRenderersController.alignItems(e);for(const o of this._items)o.drawBackground(t,e)}}draw(t,e){var o,r,i,s;if(!this._paneHasVisibleItems())return;this._tradedGroupRenderersController.alignItems(e);for(const o of this._items)o.drawLine(t,e);const{bitmapSize:a,horizontalPixelRatio:l}=e,n=null!==(r=null===(o=this._itemsRectsInfoCache)||void 0===o?void 0:o.rightmostBorder)&&void 0!==r?r:null,d=null!==(s=null===(i=this._itemsRectsInfoCache)||void 0===i?void 0:i.leftmostBorder)&&void 0!==s?s:null,c=Math.round(12*l),h=this._data.horizontalAlignment===x.TradedGroupHorizontalAlignment.Left,u=h?d:n,p=h?-1:1;if(null!==u&&u+p*c<=a.width){const o=h?0:a.width,r=Math.round(this._data.rightPadding*l),i=u+p*(Math.min(r,o-p*u)/2);this._drawVertLine(t,e,i);for(const o of this._items)o.drawPointOnLine(t,e,i)}
for(const o of this._items)o.draw(t,e)}clearMinTextWidthByItemId(t){this._minMainTextWidthCache.has(t)&&this._minMainTextWidthCache.delete(t)}clearMinTextWidthCache(){this._minMainTextWidthCache.clear()}_minTextWidth(t,e){var o;if(!t.text.text)return 0;e.save(),e.font=(0,i.ensureNotNull)(this._font);const r=Math.ceil(this._textWidthCache.measureText(e,t.text.text)),s=this._minMainTextWidthCache.get(t.id);if(void 0===s||r>s){const o=Math.ceil(this._textWidthCache.measureText(e,"0"));this._minMainTextWidthCache.set(t.id,r+o)}return e.restore(),null!==(o=this._minMainTextWidthCache.get(t.id))&&void 0!==o?o:0}_drawVertLine(t,e,o){const r=this._data.vertLine;null!==r&&null!==this._itemsRectsInfoCache&&this._itemsRectsInfoCache.yMax!==this._itemsRectsInfoCache.yMin&&(t.strokeStyle=r.color,t.lineWidth=Math.max(1,Math.floor(r.thickness*e.horizontalPixelRatio)),(0,T.setLineStyle)(t,r.style),(0,T.drawVerticalLine)(t,o,this._itemsRectsInfoCache.yMin,this._itemsRectsInfoCache.yMax))}_paneHasVisibleItems(){return this._items.filter((t=>t.data().visible)).length>0}}var J,Z=o(669874),tt=o(589637),et=o(431520),ot=o(112232),rt=o(926048),it=o(316167),st=o(52102);!function(t){t[t.ActiveColorTransparency=85]="ActiveColorTransparency",t[t.IconDisabledTransparency=80]="IconDisabledTransparency",t[t.PointShadowTransparency=70]="PointShadowTransparency",t[t.OverlayTransparency=50]="OverlayTransparency"}(J||(J={}));const at=rt.colorsPalette["color-white"],lt=rt.colorsPalette["color-tv-blue-a800"],nt=rt.colorsPalette["color-tv-blue-a700"],dt=rt.colorsPalette["color-tv-blue-a700"],ct=rt.colorsPalette["color-tv-blue-500"],ht=rt.colorsPalette["color-tv-blue-600"],ut=rt.colorsPalette["color-cold-gray-600"],pt=rt.colorsPalette["color-cold-gray-750"],_t=rt.colorsPalette["color-cold-gray-900"],yt=rt.colorsPalette["color-ripe-red-500"],ft=rt.colorsPalette["color-ripe-red-600"],bt=rt.colorsPalette["color-ripe-red-a800"],mt=rt.colorsPalette["color-ripe-red-a800"],vt=rt.colorsPalette["color-ripe-red-a800"],Ct=rt.colorsPalette["color-minty-green-a800"],gt=rt.colorsPalette["color-minty-green-500"],Pt=rt.colorsPalette["color-tan-orange-a800"],kt=rt.colorsPalette["color-tan-orange-500"],Tt="#0D3D41",xt="#453826",wt=(0,tt.generateColor)(_t,50),Mt=(0,it.blendColors)(gt,wt),St=(0,it.blendColors)(yt,wt),Bt=(0,it.blendColors)(ct,wt),Dt=(0,it.blendColors)(kt,wt),It=(0,tt.generateColor)(nt,85),Lt=((0,tt.generateColor)(nt,80),(0,tt.generateColor)(bt,85)),Ot=((0,tt.generateColor)(bt,80),(0,tt.generateColor)(Ct,85)),Rt=((0,tt.generateColor)(Ct,80),(0,tt.generateColor)(Pt,85)),Wt=((0,tt.generateColor)(Pt,80),(0,tt.generateColor)(nt,70)),At=(0,tt.generateColor)(bt,70),Ht=(0,tt.generateColor)(Ct,70),Vt=(0,tt.generateColor)(Pt,70),Gt=(0,tt.generateColor)(ct,70),Nt={pointShadowColor:Wt,labelTickColor:nt,lineColor:nt,borderBackgroundColor:_t,borderColor:nt,pointBackgroundColor:_t,disabledLineColor:dt,positivePlColor:Mt,negativePlColor:St,qty:{backgroundColor:_t,textColor:Bt,dividerColor:lt,activeColor:It},text:{backgroundColor:_t,textColor:Bt,dividerColor:lt,
buttonTextColor:Bt},close:{backgroundColor:_t,iconColor:Bt,activeColor:It},confirm:{disableBackgroundColor:pt,backgroundColor:ct,borderColor:ct,textColor:at,disableTextColor:ut,activeColor:ht},informer:{backgroundColor:st.errorNotificationBackdrop,iconColor:yt},anchor:{backgroundColor:_t,borderColor:ct,shadowColor:Gt}},qt={pointShadowColor:At,labelTickColor:bt,lineColor:bt,borderBackgroundColor:_t,borderColor:bt,pointBackgroundColor:_t,disabledLineColor:mt,positivePlColor:Mt,negativePlColor:St,qty:{backgroundColor:_t,textColor:St,dividerColor:vt,activeColor:Lt},text:{backgroundColor:_t,textColor:St,dividerColor:vt,buttonTextColor:St},close:{backgroundColor:_t,iconColor:St,activeColor:Lt},confirm:{disableBackgroundColor:pt,backgroundColor:yt,borderColor:yt,textColor:at,disableTextColor:ut,activeColor:ft},informer:{backgroundColor:st.errorNotificationBackdrop,iconColor:yt},anchor:{backgroundColor:_t,borderColor:ct,shadowColor:Gt}},Et={pointShadowColor:Ht,labelTickColor:Ct,lineColor:Ct,borderBackgroundColor:_t,borderColor:Ct,pointBackgroundColor:_t,positivePlColor:Mt,negativePlColor:St,qty:{backgroundColor:_t,textColor:Mt,dividerColor:Tt,activeColor:Ot},text:{backgroundColor:_t,textColor:Mt,dividerColor:Tt,buttonTextColor:Mt},close:{backgroundColor:_t,iconColor:Mt,activeColor:Ot},informer:{backgroundColor:st.errorNotificationBackdrop,iconColor:yt},anchor:{backgroundColor:_t,borderColor:ct,shadowColor:Gt}},Ft={pointShadowColor:Vt,labelTickColor:Pt,lineColor:Pt,borderBackgroundColor:_t,borderColor:Pt,pointBackgroundColor:_t,positivePlColor:Mt,negativePlColor:St,qty:{backgroundColor:_t,textColor:Dt,dividerColor:xt,activeColor:Rt},text:{backgroundColor:_t,textColor:Dt,dividerColor:xt,buttonTextColor:Dt},close:{backgroundColor:_t,iconColor:Dt,activeColor:Rt},informer:{backgroundColor:st.errorNotificationBackdrop,iconColor:yt},anchor:{backgroundColor:_t,borderColor:ct,shadowColor:Gt}},zt={buy:{normal:Nt,disabled:(0,it.generateBlendColors)(Nt,wt)},sell:{normal:qt,disabled:(0,it.generateBlendColors)(qt,wt)},takeProfit:{normal:Et,disabled:(0,it.generateBlendColors)(Et,wt)},stopLoss:{normal:Ft,disabled:(0,it.generateBlendColors)(Ft,wt)}};var jt;!function(t){t[t.PointShadowTransparency=80]="PointShadowTransparency",t[t.OverlayTransparency=50]="OverlayTransparency"}(jt||(jt={}))
;const Qt=rt.colorsPalette["color-white"],$t=Qt,Ut=rt.colorsPalette["color-tv-blue-50"],Yt=rt.colorsPalette["color-tv-blue-100"],Xt=rt.colorsPalette["color-tv-blue-200"],Kt=rt.colorsPalette["color-tv-blue-500"],Jt=rt.colorsPalette["color-tv-blue-600"],Zt=rt.colorsPalette["color-cold-gray-150"],te=rt.colorsPalette["color-cold-gray-300"],ee=rt.colorsPalette["color-ripe-red-50"],oe=rt.colorsPalette["color-ripe-red-100"],re=rt.colorsPalette["color-ripe-red-100"],ie=rt.colorsPalette["color-ripe-red-500"],se=rt.colorsPalette["color-ripe-red-600"],ae=rt.colorsPalette["color-minty-green-50"],le=rt.colorsPalette["color-minty-green-100"],ne=rt.colorsPalette["color-minty-green-500"],de=rt.colorsPalette["color-tan-orange-50"],ce=rt.colorsPalette["color-tan-orange-200"],he=rt.colorsPalette["color-tan-orange-500"],ue=(0,tt.generateColor)(Qt,50),pe=(0,it.blendColors)(he,ue),_e=(0,it.blendColors)(ne,ue),ye=(0,it.blendColors)(ie,ue),fe=(0,it.blendColors)(Kt,ue),be=(0,tt.generateColor)(Xt,80),me=(0,tt.generateColor)(re,80),ve=(0,tt.generateColor)(le,80),Ce=(0,tt.generateColor)(ce,80),ge=(0,tt.generateColor)(Kt,80),Pe={pointShadowColor:be,labelTickColor:Xt,lineColor:Xt,borderBackgroundColor:Qt,borderColor:Xt,pointBackgroundColor:Qt,disabledLineColor:Yt,positivePlColor:_e,negativePlColor:ye,qty:{backgroundColor:Qt,textColor:fe,dividerColor:Ut,activeColor:It},text:{backgroundColor:Qt,textColor:fe,dividerColor:Ut,buttonTextColor:fe},close:{backgroundColor:Qt,iconColor:fe,activeColor:It},confirm:{disableBackgroundColor:Zt,backgroundColor:Kt,borderColor:Kt,textColor:$t,disableTextColor:te,activeColor:Jt},informer:{backgroundColor:st.errorNotificationBackdrop,iconColor:ie},anchor:{backgroundColor:Qt,borderColor:Kt,shadowColor:ge}},ke={pointShadowColor:me,labelTickColor:re,lineColor:re,borderBackgroundColor:Qt,borderColor:re,pointBackgroundColor:Qt,disabledLineColor:oe,positivePlColor:_e,negativePlColor:ye,qty:{backgroundColor:Qt,textColor:ye,dividerColor:ee,activeColor:Lt},text:{backgroundColor:Qt,textColor:ye,dividerColor:ee,buttonTextColor:ye},close:{backgroundColor:Qt,iconColor:ye,activeColor:Lt},confirm:{disableBackgroundColor:Zt,backgroundColor:ie,borderColor:ie,textColor:$t,disableTextColor:te,activeColor:se},informer:{backgroundColor:st.errorNotificationBackdrop,iconColor:ie},anchor:{backgroundColor:Qt,borderColor:Kt,shadowColor:ge}},Te={pointShadowColor:ve,labelTickColor:le,lineColor:le,borderBackgroundColor:Qt,borderColor:le,pointBackgroundColor:Qt,positivePlColor:_e,negativePlColor:ye,qty:{backgroundColor:Qt,textColor:_e,dividerColor:ae,activeColor:Ot},text:{backgroundColor:Qt,textColor:_e,dividerColor:ae,buttonTextColor:_e},close:{backgroundColor:Qt,iconColor:_e,activeColor:Ot},informer:{backgroundColor:st.errorNotificationBackdrop,iconColor:ie},anchor:{backgroundColor:Qt,borderColor:Kt,shadowColor:ge}},xe={pointShadowColor:Ce,labelTickColor:ce,lineColor:ce,borderBackgroundColor:Qt,borderColor:ce,pointBackgroundColor:Qt,positivePlColor:_e,negativePlColor:ye,qty:{backgroundColor:Qt,textColor:pe,dividerColor:de,activeColor:Rt},
text:{backgroundColor:Qt,textColor:pe,dividerColor:de,buttonTextColor:pe},close:{backgroundColor:Qt,iconColor:pe,activeColor:Rt},informer:{backgroundColor:st.errorNotificationBackdrop,iconColor:ie},anchor:{backgroundColor:Qt,borderColor:Kt,shadowColor:ge}},we={buy:{normal:Pe,disabled:(0,it.generateBlendColors)(Pe,ue)},sell:{normal:ke,disabled:(0,it.generateBlendColors)(ke,ue)},takeProfit:{normal:Te,disabled:(0,it.generateBlendColors)(Te,ue)},stopLoss:{normal:xe,disabled:(0,it.generateBlendColors)(xe,ue)}};function Me(t,e,o,r={}){const i=o()?zt:we;let s;const a=t.bracketType();s=null!==a?a===n.BracketType.TakeProfit?i.takeProfit:i.stopLoss:t.isBuyDirection()?i.buy:i.sell;return{...e.disabled()?s.disabled:s.normal,borderStyle:t.lineStyle(),labelBorderVisible:!0,...r,lineStyle:f.LineStyle.Dashed}}var Se;!function(t){t[t.HoveredColorTransparency=85]="HoveredColorTransparency",t[t.MinQtyWidth=30]="MinQtyWidth"}(Se||(Se={}));class Be{constructor(t,e,o,r,i,s){this._item=t,this._source=e,this._chartModel=o,this._mainItemStyle=r,this._isNoOverlapMode=i.isNoOverlapMode,this._isTouchInteractionEnabled=i.isTouchInteractionEnabled,this._displayMode=i.displayMode,this._rightPadding=i.rightPadding,this._groupLineColor=i.groupLineColor,this._y=i.y,this._externalCallbacks=s}_isProfitLossHidden(){return 0===this._displayMode}_isProfitLossShorten(){return 2!==this._displayMode}_isCloseVisible(){return 0!==this._displayMode}_minQtyWidth(){return 0===this._displayMode?30:0}_isHoveredItem(t){var e;return(null===(e=this._source.hoveredItem())||void 0===e?void 0:e.id)===t.id()}_isHoveredItemPart(t,e){var o;return this._isHoveredItem(t)&&(null===(o=this._source.hoveredItem())||void 0===o?void 0:o.part)===e}_isSelectedItem(t){var e;return(null===(e=this._source.selectedItem())||void 0===e?void 0:e.id)===t.id()}_isHoveredItemWithButtons(t){if(!t)return!1;const{takeProfit:e,stopLoss:o,trailingStop:r}=(0,ot.bracketsByType)(this._source.items().projectionBrackets);return this._isHoveredItem(t)||Boolean(e&&this._isHoveredItem(e))||Boolean(o&&this._isHoveredItem(o))||Boolean(r&&this._isHoveredItem(r))}_isHoveredStopItemStopLimit(){const t=this._source.items().main,e=this._source.items().stopLimit;return!!(t&&e&&(0,u.isLimitPartStopLimitOrderItem)(e))&&this._isHoveredItem(t)}_isActiveSource(){return this._source.isHovered()||this._source.isSelected()}_itemWithButtons(){if(!this._isNoOverlapMode)return this._source.baseItem()}_projectionBracketsForItem(t){return t!==this._itemWithButtons()?[]:this._source.items().projectionBrackets}_renderDataForTPSLButtons(t){if(t!==this._itemWithButtons())return{};const e={borderStyle:this._source.isPlaced()?t.lineStyle():(0,i.ensureDefined)(this._source.mainItem()).lineStyle()},o={},{takeProfit:r,stopLoss:s,trailingStop:a,guaranteedStop:l}=(0,ot.bracketsByType)(this._source.items().projectionBrackets);if(r){const t=null===r.price(),i=this._isHoveredItemPart(r,5),s=De(r,this._source,(()=>this._chartModel.dark().value()),e);o.tp={id:r.id(),visibility:t&&this._isMainButtonsVisible()?1:0,text:r.qtyText(),
title:r.tooltip(),underlineText:!1,textColor:t?s.text.buttonTextColor:s.text.textColor,backgroundColor:s.text.backgroundColor,borderColor:s.borderColor,borderStyle:s.borderStyle,active:{visible:i,backgroundColor:s.text.backgroundColor}}}const n=s||a||l;if(n){const t=null===n.price(),r=this._isHoveredItemPart(n,6),i=De(n,this._source,(()=>this._chartModel.dark().value()),e),s=(0,tt.generateColor)(i.borderColor,85),a=this._hasAdditionalStopTypes();o.sl={id:n.id(),visibility:t&&this._isMainButtonsVisible()?1:0,text:n.qtyText(),title:n.tooltip(),underlineText:a,textColor:t?i.text.buttonTextColor:i.text.textColor,backgroundColor:i.text.backgroundColor,borderColor:i.borderColor,borderStyle:i.borderStyle,active:{visible:r,backgroundColor:a?s:i.text.backgroundColor}}}return o}_renderDataForLine(t){return{drawOnTop:this._isActiveSource()&&!this._isNoOverlapMode,thickness:this._source.lineWidth(),style:t.lineStyle,color:t.lineColor,extend:this._source.isLineExtended(),shouldOffsetPointerEvents:this._source.isPlusButtonVisible()}}_renderDataForQty(t,e){return{text:(0,et.forceLTRStr)(this._item.qtyText()),minTextWidth:this._minQtyWidth(),textColor:t.textColor,backgroundColor:t.backgroundColor,dividerColor:t.dividerColor,isDividerVisible:!0,active:{visible:this._isHoveredItemPart(this._item,1),backgroundColor:e}}}_renderDataForText(t,e){return{text:this._isProfitLossHidden()?"":this._item.profitLossText(this._isProfitLossShorten()),textColor:t.textColor,backgroundColor:t.backgroundColor,dividerColor:t.dividerColor,active:{visible:!1,backgroundColor:e}}}_renderDataForPoint(){const{takeProfit:t,stopLoss:e,trailingStop:o,guaranteedStop:r}=(0,ot.bracketsByType)(this._source.items().projectionBrackets),i=e||o||r,s=this._item===this._itemWithButtons(),a=s&&t&&null===t.price()&&this._isHoveredItem(t),l=s&&i&&null===i.price()&&this._isHoveredItem(i),n=this._isHoveredItem(this._item)||a||l?this._mainItemStyle.pointShadowColor:void 0,d=this._isSelectedItem(this._item)?this._groupLineColor:this._mainItemStyle.pointBackgroundColor,c=this._groupLineColor;return{visible:this._isActiveSource(),borderStyle:b,borderColor:c,backgroundColor:d,shadowColor:n}}_renderDataForClose(t,e){if(this._item.supportClose()&&this._isCloseVisible())return{backgroundColor:t.backgroundColor,iconColor:t.iconColor,active:{visible:this._isHoveredItemPart(this._item,3),backgroundColor:e}}}_renderDataForConfirm(){if(this._item!==this._itemWithConfirmButton()||!this._isMainButtonsVisible())return;(0,i.assert)((0,h.isOrderLikeItem)(this._item));const t=De(this._item,this._source,(()=>this._chartModel.dark().value())),e=(0,i.ensureDefined)(t.confirm),o=this._isHoveredItemPart(this._item,7),r=!this._source.hasError(),s=r?e.backgroundColor:e.disableBackgroundColor,a=r?(0,i.ensureDefined)(e.borderColor):e.disableBackgroundColor,l=r?e.textColor:e.disableTextColor;return{text:this._confirmButtonText(),textColor:l,backgroundColor:s,borderColor:a,borderStyle:f.LineStyle.Solid,active:{visible:o&&r,backgroundColor:e.activeColor,borderColor:e.activeColor}}}_renderDataGeneral(t){
let e=0;const o=this._item.price();if(null!==o){e=(this._chartModel.mainSeries().priceScale().isInverted()?-1:1)*o}return{y:this._y,visible:this._item.isVisible(),isTouchInteractionEnabled:this._isTouchInteractionEnabled,sortingIndex:e,id:this._item.id(),disabled:this._source.disabled(),borderBackgroundColor:this._borderBackgroundColor(t),borderColor:t.borderColor,borderStyle:t.borderStyle,bodyAlignment:this._source.horizontalAlignment(),rightPadding:this._rightPadding}}_callbacks(t=[]){const e={enableTouchInteraction:()=>this._externalCallbacks.setTouchInteractionMode(!0)},o={label:`[${this._modeGaLabel()}]`};this._item.hasContextMenu()&&(e.onContextMenu=t=>this._item.onContextMenu(t,o));const{takeProfit:r,stopLoss:i,trailingStop:s,guaranteedStop:a}=(0,ot.bracketsByType)(t),l=i||s||a;return e.onCancelMove=()=>{var t,e,o;return null!==(o=null===(e=(t=this._source).cancelMove)||void 0===e?void 0:e.call(t))&&void 0!==o&&o},r&&(e.onMoveProjectionTP=t=>this._source.onMove(r.id(),t),e.onFinishMoveTP=()=>this._source.onFinishMoveProjectionBracket(r.id(),{...o,event:"Add bracket from button"})),l&&(e.onMoveProjectionSL=t=>this._source.onMove(l.id(),t),e.onFinishMoveSL=()=>this._source.onFinishMoveProjectionBracket(l.id(),{...o,event:"Add bracket from button"}),this._hasAdditionalStopTypes()&&(e.onClickSL=(t,e)=>l.toggleType(t,e,o))),this._isNoOverlapMode&&(e.allInteractionsHandler=()=>this._externalCallbacks.setNoOverlapMode(!1)),this._isMainButtonsVisible()&&(e.onConfirm=()=>this._source.onConfirm(this._item.id(),o)),e}_isMainButtonsVisible(){return!this._source.isPlaced()&&this._source.isActiveSource()||this._isHoveredItemWithButtons(this._item)||this._isHoveredStopItemStopLimit()||this._source.isSelected()}_borderBackgroundColor(t){return t.borderStyle===f.LineStyle.Solid?"transparent":t.borderBackgroundColor}_modeGaLabel(){switch(this._displayMode){case 2:return"Standard view";case 1:return"Medium view";case 0:return"Minimal view"}}_confirmButtonText(){return this._item.confirmText(!0)}_itemWithConfirmButton(){if(!this._source.isPlaced()&&!this._source.isConfirmButtonOnDomWidget())return this._itemWithButtons()}_hasAdditionalStopTypes(){return this._source.isTrailingStopSupported()||this._source.isGuaranteedStopSupported()}}function De(t,e,o,r={}){return(e.isPlaced()?v.getDefaultStyleForOrderItem:Me)(t,e,o,r)}const Ie=(0,Z.appendEllipsis)(s.t(null,void 0,o(324927))),Le=s.t(null,void 0,o(898818)),Oe=s.t(null,void 0,o(759783));class Re extends Be{rendererData(){const t=(0,C.getDefaultStyleForPositionItem)(this._item.isBuyDirection(),this._source.isBlocked(),(()=>this._chartModel.dark().value()),this._item.lineStyle());let e;const o=this._renderDataForClose(t.close,t.close.activeColor);void 0!==o&&(e={...o,title:Oe});const r=this._item.extractErrorMessage(),i=r?{title:r,iconColor:t.informer.iconColor,backgroundColor:t.informer.backgroundColor}:void 0;return{type:A.Position,...this._renderDataGeneral(t),...this._renderDataForTPSLButtons(this._item),callbacks:this._callbacks(this._projectionBracketsForItem(this._item)),
line:this._renderDataForLine(t),qty:{...this._renderDataForQty(t.qty,t.qty.activeColor),title:Ie},text:{...this._renderDataForText(t.text,t.qty.activeColor),title:"",textColor:this._item.profitLossTextColor(),active:{visible:!1,backgroundColor:t.qty.activeColor}},point:this._renderDataForPoint(),close:e,reverse:this._renderDataForReverse(t.reverse),informer:i}}_callbacks(t=[]){const e=super._callbacks(t),o={label:`[${this._modeGaLabel()}]`};return this._item.supportClose()&&this._isCloseVisible()&&(e.onClose=()=>this._item.onClose(o)),this._shouldReverseShown()&&(e.onReverse=()=>this._item.onReverse(o)),this._item.supportModify()&&(e.onModify=()=>this._item.onModify(o)),e}_renderDataForReverse(t){if(!this._shouldReverseShown())return;const e=this._isHoveredItemWithButtons(this._item)||this._source.isSelected();return{title:Le,visibility:e?1:0,backgroundColor:t.backgroundColor,iconColor:t.iconColor,active:{visible:this._isHoveredItemPart(this._item,4),backgroundColor:t.activeColor}}}_shouldReverseShown(){return this._item.supportReverse()&&this._source.isReverseVisible()&&this._isReverseVisible()}_isReverseVisible(){return 2===this._displayMode&&!this._isNoOverlapMode}}var We;!function(t){t[t.AnchorBorderWidthLight=1]="AnchorBorderWidthLight",t[t.AnchorBorderWidthBold=1.5]="AnchorBorderWidthBold"}(We||(We={}));class Ae extends Be{rendererData(){var t,e;const o=this._item===this._itemWithButtons(),r=De(this._item,this._source,(()=>this._chartModel.dark().value())),i=(0,tt.generateColor)(r.borderColor,85);let s;const a=this._renderDataForClose(r.close,i);void 0!==a&&(s={...a,title:this._item.texts().close.title});const l=this._item.extractErrorMessage(),n=l?{title:l,iconColor:r.informer.iconColor,backgroundColor:r.informer.backgroundColor}:void 0;return{type:o?A.WithBracketButtons:A.Default,isGroupInErrorState:null===(e=(t=this._source).isInErrorState)||void 0===e?void 0:e.call(t),...this._renderDataGeneral(r),...this._renderDataForTPSLButtons(this._item),callbacks:this._callbacks(this._projectionBracketsForItem(this._item)),line:this._renderDataForLine(r),qty:{...this._renderDataForQty(r.qty,i),title:this._item.texts().qty.title},text:{...this._renderDataForText(r.text,i),title:this._item.profitLossTooltip()},point:this._renderDataForPoint(),close:s,confirm:this._renderDataForConfirm(),informer:n,anchor:this._renderDataForAnchor(r)}}_callbacks(t=[]){const e=this._source,o=super._callbacks(t),r={label:`[${this._modeGaLabel()}]`};return this._item.isMovingEnabled()&&!this._isNoOverlapMode&&(o.onMove=t=>e.onMove(this._item.id(),t),o.onFinishMove=()=>e.onFinishMove(this._item.id(),r)),this._item.supportModify()&&(o.onModify=()=>this._item.onModify(r)),this._item.supportClose()&&this._isCloseVisible()&&(o.onClose=()=>this._item.onClose(r)),this._item.canQtyCalcModify()&&(o.onQtyModify=(t,e)=>this._item.toggleQtyModify(t,e,r)),o}_renderDataForAnchor(t){}}class He extends Ae{constructor(t){const{item:e,source:o,chartModel:r,mainItemStyle:i,additionalData:s,callbacks:a}=t;super(e,o,r,i,s,a),this._source=o}_callbacks(t=[]){
const e=super._callbacks(t),o={label:`[${this._modeGaLabel()}]`};return this._item.supportClose()&&this._isCloseVisible()&&(e.onClose=async()=>this._source.onClose(o)),this._isNoOverlapMode||(this._item.isMovingEnabled()&&(e.onMove=t=>this._source.onMove(this._item.id(),t),e.onFinishMove=()=>this._source.onFinishMove(this._item.id(),o)),this._item.canSwitchType()&&(e.onText=(t,e)=>this._item.toggleType(t,e,o))),e}_renderDataForText(t,e){return{...super._renderDataForText(t,e),active:{visible:this._isHoveredItemPart(this._item,2),backgroundColor:e}}}}class Ve extends Be{rendererData(){const t=Me(this._item,this._source,(()=>this._chartModel.dark().value())),e=(0,tt.generateColor)(t.borderColor,85),o=this._item.bracketType()===n.BracketType.TakeProfit,r=this._item.bracketType()===n.BracketType.StopLoss||this._item.bracketType()===n.BracketType.TrailingStop||this._item.bracketType()===n.BracketType.GuaranteedStop;return{type:A.Projection,...this._renderDataGeneral(t),drawWithTPOffset:o,drawWithSLOffset:r,callbacks:this._callbacks(),line:this._renderDataForLine(t),qty:this._renderDataForQty(t.qty,e),text:{...this._renderDataForText(t.text,e),title:this._item.profitLossText(),active:{visible:!1,backgroundColor:t.qty.activeColor}},point:this._renderDataForPoint(),close:this._renderDataForClose(t.close,t.close.activeColor)}}}function Ge(t){const{item:e,source:o,chartModel:r,mainItemStyle:i,additionalData:s,callbacks:a}=t;if((0,u.isPositionItem)(e))return new Re(e,o,r,i,s,a);if((0,u.isPreOrderItem)(e))return new He({item:e,source:o,chartModel:r,mainItemStyle:i,additionalData:s,callbacks:a});if((0,u.isProjectionBracketItem)(e))return new Ve(e,o,r,i,s,a);if((0,h.isOrderLikeItem)(e))return new Ae(e,o,r,i,s,a);throw new Error("Unknown traded item type")}var Ne,qe;!function(t){t[t.NormalRightBodyPadding=64]="NormalRightBodyPadding",t[t.MobileRightBodyPadding=40]="MobileRightBodyPadding",t[t.FontSize=13]="FontSize"}(Ne||(Ne={})),function(t){t[t.Large=380]="Large",t[t.Small=280]="Small"}(qe||(qe={}));class Ee{constructor(t,e,o){this._prevItemTokens=new Map,this._displayMode=2,this._invalidated=!0,this._isTouchInteractionEnabled=!0,this._chartModel=t,this._source=e,this._tradedGroupRenderersController=o,this._showOrderProperty=e.showOrderProperty(),this._showPositionProperty=e.showPositionProperty(),this._renderer=new K(13,this._tradedGroupRenderersController),this._tradedGroupRenderersController.registerRenderer(this._renderer),this._source.positionDisplayMode().subscribe(this._renderer,this._renderer.clearMinTextWidthCache),this._source.bracketsDisplayMode().subscribe(this._renderer,this._renderer.clearMinTextWidthCache)}destroy(){this._tradedGroupRenderersController.removeRenderer(this._renderer),this._source.positionDisplayMode().unsubscribe(this._renderer,this._renderer.clearMinTextWidthCache),this._source.bracketsDisplayMode().unsubscribe(this._renderer,this._renderer.clearMinTextWidthCache)}update(){this._invalidated=!0}makeSureIsUpdated(t){if(this._invalidated){const e=this._displayMode
;this._calculateMode(t.mediaSize.width),e!==this._displayMode&&this._renderer.clearMinTextWidthCache(),this._tradedGroupRenderersController.invalidateCache(),this._updateImpl(),this._invalidated=!1}}renderer(){return this._renderer}priceToCoordinate(t){if(null===t)return null;const e=this._chartModel.mainSeries(),o=e.firstValue();return null===o?null:e.priceScale().priceToCoordinate(t,o)}_calculateMode(t){if(!y.enabled("adaptive_trading_sources"))return;const e=t<qe.Large?t<qe.Small?0:1:2;this._displayMode=e}_mainItemStyle(){const t=this._source.mainItem();return void 0===t?(0,v.getStyleForOppositeDirection)(this._source.items().brackets[0],this._source,(()=>this._chartModel.dark().value())):(0,h.isPositionLikeItem)(t)?(0,C.getDefaultStyleForPositionItem)(t.isBuyDirection(),this._source.isBlocked(),(()=>this._chartModel.dark().value()),t.lineStyle()):((0,i.assert)((0,h.isOrderLikeItem)(t),"Unexpected traded item type"),De(t,this._source,(()=>this._chartModel.dark().value())))}_rightPadding(){return 2!==this._displayMode?40:64}_sortedItems(){var t,e,o;const r=[],i=this._source.items();let s=null,a=null,l=null;const n=i.brackets.slice();if(n.push(...i.projectionBrackets),void 0!==i.stopLimit&&n.push(i.stopLimit),void 0!==i.main&&n.push(i.main),this._tradedGroupRenderersController.isNoOverlapMode())return n;for(const i of n)(null===(t=this._source.movingItem())||void 0===t?void 0:t.id)===i.id()?l=i:(null===(e=this._source.hoveredItem())||void 0===e?void 0:e.id)===i.id()?a=i:(null===(o=this._source.selectedItem())||void 0===o?void 0:o.id)===i.id()?s=i:r.push(i);return null!==s&&r.push(s),null!==a&&r.push(a),null!==l&&r.push(l),r}_updateImpl(){if(this._renderer.clearItems(),!this._showOrderProperty.value()&&!this._showPositionProperty.value()||this._isNoData())return;const t=this._mainItemStyle(),e=this._source.isSelected(),o=e&&this._source.isHoveredOtherTradedGroup()?(0,i.ensureDefined)(t.disabledLineColor):t.lineColor,r=this._rightPadding(),s={vertLine:null,horizontalAlignment:this._source.horizontalAlignment(),rightPadding:r,disableTouchInteraction:()=>{0}};(this._source.isHovered()||e)&&(s.vertLine={thickness:this._source.lineWidth(),style:this._source.isPlaced()?b:m,color:o}),this._tradedGroupRenderersController.isNoOverlapMode()&&(s.disableNoOverlap=()=>this._tradedGroupRenderersController.setNoOverlapMode(!1)),this._renderer.setData(s);const a=new Map;for(const e of this._sortedItems()){const i=this.priceToCoordinate(e.price());if(!e.isVisible()||null===i)continue;const s=Ge({item:e,mainItemStyle:t,source:this._source,chartModel:this._chartModel,additionalData:{isNoOverlapMode:this._tradedGroupRenderersController.isNoOverlapMode(),isTouchInteractionEnabled:this._isTouchInteractionEnabled,displayMode:this._displayMode,rightPadding:r,groupLineColor:o,y:i},callbacks:{setNoOverlapMode:t=>this._tradedGroupRenderersController.setNoOverlapMode(t),setTouchInteractionMode:t=>{this._isTouchInteractionEnabled=t}}}).rendererData();this._renderer.addItem(s),a.set(`${s.id} ${e.isBuyDirection()}`,s.id)}
this._prevItemTokens.forEach(((t,e)=>{a.has(e)||this._renderer.clearMinTextWidthByItemId(t)})),this._prevItemTokens=a}_isNoData(){const t=this._source.items();return void 0===t.main&&void 0===t.stopLimit&&0===t.brackets.length}}var Fe=o(887946);class ze extends Fe.PriceAxisView{constructor(t,e,o,r){super(),this._model=t,this._data=e,this._priceScaleFormatter=o,this._styleGetter=r}itemId(){return this._data.id()}_updateRendererData(t,e,o){if(t.visible=!1,!this._data.isVisible())return;const r=this._model.mainSeries(),i=r.priceScale(),s=r.firstValue();if(null===s)return;const a=this._data.price();if(null===a)return;const l=this._styleGetter();o.background=l.qty.backgroundColor,o.borderColor=l.labelBorderVisible?l.borderColor:void 0,o.borderStyle=l.labelBorderVisible?l.borderStyle:void 0,o.textColor=l.qty.textColor,o.coordinate=i.priceToCoordinate(a,s),t.borderVisible=l.labelBorderVisible,t.text=this._formatPrice(a),t.tickColor=l.labelTickColor,t.visible=!0}_formatPrice(t){return this._priceScaleFormatter().format(t,{cutFractionalByPrecision:false})}}var je,Qe=o(603164);class $e extends Qe.PriceLineAxisView{constructor(t,e,o,r,i,s,a){super(),this._chartModel=t,this._data=e,this._source=o,this._showProperty=s,this._height=r,this._verticalPadding=i,this._styleGetter=a}itemId(){return this._data.id()}_value(){const t=this._chartModel.mainSeries(),e=t.firstValue(),o=this._data.price();if(null===o||null===e)return{noData:!0};const r=t.priceScale().priceToCoordinate(o,e);return{noData:!1,floatCoordinate:r,coordinate:r,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",formattedPriceIndexedTo100:"",text:"",index:0}}_updateRendererData(t,e,o){const r=this._styleGetter();t.linestyle=r.lineStyle,o.additionalPaddingTop=this._verticalPadding,o.additionalPaddingBottom=this._verticalPadding,super._updateRendererData(t,e,o)}_priceLineColor(t){return this._styleGetter().lineColor}_lineWidth(){return this._source.lineWidth()}_lineStyle(){return this._styleGetter().lineStyle}_backgroundAreaHeight(){return this._height}_isVisible(){return this._showProperty.value()}}function Ue(t,e,o){if((0,u.isPositionItem)(o)){const r=()=>(0,C.getDefaultStyleForPositionItem)(o.isBuyDirection(),e.isBlocked(),(()=>t.dark().value()),o.lineStyle());return{priceAxisView:new ze(t,o,(()=>e.priceScaleFormatter()),r),priceLineAxisView:new $e(t,o,e,19,0,e.showPositionProperty(),r)}}(0,i.assert)((0,h.isOrderLikeItem)(o),"Unexpected traded item type");const r=()=>(0,v.getDefaultStyleForOrderItem)(o,e,(()=>t.dark().value()));return{priceAxisView:new ze(t,o,(()=>e.priceScaleFormatter()),r),priceLineAxisView:new $e(t,o,e,17,1,e.showOrderProperty(),r)}}!function(t){t[t.OrderBackgroundHeight=17]="OrderBackgroundHeight",t[t.OrderVerticalPadding=1]="OrderVerticalPadding",t[t.PositionBackgroundHeight=19]="PositionBackgroundHeight",t[t.PositionVerticalPadding=0]="PositionVerticalPadding"}(je||(je={}));class Ye{constructor(t,e){this._model=t,this._source=e}updateAllViews(t){void 0!==this._views.main&&(this._views.main.priceAxisView.update(t),
this._views.main.priceLineAxisView.update(t)),void 0!==this._views.stopLimit&&(this._views.stopLimit.priceAxisView.update(t),this._views.stopLimit.priceLineAxisView.update(t));for(const e of this._views.brackets)e.priceAxisView.update(t),e.priceLineAxisView.update(t);for(const e of this._views.project.brackets)e.priceAxisView.update(t),e.priceLineAxisView.update(t)}views(t,e){const o=this._source.movingItem()||null,r=this._source.hoveredItem()||null,i=this._source.selectedItem()||null,s=null!==o?o.id:null,a=null!==r?r.id:null,l=null!==i?i.id:null,n=[],d=[];let c=null,h=null,u=null,p=null,_=null,y=null;const f=this._views.brackets.slice();f.push(...this._views.project.brackets),this._views.main&&f.push(this._views.main),this._views.stopLimit&&f.push(this._views.stopLimit);for(const t of f)t.priceAxisView.itemId()===s?(c=t.priceAxisView,h=t.priceLineAxisView):t.priceAxisView.itemId()===a?(u=t.priceAxisView,p=t.priceLineAxisView):t.priceAxisView.itemId()===l?(_=t.priceAxisView,y=t.priceLineAxisView):(n.push(t.priceAxisView),d.push(t.priceLineAxisView));return null!==_&&null!==y&&(n.push(_),d.push(y)),null!==u&&null!==p&&(n.push(u),d.push(p)),null!==c&&null!==h&&(n.push(c),d.push(h)),[n,d]}recreateViews(){const t=this._source.items(),e=t.projectionBrackets.filter((t=>null!==t.price())).map((t=>Ue(this._model,this._source,t)));this._views={brackets:t.brackets.map((t=>Ue(this._model,this._source,t))),project:{brackets:e}},void 0!==t.main&&(this._views.main=Ue(this._model,this._source,t.main)),void 0!==t.stopLimit&&(this._views.stopLimit=Ue(this._model,this._source,t.stopLimit))}}var Xe=o(391431),Ke=o(90470);function Je(t){return t instanceof io}const Ze=s.t(null,void 0,o(155304)),to=s.t(null,void 0,o(14821)),eo=s.t(null,void 0,o(337539));function oo(t){return void 0!==t&&((0,h.isOrderItemRawData)(t)||(0,h.isPreOrderItemRawData)(t))&&4===t.type}const ro={contextMenu:{cancel:s.t(null,void 0,o(719634)),edit:(0,Z.appendEllipsis)(s.t(null,void 0,o(224522)))},qty:{title:(0,Z.appendEllipsis)(s.t(null,void 0,o(224522)))},close:{title:s.t(null,void 0,o(719634))}};class io extends a.CustomSourceBase{constructor(t,e,o,r,i,s,a,l,n,c){super(t,e),this._hadBeenModifiedAllItems=!1,this._isDestroyed=!1,this._bracketStopType=d.StopType.StopLoss,this._items={brackets:[],projectionBrackets:[]},this._blockedData=null,this._isBlocked=!1,this._mainSeries=e.mainSeries(),this._properties=o,this._configFlags=r,this._globalVisibility=i,this._globalVisibility.subscribe(this.redraw.bind(this)),this._callbacks=a,this._symbolDataProvider=l,this._symbolDataProvider.onUpdate().subscribe(this,(()=>{this._updateProjectionBracketsItems(),this.items(!0).forEach((t=>{t.fireProfitLossChange()})),this.redraw()})),this._qtySuggester=n,this._paneView=new Ee(this._model,this,c),this._tradedGroupRenderersController=c,this._priceViewsGroup=new Ye(this._model,this),this._rawDataSpawn=s.spawn(),this._rawDataSpawn.subscribe(this._setData.bind(this)),this._properties.positionPL.visibility.subscribe(this,this.redraw),
this._properties.bracketsPL.visibility.subscribe(this,this.redraw),this._properties.positionPL.display.subscribe(this,(()=>{this.redraw()})),this._properties.bracketsPL.display.subscribe(this,(()=>{this.redraw()})),this._tradedGroupRenderersController.noOverlapModeChanged().subscribe(this.redraw.bind(this)),this._properties.showPositions.subscribe(this,(()=>{this._tradedGroupRenderersController.setNoOverlapMode(!1)})),this._properties.showOrders.subscribe(this,(()=>{this._tradedGroupRenderersController.setNoOverlapMode(!1)})),this._model.mainSeries().dataEvents().symbolResolved().subscribe(this,(()=>{this._tradedGroupRenderersController.setNoOverlapMode(!1)})),this._model.onSelectedSourceChanged().subscribe(this,(()=>{this._model.selection().allSources().filter((t=>!Je(t))).length>0&&this._tradedGroupRenderersController.setNoOverlapMode(!1)})),this._model.hoveredSourceChanged().subscribe(this,(()=>{if(!this._symbolDataProvider.isActualSymbol())return;const t=this._model.hoveredSource();(null===t||t!==this&&Je(t))&&this.redraw()}))}destroy(){var t,e;this._properties.showOrders.destroy(),this._properties.showPositions.destroy(),this._properties.positionPL.visibility.unsubscribeAll(this),this._properties.positionPL.display.unsubscribeAll(this),this._properties.bracketsPL.visibility.unsubscribeAll(this),this._properties.bracketsPL.display.unsubscribeAll(this),this._model.mainSeries().dataEvents().symbolResolved().unsubscribeAll(this),this._rawDataSpawn.destroy(),null===(t=this._items.main)||void 0===t||t.destroy(),null===(e=this._items.stopLimit)||void 0===e||e.destroy(),this._items.brackets.forEach((t=>t.destroy())),this._items.projectionBrackets.forEach((t=>t.destroy())),this._globalVisibility.unsubscribe(),this._paneView.destroy(),this._symbolDataProvider.onUpdate().unsubscribeAll(this),this._symbolDataProvider.destroy(),this._isDestroyed=!0}isSelectionEnabled(){return!0}priceScaleFormatter(){return this._mainSeries.formatter()}showPositionProperty(){return this._properties.showPositions}showOrderProperty(){return this._properties.showOrders}bracketStopType(){return this._bracketStopType}setBracketStopType(t){this._bracketStopType=t,this._updateProjectionBracketsItems(!0),this.redraw()}isTrailingStopSupported(){const t=this.items().main;return void 0!==t&&(Boolean(t.data().supportTrailingStop)&&((0,u.isPositionItem)(t)?this._symbolDataProvider.supportPositionBrackets():this._symbolDataProvider.supportOrderBrackets()))}isGuaranteedStopSupported(){const t=this.items().main;return void 0!==t&&(Boolean(t.data().supportGuaranteedStop)&&((0,u.isPositionItem)(t)?this._symbolDataProvider.supportPositionBrackets():this._symbolDataProvider.supportOrderBrackets()))}supportRiskControlsAndInfo(){return!!this._configFlags.supportRiskControlsAndInfo}isReverseVisible(){return this._properties.showReverse.value()}isPlusButtonVisible(){return this._properties.plusButtonVisibility.value()}lineWidth(){return this._properties.lineProperties.width.value()}lineStyle(){return this._properties.lineProperties.style.value()}isLineExtended(){
return this._properties.lineProperties.extend.value()}isPositionPLVisible(){return this._properties.positionPL.visibility}positionDisplayMode(){return this._properties.positionPL.display}isBracketsPLVisible(){return this._properties.bracketsPL.visibility}bracketsDisplayMode(){return this._properties.bracketsPL.display}horizontalAlignment(){return this._properties.horizontalAlignment.value()}isBlocked(){return this._isBlocked}disabled(){return this.isBlocked()}hasError(){return!1}isConfirmButtonOnDomWidget(){return!1}setIsBlocked(t){this._isBlocked=t,this.redraw()}isHovered(){return this._model.hoveredSource()===this}isHoveredOtherTradedGroup(){return!this.isHovered()&&Je(this._model.hoveredSource())}isSelected(){return this._model.selection().isSelected(this)}items(t,e){if(t){const t=[];return this._items.stopLimit&&!(null==e?void 0:e.exceptStopLimit)&&t.push(this._items.stopLimit),this._items.main&&!(null==e?void 0:e.exceptMain)&&t.push(this._items.main),(null==e?void 0:e.exceptBrackets)||t.push(...this._items.brackets),(null==e?void 0:e.exceptProjection)||t.push(...this._items.projectionBrackets),t}return this._items}baseItem(){var t;return null!==(t=this._items.stopLimit)&&void 0!==t?t:this._items.main}findItem(t){const e=this.items(!0).find((e=>e.id()===t));return(0,i.assert)(void 0!==e,`Traded item with id ${t} is not found`),e}findItemWithType(t,e){const o=e===c.TradedItemType.Position?u.isPositionItem:h.isOrderLikeItem;return this.items(!0,{exceptStopLimit:!0}).find((e=>o(e)&&e.data().id===t))}movingItem(){const t=this._model.customSourceBeingMoved()===this&&this._model.customSourceMovingHitTestData()||null;return null===t||void 0===t.activeItem?null:t.activeItem}hoveredItem(){const t=this._model.hoveredSource()===this&&this._model.lastHittestData()||null;return null===t||void 0===t.activeItem?null:t.activeItem}selectedItem(){const t=this._model.selection().isSelected(this)&&this._model.lastSelectedHittestData()||null;return null===t||void 0===t.activeItem?null:t.activeItem}priceScale(){return this._mainSeries.priceScale()}updateAllViews(){this._paneView.update(),this._priceViewsGroup.updateAllViews((0,l.sourceChangeEvent)(this.id()))}updateViewsForPane(t){this._isSourceShouldBeShownOnPane(t)&&this.updateAllViews()}paneViews(t){return this._isSourceShouldBeShownOnPane(t)?[this._paneView]:[]}priceAxisViews(t,e){if(!this._isSourceShouldBeShownOnPane(t))return[];const[o,r]=this._priceViewsGroup.views(t,e);return t.findTargetPriceAxisViews(this,e,o,r)}redraw(){this.updateAllViews(),this._isSourceShouldBeShown()&&this._model.updateSource(this)}syncData(){this._isDestroyed||(null!==this._blockedData?(this._setData(this._blockedData),this._blockedData=null):this._setData(this._rawDataSpawn.value()))}allItemsSupportMove(t){if(void 0===this._items.main)return!1;for(const t of this._items.projectionBrackets)if(null!==t.price())return!1;return!(t.length<2)&&t.every((t=>(0,h.isOrderLikeItem)(t)&&t.isMovingEnabled()))}onMove(t,e,o=!1){const r=this.findItem(t),s=r.price(),a=this.items(!0);if(o&&this.setIsBlocked(!0),
e.shiftKey&&null!==r.price()&&this.allItemsSupportMove(a)){this._hadBeenModifiedAllItems=!0;const t=(0,i.ensureNotNull)(r.calcPriceDiff(e));a.forEach((e=>{(0,u.isProjectionBracketItem)(e)||e.applyPriceDiff(t)})),this._callbacks.hideChartHint()}else r.onMove(e),this._moveOtherProjectionBracketIfNeeded(r);null===s&&null!==r.price()&&this._priceViewsGroup.recreateViews(),this.redraw()}_updateStopLimit(t){const e=this._items.main,o=this._items.stopLimit;oo(t.main)&&void 0===o?this._items.stopLimit=this._createStopLimitItem(t,e):oo(t.main)&&void 0!==o?o.setData(this._dataForStopLimitOrder(t.main)):void 0!==o&&(this._convertStopLimitOrderToMainItem(t.main,o),this._deleteStopLimitItem())}_positionVisibilityGetter(){return this._isSourceShouldBeShown()&&this.showPositionProperty().value()}_orderVisibilityGetter(){return this._isSourceShouldBeShown()&&this.showOrderProperty().value()}_setData(t,e=!0){var o,s,a,l;if(this.isBlocked())this._blockedData=t,(0,u.isPositionItem)(this._items.main)&&void 0!==t.main&&((0,i.assert)((0,h.isPositionItemRawData)(t.main)),this._items.main.setData(t.main));else{const i=null!==(l=null!==(s=null===(o=t.main)||void 0===o?void 0:o.symbol)&&void 0!==s?s:null===(a=t.brackets[0])||void 0===a?void 0:a.symbol)&&void 0!==l?l:null;t=(0,r.default)(t),e?this._updateItems(t):this._createItems(t),this._updateProjectionBracketsItems(),this._priceViewsGroup.recreateViews(),this._symbolDataProvider.start(i)}this.redraw()}_processedBracketData(t){return t}_createStopLimitItem(t,e){let o;if(void 0!==t.main&&((0,h.isOrderItemRawData)(t.main)||(0,h.isPreOrderItemRawData)(t.main))&&((0,u.isOrderItem)(e)||(0,u.isPreOrderItem)(e))&&4===e.type()){const e=this._dataForStopLimitOrder(t.main);o=(0,p.createItem)(p.TradedGroupItemType.LimitPartStopLimitOrder,e,this,this._model,{itemExternalServices:{symbolDataProvider:this._symbolDataProvider,qtySuggester:this._qtySuggester,tradedGroupRenderersController:this._tradedGroupRenderersController},visibilityGetters:{order:this._orderVisibilityGetter.bind(this),position:this._positionVisibilityGetter.bind(this)},sourceCallbacks:this._callbacks},ro)}return o}_deleteStopLimitItem(){var t;null===(t=this._items.stopLimit)||void 0===t||t.destroy(),delete this._items.stopLimit}_isSourceShouldBeShown(){return!!this._globalVisibility.value()&&(!!this._symbolDataProvider.isActualSymbol()&&!(window.TradingView.printing&&!(0,Ke.isTradingObjVisibleOnScreenshot)()))}_getToggleStopTypeMenuHandler(){const t=[{title:Ze,value:d.StopType.StopLoss}];return this.isTrailingStopSupported()&&t.push({title:to,value:d.StopType.TrailingStop}),this.isGuaranteedStopSupported()&&t.push({title:eo,value:d.StopType.GuaranteedStop}),(e,o,r,i,s)=>{var a;const l=this.mainItem();if(e){const t=l&&(0,u.isPositionItem)(l)?"Chart Position":"Chart Order";this._callbacks.trackEvent(t,"Stop loss type menu opening",null!==(a=r.label)&&void 0!==a?a:"")}if(t.length>1){
const r=this._model.timeScale(),a=[r.onScroll(),r.barSpacingChanged(),this._mainSeries.onSymbolIntervalChanged()],l=t.findIndex((t=>t.value===this._bracketStopType));(0,_.updateDropdownMenu)(e,o,t,l,"Stop bracket type",a,(t=>this.setBracketStopType(t)),i,s)}}}_moveOtherProjectionBracketIfNeeded(t){const e=this._items.main;if(!(0,u.isProjectionBracketItem)(t)||void 0===e||!e.supportOnlyPairBrackets()||this._items.projectionBrackets.length<2)return;const o=(0,i.ensureNotNull)(e.price()),r=(0,i.ensureNotNull)(t.price())-o,s=this._items.projectionBrackets.find((e=>e!==t));(0,i.ensureDefined)(s).setPrice(o-r)}_createItems(t){const e=this._createMainItem(t),o=this._createStopLimitItem(t,e);this._items={main:e,stopLimit:o,brackets:t.brackets.map((t=>this._createBracketItem(t))),projectionBrackets:[]}}_updateItems(t){void 0===this._items.main&&void 0!==t.main?this._items.main=this._createMainItem(t):void 0!==this._items.main&&void 0!==t.main?this._updateMainItem(t.main):void 0!==this._items.main&&void 0===t.main&&this._deleteMainItem(),this._updateStopLimit(t),this._updateBrackets(t.brackets)}_updateBrackets(t){const e=[];this._items.brackets.forEach((o=>{const r=t.findIndex((t=>t.id===o.data().id));-1!==r?(o.setData(this._processedBracketData(t[r])),t.splice(r,1)):e.push(o)})),e.forEach((t=>{const e=this._items.brackets.findIndex((e=>e.data().id===t.data().id));-1!==e&&(this._items.brackets[e].destroy(),this._items.brackets.splice(e,1))})),t.forEach((t=>{const e=this._createBracketItem(t);this._items.brackets.push(e)}))}_updateProjectionBracketsItems(t=!1){var e,o;const r=this._items.main;if(void 0===r||!r.supportBrackets())return;const{takeProfit:s,stopLoss:a,guaranteedStop:l,trailingStop:d}=(0,ot.bracketsByType)(this._items.brackets),c=null!==(e=null!=a?a:d)&&void 0!==e?e:l,{takeProfit:h,stopLoss:u,guaranteedStop:_,trailingStop:y}=(0,ot.bracketsByType)(this._items.projectionBrackets),f=null!==(o=null!=u?u:y)&&void 0!==o?o:_;[[s,h],[c,f]].forEach((([t,e])=>{if(t&&e){const t=this._items.projectionBrackets.indexOf(e);this._items.projectionBrackets[t].destroy(),this._items.projectionBrackets.splice(t,1)}}));const b=r.data();if(!s&&!h){const t=(0,ot.buildProjectionBracketData)("ProjectionBracket",n.BracketType.TakeProfit,b),e=(0,p.createItem)(p.TradedGroupItemType.ProjectionBracket,t,this,this._model,{itemExternalServices:{symbolDataProvider:this._symbolDataProvider,qtySuggester:this._qtySuggester,tradedGroupRenderersController:this._tradedGroupRenderersController},visibilityGetters:{order:this._orderVisibilityGetter.bind(this),position:this._positionVisibilityGetter.bind(this)},sourceCallbacks:this._callbacks},ro);this._items.projectionBrackets.push(e)}if(!c&&!f||t){const t=(0,i.ensureNotNull)((0,Xe.getBracketTypeByStopType)(this._bracketStopType)),e=(0,ot.buildProjectionBracketData)("ProjectionBracket",t,b);if(f)f.setData(e);else{const t={itemExternalServices:{symbolDataProvider:this._symbolDataProvider,qtySuggester:this._qtySuggester,tradedGroupRenderersController:this._tradedGroupRenderersController},visibilityGetters:{
order:this._orderVisibilityGetter.bind(this),position:this._positionVisibilityGetter.bind(this)},sourceCallbacks:this._callbacks};0;const o=(0,p.createItem)(p.TradedGroupItemType.ProjectionBracket,e,this,this._model,t,ro);this._items.projectionBrackets.push(o)}}}_deleteMainItem(){(0,i.ensureDefined)(this._items.main).destroy(),delete this._items.main,this._deleteStopLimitItem()}_isSourceShouldBeShownOnPane(t){return t.containsMainSeries()}}},905717:(t,e,o)=>{"use strict";o.d(e,{BaseItem:()=>m,numericFormatters:()=>y,plSign:()=>_});var r=o(650151),i=o(609838),s=o(41899),a=o(329452),l=o(976418),n=o(983706),d=o(251940),c=o(431520),h=o(813108),u=o(599016),p=o(80118);function _(t,e){return`${t>0?"+":t<0?"−":""}${e?" ":""}`}const y={integerFormatter:(0,d.getNumericFormatter)(0),oneDecimalFormatter:(0,d.getNumericFormatter)(1),twoDecimalFormatter:(0,d.getNumericFormatter)(2)},f=i.t(null,void 0,o(169961)),b=i.t(null,void 0,o(168222));class m{constructor(t,e,o,r,i,s,l){this._contextMenu=null,this._profitLossChanged=new a.Delegate,this._mainSeries=o,this._source=e,this._symbolDataProvider=r,this._gaOrigin=i,this._infoGetters=s,this._itemCommands=l,this.setData(t)}destroy(){var t,e,o;null===(t=this._formatPlWV)||void 0===t||t.destroy(),null===(e=this._plColorWV)||void 0===e||e.destroy(),this._profitLossChanged.destroy(),null===(o=this._contextMenu)||void 0===o||o.hide()}data(){return this._data}texts(){return this._infoGetters.texts}price(){return this._data.price}setData(t){this._data=(0,s.clone)(t)}priceText(){return(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()).priceFormatter.format((0,r.ensureNotNull)(this.price()))}supportOnlyPairBrackets(){return!1}plColorWV(){return void 0===this._plColorWV&&(this._plColorWV=(0,l.createWVFromGetterAndSubscription)((()=>this.profitLossTextColor()),this._profitLossChanged)),this._plColorWV}formatPlWV(){return void 0===this._formatPlWV&&(this._formatPlWV=(0,l.createWVFromGetterAndSubscription)((()=>this.profitLossText()),this._profitLossChanged)),this._formatPlWV}hasContextMenu(){return this.supportModify()||this.supportClose()}useMinTickFormatter(){return!0}isBuyDirection(){return 1===this._data.side}isVisible(){return this._infoGetters.visibility()}fireProfitLossChange(){this._profitLossChanged.fire()}profitLossText(t){if(!this._data)return"";const e=this._potentialProfitLoss();if(null===e)return"";let o;switch(this._infoGetters.displayMode.value()){case n.PlDisplay.Money:o=this.moneyText(e,!0);break;case n.PlDisplay.Pips:o=this.pipsText(e,!0);break;case n.PlDisplay.Percentage:o=this.percentageText(e,!0)}return(0,c.startWithLTR)(o)}percentageText(t,e){var o;const r=_(t,e),i=this._source.baseItem(),s=null!==(o=null==i?void 0:i.price())&&void 0!==o?o:null;if(null===s)return"";const a=100*t/s*this._data.side;return`${r}${y.twoDecimalFormatter.format(Math.abs(a))}%`}moneyText(t,e){if(!this._source.supportRiskControlsAndInfo())return"";const o=this._symbolDataProvider.pipValue();if(null===o||(0,s.isNaN)(o.sellPipValue)||(0,s.isNaN)(o.buyPipValue))return"";const i=_(t,e),a=(0,
r.ensureNotNull)(this._symbolDataProvider.symbolData()),l=t/(a.pipSize||a.minTick)*this._data.side,n=this.isBuyDirection()?o.buyPipValue:o.sellPipValue,d=Math.abs((0,p.pipsToRiskInCurrency)(l,this._data.qty,n,a.priceMagnifier,a.lotSize));return`${i}${y.twoDecimalFormatter.format(d)} ${this.currency()}`}pipsText(t,e){const s=_(t,e),a=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()),l=isFinite(a.pipSize)&&a.pipSize!==a.minTick?y.oneDecimalFormatter:y.integerFormatter,n=t*this._data.side/(a.pipSize||a.minTick),d=Math.abs(n),c=l.format(d);switch(this._symbolDataProvider.pipValueType()){case u.PipValueType.Pips:return`${s}${i.t(null,{plural:"{pips} pips",count:d},o(161156)).replace("{pips}",c)}`;case u.PipValueType.Ticks:return`${s}${i.t(null,{plural:"{ticks} ticks",count:d},o(800338)).replace("{ticks}",c)}`}return""}tryBasePlOnLast(){return!1}lineStyle(){return h.LineStyle.Solid}confirmText(t){const e=1===this._data.side?f:b;return t?e:`${e} ${this.qtyText()} @ ${this.priceText()}`}extractErrorMessage(){var t,e,o;return null!==(o=null===(e=(t=this._source).extractItemErrorMessage)||void 0===e?void 0:e.call(t,this.id()))&&void 0!==o?o:null}_trackEventGA(t){const{origin:e=this._gaOrigin,event:o,label:i}=t;(0,r.assert)(!!o,"GA Event shouldn' be empty"),this._itemCommands.trackEvent(e,o,i)}_quantityText(t){return(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()).quantityFormatter.format(t)}}},96829:(t,e,o)=>{"use strict";o.d(e,{OrderBaseItem:()=>P});var r=o(650151),i=o(150335),s=o(86441),a=o(41899),l=o(540873),n=o(813108),d=o(14654),c=o(983706),h=o(735248),u=o(599016),p=o(46415),_=o(621575),y=o(631488),f=o(586137);var b=o(470692),m=o(168873),v=o(112232),C=o(482303),g=o(905717);class P extends g.BaseItem{constructor(t,e,o,r,i,s,a,l="Chart Order"){super(t,e,o,r,l,i,s),this._inEdit=!1,this._isQtyModifyOpened=!1,this._isResetQtyCalcValue=!1,this._handleQtyModifyClose=(t,e)=>{t(e)?this.applyQty(this.data().qty):this._handleQtyModifyDestroy()},this._handleQtyModifyDestroy=()=>{this.applyQty(this.data().qty),this._isQtyModifyOpened=!1,this._closeQtyCalc()},this._isBracket()&&this._source.bracketsDisplayMode().subscribe(this,this.fireProfitLossChange),a&&(this._qtyModifyCallbacks={onQtyApplyHandler:a.onQtyApplyHandler,onToggleQtyCalcHandler:a.onToggleQtyCalcHandler,qtyInfoGetter:a.qtyInfoGetter},this._qtyProvider=a.qtyProvider,this._suggestedQtySubscription=this._qtyProvider.subscribe(this._qtyModifyCallbacks.onQtyApplyHandler))}destroy(){var t,e;this._isQtyModifyOpened=!1,this._closeQtyCalc(),this._source.bracketsDisplayMode().unsubscribe(this,this.fireProfitLossChange),null===(t=this._contextMenu)||void 0===t||t.hide(),null===(e=this._suggestedQtySubscription)||void 0===e||e.unsubscribe(),super.destroy()}supportBrackets(){return!this._isBracket()&&this._symbolDataProvider.supportOrderBrackets()&&this._symbolDataProvider.supportModifyOrderBrackets()}canQtyCalcModify(){return Boolean(this._qtyProvider)}toggleQtyModify(t,e,o={}){this.canQtyCalcModify()&&(this._isQtyModifyOpened=!this._isQtyModifyOpened,
this._toggleQtyCalc(t,e,o))}modifyQty(t){this.canQtyCalcModify()&&(t<=0?this._isResetQtyCalcValue=!0:(this._isResetQtyCalcValue=!1,(0,r.ensureDefined)(this._qtyModifyCallbacks).onQtyApplyHandler(t)))}applyQty(t){var e;this.modifyQty(t),null===(e=this._qtyProvider)||void 0===e||e.applySuggestedQty(this._data.qty)}currency(){var t;return null!==(t=this._symbolDataProvider.orderCurrency())&&void 0!==t?t:""}canSwitchType(){return!1}id(){return this._id}setData(t){this._inEdit||(super.setData(t),this.fireProfitLossChange(),this._id=this._calcId())}setInEdit(t){this._inEdit=t}type(){return this._data.type}bracketType(){return this._isBracket()?(0,v.getBracketType)(this._data):null}qty(){return this._data.qty}profitLossText(t){var e;return this._data&&this._isBracket()&&(null===(e=this._source.isBracketsPLVisible())||void 0===e?void 0:e.value())&&this.bracketType()!==u.BracketType.TrailingStop&&(this._source.supportRiskControlsAndInfo()||this._infoGetters.displayMode.value()!==c.PlDisplay.Money)?super.profitLossText(t):this._bracketTypeText(t)}profitLossTextColor(){if(!this._data)return"";const t=this.style();if(!this._isBracket())return t.text.textColor;const e=this._potentialProfitLoss();return null===e?t.text.textColor:(0,h.profitLossTextColor)(t,e,!1)}profitLossTooltip(){var t;const e=this._source.mainItem(),o=null==e?void 0:e.price();if(null==o||!this._isBracket())return"";const r=this._potentialProfitLoss();if(null===r)return`${this._bracketTypeText()}`;if(!(null===(t=this._source.isBracketsPLVisible())||void 0===t?void 0:t.value())||this.bracketType()===u.BracketType.TrailingStop)return"";switch(this._infoGetters.displayMode.value()){case c.PlDisplay.Money:return`${this._bracketTypeText()} ${this.percentageText(r)} ${this.pipsText(r)}`;case c.PlDisplay.Percentage:return`${this._bracketTypeText()} ${this.moneyText(r)} ${this.pipsText(r)}`;case c.PlDisplay.Pips:return`${this._bracketTypeText()} ${this.moneyText(r)} ${this.percentageText(r)}`;default:return`${this._bracketTypeText()} ${this.pipsText(r)} ${this.percentageText(r)} ${this.moneyText(r)}`}}lineStyle(){return this.isWorking()?n.LineStyle.Solid:n.LineStyle.Dotted}calcPriceDiff(t){const e=new s.Point(t.localX,t.localY),o=this._mainSeries.priceScale(),i=this._mainSeries.firstValue();if(null===i)return null;const a=(0,r.ensureNotNull)(this.price());return o.coordinateToPrice(e.y,i)-a}applyPriceDiff(t){this._inEdit=!0,this._data.price=this._calcPriceByDiff(t)}onMove(t){const e=this.calcPriceDiff(t);null!==e&&(this.applyPriceDiff(e),t.isTouch&&(0,r.ensureDefined)(this._itemCommands.exitTrackingMode)())}async onFinishMove(t={},e={},o=!0,i,s=!0){var l,n,d,c;o&&this._source.setIsBlocked(!0);const h=(0,a.clone)(this._data),u=(0,r.ensureNotNull)(this.price());h.limitPrice=null!==(l=e.limitPrice)&&void 0!==l?l:h.limitPrice,h.takeProfit=null!==(n=e.takeProfit)&&void 0!==n?n:h.takeProfit,h.stopLoss=null!==(d=e.stopLoss)&&void 0!==d?d:h.stopLoss,h.guaranteedStop=null!==(c=e.guaranteedStop)&&void 0!==c?c:h.guaranteedStop,
h.stopPrice?h.stopPrice=u:h.limitPrice&&(h.limitPrice=u),h.stopType===p.StopType.GuaranteedStop&&(h.guaranteedStop=u),this._addTrailingStopPipsData(h,e.trailingStop),this._trackEventGA(t);const _=await this._onFinishMoveOrder(h,i,s);return this._inEdit=!1,_}hasContextMenu(){return super.hasContextMenu()||this.isMovingEnabled()}async onContextMenu(t,e){this.fireProfitLossChange(),e=(0,m.mergeGaParams)(e,{origin:this._source.isPlaced()?"Chart Order Context Menu":"Chart Project Order Context Menu"});const o=this._composeContextMenuActions(e),r={side:(0,_.sideToText)(this._data.side),qty:this.qtyText(),price:this.priceText(),orderType:(0,_.orderTypeToText)({orderType:this._data.type}),formatPlWV:this._isBracket()?this.formatPlWV():void 0},i=await async function(t,e){const o=[],r=await(0,f.createContextMenuTitle)("Trading.OrderTitle",e);r&&o.push(r);for(const{actionId:e,label:r,onExecute:i}of t)o.push(new l.Action({actionId:e,options:{label:r,onExecute:i}}));return o}(o,r),s=this._infoGetters.noOverlapAction(e,(t=>this._trackEventGA(t)));s&&(i.push(new l.Separator),i.push(s)),this._contextMenu=await(0,f.showContextMenu)(i,t,(()=>{this._contextMenu=null}),{detail:{type:"order",id:this.id().toString()}})}_composeContextMenuActions(t){const e=[];return this.supportModify()&&e.push({actionId:"Trading.EditOrder",label:this.texts().contextMenu.edit,onExecute:()=>this.onModify(t)}),this.supportClose()&&e.push({actionId:"Trading.CancelOrder",label:this.texts().contextMenu.cancel,onExecute:()=>this.onClose(t)}),e}_calcPriceByDiff(t){const{minTick:e,variableMinTickData:o}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()),s=t+(0,r.ensureNotNull)(this.price()),a=(0,d.getMinTick)({minTick:e,price:s,variableMinTickData:o});return(0,i.fixComputationError)(a*Math.round(s/a))}_addTrailingStopPipsData(t,e){const o=this._source.mainItem();if(void 0===o)return;const{side:i,stopPrice:s,limitPrice:a}=o.data(),l=1===i?-1:1,{pipSize:n}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData()),d=t.stopPrice||t.limitPrice;if(void 0===e||void 0===d)if((0,b.isBracketOrderRawData)(t)&&t.parentId&&t.stopType===p.StopType.TrailingStop&&void 0!==d){if((0,C.isPositionLikeItem)(o)){const{bid:e,ask:o}=(0,r.ensureNotNull)(this._symbolDataProvider.lastData()),s=1===i?e:o;return void(t.trailingStopPips=(0,y.calcPipsByPrice)(d,s,l,n))}const e=3===o.data().type?s:a;t.trailingStopPips=(0,y.calcPipsByPrice)(d,(0,r.ensureDefined)(e),l,n)}else;else t.trailingStopPips=(0,y.calcPipsByPrice)(e,d,l,n)}_bracketTypeText(t){if(!this._data)return"";if(this._isBracket()){const e=(0,v.getBracketTypeToText)(this._data.type,this._data.stopType,t);if(null!==e)return e}return t?(0,_.orderTypeToText)({orderType:this._data.type,uppercase:!0,shorten:!0}):`${(0,_.sideToText)(this._data.side)} ${(0,_.orderTypeToText)({orderType:this._data.type,uppercase:!1})}`}_potentialProfitLoss(){const t=this._source.baseItem();if(!this._data||!t)return null
;const e=this.price(),{ask:o,bid:r}=this._symbolDataProvider.lastData()||{},i=t.tryBasePlOnLast()&&3===this._data.type&&this._data.stopType===p.StopType.TrailingStop;if(!(0,a.isNumber)(e))return null;const s=i?this.isBuyDirection()?o:r:t.price();return(0,a.isNumber)(s)?(s-e)*this._data.side:null}_isBracket(){const t=this.data();if(!(0,b.isBracketOrderRawData)(t))return!1;const e=this._source.mainItem();return 1!==t.parentType||void 0!==e&&e.data().side!==this._data.side}_closeQtyCalc(){this._toggleQtyCalc((()=>!1),new s.Point(0,0))}_qtyCalcValueGetter(){return this._isResetQtyCalcValue?0:this.data().qty}_toggleQtyCalc(t,e=new s.Point(0,0),o={}){if(!this.canQtyCalcModify())return;const{onToggleQtyCalcHandler:i,qtyInfoGetter:a}=(0,r.ensureDefined)(this._qtyModifyCallbacks);i(this._isQtyModifyOpened,e,a,(()=>this._qtyCalcValueGetter()),(t=>this.modifyQty(t)),(e=>this._handleQtyModifyClose(t,e)),this._handleQtyModifyDestroy)}}},99834:(t,e,o)=>{"use strict";o.d(e,{OrderWithMenuItem:()=>a});var r=o(650151),i=o(86441),s=o(96829);class a extends s.OrderBaseItem{constructor(t,e,o,r,i,s,a,l){super(t,e,o,r,i,s,l),this._isTypeMenuOpened=!1,this._handleTypeMenuClose=(t,e)=>{t(e)||this._handleTypeMenuDestroy()},this._handleTypeMenuDestroy=()=>{this._isTypeMenuOpened=!1},this._typeMenuCallbacks=a}destroy(){var t;null===(t=this._typeMenuCallbacks)||void 0===t||t.closeDropdownMenuHandler(),super.destroy()}isMovingEnabled(){return!0}toggleType(t,e,o={}){this._typeMenuCallbacks&&(this._isTypeMenuOpened=!this._isTypeMenuOpened,this._toggleTypeMenu(t,e,o))}async onClose(t){}async onModify(t){return!1}async _onFinishMoveOrder(t,e,o=!0){return!0}_toggleTypeMenu(t,e=new i.Point(0,0),o={}){(0,r.ensureDefined)(this._typeMenuCallbacks).onToggleTypeMenuHandler(this._isTypeMenuOpened,e,o,(e=>this._handleTypeMenuClose(t,e)),this._handleTypeMenuDestroy)}}},482303:(t,e,o)=>{"use strict";var r;function i(t){return"onReverse"in t}function s(t){return function(t){return"isMovingEnabled"in t&&"onMove"in t&&"onFinishMove"in t}(t)&&"bracketType"in t&&"isWorking"in t}function a(t){return"Position"===t.dataType}function l(t){return"PreOrder"===t.dataType}function n(t){return"Order"===t.dataType}o.d(e,{isOrderItemRawData:()=>n,isOrderLikeItem:()=>s,isPositionItemRawData:()=>a,isPositionLikeItem:()=>i,isPreOrderItemRawData:()=>l}),function(t){t.PreOrder="PreOrder",t.Order="Order",t.Position="Position"}(r||(r={}))},265328:(t,e,o)=>{"use strict";o.d(e,{TradedGroupItemType:()=>r,createItem:()=>f});var r,i=o(650151),s=o(822914),a=o(586137),l=o(482303),n=o(28518),d=o(680813),c=o(971283),h=o(980465),u=o(87502),p=o(287782),_=o(842471);class y{constructor(t,e){this._symbol=t,this._qtySuggester=e}subscribe(t){return this._qtySuggester.suggestedQtyChanged(this._symbol).subscribe(t)}async applySuggestedQty(t){this._qtySuggester.setQty(this._symbol,t)}}function f(t,e,o,f,b,m){const v=f.mainSeries(),C=(t,e)=>(0,a.createNoOverlapMenuAction)(b.itemExternalServices.tradedGroupRenderersController,t,e);if(t===r.Order&&(0,l.isOrderItemRawData)(e)){
const{dataType:t,...r}=e,i=t=>(0,u.getDefaultStyleForOrderItem)(t,o,(()=>f.dark().value()));return new c.OrderItem(r,o,v,b.itemExternalServices.symbolDataProvider,{displayMode:o.bracketsDisplayMode(),style:i,visibility:b.visibilityGetters.order,noOverlapAction:C,texts:m},{trackEvent:b.sourceCallbacks.trackEvent,exitTrackingMode:b.sourceCallbacks.exitTrackingMode},void 0,b.gaOrigin)}if(t===r.Position&&(0,l.isPositionItemRawData)(e)){const t=t=>(0,h.getDefaultStyleForPositionItem)(t.isBuyDirection(),o.isBlocked(),(()=>f.dark().value()),t.lineStyle()),{dataType:r,...i}=e;return new p.PositionItem(i,o,v,b.itemExternalServices.symbolDataProvider,{displayMode:o.positionDisplayMode(),style:t,visibility:b.visibilityGetters.position,noOverlapAction:C,texts:m},{trackEvent:b.sourceCallbacks.trackEvent})}if(t===r.LimitPartStopLimitOrder&&(0,l.isOrderItemRawData)(e)){const t=t=>(0,u.getDefaultStyleForOrderItem)(t,o,(()=>f.dark().value())),r={...(0,s.default)(e),price:(0,i.ensureDefined)(e.limitPrice),considerFilledQty:!1},{dataType:a,...l}=r;let n;if(b.qtyModifyCallbacks){n={qtyProvider:new y(l.symbol,b.itemExternalServices.qtySuggester),...(0,i.ensureDefined)(b.qtyModifyCallbacks)}}return new d.LimitPartStopLimitOrderItem(l,o,v,b.itemExternalServices.symbolDataProvider,{displayMode:o.bracketsDisplayMode(),style:t,visibility:b.visibilityGetters.order,noOverlapAction:C,texts:m},{trackEvent:b.sourceCallbacks.trackEvent,exitTrackingMode:b.sourceCallbacks.exitTrackingMode},n)}if(t===r.ProjectionBracket&&(0,l.isOrderItemRawData)(e)){const{dataType:t,...r}=e,i=t=>(0,u.getDefaultStyleForOrderItem)(t,o,(()=>f.dark().value()));return new n.ProjectionBracketItem(r,o,v,b.itemExternalServices.symbolDataProvider,{displayMode:o.bracketsDisplayMode(),style:i,visibility:b.visibilityGetters.order,noOverlapAction:C,texts:m},{trackEvent:b.sourceCallbacks.trackEvent,exitTrackingMode:b.sourceCallbacks.exitTrackingMode},b.menuCallbacks)}if(t===r.PreOrder&&(0,l.isPreOrderItemRawData)(e)){const t=t=>(0,u.getDefaultStyleForOrderItem)(t,o,(()=>f.dark().value())),{dataType:r,...s}=e,a=new y(s.symbol,b.itemExternalServices.qtySuggester);return new _.PreOrderItem(s,o,v,b.itemExternalServices.symbolDataProvider,{displayMode:o.bracketsDisplayMode(),style:t,visibility:b.visibilityGetters.order,noOverlapAction:C,texts:m},{trackEvent:b.sourceCallbacks.trackEvent,exitTrackingMode:b.sourceCallbacks.exitTrackingMode},b.menuCallbacks,{qtyProvider:a,...(0,i.ensureDefined)(b.qtyModifyCallbacks)})}throw new Error("Unknown traded item type")}!function(t){t[t.Position=0]="Position",t[t.Order=1]="Order",t[t.LimitPartStopLimitOrder=2]="LimitPartStopLimitOrder",t[t.ProjectionBracket=3]="ProjectionBracket",t[t.PreOrder=4]="PreOrder"}(r||(r={}))},431635:(t,e,o)=>{"use strict";o.d(e,{isLimitPartStopLimitOrderItem:()=>h,isOrderItem:()=>d,isPositionItem:()=>n,isPreOrderItem:()=>c,isProjectionBracketItem:()=>u});var r=o(28518),i=o(680813),s=o(971283),a=o(287782),l=o(842471);function n(t){return t instanceof a.PositionItem}function d(t){return t instanceof s.OrderItem}
function c(t){return t instanceof l.PreOrderItem}function h(t){return t instanceof i.LimitPartStopLimitOrderItem}function u(t){return t instanceof r.ProjectionBracketItem}},680813:(t,e,o)=>{"use strict";o.d(e,{LimitPartStopLimitOrderItem:()=>l});var r=o(650151),i=o(41899),s=o(621575),a=o(971283);class l extends a.OrderItem{isWorking(){return!1}async onFinishMove(t,e={},o=!0,s){this._source.setIsBlocked(o);const a=(0,i.clone)(this.data()),l=(0,r.ensureNotNull)(a.price);a.limitPrice=l,a.takeProfit=e.takeProfit||a.takeProfit,a.stopLoss=e.stopLoss||a.stopLoss,await this._addTrailingStopPipsData(a),void 0===s&&(s=1),this._trackEventGA(t);const n=await(0,r.ensureDefined)(this._data.callbacks.moveOrder)(a.id,a,s);return this._inEdit=!1,this._source.setIsBlocked(!1),this._source.syncData(),n}profitLossText(t){return this._source.isPlaced()?this._bracketTypeText(t):(0,s.orderTypeToText)({orderType:this.data().type,uppercase:t,shorten:t})}supportClose(){return!1}_calcId(){return this.data().type}}},971283:(t,e,o)=>{"use strict";o.d(e,{OrderItem:()=>h});var r=o(650151),i=o(41899),s=o(440891),a=o(599016),l=o(168873),n=o(96829),d=o(112232);const c=s.enabled("chart_hide_close_order_button");class h extends n.OrderBaseItem{style(){return this._infoGetters.style(this)}isMovingEnabled(){return this._data.supportMove}supportClose(){return!c&&Boolean(this._data.callbacks.cancelOrder)}supportModify(){return Boolean(this._data.callbacks.modifyOrder)}isWorking(){return 6===this._data.status}qtyText(){return super._quantityText(this._data.considerFilledQty?this._data.qty-(this._data.filledQty||0):this._data.qty)}profitLossText(t){var e;return this._data&&this._isBracket()&&(null===(e=this._source.isBracketsPLVisible())||void 0===e?void 0:e.value())&&this.bracketType()!==a.BracketType.TrailingStop?super.profitLossText(t):this._bracketTypeText(t)}async onModify(t={},e){this._source.setIsBlocked(!0);const o=(0,i.clone)(this._data);await this._addTrailingStopPipsData(o),this._trackEventGA((0,l.mergeGaParams)(t,{event:this._source.isPlaced()?"Edit Order":"Edit project order"}));const s=await(0,r.ensureDefined)(this._data.callbacks.modifyOrder)(o.id,o,this._getOrderTicketFocusControl(),e);return this._source.setIsBlocked(!1),this._source.syncData(),s}async onClose(t={}){this._source.isBlocked()||(this._source.setIsBlocked(!0),this._trackEventGA((0,l.mergeGaParams)(t,{event:this._source.isPlaced()?"Cancel Order":"Cancel project order"})),await(0,r.ensureDefined)(this._data.callbacks.cancelOrder)(this._data.id),this._source.setIsBlocked(!1),this._source.syncData())}_onFinishMoveOrder(t,e,o=!0){return this._data.callbacks.moveOrder||this._data.supportModifyOrderPrice?(0,r.ensureDefined)(this._data.callbacks.moveOrder)(t.id,t,e):(0,r.ensureDefined)(this._data.callbacks.modifyOrder)(t.id,t,e,o)}_calcId(){return void 0!==this._data.parentId?(0,r.ensureNotNull)((0,d.getBracketType)(this._data)):this._data.id}_getOrderTicketFocusControl(){const t=this.bracketType();return null===t?3===this._data.type?2:1:t===a.BracketType.TakeProfit?3:4}}},
52102:(t,e,o)=>{"use strict";o.d(e,{buyActive:()=>k,buyPointShadow:()=>M,darkTheme:()=>L,errorNotificationBackdrop:()=>D,overlay:()=>B,sellActive:()=>T,sellPointShadow:()=>S,stopLossActive:()=>w,takeProfitActive:()=>x});var r,i=o(926048),s=o(589637),a=o(619624);!function(t){t[t.ActiveColorTransparency=85]="ActiveColorTransparency",t[t.IconDisabledTransparency=80]="IconDisabledTransparency",t[t.PointShadowTransparency=70]="PointShadowTransparency",t[t.OverlayTransparency=50]="OverlayTransparency",t[t.BackdropTransparency=10]="BackdropTransparency"}(r||(r={}));const l=i.colorsPalette["color-white"],n=i.colorsPalette["color-tv-blue-a800"],d=i.colorsPalette["color-tv-blue-a700"],c=i.colorsPalette["color-tv-blue-500"],h=i.colorsPalette["color-tv-blue-600"],u=i.colorsPalette["color-cold-gray-600"],p=i.colorsPalette["color-cold-gray-750"],_=i.colorsPalette["color-cold-gray-900"],y=i.colorsPalette["color-minty-green-500"],f=i.colorsPalette["color-ripe-red-a800"],b=f,m=i.colorsPalette["color-ripe-red-500"],v=i.colorsPalette["color-ripe-red-600"],C=i.colorsPalette["color-tan-orange-500"],g=(0,s.generateColor)(y,70),P=(0,s.generateColor)(C,70),k=(0,s.generateColor)(c,85),T=(0,s.generateColor)(m,85),x=(0,s.generateColor)(y,85),w=(0,s.generateColor)(C,85),M=(0,s.generateColor)(c,70),S=(0,s.generateColor)(m,70),B=(0,s.generateColor)(_,50),D=(0,s.generateColor)(m,10),I=((0,s.generateColor)(m,80),(0,s.generateColor)(y,80),(0,s.generateColor)(C,80),(0,s.generateColor)(c,80),{text:l,buySecondary:n,buyDisabled:d,buyPrimary:c,confirmActiveBuy:h,textDisabled:u,backgroundDisabled:p,background:_,takeProfitPrimary:y,sellSecondary:f,sellDisabled:b,sellPrimary:m,confirmActiveSell:v,stopLossPrimary:C,takeProfitSecondary:"#0D3D41",stopLossSecondary:"#453826",buyActive:k,sellActive:T,takeProfitActive:x,stopLossActive:w,buyPointShadow:M,sellPointShadow:S,takeProfitPointShadow:g,stopLossPointShadow:P,overlay:B,errorNotificationBackdrop:D}),L=(0,a.generateOrderColorTheme)(I)},328969:(t,e,o)=>{"use strict";o.d(e,{buyPointShadow:()=>w,lightTheme:()=>D,overlay:()=>S,sellPointShadow:()=>M});var r,i=o(926048),s=o(589637),a=o(619624),l=o(52102);!function(t){t[t.PointShadowTransparency=80]="PointShadowTransparency",t[t.OverlayTransparency=50]="OverlayTransparency"}(r||(r={}));const n=i.colorsPalette["color-tv-blue-50"],d=i.colorsPalette["color-tv-blue-100"],c=i.colorsPalette["color-tv-blue-500"],h=i.colorsPalette["color-cold-gray-150"],u=i.colorsPalette["color-cold-gray-300"],p=i.colorsPalette["color-tv-blue-600"],_=i.colorsPalette["color-minty-green-50"],y=i.colorsPalette["color-minty-green-500"],f=i.colorsPalette["color-ripe-red-50"],b=i.colorsPalette["color-ripe-red-100"],m=i.colorsPalette["color-ripe-red-500"],v=i.colorsPalette["color-ripe-red-600"],C=i.colorsPalette["color-tan-orange-50"],g=i.colorsPalette["color-tan-orange-500"],P=i.colorsPalette["color-white"],k=i.colorsPalette["color-white"],T=(0,s.generateColor)(y,80),x=(0,s.generateColor)(g,80),w=(0,s.generateColor)(c,80),M=(0,s.generateColor)(m,80),S=(0,s.generateColor)(P,50),B={text:k,
buySecondary:n,buyDisabled:d,buyPrimary:c,confirmActiveBuy:p,textDisabled:u,backgroundDisabled:h,background:P,takeProfitPrimary:y,sellSecondary:f,sellDisabled:b,sellPrimary:m,confirmActiveSell:v,stopLossPrimary:g,takeProfitSecondary:_,stopLossSecondary:C,buyActive:l.buyActive,sellActive:l.sellActive,takeProfitActive:l.takeProfitActive,stopLossActive:l.stopLossActive,buyPointShadow:w,sellPointShadow:M,takeProfitPointShadow:T,stopLossPointShadow:x,overlay:S,errorNotificationBackdrop:l.errorNotificationBackdrop},D=(0,a.generateOrderColorTheme)(B)},87502:(t,e,o)=>{"use strict";o.d(e,{getDefaultStyleForOrderItem:()=>l,getStyleForOppositeDirection:()=>n});var r=o(813108),i=o(599016),s=o(328969),a=o(52102);function l(t,e,o,l={}){const n=o()?a.darkTheme:s.lightTheme;let d;const c=t.bracketType();d=null!==c?c===i.BracketType.TakeProfit?n.takeProfit:n.stopLoss:t.isBuyDirection()?n.buy:n.sell;const h=e.disabled()?d.disabled:d.normal,u=e.isPlaced()?t.lineStyle():r.LineStyle.Dashed;return{...h,lineStyle:u,borderStyle:u,labelBorderVisible:!0,...l}}function n(t,e,o){const i=o()?a.darkTheme:s.lightTheme,l=t.isBuyDirection()?i.sell:i.buy;return{...e.disabled()?l.disabled:l.normal,lineStyle:t.isWorking()?e.lineStyle():r.LineStyle.Dotted,borderStyle:t.isWorking()?r.LineStyle.Solid:r.LineStyle.Dotted,labelBorderVisible:!0}}},287782:(t,e,o)=>{"use strict";o.d(e,{PositionItem:()=>P});var r=o(650151),i=o(983706),s=o(540873),a=o(440891),l=o(41899),n=o(248361),d=o(937778),c=o(621575),h=o(586137),u=o(631488),p=o(168873),_=o(905717),y=o(609838);const f=(0,o(669874).appendEllipsis)(y.t(null,void 0,o(591932))),b=y.t(null,void 0,o(383236)),m=y.t(null,void 0,o(360196));var v=o(735248);const C=(0,d.getLogger)("Trading.Positions"),g=a.enabled("chart_hide_close_position_button");class P extends _.BaseItem{constructor(t,e,o,r,i,s){super(t,e,o,r,"Chart Position",i,s),this._source.positionDisplayMode().subscribe(this,this.fireProfitLossChange)}destroy(){this._source.positionDisplayMode().unsubscribe(this,this.fireProfitLossChange),super.destroy()}supportBrackets(){return this._symbolDataProvider.supportPositionBrackets()}currency(){var t;return null!==(t=this._symbolDataProvider.positionCurrency())&&void 0!==t?t:""}profitLossTextColor(){if(!this._data)return"";const t=this._potentialProfitLoss();return null===t?"":(0,v.profitLossTextColor)(this._infoGetters.style(this),t,this._infoGetters.displayMode.value()===i.PlDisplay.Money)}id(){return this._data.id}setData(t){var e;const o=null===(e=this.data())||void 0===e?void 0:e.pl;super.setData(t),this.data().pl!==o&&this.fireProfitLossChange()}qtyText(){return super._quantityText(this._data.qtyBySide)}qty(){return this._data.qtyBySide}supportOnlyPairBrackets(){return this._data.supportOnlyPairBrackets}supportReverse(){return this._symbolDataProvider.supportPositionReverse()}async onReverse(t={}){t=(0,p.mergeGaParams)(t,{event:"Reverse Position"}),await this._doActionWithBlock("reversePosition",!0,t)}supportClose(){return!g&&this._data.supportClose}async onClose(t={}){t=(0,p.mergeGaParams)(t,{
event:"Close Position"}),await this._doActionWithBlock("closePosition",!0,t)}supportModify(){return this.supportBrackets()}async onModify(t={}){return t=(0,p.mergeGaParams)(t,{event:"Edit Position"}),this._doActionWithBlock("modifyPosition",!0,t,void 0,void 0,!1)}useMinTickFormatter(){return!1}async onModifyWithBracket(t={},e={},o=!0,i,s=!0){var a,l;const n=this._symbolDataProvider.lastData(),d=null!==(a=null==n?void 0:n.bid)&&void 0!==a?a:null,c=null!==(l=null==n?void 0:n.ask)&&void 0!==l?l:null;if(void 0!==e.trailingStop&&d&&c){const t=1===this._data.side?-1:1,o=1===this._data.side?d:c,{pipSize:i}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData());e.trailingStopPips=(0,u.calcPipsByPrice)(e.trailingStop,o,t,i),e.trailingStop=void 0}return this._doActionWithBlock("modifyPosition",o,t,e,i,s)}hasContextMenu(){return super.hasContextMenu()||this.supportReverse()}moneyText(t,e){return`${(0,_.plSign)(t,e)}${_.numericFormatters.twoDecimalFormatter.format(Math.abs(t))} ${this.currency()}`}async onContextMenu(t,e){this.fireProfitLossChange();const o={};e=(0,p.mergeGaParams)(e,{origin:"Chart Position Context Menu"}),this.supportClose()&&(o.closePosition=this.onClose.bind(this,e)),this.supportReverse()&&(o.reversePosition=this.onReverse.bind(this,e)),this.supportModify()&&(o.modifyPosition=this.onModify.bind(this,e));const r={side:(0,c.sideToText)(this._data.side),qty:this.qtyText(),price:this.priceText(),formatPlWV:this.formatPlWV(),plColorWV:this.plColorWV()},i=await async function(t,e){const o=[],r=await(0,h.createContextMenuTitle)("Trading.PositionTitle",e);return r&&o.push(r),void 0!==t.modifyPosition&&o.push(new s.Action({actionId:"Trading.ModifyPosition",options:{label:f,onExecute:t.modifyPosition}})),void 0!==t.closePosition&&o.push(new s.Action({actionId:"Trading.ClosePosition",options:{label:b,onExecute:t.closePosition}})),void 0!==t.reversePosition&&o.push(new s.Action({actionId:"Trading.ReversePosition",options:{label:m,onExecute:t.reversePosition}})),o}(o,r),a=this._infoGetters.noOverlapAction(e,(t=>this._trackEventGA(t)));a&&(i.push(new s.Separator),i.push(a)),this._contextMenu=await(0,h.showContextMenu)(i,t,(()=>{this._contextMenu=null}),{detail:{type:"position",id:this.id()}})}tryBasePlOnLast(){return!0}_potentialProfitLoss(){var t;if(!this._source.isPositionPLVisible().value()||!this._data)return null;const{pl:e,side:o,price:r}=this._data;if(null===e)return null;if(this._infoGetters.displayMode.value()===i.PlDisplay.Money)return e;const{trade:s,ask:a,bid:n}=this._symbolDataProvider.lastData()||{},d=null!==(t=this._data.plBasedOnLast?s:this.isBuyDirection()?n:a)&&void 0!==t?t:r;return(0,l.isNumber)(d)?(d-r)*o:null}async _doActionWithBlock(t,e,o={},i={},s,a){if(void 0===this._data.callbacks[t])return!1;e&&this._source.setIsBlocked(!0),this._trackEventGA(o);let l=!1;try{l="modifyPosition"===t?await(0,r.ensureDefined)(this._data.callbacks.modifyPosition)(this._data.id,i,s,a):await(0,r.ensureDefined)(this._data.callbacks[t])(this._data.id)}catch(e){C.logWarn(`Try to ${t}, but got error: ${(0,
n.errorToString)(e)}`)}finally{e&&(this._source.setIsBlocked(!1),this._source.syncData())}return l}}},980465:(t,e,o)=>{"use strict";o.d(e,{getDefaultStyleForPositionItem:()=>_});var r=o(813108),i=o(926048),s=o(316167),a=o(52102);const l={pointShadowColor:a.buyPointShadow,lineColor:i.colorsPalette["color-tv-blue-500"],borderBackgroundColor:i.colorsPalette["color-cold-gray-900"],borderColor:i.colorsPalette["color-tv-blue-500"],pointBackgroundColor:i.colorsPalette["color-cold-gray-900"],disabledLineColor:i.colorsPalette["color-tv-blue-a700"],positivePlColor:i.colorsPalette["color-minty-green-500"],negativePlColor:i.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:i.colorsPalette["color-tv-blue-500"],textColor:i.colorsPalette["color-white"],dividerColor:i.colorsPalette["color-tv-blue-500"],activeColor:i.colorsPalette["color-tv-blue-600"]},text:{backgroundColor:i.colorsPalette["color-cold-gray-900"],textColor:i.colorsPalette["color-cold-gray-600"],dividerColor:i.colorsPalette["color-tv-blue-a800"]},close:{backgroundColor:i.colorsPalette["color-cold-gray-900"],iconColor:i.colorsPalette["color-tv-blue-500"],activeColor:a.buyActive},reverse:{backgroundColor:i.colorsPalette["color-cold-gray-900"],borderColor:i.colorsPalette["color-tv-blue-500"],iconColor:i.colorsPalette["color-tv-blue-500"],activeColor:a.buyActive},confirm:{disableBackgroundColor:i.colorsPalette["color-cold-gray-750"],backgroundColor:i.colorsPalette["color-tv-blue-500"],borderColor:i.colorsPalette["color-tv-blue-500"],textColor:i.colorsPalette["color-white"],disableTextColor:i.colorsPalette["color-cold-gray-600"],activeColor:i.colorsPalette["color-tv-blue-600"]},informer:{backgroundColor:a.errorNotificationBackdrop,iconColor:i.colorsPalette["color-ripe-red-500"]}},n={pointShadowColor:a.sellPointShadow,lineColor:i.colorsPalette["color-ripe-red-500"],borderBackgroundColor:i.colorsPalette["color-cold-gray-900"],borderColor:i.colorsPalette["color-ripe-red-500"],pointBackgroundColor:i.colorsPalette["color-cold-gray-900"],disabledLineColor:i.colorsPalette["color-ripe-red-a800"],positivePlColor:i.colorsPalette["color-minty-green-500"],negativePlColor:i.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:i.colorsPalette["color-ripe-red-500"],textColor:i.colorsPalette["color-white"],dividerColor:i.colorsPalette["color-ripe-red-500"],activeColor:i.colorsPalette["color-ripe-red-600"]},text:{backgroundColor:i.colorsPalette["color-cold-gray-900"],textColor:i.colorsPalette["color-cold-gray-600"],dividerColor:i.colorsPalette["color-ripe-red-a800"]},close:{backgroundColor:i.colorsPalette["color-cold-gray-900"],iconColor:i.colorsPalette["color-ripe-red-500"],activeColor:a.sellActive},reverse:{backgroundColor:i.colorsPalette["color-cold-gray-900"],borderColor:i.colorsPalette["color-ripe-red-500"],iconColor:i.colorsPalette["color-ripe-red-500"],activeColor:a.sellActive},confirm:{disableBackgroundColor:i.colorsPalette["color-cold-gray-750"],backgroundColor:i.colorsPalette["color-ripe-red-500"],borderColor:i.colorsPalette["color-ripe-red-500"],
textColor:i.colorsPalette["color-white"],disableTextColor:i.colorsPalette["color-cold-gray-600"],activeColor:i.colorsPalette["color-ripe-red-600"]},informer:{backgroundColor:a.errorNotificationBackdrop,iconColor:i.colorsPalette["color-ripe-red-500"]}},d={buy:{normal:l,disabled:(0,s.generateBlendColors)(l,a.overlay)},sell:{normal:n,disabled:(0,s.generateBlendColors)(n,a.overlay)}};var c=o(328969);const h={pointShadowColor:c.buyPointShadow,lineColor:i.colorsPalette["color-tv-blue-500"],borderBackgroundColor:i.colorsPalette["color-white"],borderColor:i.colorsPalette["color-tv-blue-500"],pointBackgroundColor:i.colorsPalette["color-white"],disabledLineColor:i.colorsPalette["color-tv-blue-100"],positivePlColor:i.colorsPalette["color-minty-green-500"],negativePlColor:i.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:i.colorsPalette["color-tv-blue-500"],textColor:i.colorsPalette["color-white"],dividerColor:i.colorsPalette["color-tv-blue-500"],activeColor:i.colorsPalette["color-tv-blue-600"]},text:{backgroundColor:i.colorsPalette["color-white"],textColor:i.colorsPalette["color-cold-gray-300"],dividerColor:i.colorsPalette["color-tv-blue-50"]},close:{backgroundColor:i.colorsPalette["color-white"],iconColor:i.colorsPalette["color-tv-blue-500"],activeColor:a.buyActive},reverse:{backgroundColor:i.colorsPalette["color-white"],borderColor:i.colorsPalette["color-tv-blue-500"],iconColor:i.colorsPalette["color-tv-blue-500"],activeColor:a.buyActive},confirm:{disableBackgroundColor:i.colorsPalette["color-cold-gray-150"],backgroundColor:i.colorsPalette["color-tv-blue-500"],borderColor:i.colorsPalette["color-tv-blue-500"],textColor:i.colorsPalette["color-white"],disableTextColor:i.colorsPalette["color-cold-gray-300"],activeColor:i.colorsPalette["color-tv-blue-600"]},informer:{backgroundColor:a.errorNotificationBackdrop,iconColor:i.colorsPalette["color-ripe-red-500"]}},u={pointShadowColor:c.sellPointShadow,lineColor:i.colorsPalette["color-ripe-red-500"],borderBackgroundColor:i.colorsPalette["color-white"],borderColor:i.colorsPalette["color-ripe-red-500"],pointBackgroundColor:i.colorsPalette["color-white"],disabledLineColor:i.colorsPalette["color-ripe-red-100"],positivePlColor:i.colorsPalette["color-minty-green-500"],negativePlColor:i.colorsPalette["color-ripe-red-500"],qty:{backgroundColor:i.colorsPalette["color-ripe-red-500"],textColor:i.colorsPalette["color-white"],dividerColor:i.colorsPalette["color-ripe-red-500"],activeColor:i.colorsPalette["color-ripe-red-600"]},text:{backgroundColor:i.colorsPalette["color-white"],textColor:i.colorsPalette["color-cold-gray-300"],dividerColor:i.colorsPalette["color-ripe-red-50"]},close:{backgroundColor:i.colorsPalette["color-white"],iconColor:i.colorsPalette["color-ripe-red-500"],activeColor:a.sellActive},reverse:{backgroundColor:i.colorsPalette["color-white"],borderColor:i.colorsPalette["color-ripe-red-500"],iconColor:i.colorsPalette["color-ripe-red-500"],activeColor:a.sellActive},confirm:{disableBackgroundColor:i.colorsPalette["color-cold-gray-150"],
backgroundColor:i.colorsPalette["color-ripe-red-500"],borderColor:i.colorsPalette["color-ripe-red-500"],textColor:i.colorsPalette["color-white"],disableTextColor:i.colorsPalette["color-cold-gray-300"],activeColor:i.colorsPalette["color-ripe-red-600"]},informer:{backgroundColor:a.errorNotificationBackdrop,iconColor:i.colorsPalette["color-ripe-red-500"]}},p={buy:{normal:h,disabled:(0,s.generateBlendColors)(h,c.overlay)},sell:{normal:u,disabled:(0,s.generateBlendColors)(u,c.overlay)}};function _(t,e,o,i=r.LineStyle.Solid){const s=o()?d:p,a=t?s.buy:s.sell;return{...e?a.disabled:a.normal,lineStyle:i,borderStyle:i,labelBorderVisible:!1}}},842471:(t,e,o)=>{"use strict";o.d(e,{PreOrderItem:()=>n});var r=o(609838),i=o(813108),s=o(621575),a=o(99834);const l=r.t(null,void 0,o(302873));class n extends a.OrderWithMenuItem{constructor(){super(...arguments),this._supportedOrderTypes=[]}qtyText(){return super._quantityText(this._data.qty)}style(){return this._infoGetters.style(this)}setSupportOrderType(t){this._supportedOrderTypes=t}canSwitchType(){return this._supportedOrderTypes.length>1}orderTypesItems(){return this._supportedOrderTypes.map((t=>({type:t,typeText:(0,s.orderTypeToText)({orderType:t})})))}isWorking(){return!0}profitLossText(t){return(0,s.orderTypeToText)({orderType:this.data().type,uppercase:t,shorten:t})}profitLossTooltip(){return l}lineStyle(){return i.LineStyle.Solid}supportClose(){return!0}supportModify(){return this._data.supportModify}async onClose(t){var e,o;null===(o=(e=this._source).onClose)||void 0===o||o.call(e,t)}async onModify(t){var e,o;return this._source.isPlaced()||(t.event="Edit project order"),null===(o=(e=this._source).onModify)||void 0===o||o.call(e,t),!0}supportBrackets(){return!this._isBracket()&&this._symbolDataProvider.supportOrderBrackets()}_calcId(){return"preOrder"}}},28518:(t,e,o)=>{"use strict";o.d(e,{ProjectionBracketItem:()=>g});var r=o(650151),i=o(150335),s=o(86441),a=o(609838),l=o(41899),n=o(813108),d=o(983706),c=o(599016),h=o(46415),u=o(99834);const p=a.t(null,{context:"Stop loss"},o(867008)),_=a.t(null,{context:"Guaranteed stop"},o(389026)),y=a.t(null,{context:"Trailing stop"},o(335363)),f=a.t(null,{context:"Take profit"},o(607660)),b=a.t(null,void 0,o(734474)),m=a.t(null,void 0,o(221718)),v=a.t(null,void 0,o(424234)),C=a.t(null,void 0,o(154908));class g extends u.OrderWithMenuItem{style(){return this._infoGetters.style(this)}setPrice(t){const{minTick:e}=(0,r.ensureNotNull)(this._symbolDataProvider.symbolData());null!==t&&(t=(0,i.fixComputationError)(e*Math.round(t/e))),this.setData({...(0,l.clone)(this.data()),price:t})}data(){return super.data()}qtyText(){return this._bracketTypeText(!0)}tooltip(){switch(this.bracketType()){case c.BracketType.TakeProfit:return b;case c.BracketType.StopLoss:return m;case c.BracketType.GuaranteedStop:return v;case c.BracketType.TrailingStop:return C;default:throw new Error("Unknown bracket type")}}isWorking(){return!0}supportClose(){return!1}supportModify(){return!0}profitLossText(t){var e
;return!(null===(e=this._source.isBracketsPLVisible())||void 0===e?void 0:e.value())||this.bracketType()===c.BracketType.TrailingStop||!this._source.supportRiskControlsAndInfo()&&this._infoGetters.displayMode.value()===d.PlDisplay.Money?"":super.profitLossText(t)}isMinifyMode(){return null===this.price()}bracketType(){return this.data().bracketType}async onMove(t){const e=new s.Point(t.localX,t.localY),o=this._mainSeries.priceScale(),i=this._mainSeries.firstValue();if(null===i)return;const a=o.coordinateToPrice(e.y,i);this.setPrice(a),t.isTouch&&(0,r.ensureDefined)(this._itemCommands.exitTrackingMode)()}lineStyle(){return n.LineStyle.Solid}_isBracket(){return!0}_calcId(){return this._data.id}_bracketTypeText(t){return this._data?this.bracketType()===c.BracketType.TakeProfit?f:this._source.bracketStopType()===h.StopType.TrailingStop?y:this._source.bracketStopType()===h.StopType.GuaranteedStop?_:p:""}}},631488:(t,e,o)=>{"use strict";o.d(e,{calcPipsByPrice:()=>i,calcPriceByPips:()=>s});var r=o(960521);function i(t,e,o,i){return(0,r.Big)(t).minus(e).div(i).mul(1===o?1:-1).toNumber()}function s(t,e,o,i){return(0,r.Big)(1===o?1:-1).mul(t).mul(i).plus(e).toNumber()}},168873:(t,e,o)=>{"use strict";o.d(e,{mergeGaParams:()=>l});var r,i,s,a=o(650151);function l(t,e){(0,a.assert)(!(t.origin&&e.origin&&t.origin!==e.origin||t.event&&e.event&&t.event!==e.event),"origin and event should be only in one params object");const o={...t,...e};return t.label&&e.label&&(o.label=`${t.label} ${e.label}`),o}!function(t){t.PlaceOrderDefault="Chart Place Order",t.OrderDefault="Chart Order",t.OrderContextMenu="Chart Order Context Menu",t.ProjectOrderContextMenu="Chart Project Order Context Menu",t.PositionDefault="Chart Position",t.PositionContextMenu="Chart Position Context Menu"}(r||(r={})),function(t){t.MoveOrder="Move Order",t.ModifyOrder="Modify order",t.AddBracket="Add bracket from button",t.StopTypeMenuOpen="Stop loss type menu opening",t.OrderTypeMenuOpen="Order type menu opening",t.ChangeOrderType="Change order type",t.ChangeQty="Change quantity",t.CancelOrder="Cancel order"}(i||(i={})),function(t){t.Single="single",t.Group="group",t.TakeProfit="take profit",t.StopLoss="stop loss",t.TrailingStop="trailing stop",t.GuaranteedStop="guaranteed stop",t.BothBracket="both bracket"}(s||(s={}))},112232:(t,e,o)=>{"use strict";o.d(e,{bracketsByType:()=>m,buildProjectionBracketData:()=>v,getBracketType:()=>f,getBracketTypeToText:()=>b});var r=o(609838),i=o(391431),s=o(599016),a=o(46415),l=o(482303);const n=r.t(null,void 0,o(992201)),d=r.t(null,void 0,o(719702)),c=r.t(null,void 0,o(337539)),h=r.t(null,void 0,o(255739)),u=r.t(null,{context:"Trailing stop"},o(335363)),p=r.t(null,{context:"Stop loss"},o(867008)),_=r.t(null,{context:"Guaranteed stop"},o(389026)),y=r.t(null,{context:"Take profit"},o(607660));function f(t){return 3===t.type?void 0!==t.stopType?(0,i.getBracketTypeByStopType)(t.stopType):s.BracketType.StopLoss:1===t.type?s.BracketType.TakeProfit:null}function b(t,e,o){return 3===t?function(t,e){
return t===a.StopType.TrailingStop?e?u:n:t===a.StopType.GuaranteedStop?e?_:c:e?p:d}(e,o):1===t?o?y:h:null}function m(t){let e,o,r,i;return t.forEach((t=>{switch((0,l.isOrderLikeItem)(t)?t.bracketType():f(t)){case s.BracketType.TakeProfit:e=t;break;case s.BracketType.TrailingStop:i=t;break;case s.BracketType.StopLoss:o=t;break;case s.BracketType.GuaranteedStop:r=t}})),{takeProfit:e,trailingStop:i,stopLoss:o,guaranteedStop:r}}function v(t,e,o){const r=(0,i.getStopTypeByBracketType)(e),a=e===s.BracketType.TakeProfit?1:3,l=-1===o.side?1:-1;let n;switch(e){case s.BracketType.TakeProfit:n=`${t}TakeProfit`;break;case s.BracketType.StopLoss:n=`${t}StopLoss`;break;case s.BracketType.GuaranteedStop:n=`${t}GuaranteedStop`;break;case s.BracketType.TrailingStop:n=`${t}TrailingStop`}return{dataType:"Order",id:n,price:null,type:a,stopType:r,side:l,bracketType:e,qty:o.qty,status:6,symbol:o.symbol,plBasedOnLast:"plBasedOnLast"in o&&o.plBasedOnLast,considerFilledQty:!1,supportModify:!1,supportModifyOrderPrice:!1,supportMove:!0,supportCancel:!1,supportTrailingStop:!1,supportGuaranteedStop:!1,callbacks:{},trailingStopPips:o.trailingStopPips}}},586137:(t,e,o)=>{"use strict";o.d(e,{createContextMenuTitle:()=>c,createNoOverlapMenuAction:()=>n,showContextMenu:()=>d});var r=o(609838),i=o(540873),s=o(529596),a=o(168873);const l=r.t(null,void 0,o(825586));function n(t,e,o){const r=(0,a.mergeGaParams)(e,{event:"No overlap orders and positions"});return new i.Action({actionId:"Trading.NoOverlapMode",options:{label:l,onExecute:()=>{o(r),t.setNoOverlapMode(!0)},disabled:!t.isItemsOverlap()}})}async function d(t,e,o,r){return s.ContextMenuManager.createMenu(t,{},{...r,menuName:"TradingOrderContextMenu"},o).then((t=>(t.show(e),t)))}async function c(t,e){return null}},333433:(t,e,o)=>{"use strict";o.d(e,{closeDropdownMenu:()=>v,updateDropdownMenu:()=>C});var r=o(50959),i=o(632227),s=o(86441),a=o(650151),l=o(930202),n=o(914090),d=o(734602),c=o(930052),h=o(759339),u=o(163694),p=o(924910),_=o(192063),y=o(722426);const f=new WeakMap;function b(t){const{position:e,activeItemIndex:o,title:i,onClose:s,onDestroy:a,onSelect:b,customCloseSubscriptions:m=[]}=t,[v,C]=(0,r.useState)(o);(0,d.useGlobalCloseOnScrollAndCustomEvents)(m);const g=t.items.map(((e,o)=>(f.has(e)||f.set(e,(0,p.randomHash)()),r.createElement(_.PopupMenuItem,{key:f.get(e),onClick:()=>function(e){C(e),b(t.items[e].value),a()}(o),label:e.title,isActive:o===v}))));return r.createElement(u.DrawerManager,null,r.createElement(c.MatchMedia,{rule:"screen and (max-width: 430px)"},(t=>t?r.createElement(h.Drawer,{onClose:s,position:"Bottom"},r.createElement(y.ToolWidgetMenuSummary,null,i),g):r.createElement(n.TooltipPopup,{position:e,onClose:s,onClickOutside:P,onForceClose:a,onKeyDown:k},g))));function P(t){s(t)}function k(e){switch((0,l.hashFromEvent)(e)){case 40:e.preventDefault(),e.stopPropagation(),function(){const e=v+1>t.items.length-1?0:v+1;C(e)}();break;case 38:e.preventDefault(),e.stopPropagation(),function(){const e=v-1<0?t.items.length-1:v-1;C(e)}();break;case 13:e.preventDefault(),
e.stopPropagation(),b(t.items[v].value),a()}}}const m=document.createElement("div");function v(){i.unmountComponentAtNode((0,a.ensureNotNull)(m))}function C(t,e,o,l,n,d,c,h,u){if(!t)return;const p={items:o,activeItemIndex:l,title:n,onClose:function(t){if(t){const e=t.target.getBoundingClientRect()||{left:0,top:0};h(new s.Point(t.clientX-e.left,t.clientY-e.top))}i.unmountComponentAtNode((0,a.ensureNotNull)(m))},onDestroy:function(){u(),i.unmountComponentAtNode((0,a.ensureNotNull)(m))},onSelect:c,customCloseSubscriptions:d,position:e};i.render(r.createElement(b,{...p}),m)}},805033:(t,e,o)=>{"use strict";o.d(e,{drawArrow:()=>n,drawErrorNotificationBackdrop:()=>_,drawExclamationIcon:()=>f,drawHalfArrow:()=>c,drawOutlinedArrowHead:()=>d,drawOutlinedText:()=>p,drawText:()=>h,drawUnderlinedText:()=>u});var r,i,s=o(813108),a=o(898646),l=o(652283);function n(t,e,o,r,i,s,a,l,n){t.save();const d=t.lineWidth,c=t.lineWidth%2?.5:0;t.translate(e+c,o+c),s&&t.scale(1,-1);const h=Math.round(l/2),u=h,p=h;n&&(t.strokeStyle=i,t.lineWidth=2*t.lineWidth,t.lineCap="square",t.beginPath(),t.moveTo(0,h),t.lineTo(u,0),t.lineTo(l,h),t.stroke(),t.lineCap="butt",t.beginPath(),t.moveTo(p,a+(t.lineWidth-d)/2),t.lineTo(u,0),t.stroke()),t.lineWidth=d,t.strokeStyle=r,t.lineCap="square",t.beginPath(),t.moveTo(0,h),t.lineTo(u,0),t.lineTo(l,h),t.stroke(),t.lineCap="butt",t.beginPath(),t.moveTo(p,a),t.lineTo(u,0),t.stroke(),t.restore()}function d(t,e,o,r,i,s,a,l=90){t.save();const n=t.lineWidth,d=2*t.lineWidth,c=t.lineWidth%2?.5:0;t.translate(e+c+a/2-n,o+c),t.rotate(l*Math.PI/180);const h=Math.round(a/2);t.lineCap="square",t.lineWidth=d,t.strokeStyle=i,t.beginPath(),t.moveTo(0,h),t.lineTo(h,0),t.lineTo(a,h),t.stroke(),t.lineCap="square",t.lineWidth=n,t.strokeStyle=r,t.beginPath(),t.moveTo(0,h),t.lineTo(h,0),t.lineTo(a,h),t.stroke(),t.restore()}function c(t,e,o,r,i,s,a){t.save(),t.strokeStyle=r,t.lineJoin="miter";const l=t.lineWidth%2?.5:0,n=Math.round(s/3);t.translate(e+l,o+l),i&&t.scale(-1,-1),t.beginPath(),t.moveTo(0,s),t.lineTo(0,0),t.lineTo(-a,n),t.stroke(),t.restore()}function h(t,e,o,r,i,s,a,n,d="center"){t.save(),t.textAlign=d,t.textBaseline="middle",t.fillStyle=a,t.font=n,t.translate(r,i+s),(0,l.drawScaled)(t,e.horizontalPixelRatio,e.verticalPixelRatio,(()=>{t.fillText(o,0,0)})),t.restore()}function u(t,e,o,r,i,n,d,c,h){t.save(),t.textAlign="center",t.textBaseline="middle",t.fillStyle=d,t.font=c;const u=1,p=1,{horizontalPixelRatio:_,verticalPixelRatio:y}=(s.LineStyle.Dashed,e),f=Math.round(10*y)/2,b=Math.max(1,Math.floor(p*_)),m=h*_,v=Math.max(1,Math.floor(u*y)),C=Math.round(r-m/2),g=Math.round(i+f+v);t.strokeStyle=d,t.lineWidth=b;const P=Math.round(3*t.lineWidth),k=Math.round(3*t.lineWidth/2),T=Math.round(2*t.lineWidth);let x=Math.trunc(m/(P+T));const w=Math.trunc(m%(P+T)/2),M=[];for(M.push(k+w);x>1;)M.push(T,P),x--;M.push(T,k+w),t.setLineDash(M),(0,a.drawHorizontalLine)(t,g,C,C+Math.round(m)),t.translate(r,i+n),(0,l.drawScaled)(t,_,y,(()=>{t.fillText(o,0,0)})),t.restore()}function p(t,e,o,r,i,s,a,n,d){t.save(),t.textAlign="center",
t.textBaseline="middle",t.fillStyle=a,t.font=n,t.lineJoin="round",t.translate(r,i+s),(0,l.drawScaled)(t,e.horizontalPixelRatio,e.verticalPixelRatio,(()=>{t.strokeStyle=d,t.strokeText(o,0,0),t.fillText(o,0,0)})),t.restore()}function _(t){const{ctx:e,x:o,y:r,w:i,h:s,horizontalPixelRatio:a,verticalPixelRatio:l}=t;e.fillStyle="rgba(242, 54, 69, 0.1)",e.fillRect(o,r-s*l/2,i*a,s*l)}!function(t){t.TextAlign="center",t.TextBaseline="middle",t.FontWeight="normal",t[t.DashWidth=3]="DashWidth",t[t.SpaceWidth=2]="SpaceWidth"}(r||(r={})),function(t){t[t.Up=0]="Up",t[t.Right=90]="Right",t[t.Down=180]="Down",t[t.Left=-90]="Left"}(i||(i={}));const y=new Path2D("M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16ZM9 4c-.79 0-1.38.7-1.25 1.48l.67 4.03a.59.59 0 0 0 1.16 0l.67-4.03A1.27 1.27 0 0 0 9 4Zm0 8a1 1 0 1 0 0 2 1 1 0 0 0 0-2Z");function f(t){const{ctx:e,x:o,y:r,horizontalPixelRatio:i,verticalPixelRatio:s}=t;e.save(),e.translate(o,r),(0,l.drawScaled)(e,i,s,(()=>{e.fillStyle="white",e.beginPath(),e.arc(9,9,7,0,2*Math.PI,!0),e.fill(),e.fillStyle="rgba(242, 54, 69, 1)",e.fill(y,"evenodd")})),e.restore()}},619624:(t,e,o)=>{"use strict";o.d(e,{generateOrderColorTheme:()=>i});var r=o(316167);function i(t){const{text:e,buySecondary:o,buyDisabled:i,buyPrimary:s,confirmActiveBuy:a,textDisabled:l,backgroundDisabled:n,background:d,takeProfitPrimary:c,sellSecondary:h,sellDisabled:u,sellPrimary:p,confirmActiveSell:_,stopLossPrimary:y,takeProfitSecondary:f,stopLossSecondary:b,buyActive:m,sellActive:v,takeProfitActive:C,stopLossActive:g,buyPointShadow:P,sellPointShadow:k,takeProfitPointShadow:T,stopLossPointShadow:x,overlay:w,errorNotificationBackdrop:M}=t,S={pointShadowColor:P,labelTickColor:s,lineColor:s,borderBackgroundColor:d,borderColor:s,pointBackgroundColor:d,disabledLineColor:i,positivePlColor:c,negativePlColor:p,qty:{backgroundColor:d,textColor:s,dividerColor:o,activeColor:m},text:{backgroundColor:d,textColor:s,dividerColor:o,buttonTextColor:s},close:{backgroundColor:d,iconColor:s,activeColor:m},confirm:{disableBackgroundColor:n,backgroundColor:s,borderColor:s,textColor:e,disableTextColor:l,activeColor:a},informer:{backgroundColor:M,iconColor:p},anchor:{backgroundColor:d,borderColor:s,shadowColor:P}},B={pointShadowColor:k,labelTickColor:p,lineColor:p,borderBackgroundColor:d,borderColor:p,pointBackgroundColor:d,disabledLineColor:u,positivePlColor:c,negativePlColor:p,qty:{backgroundColor:d,textColor:p,dividerColor:h,activeColor:v},text:{backgroundColor:d,textColor:p,dividerColor:h,buttonTextColor:p},close:{backgroundColor:d,iconColor:p,activeColor:v},confirm:{disableBackgroundColor:n,backgroundColor:p,borderColor:p,textColor:e,disableTextColor:l,activeColor:_},informer:{backgroundColor:M,iconColor:p},anchor:{backgroundColor:d,borderColor:s,shadowColor:P}},D={pointShadowColor:T,labelTickColor:c,lineColor:c,borderBackgroundColor:d,borderColor:c,pointBackgroundColor:d,positivePlColor:c,negativePlColor:p,qty:{backgroundColor:d,textColor:c,dividerColor:f,activeColor:C},text:{backgroundColor:d,textColor:c,dividerColor:f,buttonTextColor:c},close:{
backgroundColor:d,iconColor:c,activeColor:C},informer:{backgroundColor:M,iconColor:p},anchor:{backgroundColor:d,borderColor:s,shadowColor:P}},I={pointShadowColor:x,labelTickColor:y,lineColor:y,borderBackgroundColor:d,borderColor:y,pointBackgroundColor:d,positivePlColor:c,negativePlColor:p,qty:{backgroundColor:d,textColor:y,dividerColor:b,activeColor:g},text:{backgroundColor:d,textColor:y,dividerColor:b,buttonTextColor:y},close:{backgroundColor:d,iconColor:y,activeColor:g},informer:{backgroundColor:M,iconColor:p},anchor:{backgroundColor:d,borderColor:s,shadowColor:P}};return{buy:{normal:S,disabled:(0,r.generateBlendColors)(S,w)},sell:{normal:B,disabled:(0,r.generateBlendColors)(B,w)},takeProfit:{normal:D,disabled:(0,r.generateBlendColors)(D,w)},stopLoss:{normal:I,disabled:(0,r.generateBlendColors)(I,w)}}}},90470:(t,e,o)=>{"use strict";o.d(e,{isTradingObjVisibleOnScreenshot:()=>i});var r=o(440891);function i(){return r.enabled("snapshot_trading_drawings")}}}]);