(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[8751],{628705:e=>{e.exports={dialog:"dialog-YZ_qHmON",dialogBody:"dialogBody-YZ_qHmON"}},993898:e=>{e.exports={positionInfo:"positionInfo-oWbWR7tt",title:"title-oWbWR7tt"}},114827:e=>{e.exports={positionPanel:"positionPanel-vffbLvO_"}},860393:e=>{e.exports={positionWidget:"positionWidget-mbUCea4m",separator:"separator-mbUCea4m",brackets:"brackets-mbUCea4m",customFieldsWrapper:"customFieldsWrapper-mbUCea4m",infoWrapper:"infoWrapper-mbUCea4m",warning:"warning-mbUCea4m",button:"button-mbUCea4m"}},562152:(e,o,t)=>{"use strict";t.r(o),t.d(o,{closePositionDialog:()=>T,mountPositionPanel:()=>U,showPositionDialog:()=>R,showPositionDrawer:()=>A,unmountPositionPanel:()=>_});var n=t(50959),l=t(632227),s=t(930894),a=t(533408),i=t(601227),r=t(180185),d=t(918460),c=t(937778),u=t(650151),m=t(97518),p=t(788865),f=t(570446),b=t(363111),C=t(661851),E=t(564245),v=t(993898);function g(e){const{model:o}=e,t=(0,C.useObservable)(o.infoTableData$,{rows:[]});return n.createElement("div",{className:v.positionInfo},n.createElement("div",{className:v.title},o.title()),n.createElement(E.InfoTable,{rows:t.rows,header:t.header,disabled:!1}))}var h=t(556013),w=t(763281),O=t(860393);const P=(0,c.getLogger)("Trading.OrderPanel");function D(e){const{model:o,focus:t,shouldShowActionButton:l}=e,s=(0,n.useRef)(null),a=(0,C.useObservable)(o.warning$),{mode:c}=(0,n.useContext)(w.WidgetContext);(0,n.useEffect)((()=>{null!==s.current&&void 0===t&&s.current.focus()}),[]);const E=(0,n.useCallback)((e=>{const t=(0,r.hashFromEvent)(e);13!==t&&t!==r.hashShiftPlusEnter||o.isButtonDisabled()||(i.CheckMobile.any()?document.activeElement instanceof HTMLElement?document.activeElement.blur():P.logWarn("Failed to deselect: active element is not HTMLElement"):o.doneButtonClick())}),[o]),v=o.customFieldsModel.getCustomFieldsModels(),D=function(e,o){return o===b.OrderEditorDisplayMode.Panel&&null!==e.positionInfoModel&&e.positionInfoModel.getOrderInfoTableRowsCount()>0}(o,c);return n.createElement("div",{className:O.positionWidget,onKeyDown:E,tabIndex:-1,ref:s},(c===b.OrderEditorDisplayMode.Popup||c===b.OrderEditorDisplayMode.ResizableDrawer)&&n.createElement(m.HeaderContainer,{...o.headerStateValue}),n.createElement("div",{className:O.brackets},n.createElement(p.BracketControlGroup,{model:o,focus:t})),v.length>0&&n.createElement("div",{className:O.customFieldsWrapper},n.createElement("div",{className:O.separator}),n.createElement(h.OrderPanelCustomFields,{customFieldModels:v})),a&&n.createElement(d.Informer,{className:O.warning,content:a,informerIntent:"default"}),void 0!==o.buttonModel&&l&&n.createElement("div",{className:O.button},n.createElement(f.PlaceAndModifyButton,{model:o,buttonModel:o.buttonModel})),D&&n.createElement("div",{className:O.infoWrapper},n.createElement("div",{className:O.separator}),n.createElement(g,{"data-name":"position-info",model:(0,u.ensureNotNull)(o.positionInfoModel)})))}var k=t(274837),M=t(628705);const y=n.memo((e=>{const{model:o,isOpened:t,focus:l,onOpen:i,onClose:r}=e
;return(0,k.useCommonDialogHandlers)({isOpened:t,onOpen:i,onClose:r}),n.createElement(a.AdaptivePopupDialog,{className:M.dialog,isOpened:t,dataName:"position-dialog-popup",render:function(){return n.createElement(s.Body,{className:M.dialogBody},n.createElement(D,{key:o.id,model:o,focus:l,shouldShowActionButton:!0}))},onClose:()=>null==r?void 0:r()})}));var N=t(910549),B=t(977540),$=t(110686);const W=n.memo((e=>{const{model:o,isOpened:t,focus:l,onOpen:s,onClose:a}=e;return(0,k.useCommonDialogHandlers)({isOpened:t,onOpen:s,onClose:a}),n.createElement(B.ResizableDrawer,{controlsContent:n.createElement($.OrderDrawerControlContent,{buttonModel:o.buttonModel,onClose:a,side:()=>o.side(),isButtonDisabled$:o.isButtonDisabled$,isButtonDisabled:()=>o.isButtonDisabled(),loading$:o.loading$,doneButtonClick:()=>o.doneButtonClick()}),disableSwipe:!1,disablePan:!1,initialContentHeight:B.ResizableDrawerContentHeight.Full},n.createElement(N.PopupContext.Consumer,null,(()=>n.createElement(D,{model:o,key:o.id,focus:l,shouldShowActionButton:!1}))))}));var I=t(114827);class F extends n.PureComponent{constructor(e){super(e),this._onKeyDown=e=>{27===e.keyCode&&this.props.onCancel&&this.props.onCancel()}}render(){return n.createElement("div",{"data-name":"position-panel",className:I.positionPanel,onKeyDown:this._onKeyDown},n.createElement(D,{model:this.props.model,focus:this.props.focus,key:this.props.model.id,shouldShowActionButton:!0}))}}var S=t(651674);let x=null,H=null;function R(e){const{viewModel:o,settings$:t,mode:l,focus:s,onClose:a,onOpen:i}=e,r=n.createElement(w.OrderTicketProvider,{settings$:t,mode:l,orderPanelStatus$:o.status$},n.createElement(y,{model:o,isOpened:!0,focus:s,onOpen:i,onClose:()=>T(a)}));H?H.render(r):(x=document.createElement("div"),document.body.appendChild(x),H=(0,S.createReactRoot)(r,x))}function T(e){x&&(null==H||H.unmount(),H=null,document.body.removeChild(x),x=null,null==e||e())}function A(e){const{viewModel:o,settings$:t,mode:s,focus:a,onClose:i,onOpen:r}=e;null===x&&(x=document.createElement("div")),document.body.appendChild(x),l.render(n.createElement(w.OrderTicketProvider,{settings$:t,mode:s,orderPanelStatus$:o.status$},n.createElement(W,{model:o,isOpened:!0,focus:a,onOpen:r,onClose:()=>T(i)})),x)}function U(e,o,t,s,a){l.render(n.createElement(w.OrderTicketProvider,{settings$:o,mode:t,orderPanelStatus$:e.status$},n.createElement(F,{model:e,focus:a,onCancel:()=>{var o;return null===(o=e.headerModel)||void 0===o?void 0:o.back()}})),s)}function _(e){l.unmountComponentAtNode(e)}}}]);