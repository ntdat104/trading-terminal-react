(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[2306,3177],{266783:e=>{"use strict";var t=Object.prototype.hasOwnProperty;function o(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}e.exports=function(e,i){if(o(e,i))return!0;if("object"!=typeof e||null===e||"object"!=typeof i||null===i)return!1;var n=Object.keys(e),r=Object.keys(i);if(n.length!==r.length)return!1;for(var s=0;s<n.length;s++)if(!t.call(i,n[s])||!o(e[n[s]],i[n[s]]))return!1;return!0}},849844:e=>{e.exports={loader:"loader-UL6iwcBa",static:"static-UL6iwcBa",item:"item-UL6iwcBa","tv-button-loader":"tv-button-loader-UL6iwcBa",medium:"medium-UL6iwcBa",small:"small-UL6iwcBa",black:"black-UL6iwcBa",white:"white-UL6iwcBa",gray:"gray-UL6iwcBa",primary:"primary-UL6iwcBa"}},451179:e=>{e.exports={}},842329:e=>{e.exports={}},429399:e=>{e.exports={}},262133:e=>{e.exports={wrap:"wrap-Nn3SCuEL",icon:"icon-Nn3SCuEL",colorBg:"colorBg-Nn3SCuEL",color:"color-Nn3SCuEL",multicolor:"multicolor-Nn3SCuEL",white:"white-Nn3SCuEL"}},631527:e=>{e.exports={button:"button-BuUjli6L"}},766431:e=>{e.exports={item:"item-KdWj36gM",withIcon:"withIcon-KdWj36gM",icon:"icon-KdWj36gM",labelRow:"labelRow-KdWj36gM",multiWidth:"multiWidth-KdWj36gM",buttonWrap:"buttonWrap-KdWj36gM",buttonLabel:"buttonLabel-KdWj36gM"}},610765:e=>{e.exports={accessible:"accessible-rm8yeqY4"}},633832:e=>{e.exports={loaderWrap:"loaderWrap-jGEARQlM",big:"big-jGEARQlM",loader:"loader-jGEARQlM"}},603232:e=>{e.exports={item:"item-GJX1EXhk",interactive:"interactive-GJX1EXhk",hovered:"hovered-GJX1EXhk",disabled:"disabled-GJX1EXhk",active:"active-GJX1EXhk",shortcut:"shortcut-GJX1EXhk",normal:"normal-GJX1EXhk",big:"big-GJX1EXhk",iconCell:"iconCell-GJX1EXhk",icon:"icon-GJX1EXhk",checkmark:"checkmark-GJX1EXhk",content:"content-GJX1EXhk",label:"label-GJX1EXhk",checked:"checked-GJX1EXhk",toolbox:"toolbox-GJX1EXhk",showToolboxOnHover:"showToolboxOnHover-GJX1EXhk",arrowIcon:"arrowIcon-GJX1EXhk",subMenu:"subMenu-GJX1EXhk",invisibleHotkey:"invisibleHotkey-GJX1EXhk"}},674704:e=>{e.exports={row:"row-DFIg7eOh",line:"line-DFIg7eOh",hint:"hint-DFIg7eOh"}},742931:e=>{e.exports={menu:"menu-Tx5xMZww"}},236411:e=>{e.exports={item:"item-WJDah4zD",emptyIcons:"emptyIcons-WJDah4zD",loading:"loading-WJDah4zD",disabled:"disabled-WJDah4zD",interactive:"interactive-WJDah4zD",hovered:"hovered-WJDah4zD",normal:"normal-WJDah4zD",big:"big-WJDah4zD",icon:"icon-WJDah4zD",label:"label-WJDah4zD",title:"title-WJDah4zD",nested:"nested-WJDah4zD",shortcut:"shortcut-WJDah4zD",remove:"remove-WJDah4zD"}},598941:e=>{e.exports={separator:"separator-Ymxd0dt_"}},111772:e=>{e.exports={button:"button-iLKiGOdQ",hovered:"hovered-iLKiGOdQ",disabled:"disabled-iLKiGOdQ",active:"active-iLKiGOdQ",hidden:"hidden-iLKiGOdQ"}},15378:(e,t,o)=>{"use strict";var i,n,r,s;!function(e){e.Primary="primary",e.QuietPrimary="quiet-primary",e.Secondary="secondary",e.Ghost="ghost"}(i||(i={})),function(e){e.XXSmall="xxsmall",e.XSmall="xsmall",e.Small="small",e.Medium="medium",e.Large="large",e.XLarge="xlarge",e.XXLarge="xxlarge"}(n||(n={})),function(e){e.Brand="brand",
e.Gray="gray",e.LightGray="light-gray",e.Green="green",e.Red="red",e.Black="black",e.Gradient="gradient",e.BlackFriday="black-friday",e.CyberMonday="cyber-monday"}(r||(r={})),function(e){e.Semibold18px="semibold18px",e.Semibold16px="semibold16px",e.Semibold14px="semibold14px",e.Medium16px="medium16px",e.Regular16px="regular16px",e.Regular14px="regular14px"}(s||(s={}))},380327:(e,t,o)=>{"use strict";o.d(t,{ControlGroupContext:()=>i});const i=o(50959).createContext({isGrouped:!1,cellState:{isTop:!0,isRight:!0,isBottom:!0,isLeft:!0}})},234404:(e,t,o)=>{"use strict";o.d(t,{Loader:()=>l});var i,n=o(50959),r=o(497754),s=o(849844),a=o.n(s);function l(e){const{className:t,size:o="medium",staticPosition:i,color:s="black"}=e,l=r(a().item,a()[s],a()[o]);return n.createElement("span",{className:r(a().loader,i&&a().static,t)},n.createElement("span",{className:l}),n.createElement("span",{className:l}),n.createElement("span",{className:l}))}!function(e){e.Medium="medium",e.Small="small"}(i||(i={}))},65160:(e,t,o)=>{"use strict";function i(e){const{paddingTop:t,paddingBottom:o}=window.getComputedStyle(e);return[t,o].reduce(((e,t)=>e-Number((t||"").replace("px",""))),e.clientHeight)}function n(e,t=!1){const o=getComputedStyle(e),i=[o.height];return"border-box"!==o.boxSizing&&i.push(o.paddingTop,o.paddingBottom,o.borderTopWidth,o.borderBottomWidth),t&&i.push(o.marginTop,o.marginBottom),i.reduce(((e,t)=>e+(parseFloat(t)||0)),0)}function r(e,t=!1){const o=getComputedStyle(e),i=[o.width];return"border-box"!==o.boxSizing&&i.push(o.paddingLeft,o.paddingRight,o.borderLeftWidth,o.borderRightWidth),t&&i.push(o.marginLeft,o.marginRight),i.reduce(((e,t)=>e+(parseFloat(t)||0)),0)}o.d(t,{contentHeight:()=>i,outerHeight:()=>n,outerWidth:()=>r})},601198:(e,t,o)=>{"use strict";o.d(t,{getTextForTooltip:()=>s});var i=o(50959);const n=e=>(0,i.isValidElement)(e)&&Boolean(e.props.children),r=e=>null==e||"boolean"==typeof e||"{}"===JSON.stringify(e)?"":e.toString()+" ",s=e=>Array.isArray(e)||(0,i.isValidElement)(e)?i.Children.toArray(e).reduce(((e,t)=>{let o="";return o=(0,i.isValidElement)(t)&&n(t)?s(t.props.children):(0,i.isValidElement)(t)&&!n(t)?"":r(t),e.concat(o)}),"").trim():r(e)},496818:(e,t,o)=>{"use strict";o.d(t,{Draggable:()=>r,PointerBackend:()=>s});var i=o(650151),n=o(821205);o(429399);class r{constructor(e){var t,o;this._helper=null,this._handleDragStart=e=>{var t;if(null!==this._helper)return;const o=this._source;o.classList.add("ui-draggable-dragging");const[i,r]=[(0,n.outerWidth)(o),(0,n.outerHeight)(o)];this._helper={startTop:parseFloat(o.style.top)||0,startLeft:parseFloat(o.style.left)||0,nextTop:null,nextLeft:null,raf:null,size:[i,r],
containment:this._containment instanceof HTMLElement?[parseInt(getComputedStyle(this._containment).borderLeftWidth)+parseInt(getComputedStyle(this._containment).paddingLeft),parseInt(getComputedStyle(this._containment).borderTopWidth)+parseInt(getComputedStyle(this._containment).paddingTop),this._containment.offsetWidth-parseInt(getComputedStyle(this._containment).borderRightWidth)-parseInt(getComputedStyle(this._containment).paddingRight)-parseInt(getComputedStyle(o).marginLeft)-parseInt(getComputedStyle(o).marginRight)-i,this._containment.offsetHeight-parseInt(getComputedStyle(this._containment).borderBottomWidth)-parseInt(getComputedStyle(this._containment).paddingBottom)-parseInt(getComputedStyle(o).marginTop)-parseInt(getComputedStyle(o).marginBottom)-r]:"window"===this._containment?[window.scrollX,window.scrollY,window.scrollX+document.documentElement.offsetWidth-i,window.scrollY+document.documentElement.offsetHeight-r]:null},null===(t=this._start)||void 0===t||t.call(this)},this._handleDragMove=e=>{var t;if(null===this._helper)return;const{current:o,initial:i}=e.detail,n=this._source,r=this._helper.nextTop,s=this._helper.nextLeft,a="y"===this._axis||!1===this._axis||0!==o.movementY;if(a){const e=this._helper.startTop;isFinite(e)&&(this._helper.nextTop=o.clientY-i.clientY+e)}const l="x"===this._axis||!1===this._axis||0!==o.movementY;if(l){const e=this._helper.startLeft;isFinite(e)&&(this._helper.nextLeft=o.clientX-i.clientX+e)}if(null!==this._helper.containment){const[e,t,o,i]=this._helper.containment;a&&this._helper.nextTop&&(this._helper.nextTop=Math.min(this._helper.nextTop,i),this._helper.nextTop=Math.max(this._helper.nextTop,t)),l&&this._helper.nextLeft&&(this._helper.nextLeft=Math.min(this._helper.nextLeft,o),this._helper.nextLeft=Math.max(this._helper.nextLeft,e))}null!==this._helper.raf||r===this._helper.nextTop&&s===this._helper.nextLeft||(this._helper.raf=requestAnimationFrame((()=>{null!==this._helper&&(null!==this._helper.nextTop&&(n.style.top=this._helper.nextTop+"px",this._helper.nextTop=null),null!==this._helper.nextLeft&&(n.style.left=this._helper.nextLeft+"px",this._helper.nextLeft=null),this._helper.raf=null)}))),null===(t=this._drag)||void 0===t||t.call(this)},this._handleDragStop=e=>{var t;if(null===this._helper)return;this._source.classList.remove("ui-draggable-dragging"),this._helper=null,null===(t=this._stop)||void 0===t||t.call(this)};const i=this._source=e.source;i.classList.add("ui-draggable");const r=this._handle=null!==(t=e.handle?i.querySelector(e.handle):null)&&void 0!==t?t:i;r.classList.add("ui-draggable-handle"),this._start=e.start,this._stop=e.stop,this._drag=e.drag,this._backend=new s({handle:r,onDragStart:this._handleDragStart,onDragMove:this._handleDragMove,onDragStop:this._handleDragStop}),this._axis=null!==(o=e.axis)&&void 0!==o&&o,this._containment=e.containment}destroy(){const e=this._source;e.classList.remove("ui-draggable"),e.classList.remove("ui-draggable-dragging");this._handle.classList.remove("ui-draggable-handle"),this._backend.destroy(),
null!==this._helper&&(this._helper.raf&&cancelAnimationFrame(this._helper.raf),this._helper=null)}}class s{constructor(e){var t;this._pointerStarted=!1,this._initial=null,this._handlePointerDown=e=>{if(null!==this._initial||0!==e.button)return;if(!(e.target instanceof Element&&this._handle.contains(e.target)))return;if(this._initial=e,!this._distance&&(this._pointerStart(),!this._pointerStarted))return;e.preventDefault();const t=this._getEventTarget();t.addEventListener("pointermove",this._handlePointerMove),t.addEventListener("pointerup",this._handlePointerUp),t.addEventListener("pointercancel",this._handlePointerUp),t.addEventListener("lostpointercapture",this._handleLostPointerCapture)},this._handleLostPointerCapture=e=>{this._getEventTarget()===e.target&&this._handlePointerUp(e)},this._handlePointerMove=e=>{if(null!==this._initial&&this._initial.pointerId===e.pointerId)if(this._pointerStarted)this._pointerDrag(e);else if(this._pointerDistanceMet(e)){if(this._pointerStart(),this._pointerStarted)return void this._pointerDrag(e);this._handlePointerUp(e)}},this._handlePointerUp=e=>{if(null===this._initial||this._initial.pointerId!==e.pointerId)return;e.preventDefault();const t=this._getEventTarget();t.removeEventListener("pointermove",this._handlePointerMove),t.removeEventListener("pointerup",this._handlePointerUp),t.removeEventListener("pointercancel",this._handlePointerUp),t.removeEventListener("lostpointercapture",this._handlePointerUp),this._pointerStarted&&(this._pointerStarted=!1,t.releasePointerCapture(this._initial.pointerId),this._dispatchEvent(this._createEvent("pointer-drag-stop",e))),this._initial=null};const o=this._handle=e.handle;this._onDragStart=e.onDragStart,this._onDragMove=e.onDragMove,this._onDragStop=e.onDragStop,this._distance=null!==(t=e.distance)&&void 0!==t?t:0,this._rootElement=e.rootElement,o.style.touchAction="none",o.addEventListener("pointerdown",this._handlePointerDown)}destroy(){const e=this._handle;e.style.touchAction="",e.removeEventListener("pointerdown",this._handlePointerDown),e.removeEventListener("pointermove",this._handlePointerMove),e.removeEventListener("pointerup",this._handlePointerUp),e.removeEventListener("pointercancel",this._handlePointerUp),e.removeEventListener("lostpointercapture",this._handlePointerUp),null!==this._initial&&(e.releasePointerCapture(this._initial.pointerId),this._initial=null),this._pointerStarted=!1}_pointerStart(){if(!this._initial)return;const e=this._getEventTarget();this._dispatchEvent(this._createEvent("pointer-drag-start",this._initial))?(this._pointerStarted=!0,e.setPointerCapture(this._initial.pointerId)):this._initial=null}_pointerDrag(e){e.preventDefault(),this._dispatchEvent(this._createEvent("pointer-drag-move",e))}_pointerDistanceMet(e){return!this._initial||!this._distance||Math.max(Math.abs(this._initial.clientX-e.clientX),Math.abs(this._initial.clientY-e.clientY))>=this._distance}_getEventTarget(){var e;return null!==(e=this._rootElement)&&void 0!==e?e:this._handle}_dispatchEvent(e){switch(e.type){case"pointer-drag-start":
this._onDragStart(e);break;case"pointer-drag-move":this._onDragMove(e);break;case"pointer-drag-stop":this._onDragStop(e)}return!e.defaultPrevented}_createEvent(e,t){return(0,i.assert)(null!==this._initial),new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:{backend:this,initial:this._initial,current:t}})}}},821205:(e,t,o)=>{"use strict";o.d(t,{contentHeight:()=>n.contentHeight,html:()=>r,outerHeight:()=>n.outerHeight,outerWidth:()=>n.outerWidth,position:()=>a});var i=o(650151),n=o(65160);function r(e,t){return void 0===t||(null===t&&(e.innerHTML=""),"string"!=typeof t&&"number"!=typeof t||(e.innerHTML=String(t))),e}function s(e){if(!e.getClientRects().length)return{top:0,left:0};const t=e.getBoundingClientRect(),o=(0,i.ensureNotNull)(e.ownerDocument.defaultView);return{top:t.top+o.pageYOffset,left:t.left+o.pageXOffset}}function a(e){const t=getComputedStyle(e);let o,i={top:0,left:0};if("fixed"===t.position)o=e.getBoundingClientRect();else{o=s(e);const t=e.ownerDocument;let n=e.offsetParent||t.documentElement;for(;n&&(n===t.body||n===t.documentElement)&&"static"===getComputedStyle(n).position;)n=n.parentElement;n&&n!==e&&1===n.nodeType&&(i=s(n),i.top+=parseFloat(getComputedStyle(n).borderTopWidth),i.left+=parseFloat(getComputedStyle(n).borderLeftWidth))}return{top:o.top-i.top-parseFloat(t.marginTop),left:o.left-i.left-parseFloat(t.marginLeft)}}},523847:(e,t,o)=>{"use strict";o.d(t,{ColorPickerButton:()=>v});var i=o(50959),n=o(497754),r=o.n(n),s=o(650151),a=o(72571),l=o(724377),c=o(589637),h=o(206397),d=o(972646),p=o(860184),u=o(679458),m=o(834297),_=o(162458),g=o(262133);function v(e){const{property:t,icon:o,propertyApplier:n,title:v,undoText:b,isToolbarFixed:f,className:y}=e,w=(0,m.useProperty)(t),T=(0,i.useRef)(null),x=w?(0,l.parseRgba)(w)[3]:void 0,C=""===w,E=String(M()).toLowerCase()===p.white,[S,L,P]=(0,h.useCustomColors)();return i.createElement(u.ToolWidgetMenu,{className:y,verticalDropDirection:f?_.VerticalDropDirection.FromBottomToTop:void 0,horizontalDropDirection:f?_.HorizontalDropDirection.FromLeftToRight:void 0,horizontalAttachEdge:f?_.HorizontalAttachEdge.Left:void 0,verticalAttachEdge:f?_.VerticalAttachEdge.Top:void 0,content:i.createElement("div",{className:g.wrap},i.createElement(a.Icon,{className:g.icon,icon:o}),i.createElement("div",{className:g.colorBg},i.createElement("div",{className:r()(g.color,C&&g.multicolor,E&&g.white),style:C?void 0:{backgroundColor:w}}))),arrow:!1,title:v,ref:T,"data-name":e["data-name"],menuDataName:`${e["data-name"]}-menu`},i.createElement(d.ColorPicker,{color:M(),opacity:x,onColorChange:function(e,t){const o=w?(0,c.alphaToTransparency)((0,l.parseRgba)(w)[3]):0;k((0,c.generateColor)(String(e),o,true)),t||(0,s.ensureNotNull)(T.current).close()},onOpacityChange:function(e){k((0,c.generateColor)(w,(0,c.alphaToTransparency)(e),!0))},selectOpacity:void 0!==x,selectCustom:!0,customColors:S,onAddColor:function(e){L(e),(0,s.ensureNotNull)(T.current).close()},onRemoveCustomColor:P}));function M(){return w?(0,l.rgbToHexString)((0,l.parseRgb)(w)):null}function k(e){
n.setProperty(t,e,b)}}},822598:(e,t,o)=>{"use strict";o.d(t,{LineWidthButton:()=>y});var i=o(50959),n=o(497754),r=o(650151),s=o(72571),a=o(679458),l=o(834297),c=o(192063),h=o(493173),d=o(162458),p=o(222978),u=o(114631),m=o(206096),_=o(206483),g=o(266611),v=o(766431);const b=(0,h.mergeThemes)(c.DEFAULT_POPUP_MENU_ITEM_THEME,v),f=[{value:1,icon:p},{value:2,icon:u},{value:3,icon:m},{value:4,icon:_}];function y(e){const{multipleProperty:t,title:o,undoText:h,propertyApplier:p,isToolbarFixed:u,className:m,isSmallScreen:_}=e,y=(0,l.useProperty)((0,r.ensureDefined)(t)),w="mixed"===y||!y,T=function(e){const t=f.find((t=>t.value===e));if(!t)return g;return t.icon}(y);return i.createElement(a.ToolWidgetMenu,{className:m,arrow:!1,title:o,"data-name":e["data-name"],menuDataName:`${e["data-name"]}-menu`,verticalDropDirection:u?d.VerticalDropDirection.FromBottomToTop:void 0,horizontalDropDirection:u?d.HorizontalDropDirection.FromRightToLeft:void 0,horizontalAttachEdge:u?d.HorizontalAttachEdge.Right:void 0,verticalAttachEdge:u?d.VerticalAttachEdge.Top:void 0,content:i.createElement("div",null,w?i.createElement("div",{className:v.multiWidth},i.createElement(s.Icon,{icon:g})):i.createElement("div",{className:v.buttonWrap},!_&&i.createElement(s.Icon,{icon:T}),i.createElement("div",{className:n(!_&&v.buttonLabel)},`${y}px`)))},f.map((({value:e,icon:t})=>i.createElement(c.PopupMenuItem,{key:e,theme:b,label:`${e}px`,icon:t,isActive:e===y,onClick:x,onClickArg:e}))));function x(e){e&&t&&(p.beginUndoMacro(h),t.setValue(e,void 0,{applyValue:(e,t)=>{p.setProperty(e,t,h)}}),p.endUndoMacro())}}},834297:(e,t,o)=>{"use strict";o.d(t,{useProperty:()=>n});var i=o(50959);const n=e=>{const[t,o]=(0,i.useState)(e.value());return(0,i.useEffect)((()=>{const t=e=>{o(e.value())};t(e);const i={};return e.subscribe(i,t),()=>e.unsubscribe(i,t)}),[e]),t}},190266:(e,t,o)=>{"use strict";o.d(t,{runOrSignIn:()=>i,runOrSignInWithPromo:()=>n});function i(e,t){e()}function n(e,t,o){o()}},879091:(e,t,o)=>{"use strict";o.d(t,{ContextMenuAction:()=>y});var i=o(50959),n=o(650151),r=o(820883),s=o(370981),a=o(32133),l=o(730743),c=o(823030),h=o(497754),d=o.n(h),p=o(234404),u=o(871923),m=o(633832);function _(e){const{size:t="normal"}=e;return i.createElement(u.ContextMenuItem,{size:t,jsxLabel:i.createElement("div",{className:d()(m.loaderWrap,m[t])},i.createElement(p.Loader,{className:m.loader})),noInteractive:!0,onMouseOver:e.onMouseOver})}var g=o(930202),v=o(865266),b=o(610765);const f=(0,i.forwardRef)((function(e,t){const{className:o,...n}=e,[r,s]=(0,v.useRovingTabindexElement)(t);return i.createElement(u.ContextMenuItem,{...n,className:d()(b.accessible,o),reference:r,tabIndex:s,onKeyDown:function(e){if(e.target!==e.currentTarget)return;const t=(0,g.hashFromEvent)(e);13!==t&&32!==t||(e.preventDefault(),r.current instanceof HTMLElement&&r.current.click())},"data-role":"menuitem","aria-disabled":e.disabled||void 0})}));class y extends i.PureComponent{constructor(e){super(e),this._itemRef=null,this._menuElementRef=i.createRef(),this._menuRef=null,this._handleClick=e=>{
e.isDefaultPrevented()||this.state.disabled||(this._hasSubItems()?this._showSubMenu():(this.state.doNotCloseOnClick||(0,s.globalCloseMenu)(),this.props.action.execute(),this._trackEvent(),this.props.onExecute&&this.props.onExecute(this.props.action)))},this._handleClickToolbox=()=>{(0,s.globalCloseMenu)()},this._handleItemMouseOver=()=>{this._showSubMenu(),this._setCurrentContextValue()},this._handleMenuMouseOver=()=>{this._setCurrentContextValue()},this._showSubMenu=()=>{this.props.onShowSubMenu(this.props.action)},this._calcSubMenuPos=e=>(0,l.calcSubMenuPos)(e.contentWidth,this._itemRef),this._updateState=e=>{this.setState(e.getState())},this._setItemRef=e=>{this._itemRef=e},this._handleMenuRef=e=>{this._menuRef=e},this._registerSubmenu=()=>{var e;return null===(e=this.context)||void 0===e?void 0:e.registerSubmenu(this.props.action.id,(e=>(0,n.ensureNotNull)(this._itemRef).contains(e)||null!==this._menuElementRef.current&&this._menuElementRef.current.contains(e)))},this.state={...this.props.action.getState()}}componentDidMount(){this.props.action.onUpdate().subscribe(this,this._updateState),this.state.subItems.length&&(this._unsubscribe=this._registerSubmenu()),this.props.reference&&(this._itemRef=this.props.reference.current)}componentDidUpdate(e,t){var o,i,n;t.loading!==this.state.loading&&(null===(i=(o=this.props).onRequestUpdate)||void 0===i||i.call(o)),0===t.subItems.length&&this.state.subItems.length>0&&(this._unsubscribe=this._registerSubmenu()),t.subItems.length>0&&0===this.state.subItems.length&&(null===(n=this._unsubscribe)||void 0===n||n.call(this)),t.subItems!==this.state.subItems&&null!==this._menuRef&&this._menuRef.update()}componentWillUnmount(){this.props.action.onUpdate().unsubscribe(this,this._updateState),this._unsubscribe&&this._unsubscribe()}render(){var e,t;const o=(null===(e=this.context)||void 0===e?void 0:e.current)?this.context.current===this.props.action.id:this.props.isSubMenuOpened;return this.state.loading?i.createElement(_,{size:this.state.size}):i.createElement(f,{theme:this.props.theme,ref:null!==(t=this.props.reference)&&void 0!==t?t:this._setItemRef,onClick:this._handleClick,onClickToolbox:this._handleClickToolbox,onMouseOver:this._handleItemMouseOver,hovered:o,hasSubItems:this._hasSubItems(),actionName:this.state.name,checkboxInput:this.props.checkboxInput,selected:this.props.selected,...this.state},i.createElement(r.ContextMenu,{isOpened:o,items:this.state.subItems,position:this._calcSubMenuPos,menuStatName:this.props.menuStatName,parentStatName:this._getStatName(),menuElementReference:this._menuElementRef,onMouseOver:this.state.subItems.length?this._handleMenuMouseOver:void 0,ref:this._handleMenuRef}))}_setCurrentContextValue(){var e;this.state.subItems.length&&(null===(e=this.context)||void 0===e||e.setCurrent(this.props.action.id))}_hasSubItems(){return this.state.subItems.length>0}_trackEvent(){const e=this._getStatName();(0,a.trackEvent)("ContextMenuClick",this.props.menuStatName||"",e)}_getStatName(){
return[this.props.parentStatName,this.state.statName].filter((e=>Boolean(e))).join(".")}}y.contextType=c.SubmenuContext},871923:(e,t,o)=>{"use strict";o.d(t,{ContextMenuItem:()=>y,DEFAUL_CONTEXT_MENU_ITEM_THEME:()=>b});var i=o(50959),n=o(497754),r=o(408323),s=o(601227),a=o(324606),l=o(72621),c=o(577687),h=o(68620),d=o(76821),p=o(440891),u=o(800417),m=o(460925),_=o(80802),g=o(214665),v=o(603232);const b=v,f=p.enabled("items_favoriting");class y extends i.PureComponent{constructor(){super(...arguments),this._handleMouseOver=e=>{(0,a.isTouchEvent)(e.nativeEvent)||this.props.onMouseOver&&this.props.onMouseOver()},this._handleClickToolbox=e=>{e.stopPropagation(),this.props.onClickToolbox&&this.props.onClickToolbox()}}render(){const{hasSubItems:e,shortcutHint:t,hint:o,invisibleHotkey:r,favourite:a,theme:l=v,size:d="normal",onKeyDown:p,label:m,jsxLabel:_,styledLabel:b}=this.props,y=this.props.checkable&&this.props.checkboxInput?"label":"div";return i.createElement(i.Fragment,null,i.createElement("tr",{...(0,u.filterDataProps)(this.props),...(0,u.filterAriaProps)(this.props),className:n(this.props.className,l.item,!this.props.noInteractive&&l.interactive,this.props.hovered&&l.hovered,this.props.disabled&&l.disabled,this.props.active&&l.active,this.props.selected&&l.selected,l[d]),onClick:this.props.onClick,onMouseOver:this._handleMouseOver,ref:this.props.reference,"data-action-name":this.props.actionName,tabIndex:this.props.tabIndex,onKeyDown:p},f&&void 0!==a&&i.createElement("td",null,i.createElement(c.FavoriteButton,{className:l.favourite,isFilled:a,onClick:this.props.onFavouriteClick})),i.createElement("td",{className:n(l.iconCell),"data-icon-cell":!0},this._icon(l)),i.createElement("td",{className:l.contentCell},i.createElement(y,{className:l.content},i.createElement("span",{className:n(l.label,this.props.checked&&l.checked),"data-label":!0},!_&&b?b.map((({text:e,...t},o)=>i.createElement("span",{key:o,style:t},e))):null!=_?_:m),this._toolbox(l),e&&i.createElement("span",{className:l.arrowIcon,dangerouslySetInnerHTML:{__html:g},"data-submenu-arrow":!0}),!e&&t&&!s.CheckMobile.any()&&i.createElement(h.Hint,{className:n(r&&l.invisibleHotkey),text:t}),!e&&!t&&o&&i.createElement(h.Hint,{text:o})))),i.createElement("tr",{className:l.subMenu},i.createElement("td",null,this.props.children)))}_icon(e){if(this.props.checkable){if(this.props.checkboxInput)return i.createElement(r.CheckboxInput,{className:n(e.icon,e.checkboxInput),checked:this.props.checked});if(this.props.checked){const t=!this.props.icon&&!this.props.iconChecked,o=this.props.iconChecked||this.props.icon||_;return i.createElement("span",{className:n(e.icon,t&&e.checkmark),dangerouslySetInnerHTML:{__html:o},"data-icon-checkmark":t})}return this.props.icon?i.createElement("span",{className:e.icon,dangerouslySetInnerHTML:{__html:this.props.icon}}):i.createElement("span",{className:e.icon})}return this.props.icon?i.createElement("span",{className:e.icon,dangerouslySetInnerHTML:{__html:this.props.icon}}):null}_toolbox(e){
return this.props.toolbox?i.createElement("span",{className:n(e.toolbox,this.props.showToolboxOnHover&&e.showToolboxOnHover),onClick:this._handleClickToolbox,"data-toolbox":!0},this._renderToolboxContent()):null}_renderToolboxContent(){return this.props.toolbox&&this.props.toolbox.type===d.ToolboxType.Delete?i.createElement(l.RemoveButton,{icon:m,onClick:this.props.toolbox.action}):null}}},820883:(e,t,o)=>{"use strict";o.d(t,{ContextMenu:()=>E,OverlapContextMenu:()=>S});var i=o(50959),n=o(497754),r=o.n(n),s=o(874485),a=o(510618),l=o(738036),c=o(249161),h=o(126096),d=o(163694),p=o(930052),u=o(598941);function m(e){return i.createElement("li",{className:u.separator})}var _=o(729624),g=o(759339),v=o(370981);function b(e){var t;const o=null!==(t=e.action.custom())&&void 0!==t?t:e.action,[n,r]=(0,i.useState)((()=>o.getState())),[s,a]=(0,i.useState)(!1),l=!!n.subItems.length,c=l&&s;return(0,i.useEffect)((()=>{const e=()=>r(o.getState());return o.onUpdate().subscribe(null,e),()=>{o.onUpdate().unsubscribe(null,e)}}),[]),i.createElement(_.ContextMenuItem,{...n,onClick:function(e){if(n.disabled||e.defaultPrevented)return;if(l)return void a(!0);n.doNotCloseOnClick||(0,v.globalCloseMenu)();o.execute()},isLoading:n.loading,isHovered:c},c&&i.createElement(g.Drawer,{onClose:h},i.createElement(w,{items:n.subItems,parentAction:o,closeNested:h})));function h(e){e&&e.preventDefault(),a(!1)}}var f=o(134064),y=o(366493);function w(e){const{items:t,parentAction:o,closeNested:n}=e,r=!Boolean(o)&&t.every((e=>!Boolean("separator"!==e.type&&(e.getState().icon||e.getState().checkable))));return i.createElement(f.EmptyIconsContext.Provider,{value:r},i.createElement("ul",null,o&&i.createElement(i.Fragment,null,i.createElement(_.ContextMenuItem,{label:o.getState().label,isTitle:!0,active:!1,disabled:!1,subItems:[],checkable:!1,checked:!1,doNotCloseOnClick:!1,icon:y,onClick:n}),i.createElement(m,null)),t.map((e=>{switch(e.type){case"action":return i.createElement(b,{key:e.id,action:e});case"separator":return i.createElement(m,{key:e.id})}}))))}const T=i.createContext(null);var x=o(994567),C=o(742931);class E extends i.PureComponent{constructor(e){super(e),this._menuRef=i.createRef(),this._handleRequestUpdate=()=>{this.update()},this._handleClose=()=>{this.props.onClose&&this.props.onClose()},this._handleOutsideClickClose=e=>{const{doNotCloseOn:t,onClose:o}=this.props;!o||void 0!==t&&t.contains(e.target)||o()},this._handleFocusOnOpen=()=>{var e,t;(null===(e=this.props.menuElementReference)||void 0===e?void 0:e.current)&&this.props.takeFocus&&(null===(t=this.props.menuElementReference)||void 0===t||t.current.focus({preventScroll:!0}))},this._handleFocus=e=>{this.props.isKeyboardEvent&&e.target&&(0,x.focusFirstMenuItem)(e.target)},this.state={}}render(){const{isOpened:e,onClose:t,items:o,doNotCloseOn:n,menuStatName:s,parentStatName:u,takeFocus:m,..._}=this.props;return e?i.createElement(d.DrawerManager,null,i.createElement(c.KeyboardDocumentListener,{keyCode:27,eventType:"keyup",handler:this._handleClose}),i.createElement(p.MatchMedia,{
rule:"screen and (max-width: 430px)"},(t=>this._isDrawer(t)?i.createElement(T.Provider,{value:{type:"drawer"}},i.createElement(g.Drawer,{onClose:this._handleClose,position:"Bottom","data-name":_["data-name"]},i.createElement(w,{items:o}))):i.createElement(T.Provider,{value:{type:"menu"}},i.createElement(l.OutsideEvent,{handler:this._handleOutsideClickClose,mouseDown:!0,touchStart:!0,reference:this.props.menuElementReference},(t=>i.createElement(a.Menu,{..._,reference:t,className:r()(C.menu,"context-menu"),onClose:this._handleClose,noMomentumBasedScroll:!0,ref:this._menuRef,tabIndex:m?-1:void 0,onOpen:this._handleFocusOnOpen,onFocus:this._handleFocus,onKeyDown:x.handleAccessibleMenuKeyDown},i.createElement(h.ActionsTable,{items:o,menuStatName:s,parentStatName:u,parentIsOpened:e,onRequestUpdate:this._handleRequestUpdate})))))))):null}update(){var e;this._menuRef.current&&this._menuRef.current.update(),this.props.isKeyboardEvent&&(null===(e=this.props.menuElementReference)||void 0===e?void 0:e.current)&&document.activeElement===this.props.menuElementReference.current&&(0,x.focusFirstMenuItem)(this.props.menuElementReference.current)}_isDrawer(e){return void 0===this.props.mode?e:"drawer"===this.props.mode}}const S=(0,s.makeOverlapable)(E)},68620:(e,t,o)=>{"use strict";o.d(t,{Hint:()=>a});var i=o(50959),n=o(497754),r=o.n(n),s=o(603232);function a(e){const{text:t="",className:o}=e;return i.createElement("span",{className:r()(s.shortcut,o)},t)}},729624:(e,t,o)=>{"use strict";o.d(t,{ContextMenuItem:()=>m});var i=o(50959),n=o(497754),r=o.n(n),s=o(72571),a=o(234404),l=o(134064),c=o(68620),h=o(339750),d=o(379978),p=o(460925),u=o(236411);function m(e){const{className:t,isTitle:o,isLoading:n,isHovered:m,active:_,checkable:g,disabled:v,checked:b,icon:f,iconChecked:y,hint:w,subItems:T,label:x,styledLabel:C,onClick:E,children:S,toolbox:L,jsxLabel:P,size:M="normal"}=e,k=(0,i.useContext)(l.EmptyIconsContext),D=!!T.length;return n?i.createElement("li",{className:r()(t,u.item,u.loading,u[M])},i.createElement(a.Loader,null)):i.createElement("li",{className:r()(t,u.item,u.interactive,o&&u.title,v&&u.disabled,m&&u.hovered,_&&u.active,k&&u.emptyIcons,u[M]),onClick:E},i.createElement(s.Icon,{className:r()(u.icon),icon:function(){if(g&&b)return y||f||h;return f}()}),i.createElement("span",{className:r()(u.label)},!P&&C?C.map((({text:e,...t},o)=>i.createElement("span",{key:o,style:t},e))):null!=P?P:x),!!L&&i.createElement(s.Icon,{onClick:function(){L&&L.action()},className:u.remove,icon:p}),!D&&w&&i.createElement(c.Hint,{className:u.shortcut,text:w}),D&&i.createElement(s.Icon,{className:u.nested,icon:d}),S)}},134064:(e,t,o)=>{"use strict";o.d(t,{EmptyIconsContext:()=>i});const i=o(50959).createContext(!1)},249161:(e,t,o)=>{"use strict";o.d(t,{KeyboardDocumentListener:()=>n});var i=o(50959);class n extends i.PureComponent{constructor(){super(...arguments),this._handleKeyDown=e=>{e.keyCode===this.props.keyCode&&this.props.handler(e)}}componentDidMount(){document.addEventListener(this.props.eventType||"keydown",this._handleKeyDown,!1)}
componentWillUnmount(){document.removeEventListener(this.props.eventType||"keydown",this._handleKeyDown,!1)}render(){return null}}},313739:(e,t,o)=>{"use strict";o.d(t,{MatchMediaMap:()=>s});var i=o(50959),n=o(266783),r=o.n(n);class s extends i.Component{constructor(e){super(e),this._handleMediaChange=()=>{const e=l(this.state.queries,((e,t)=>t.matches));let t=!1;for(const o in e)if(e.hasOwnProperty(o)&&this.state.matches[o]!==e[o]){t=!0;break}t&&this.setState({matches:e})};const{rules:t}=this.props;this.state=a(t)}shouldComponentUpdate(e,t){return!r()(e,this.props)||(!r()(t.rules,this.state.rules)||!r()(t.matches,this.state.matches))}componentDidMount(){this._migrate(null,this.state.queries)}componentDidUpdate(e,t){r()(e.rules,this.props.rules)||this._migrate(t.queries,this.state.queries)}componentWillUnmount(){this._migrate(this.state.queries,null)}render(){return this.props.children(this.state.matches)}static getDerivedStateFromProps(e,t){if(r()(e.rules,t.rules))return null;const{rules:o}=e;return a(o)}_migrate(e,t){null!==e&&l(e,((e,t)=>{t.removeEventListener("change",this._handleMediaChange)})),null!==t&&l(t,((e,t)=>{t.addEventListener("change",this._handleMediaChange)}))}}function a(e){const t=l(e,((e,t)=>window.matchMedia(t)));return{queries:t,matches:l(t,((e,t)=>t.matches)),rules:{...e}}}function l(e,t){const o={};for(const i in e)e.hasOwnProperty(i)&&(o[i]=t(i,e[i]));return o}},730743:(e,t,o)=>{"use strict";o.d(t,{calcSubMenuPos:()=>n});var i=o(431520);function n(e,t,o={x:0,y:10}){if(t){const{left:o,right:n,top:r}=t.getBoundingClientRect(),s=document.documentElement.clientWidth,a={x:o-e,y:r},l={x:n,y:r};return(0,i.isRtl)()?o<=e?l:a:s-n>=e?l:a}return o}},72621:(e,t,o)=>{"use strict";o.d(t,{RemoveButton:()=>c});var i=o(609838),n=o(50959),r=o(497754),s=o(72571),a=o(333765),l=o(111772);function c(e){const{className:t,isActive:c,onClick:h,onMouseDown:d,title:p,hidden:u,"data-name":m="remove-button",icon:_,...g}=e;return n.createElement(s.Icon,{...g,"data-name":m,className:r(l.button,"apply-common-tooltip",c&&l.active,u&&l.hidden,t),icon:_||a,onClick:h,onMouseDown:d,title:p||i.t(null,void 0,o(767410))})}},493173:(e,t,o)=>{"use strict";function i(e,t,o={}){return Object.assign({},e,function(e,t,o={}){const i=Object.assign({},t);for(const n of Object.keys(t)){const r=o[n]||n;r in e&&(i[n]=[e[r],t[n]].join(" "))}return i}(e,t,o))}o.d(t,{mergeThemes:()=>i})},852495:e=>{e.exports={button:"button-xNqEcuN2"}},834426:e=>{e.exports={dots:"dots-meVFo3Y9"}},33335:e=>{e.exports={mobile:"screen and (max-width: 567px)"}},994567:(e,t,o)=>{"use strict";o.d(t,{focusFirstMenuItem:()=>c,handleAccessibleMenuFocus:()=>a,handleAccessibleMenuKeyDown:()=>l,queryMenuElements:()=>p});var i=o(442092),n=o(333086),r=o(180185);const s=[37,39,38,40];function a(e,t){var o;if(!e.target)return;const i=null===(o=e.relatedTarget)||void 0===o?void 0:o.getAttribute("aria-activedescendant");if(e.relatedTarget!==t.current){const e=i&&document.getElementById(i);if(!e||e!==t.current)return}c(e.target)}function l(e){var t;if(e.defaultPrevented)return
;const o=(0,r.hashFromEvent)(e);if(!s.includes(o))return;const a=document.activeElement;if(!(document.activeElement instanceof HTMLElement))return;const l=p(e.currentTarget).sort(i.navigationOrderComparator);if(0===l.length)return;const c=document.activeElement.closest('[data-role="menuitem"]')||(null===(t=document.activeElement.parentElement)||void 0===t?void 0:t.querySelector('[data-role="menuitem"]'));if(!(c instanceof HTMLElement))return;const m=l.indexOf(c);if(-1===m)return;const _=u(c),g=_.indexOf(document.activeElement),v=-1!==g,b=e=>{a&&(0,n.becomeSecondaryElement)(a),(0,n.becomeMainElement)(e),e.focus()};switch((0,i.mapKeyCodeToDirection)(o)){case"inlinePrev":if(!_.length)return;e.preventDefault(),b(0===g?l[m]:v?h(_,g,-1):_[_.length-1]);break;case"inlineNext":if(!_.length)return;e.preventDefault(),g===_.length-1?b(l[m]):b(v?h(_,g,1):_[0]);break;case"blockPrev":{e.preventDefault();const t=h(l,m,-1);if(v){const e=d(t,g);b(e||t);break}b(t);break}case"blockNext":{e.preventDefault();const t=h(l,m,1);if(v){const e=d(t,g);b(e||t);break}b(t)}}}function c(e){const[t]=p(e);t&&((0,n.becomeMainElement)(t),t.focus())}function h(e,t,o){return e[(t+e.length+o)%e.length]}function d(e,t){const o=u(e);return o.length?o[(t+o.length)%o.length]:null}function p(e){return Array.from(e.querySelectorAll('[data-role="menuitem"]:not([disabled]):not([aria-disabled])')).filter((0,i.createScopedVisibleElementFilter)(e))}function u(e){return Array.from(e.querySelectorAll("[tabindex]:not([disabled]):not([aria-disabled])")).filter((0,i.createScopedVisibleElementFilter)(e))}},126096:(e,t,o)=>{"use strict";o.d(t,{ActionsTable:()=>a});var i=o(50959),n=o(674704);function r(e){return i.createElement("tr",{className:n.row},i.createElement("td",null,i.createElement("div",{className:n.line})),i.createElement("td",null,i.createElement("div",{className:n.line}),e.hint?i.createElement("div",{className:n.hint},e.hint):null))}var s=o(879091);class a extends i.PureComponent{constructor(e){super(e),this._handleShowSubMenu=e=>{const t=e.getState();this.setState({showSubMenuOf:t.subItems.length?e:void 0})},this.state={}}render(){return i.createElement("table",null,i.createElement("tbody",null,this.props.items.map((e=>this._item(e)))))}static getDerivedStateFromProps(e,t){return!e.parentIsOpened&&t.showSubMenuOf?{showSubMenuOf:void 0}:null}_item(e){var t;switch(e.type){case"separator":return i.createElement(r,{key:e.id,hint:e.getHint()});case"action":const o=null!==(t=e.custom())&&void 0!==t?t:e;return i.createElement(s.ContextMenuAction,{key:o.id,action:o,onShowSubMenu:this._handleShowSubMenu,isSubMenuOpened:this.state.showSubMenuOf===o,menuStatName:this.props.menuStatName,parentStatName:this.props.parentStatName,onRequestUpdate:this.props.onRequestUpdate})}}}},511349:(e,t,o)=>{"use strict";o.d(t,{ToolWidgetIconButton:()=>a});var i=o(50959),n=o(497754),r=o(155352),s=o(852495);const a=i.forwardRef((function(e,t){const{className:o,id:a,...l}=e;return i.createElement(r.ToolWidgetButton,{id:a,"data-name":a,...l,ref:t,className:n(o,s.button)})}))},
27833:(e,t,o)=>{"use strict";o.r(t),o.d(t,{FavoriteDrawingToolbar:()=>L});var i=o(50959),n=o(632227),r=o(609838),s=o(310107),a=o(909434),l=(o(650151),o(441827)),c=o(540873),h=o(529596),d=o(651407),p=o(16509),u=o(870122),m=o(131595),_=o(240534),g=o(744471),v=o(868674),b=o(72571),f=o(679458),y=o(46305),w=o(403933),T=o(297265),x=o(497754),C=o(844996),E=o(834426);function S(e){const{title:t,actions:o,className:n,onActionClick:r}=e,s=(0,T.useWatchedValueReadonly)({watchedValue:d.tool}),a=o.map((e=>function(e,t,o){return i.createElement(y.AccessibleMenuItem,{key:e,onClick:()=>o(e),label:p.lineToolsInfo[e].localizedName,icon:p.lineToolsInfo[e].icon,isActive:e===t})}(e,s,r)));return i.createElement(f.ToolWidgetMenu,{className:x(n,E.dots),arrow:!1,title:t,drawerBreakpoint:w.TradingLayoutBreakpoint.Mobile,content:i.createElement(b.Icon,{icon:C}),"data-name":"more",menuDataName:"more-menu",closeOnEsc:!0},a)}o(451179);class L extends s.FloatingToolbar{constructor(e){super({allowSortable:!0,dragOnlyInsideToolbar:!0,defaultPosition:e,positionSettingsKey:"chart.favoriteDrawingsPosition",positionStorageType:"device"}),this._linetoolsWidgets={},this._canBeShownValue=new _.WatchedValue(!1),this._reactContainer=null,this._onActionClick=async e=>{await(0,v.initLineTool)(e),h.ContextMenuManager.hideAll(),d.tool.value()!==e&&d.tool.setValue(e)},this._createLineToolRenderer=()=>{let e=!0;const t=window.innerHeight>window.innerWidth,o=window.innerWidth>window.innerHeight,i=window.innerHeight===window.innerWidth;return n=>{if(e){const r=this._createLinetoolWidget(n);this.addWidget(r),t&&this.isVertical()||o&&!this.isVertical()||i?(e=this._isWidgetCanBeOnScreen(),e?this._linetoolsWidgets[n]=r:(this.removeWidget(r),this._dropdownItems.push(n))):this._linetoolsWidgets[n]=r}else this._dropdownItems.push(n)}},this._renderToolbarContent=()=>{const e=this._createLineToolRenderer();this._renderWidgetPlug(),this._linetoolsWidgets={},this._dropdownItems=[],this.removeWidgets(),a.LinetoolsFavoritesStore.favorites().filter((e=>p.lineToolsInfo[e]&&!0)).forEach(e),this._dropdownItems.length&&this._renderReactContent(),!this._dropdownItems.length&&this._reactContainer&&n.unmountComponentAtNode(this._reactContainer)},this._attachHandlers(),this._loadVisibilityState(),this._hideAction=this._createHideToolbarAction(),this._reactContainer=this.getReactWidgetContainer(),this._dropdownItems=[]}show(){this._canBeShownValue.value()&&(super.show(this._renderToolbarContent),window.addEventListener("resize",this._renderToolbarContent))}hide(){window.removeEventListener("resize",this._renderToolbarContent),super.hide()}showAndSaveSettingsValue(){this._canBeShownValue.value()&&(m.TVLocalStorage.setItem("ChartFavoriteDrawingToolbarWidget.visible","true"),this.show())}hideAndSaveSettingsValue(){m.TVLocalStorage.setItem("ChartFavoriteDrawingToolbarWidget.visible","false"),this.hide()}canBeShown(){return this._canBeShownValue.readonly()}_onFavoriteAdded(e){this.isVisible()&&this._renderToolbarContent(),
a.LinetoolsFavoritesStore.favorites().filter(P).length>0&&(this._canBeShownValue.setValue(!0),this.showAndSaveSettingsValue())}_onFavoriteRemoved(e){delete this._linetoolsWidgets[e],this.isVisible()&&this._renderToolbarContent(),0===a.LinetoolsFavoritesStore.favorites().filter(P).length&&(this._canBeShownValue.setValue(!1),this.hide())}_onFavoriteMoved(){this._renderToolbarContent()}_onSelectedLinetoolChanged(e){Object.keys(this._linetoolsWidgets).forEach((t=>{this._linetoolsWidgets[t].classList.toggle("i-active",e===t)})),this._dropdownItems.includes(e)&&this._renderReactContent()}_createLinetoolWidget(e){const t=`<span class="tv-favorited-drawings-toolbar__widget apply-common-tooltip ${e===d.tool.value()?"i-active":""}" title="${p.lineToolsInfo[e].localizedName}" data-name="FavoriteToolbar${e}">${p.lineToolsInfo[e].icon}</span>`,o=(0,l.parseHtmlElement)(t);return o.addEventListener("click",(()=>this._onActionClick(e))),o}_isWidgetCanBeOnScreen(){const e=this._getCorrectedWidgetRect();return this.isVertical()?e.height<window.innerHeight:e.width<window.innerWidth}_renderWidgetPlug(){n.render(i.createElement("div",{className:"tv-favorited-drawings-toolbar__widget"}),this._reactContainer)}_renderReactContent(){n.render(i.createElement(S,{title:r.t(null,void 0,o(437117)),actions:this._dropdownItems,onActionClick:this._onActionClick,className:"tv-favorited-drawings-toolbar__widget"}),this._reactContainer)}_attachHandlers(){a.LinetoolsFavoritesStore.favoriteAdded.subscribe(this,this._onFavoriteAdded),a.LinetoolsFavoritesStore.favoriteRemoved.subscribe(this,this._onFavoriteRemoved),a.LinetoolsFavoritesStore.favoriteMoved.subscribe(this,this._onFavoriteMoved),a.LinetoolsFavoritesStore.favoritesSynced.subscribe(null,(()=>{this._loadVisibilityState(),this._renderToolbarContent()})),this.onWidgetsReordered().subscribe(this,((e,t)=>{const o=a.LinetoolsFavoritesStore.favorite(e);if(o){const e=this._linetoolsWidgets[o];e.classList.remove("clicked"),setTimeout((()=>{e.style.pointerEvents=""}),50)}if(e!==t){if(a.LinetoolsFavoritesStore.favoriteMoved.unsubscribe(this,this._onFavoriteMoved),!a.LinetoolsFavoritesStore.moveFavorite(o,t))throw new Error("Something went wrong");a.LinetoolsFavoritesStore.favoriteMoved.subscribe(this,this._onFavoriteMoved)}})),this.onSortableStart().subscribe(this,(e=>{const t=a.LinetoolsFavoritesStore.favorite(e);if(!t)return;const o=this._linetoolsWidgets[t];o.classList.add("clicked"),(0,g.hide)(),o.style.pointerEvents="none"})),this.onContextMenu((e=>{e.preventDefault(),h.ContextMenuManager.showMenu([this._hideAction],e)})),d.tool.subscribe(this._onSelectedLinetoolChanged.bind(this))}_createHideToolbarAction(){return new c.Action({actionId:"Chart.FavoriteDrawingToolsToolbar.Hide",options:{label:r.t(null,void 0,o(322688)),onExecute:()=>{this.hideAndSaveSettingsValue()}}})}_loadVisibilityState(){const e=a.LinetoolsFavoritesStore.favorites().filter(P).length>0;this._canBeShownValue.setValue(e);const t=a.LinetoolsFavoritesStore.favoritesCount()>0;let o
;const i=u.getValue("ChartFavoriteDrawingToolbarWidget.visible");void 0!==i?(u.remove("ChartFavoriteDrawingToolbarWidget.visible",{forceFlush:!0}),o="false"!==i,m.TVLocalStorage.setItem("ChartFavoriteDrawingToolbarWidget.visible",i)):o="false"!==m.TVLocalStorage.getItem("ChartFavoriteDrawingToolbarWidget.visible"),o&&t?this.show():this.hide()}}function P(e){return!0}},310107:(e,t,o)=>{"use strict";o.d(t,{FLOATING_TOOLBAR_REACT_WIDGETS_CLASS:()=>y,FloatingToolbar:()=>T});var i=o(370981),n=o(972535),r=o(176616),s=o(870122),a=o(329452),l=o(240534),c=o(181370);class h extends c.ChunkLoader{_startLoading(){return Promise.all([o.e(1553),o.e(2377)]).then(o.bind(o,177525)).then((e=>e.HammerJS))}}var d=o(131595),p=o(496818),u=o(822960),m=o(431520),_=o(914314);class g{constructor(e){this._items=[],this._backends=[],this._helper=null,this._handleDragStart=e=>{var t,o;const i=this._getAllItems()[e];if(!(i instanceof HTMLElement)||null!==this._helper)return;i.style.zIndex="10";const n=this._options.source,r=i.getBoundingClientRect(),s=n.getBoundingClientRect();this._helper={movedIndexes:new Set,draggableIndex:e,leftBorder:s.left+v(n,"padding-left")+v(n,"border-left-width")-r.left-1,rightBorder:s.right-v(n,"padding-right")-v(n,"border-right-width")-r.right+1,topBorder:s.top+v(n,"padding-top")+v(n,"border-top-width")-r.top-1,bottomBorder:s.bottom-v(n,"padding-bottom")-v(n,"border-bottom-width")-r.bottom+1},null===(o=(t=this._options).start)||void 0===o||o.call(t,e)},this._handleDragMove=e=>{if(null===this._helper)return;const{topBorder:t,bottomBorder:o,leftBorder:i,rightBorder:n,draggableIndex:r}=this._helper,s=this._getAllItems()[r],{current:a,initial:l}=e.detail,{axis:c}=this._options,h=a.clientX-l.clientX,d=a.clientY-l.clientY;if("y"===c){const e=(0,u.clamp)(d,t,o);s.style.transform=`translateY(${e}px)`}if("x"===c){const e=(0,u.clamp)(h,i,n);s.style.transform=`translateX(${e}px)`}this._updateIdleItemsStateAndPosition()},this._handleDragStop=()=>{var e,t;if(null===this._helper)return;this._getAllItems()[this._helper.draggableIndex].style.zIndex="";const o=this._applyNewItemsOrder();this._cleanup(),this._initBackends(),null!==o&&(null===(t=(e=this._options).stop)||void 0===t||t.call(e,o))},this._options=e,this._initBackends()}destroy(){this._cleanup();for(const e of this._backends)e.destroy()}updateOptions(e){(0,_.default)(this._options,e)}updateList(){this._cleanup(),this._initBackends()}_initBackends(){for(const e of this._backends)e.destroy();const e=[];this._getAllItems().forEach(((t,o)=>{e.push(new p.PointerBackend({handle:t,onDragStart:()=>this._handleDragStart(o),onDragMove:this._handleDragMove,onDragStop:this._handleDragStop,distance:5,rootElement:window.document.documentElement}))})),this._backends=e}_cleanup(){this._getAllItems().forEach((e=>{e.style.transform=""})),this._helper=null,this._items=[]}_getAllItems(){var e;return(null===(e=this._items)||void 0===e?void 0:e.length)||(this._items=Array.from(this._options.source.children)),this._items}_updateIdleItemsStateAndPosition(){if(null===this._helper)return
;const{axis:e}=this._options,{draggableIndex:t}=this._helper,o=this._getAllItems(),i=o[t].getBoundingClientRect(),n=i.top+i.height/2,r=i.left+i.width/2,s="x"===e?r:n,a=new Set;o.forEach(((o,n)=>{if(t===n)return;const r=o.getBoundingClientRect(),l=r.left+r.width/2,c=r.top+r.height/2,h="x"===e?l:c,d=t>n,p=(0,m.isRtl)();let u;if(u=d?p&&s>=h||!p&&s<=h:p&&s<=h||!p&&s>=h,u){a.add(n);const t=d?p?-1:1:p?1:-1;switch(e){case"x":o.style.transform=`translateX(${t*i.width}px)`;break;case"y":o.style.transform=`translateY(${t*i.height}px)`}}else o.style.transform="",a.delete(n)})),this._helper.movedIndexes=a}_applyNewItemsOrder(){if(null===this._helper)return null;const{draggableIndex:e,movedIndexes:t}=this._helper,o=this._getAllItems(),i=o[e];let n=null;const r=[];o.forEach(((o,i)=>{if(i===e)return;const n=e>i;if(!t.has(i))return void(r[i]=o);r[n?i+1:i-1]=o}));for(let e=0;e<o.length;e++){void 0===r[e]&&(n=e,r[e]=i)}return t.size&&r.forEach((e=>{this._options.source.appendChild(e)})),n}}function v(e,t){return parseInt(function(e,t){return getComputedStyle(e,null).getPropertyValue(t)}(e,t))}var b=o(441827),f=o(25388);o(842329);const y="floating-toolbar-react-widgets",w=`<div class="tv-floating-toolbar i-closed i-hidden"><div class="tv-floating-toolbar__widget-wrapper"><div class="tv-floating-toolbar__drag js-drag">${f}</div><div class="tv-floating-toolbar__content js-content"></div><div class="${y}"></div></div></div>`;class T{constructor(e){this._widget=document.createElement("div"),this._isVertical=!1,this._hiddingTimeoutId=null,this._visibility=new l.WatchedValue(!1),this._windowResizeListener=this._onWindowResize.bind(this),this._reorderedDelegate=new a.Delegate,this._startSortableDelegate=new a.Delegate,this._responsiveResizeFunction=null,this._showTimeStamp=null,this._draggable=null,this._sortable=null,this._preventClickUntilAnimation=e=>{null!==this._showTimeStamp&&performance.now()-this._showTimeStamp<this.hideDuration()&&e.stopPropagation()},T._toolbars.push(this),this._options=e,this._widget=(0,b.parseHtmlElement)(w),this._content=this._widget.getElementsByClassName("js-content").item(0),this._reactWidgetsContainer=this._widget.getElementsByClassName(y).item(0),this._setZIndex(T._startZIndex+T._toolbars.length-1),this._options.addClass&&(this._widget.className+=` ${this._options.addClass}`),this._options["data-name"]&&(this._widget.dataset.name=this._options["data-name"]),this._options.layout&&"auto"!==this._options.layout&&(this._isVertical="vertical"===this._options.layout,this._updateLayoutType()),this._widget.addEventListener("click",this._preventClickUntilAnimation,!0)}destroy(){this.hide(!0),T._toolbars.splice(T._toolbars.indexOf(this),1),this._widget.removeEventListener("click",this._preventClickUntilAnimation,!0),document.body.contains(this._widget)&&document.body.removeChild(this._widget),null!==this._draggable&&this._draggable.destroy(),null!==this._sortable&&this._sortable.destroy(),this._widget.innerHTML="",this._responsiveResizeFunction=null}setResponsiveResizeFunc(e){this._responsiveResizeFunction=e}
isVisible(){return this._visibility.value()}visibility(){return this._visibility.readonly()}isVertical(){return this._isVertical}show(e){this.isVisible()||(document.body.contains(this._widget)||(this._init(),document.body.appendChild(this._widget)),this._setHiddingTimeout(null),window.addEventListener("resize",this._windowResizeListener),this.raise(),this._visibility.setValue(!0),this._showTimeStamp=performance.now(),this._widget.classList.contains("i-hidden")?(this._widget.classList.remove("i-hidden"),setTimeout((()=>{this.isVisible()&&(null==e||e(),this._widget.classList.remove("i-closed"))}))):(null==e||e(),this._widget.classList.remove("i-closed")),this._onWindowResize())}hide(e=!1){if(!this.isVisible())return;const t=this._widget.classList.contains("i-closed");if(this._widget.classList.add("i-closed"),this._visibility.setValue(!1),e||t)this._setHiddingTimeout(null),this._widget.classList.add("i-hidden");else{const e=setTimeout((()=>{this._setHiddingTimeout(null),this._widget.classList.add("i-hidden")}),this.hideDuration());this._setHiddingTimeout(e)}window.removeEventListener("resize",this._windowResizeListener)}raise(){T._toolbars.length+T._startZIndex!==this._zIndex()&&(T._toolbars.splice(T._toolbars.indexOf(this),1),T._toolbars.push(this),T._updateAllZIndexes())}hideDuration(){return.75*r.dur}addWidget(e,t={}){var o;const i=this.widgetsCount();if(void 0===t.index&&(t.index=i),t.index<0||t.index>i)throw new Error(`Index must be in [0, ${i}]`);const n=document.createElement("div");n.className="tv-floating-toolbar__widget js-widget",n.appendChild(e);const r=t.index===i?null:this._content.childNodes.item(t.index);this._content.insertBefore(n,r),this._onWindowResize(),null===(o=this._sortable)||void 0===o||o.updateList()}getReactWidgetContainer(){return this._reactWidgetsContainer}onWidgetsReordered(){return this._reorderedDelegate}onSortableStart(){return this._startSortableDelegate}removeWidget(e){var t;const o=this._findWrapperForWidget(e);o&&(this._content.removeChild(o),this._onWindowResize(),null===(t=this._sortable)||void 0===t||t.updateList())}widgetsCount(){return this._content.childNodes.length}showWidget(e){const t=this._findWrapperForWidget(e);t&&t.classList.remove("i-hidden")}hideWidget(e){const t=this._findWrapperForWidget(e);t&&t.classList.add("i-hidden")}removeWidgets(){for(;this._content.firstChild;)this._content.removeChild(this._content.firstChild);this._onWindowResize()}onContextMenu(e){if(n.mobiletouch){(new h).load().then((t=>{const o=new t(this._widget);o.get("press").set({time:500}),o.on("press",(t=>{this._preventWidgetTouchEndEvent(),e(t.srcEvent)}))}))}else this._widget.addEventListener("contextmenu",e)}checkPosition(){const e=this._getCorrectedWidgetRect(),t={left:e.left,top:e.top};this._correctPosition(t),e.left===t.left&&e.top===t.top||(this._widget.style.left=t.left+"px",this._widget.style.top=t.top+"px")}_determineCurrentLayoutVertical(e){const t=this._isVertical?e.height:e.width;return window.innerWidth<t&&window.innerWidth<window.innerHeight}_getWidget(){return this._widget}
_findWrapperForWidget(e){const t=this._content.getElementsByClassName("js-widget");for(let o=0;o<t.length;++o){const i=t.item(o);if(i.contains(e))return i}return null}_onVerticalChanged(e,t){}_correctPosition(e){const t=this._getCorrectedWidgetRect(),o=this._getSavedPosition(),i=window.innerWidth-t.right,n=window.innerHeight-t.bottom;i<0?e.left=Math.max(0,window.innerWidth-t.width):o&&o.left>e.left&&(e.left=Math.min(e.left+i,o.left)),n<0?e.top=Math.max(0,window.innerHeight-t.height):o&&o.top>e.top&&(e.top=Math.min(e.top+n,o.top))}_getCorrectedWidgetRect(){const e=this._widget.getBoundingClientRect();if(this._widget.classList.contains("i-closed")){const t=1/.925-1,o=e.width*t,i=e.height*t;return{bottom:e.bottom+i/2,height:e.height+i,left:e.left-o/2,right:e.right+o/2,top:e.top-i/2,width:e.width+o}}return e}_getSavedPosition(){var e;let t;if("device"===this._options.positionStorageType){const e=d.TVLocalStorage.getItem(this._options.positionSettingsKey);t=null!==e?JSON.parse(e):null}else t=null!==(e=(0,s.getJSON)(this._options.positionSettingsKey))&&void 0!==e?e:null;return null!==t&&"top"in t&&"left"in t?t:null}_setHiddingTimeout(e){null!==this._hiddingTimeoutId&&clearTimeout(this._hiddingTimeoutId),this._hiddingTimeoutId=e}_preventWidgetTouchEndEvent(){const e=t=>{t.preventDefault(),this._widget.removeEventListener("touchend",e)};this._widget.addEventListener("touchend",e)}_updateLayoutType(){this._widget.classList.toggle("i-vertical",this._isVertical)}_updateAxisOption(){this._sortable&&this._sortable.updateOptions({axis:this._isVertical?"y":"x"})}_onWindowResize(){if("auto"===(this._options.layout||"auto")){const e=this._isVertical,t=this._getCorrectedWidgetRect();this._isVertical=this._determineCurrentLayoutVertical(t),this._updateLayoutType(),e!==this._isVertical&&(this._onVerticalChanged(this._isVertical,e),this._updateAxisOption())}this.checkPosition(),this._resizeResponsive()}_resizeResponsive(){if(null===this._responsiveResizeFunction)return;let e=this._options.layout||"auto";"auto"===e&&(e=this._isVertical?"vertical":"horizontal");const t="vertical"===e?this._widget.clientHeight:this._widget.clientWidth,o=("vertical"===e?window.innerHeight:window.innerWidth)-t;this._responsiveResizeFunction(t,o,e)}_setZIndex(e){this._widget.style.zIndex=String(e)}_zIndex(){return Number(this._widget.style.zIndex)}_loadPosition(){var e;const t=null!==(e=this._getSavedPosition())&&void 0!==e?e:this._options.defaultPosition;this._widget.style.left=Math.round(t.left)+"px",this._widget.style.top=Math.round(t.top)+"px",this._onWindowResize()}_savePosition(){const e=this._widget.getBoundingClientRect();if("device"===this._options.positionStorageType)try{d.TVLocalStorage.setItem(this._options.positionSettingsKey,JSON.stringify({left:e.left,top:e.top}))}catch(e){}else(0,s.setJSON)(this._options.positionSettingsKey,{left:e.left,top:e.top})}_init(){this._loadPosition(),this._draggable=new p.Draggable({source:this._widget,containment:"window",handle:".js-drag",start:i.globalCloseMenu,stop:this._savePosition.bind(this)}),
this._initSortable(),this._widget.addEventListener("pointerdown",this.raise.bind(this))}_initSortable(){if(!this._options.allowSortable)return;let e=-1;this._sortable=new g({source:this._content,axis:this._isVertical?"y":"x",start:t=>{(0,i.globalCloseMenu)(),e=t,this._startSortableDelegate.fire(e)},stop:t=>{this._reorderedDelegate.fire(e,t)}})}static _updateAllZIndexes(){T._toolbars.forEach(((e,t)=>{e._setZIndex(T._startZIndex+t)}))}}T._startZIndex=20,T._toolbars=[]},233614:(e,t,o)=>{"use strict";o.d(t,{LineToolPropertiesWidgetBase:()=>Me});var i=o(50959),n=o(632227),r=o(609838),s=o(272047),a=o(440891),l=o(240534),c=o(41899),h=o(651407),d=o(622860),p=o(981856),u=o(650151),m=o(571772);class _ extends m.Property{constructor(e,t,o){super(),this._listenersMappers=[],this._isProcess=!1,this._baseProperty=e,this._propertyApplier=t,this._undoText=o}destroy(){this._baseProperty.destroy(),super.destroy()}value(){return this._baseProperty.value()}setValue(e){this._isProcess=!0,this._baseProperty.setValue(e,void 0,{applyValue:(e,t)=>this._propertyApplier.setProperty(e,t,this._undoText)}),this._isProcess=!1,this._listenersMappers.forEach((e=>{e.method.call(e.obj,this,"")}))}subscribe(e,t){const o=o=>{this._isProcess||t.call(e,this,"")},i={obj:e,method:t,callback:o};this._listenersMappers.push(i),this._baseProperty.subscribe(e,o)}unsubscribe(e,t){var o;const i=(0,u.ensureDefined)(null===(o=this._listenersMappers.find((o=>o.obj===e&&o.method===t)))||void 0===o?void 0:o.callback);this._baseProperty.unsubscribe(e,i)}unsubscribeAll(e){this._baseProperty.unsubscribeAll(e)}}var g=o(543259),v=o(497754),b=o.n(v),f=o(313739),y=o(310107),w=o(996038);const T=y.FLOATING_TOOLBAR_REACT_WIDGETS_CLASS+"__button";function x(e){const{templateButton:t,propertyButtons:o,commonButtons:n,isDrawingFinished:r,isToolbarFixed:s,buttonClassName:a,activeChartWidget:l}=e,c=l.hasModel()&&l.model().selection().dataSources();return c&&c.length?i.createElement(f.MatchMediaMap,{rules:{isSmallWidth:w.DialogBreakpoints.TabletSmall,isSmallHeight:"screen and (max-height: 430px)"}},(({isSmallWidth:e,isSmallHeight:t})=>i.createElement(i.Fragment,null,h(),r&&i.createElement(i.Fragment,null,Boolean(o.length)&&o.map(((o,n)=>i.createElement(o.component,{...o.props,key:`${o.props.title}_${n}`,className:b()(T,a),isSmallScreen:e||t,isToolbarFixed:s}))),Boolean(n.length)&&n.map(((o,n)=>{const r=e||t;return r?o.showForSmallScreen?i.createElement(o.component,{...o.props,isSmallScreen:r,key:`${o.props.title}_${n}`,className:b()(T,a)}):null:i.createElement(o.component,{...o.props,key:`${o.props.title}_${n}`,className:b()(T,a)})})))))):h();function h(){return null===t?null:i.createElement(t.component,{...t.props,isToolbarFixed:s,isDrawingFinished:r,className:b()(T,a)})}}var C=o(32133),E=o(511349),S=o(634369);function L(e){const{title:t,activeChartWidget:o,className:n}=e;return i.createElement(E.ToolWidgetIconButton,{className:n,icon:S,title:t,onClick:async function(){(0,C.trackEvent)("GUI","Context action on drawings","Settings")
;const e=o.model().selection().lineDataSources(),t=e.length;1===t?await o.showChartPropertiesForSource(e[0],void 0,{onWidget:o.onWidget()}):t>1&&await o.showChartPropertiesForSources({sources:e})},"data-name":"settings"})}var P=o(834297),M=o(898828),k=o(631527);function D(e){const{className:t,...o}=e;return i.createElement(M.ToolButton,{className:v(t,k.button),tooltipPosition:"horizontal",...o})}var A=o(665186),N=o(691244);function B(e){const{activeChartWidget:t,className:n}=e,s=t.model().selection().lineDataSources();if(0===s.length)return null;const a=s[0].properties().frozen,l=(0,P.useProperty)(a),c=l?{tooltip:r.t(null,void 0,o(999894)),icon:A}:{tooltip:r.t(null,void 0,o(205837)),icon:N};return i.createElement(D,{className:n,isActive:Boolean(l),onClick:function(){(0,C.trackEvent)("GUI","Context action on drawings","Lock"),t.toggleLockSelectedObject()},"data-name":Boolean(l)?"unlock":"lock",...c})}var W=o(993544);function I(e){const{title:t,activeChartWidget:o,className:n}=e;return i.createElement(E.ToolWidgetIconButton,{className:n,icon:W,title:t,"data-name":"remove",onClick:function(){(0,C.trackEvent)("GUI","Context action on drawings","Remove"),o.removeSelectedSources()}})}var R=o(72571),V=o(804395),F=o(972535),O=o(679458),z=o(126096),H=o(529596),U=o(179102),X=o(180185),j=o(376202),G=o(540873);function J(e,t){const i=[(0,U.createVisualOrderAction)(e,t),(0,U.createChangeIntervalsVisibilitiesAction)(e,t)],n=function(e,t){const i=[],n=X.isMacKeyboard?" +":"",s=t.filter((e=>e.cloneable()));s.length>0&&i.push(new G.Action({actionId:"Chart.LineTool.Clone",options:{name:"clone",icon:o(636296),shortcutHint:X.humanReadableModifiers(j.Modifiers.Mod)+n+" Drag",label:r.t(null,void 0,o(712537)),onExecute:()=>{e.model().cloneLineTools(s,!1),(0,C.trackEvent)("GUI","Context action on drawings","Clone")}}}));const a=t.filter((e=>e.copiable()));if(a.length>0){const t={name:"copy",label:r.t(null,void 0,o(249680)),shortcutHint:X.humanReadableModifiers(j.Modifiers.Mod)+n+" C",onExecute:()=>{e.chartWidgetCollection().clipboard.uiRequestCopy(a)}};i.push(new G.Action({actionId:"Chart.Clipboard.CopyLineTools",options:t,id:"Copy"}))}return i}(e,t);if(n.length&&i.push(new G.Separator,...n),t.some((e=>e.isSynchronizable()))){const o=(0,U.createSyncDrawingActions)(e,t);o.length&&i.push(new G.Separator,...o)}return i.push(new G.Separator,(0,U.createActionToggleVisibilityDataSources)(e,t)),i}var K=o(844996);function Z(e){const{title:t,activeChartWidget:o,isSmallScreen:n,className:r}=e,s=o.model(),a=s.selection().lineDataSources(),[l,c]=(0,i.useState)([]),h=(0,i.useRef)(null),d=(0,i.useMemo)((()=>new U.ActionsProvider(o)),[o]),p=(0,i.useCallback)((()=>d.contextMenuActionsForSources(a,(0,u.ensureNotNull)(s.paneForSource(a[0])))),[d,a]),m=(0,i.useCallback)((()=>{if(n)return;const e=J(o,a);c($(e))}),[n,o,a]),_=(0,i.useCallback)((e=>{n&&p().then((t=>{const o=$(t);window.matchMedia(w.DialogBreakpoints.TabletSmall).matches||!V.isAnyMobile?H.ContextMenuManager.showMenu(o,e,{mode:V.isAnyMobile?"drawer":"menu","data-name":"more-menu"},{
menuName:"LineToolFloatingToolbarMoreMenu"}):c(o)}))}),[n,p]);return(0,i.useEffect)((()=>{var e;l.length&&(null===(e=h.current)||void 0===e||e.update())}),[l]),i.createElement(O.ToolWidgetMenu,{className:r,ref:h,arrow:!1,onOpen:m,onClick:_,title:t,content:i.createElement(R.Icon,{icon:K}),"data-name":"more",menuDataName:"more-menu",closeOnEsc:!0},i.createElement(z.ActionsTable,{parentIsOpened:!0,items:l}))}function $(e){if(F.touch&&!window.matchMedia("(pointer:fine)").matches){const t=e.filter((e=>"Copy"!==e.id));if(t.length===e.length)return t;const o=[];return t.forEach((e=>{("separator"!==e.type||o.length>0&&"separator"!==o[o.length-1].type)&&o.push(e)})),o}return e}var q=o(813108),Y=o(162458),Q=o(200501),ee=o(123851),te=o(357740),oe=o(780427);function ie(e){const{property:t,propertyApplier:n,title:s,undoText:a,isToolbarFixed:l,className:c}=e,h=(0,P.useProperty)(t),d=(0,i.useMemo)((()=>[new G.Action({actionId:"Chart.LineTool.Toolbar.ChangeLineStyleToSolid",options:{icon:Q,label:r.t(null,void 0,o(903554)),active:q.LineStyle.Solid===h,onExecute:()=>n.setProperty(t,q.LineStyle.Solid,a)}}),new G.Action({actionId:"Chart.LineTool.Toolbar.ChangeLineStyleToDashed",options:{icon:ee,label:r.t(null,void 0,o(488123)),active:q.LineStyle.Dashed===h,onExecute:()=>n.setProperty(t,q.LineStyle.Dashed,a)}}),new G.Action({actionId:"Chart.LineTool.Toolbar.ChangeLineStyleToDotted",options:{icon:te,label:r.t(null,void 0,o(27390)),active:q.LineStyle.Dotted===h,onExecute:()=>n.setProperty(t,q.LineStyle.Dotted,a)}})]),[n,t,h]);return i.createElement(O.ToolWidgetMenu,{className:c,arrow:!1,content:i.createElement(R.Icon,{icon:ne(h)}),title:s,"data-name":e["data-name"],menuDataName:`${e["data-name"]}-menu`,verticalDropDirection:l?Y.VerticalDropDirection.FromBottomToTop:void 0,horizontalDropDirection:l?Y.HorizontalDropDirection.FromRightToLeft:void 0,horizontalAttachEdge:l?Y.HorizontalAttachEdge.Right:void 0,verticalAttachEdge:l?Y.VerticalAttachEdge.Top:void 0},i.createElement(z.ActionsTable,{items:d}))}function ne(e){switch(e){case q.LineStyle.Solid:return Q;case q.LineStyle.Dashed:return ee;case q.LineStyle.Dotted:return te;case"mixed":return oe;default:return""}}const re=[10,11,12,14,16,20,24,28,32,40];function se(e){const{property:t,propertyApplier:o,title:n,undoText:r,isToolbarFixed:s,className:a}=e,l=(0,P.useProperty)(t),c=re.map((e=>new G.Action({actionId:"Chart.LineTool.Toolbar.ChangeFontSizeProperty",options:{label:e.toString(),onExecute:()=>o.setProperty(t,e,r),active:e===l}})));return i.createElement(O.ToolWidgetMenu,{arrow:!1,content:l,className:a,title:n,verticalDropDirection:s?Y.VerticalDropDirection.FromBottomToTop:void 0,horizontalDropDirection:s?Y.HorizontalDropDirection.FromRightToLeft:void 0,horizontalAttachEdge:s?Y.HorizontalAttachEdge.Right:void 0,verticalAttachEdge:s?Y.VerticalAttachEdge.Top:void 0,"data-name":e["data-name"],menuDataName:`${e["data-name"]}-menu`},i.createElement(z.ActionsTable,{items:c}))}var ae=o(186661),le=o(868674),ce=o(816232),he=o(669874),de=o(76821),pe=o(608280);function ue(e){
const{model:t,onRestore:n,onSave:s,isDrawingFinished:l,isToolbarFixed:c,className:h,...d}=e,[p,u]=(0,i.useState)(!1),[m,_]=(0,i.useState)(null),g=(0,i.useRef)(null);(0,i.useEffect)((()=>{var e;null===(e=g.current)||void 0===e||e.update()}),[p]);const v=(0,i.useMemo)((()=>{if(s)return()=>{t.showSaveDialog((e=>{t.saveTemplate(e,JSON.stringify(s()))}))}}),[t,s]),b=(0,i.useMemo)((()=>{const e=[];return l&&v&&e.push(new G.Action({actionId:"Chart.LineTool.Templates.SaveAs",options:{label:(0,he.appendEllipsis)(r.t(null,void 0,o(776047))),onExecute:v}})),e.push(new G.Action({actionId:"Chart.LineTool.Templates.ApplyDefaults",options:{label:r.t(null,void 0,o(114663)),onExecute:n}})),p?e.push(new G.Loader("Chart.LineTool.Templates.Apply")):!p&&(null==m?void 0:m.length)&&(e.push(new G.Separator),e.push(...m.map((e=>new G.Action({actionId:"Chart.LineTool.Templates.Apply",options:{label:e,onExecute:()=>function(e){void 0!==e&&t.loadTemplate(e)}(e),showToolboxOnHover:!0,toolbox:{type:de.ToolboxType.Delete,action:()=>t.deleteAction(e)}}}))))),e}),[v,n,m,t,l,p]);return i.createElement(O.ToolWidgetMenu,{title:r.t(null,void 0,o(881152)),content:i.createElement(R.Icon,{icon:pe}),onOpen:a.enabled("drawing_templates")?function(){u(!0),t.templatesLoaded().then((()=>{const e=t.getData();void 0!==e&&(_(e),u(!1))})),(0,C.trackEvent)("GUI","Context action on drawings","Templates")}:void 0,arrow:!1,className:h,"data-name":"templates",menuDataName:"templates-menu",verticalDropDirection:c?Y.VerticalDropDirection.FromBottomToTop:void 0,horizontalDropDirection:c?Y.HorizontalDropDirection.FromLeftToRight:void 0,horizontalAttachEdge:c?Y.HorizontalAttachEdge.Left:void 0,verticalAttachEdge:c?Y.VerticalAttachEdge.Top:void 0,ref:g,...d},i.createElement(z.ActionsTable,{items:b}))}var me=o(568007),_e=o(624202),ge=o(363810),ve=o(214375),be=o(24003);const fe=!a.enabled("widget")||window.is_authenticated,ye=new s.TranslatedString("change line tool(s) font size",r.t(null,void 0,o(237453))),we=new s.TranslatedString("change line tool(s) line style",r.t(null,void 0,o(413423))),Te=new s.TranslatedString("apply drawing template",r.t(null,void 0,o(89720))),xe=new s.TranslatedString("line tool(s) line style",r.t(null,{context:"line tool property name"},o(664974))),Ce=r.t(null,void 0,o(232514)),Ee=r.t(null,void 0,o(767410)),Se=r.t(null,void 0,o(437117)),Le=r.t(null,void 0,o(492516)),Pe=r.t(null,void 0,o(702573));class Me{constructor(e){this._isDrawingFinished=new l.WatchedValue(!0),this._currentTool=null,this._updateVisibilityTimeout=null,this._lineWidthsProperty=null,this._lineColorsProperty=null,this._currentProperties=null,this._floatingContainer=null,this._floatingToolbarRendered=!1,this._toolbarVisible=!1,this._propertiesVisible=!1,this._templatesButton=null,this._propertyButtons=[],this._commonButtons=[],this._handleSourceEdit=e=>{h.isDirectionalMovementActive.value()||(e?this._floatingToolbar.hide(!0):this._floatingToolbarRendered&&this._floatingToolbar.show())},this._chartWidgetCollection=e,this._floatingToolbar=new y.FloatingToolbar({defaultPosition:{
top:ae.HEADER_TOOLBAR_HEIGHT_EXPANDED+15,left:window.innerWidth/2},positionSettingsKey:"properties_toolbar.position",positionStorageType:"device",layout:"horizontal","data-name":"drawing-toolbar"}),this._floatingContainer=this._floatingToolbar.getReactWidgetContainer(),this._isToolMovingNowSpawn=h.isToolMovingNow.spawn(),this._isToolEditingNowSpawn=h.isToolEditingNow.spawn(),this._toolSpawn=h.tool.spawn(),this._iconToolSpawn=h.iconTool.spawn(),this._emojiToolSpawn=h.emojiTool.spawn(),this._selectedSourcesSpawn=this._chartWidgetCollection.selectedSources.spawn(),this._isToolMovingNowSpawn.subscribe(this._handleSourceEdit),this._isToolEditingNowSpawn.subscribe(this._handleSourceEdit),this._toolSpawn.subscribe((e=>this._onToolChanged(e)),{callWithLast:!0}),this._iconToolSpawn.subscribe((()=>this._onToolChanged(h.tool.value()))),this._emojiToolSpawn.subscribe((()=>this._onToolChanged(h.tool.value()))),this._selectedSourcesSpawn.subscribe((()=>this.refresh())),this._chartWidgetCollection.onAboutToBeDestroyed.subscribe(this,this.destroy,!0)}destroy(){this._isToolMovingNowSpawn.destroy(),this._isToolEditingNowSpawn.destroy(),this._toolSpawn.destroy(),this._iconToolSpawn.destroy(),this._emojiToolSpawn.destroy(),this._selectedSourcesSpawn.destroy()}refresh(){this._onSourceChanged(this.selectedSources())}activeChartWidget(){return this._chartWidgetCollection.activeChartWidget.value()}selectedSources(){return this._chartWidgetCollection.selectedSources.value().filter(le.isLineTool)}hide(){this._updateVisibilityTimeout&&clearTimeout(this._updateVisibilityTimeout),this._updateVisibilityTimeout=setTimeout((()=>{(0,le.unsetNewToolProperties)(),this._floatingToolbar.hide(!0),this._isToolbarRendered()&&this._unmountFloatingToolbar(),this._clearProperties(),this._clearCommonButtons()}),0),delete this._propertyApplier}templatesList(){return this._templatesList}_onToolChanged(e,t){this._currentTool=e;const o=this.selectedSources();if(this._isDrawingToolExcludingCustomUrlEventTool(e)){if(this._isDrawingFinished.setValue(!1),fe){const o=t instanceof me.DefaultProperty?t:(0,le.setNewToolProperties)(e,"LineToolIcon"===e?h.iconTool.value():"LineToolEmoji"===e?h.emojiTool.value():void 0,this._chartWidgetCollection.activeChartWidget.value().model().model());this.showPropertiesOf(e,o,t instanceof me.DefaultProperty),this._showTemplatesOf({tool:e,properties:o}),this._toolbarVisible=!0}this._updateVisibility()}else o&&o.length?(o.length>1&&this._isDrawingFinished.setValue(!0),this.refresh()):this.hide()}_onSourceChanged(e){if(!(null==e?void 0:e.length))return this._propertiesVisible=!1,this._toolbarVisible=!1,void this.hide();if(this._createCommonButtons(),e.every((t=>t.toolname===e[0].toolname))?this._showTemplatesOf({sources:e}):this._templatesButton&&this._clearTemplatesButton(),1===e.length){const[t]=e;t.isAvailableInFloatingWidget()&&this.activeChartWidget().model().model().dataSourceForId(t.id())?(!t.userEditEnabled()||!(0,
_e.isLineDrawnWithPressedButton)(t.toolname)&&this.activeChartWidget().model().lineBeingCreated()||this._isDrawingFinished.setValue(!0),this.showPropertiesOf(t.toolname,t.properties(),!0),this._toolbarVisible=!0):this.hide()}else this._clearProperties(),this._createWidthsButton(void 0,!0),this._createLineStyleButton(),this._createColorsButton(void 0,!0),this._createBackgroundsButton(void 0,!0),this._createTextColorsButton(void 0,!0),this._propertiesVisible=!0;this._updateVisibility()}_propertyApplierImpl(){return this._propertyApplier||(this._propertyApplier=new ve.PropertyApplierWithoutSavingChart((()=>this.activeChartWidget().model()))),this._propertyApplier}_clearProperties(){this._clearPropertyButtons(),this._lineWidthsProperty&&(this._lineWidthsProperty.destroy(),this._lineWidthsProperty=null),this._lineColorsProperty&&(this._lineColorsProperty.destroy(),this._lineColorsProperty=null),this._currentProperties&&(this._currentProperties=null)}_show(){this._updateVisibilityTimeout&&clearTimeout(this._updateVisibilityTimeout),this._updateVisibilityTimeout=setTimeout((()=>{this._renderFloatingToolbar(),this._floatingToolbar.show(),this._floatingToolbar.checkPosition()}),0)}_addPropertyButton(e){this._propertyButtons.push(e),this._renderFloatingToolbar()}_addCommonButton(e){this._commonButtons.push(e),this._renderFloatingToolbar()}_addTemplatesButton(e){this._templatesButton=e}_renderFloatingToolbar(){null!==this._floatingContainer&&this.activeChartWidget()&&this.activeChartWidget().hasModel()&&(n.render(i.createElement(x,{templateButton:this._templatesButton,propertyButtons:this._propertyButtons,commonButtons:this._commonButtons,isDrawingFinished:this._isDrawingFinished.value(),activeChartWidget:this.activeChartWidget()}),this._floatingContainer),this._floatingToolbarRendered=!0)}_unmountFloatingToolbar(){null!==this._floatingContainer&&(n.unmountComponentAtNode(this._floatingContainer),this._floatingToolbarRendered=!1)}_clearTemplatesButton(){this._templatesButton=null}_clearPropertyButtons(){this._propertyButtons=[]}_clearCommonButtons(){this._commonButtons=[]}_isToolbarRendered(){return this._floatingToolbarRendered}_createSettingsButton(){const e={component:L,props:{title:Ce,activeChartWidget:this.activeChartWidget()}};this._addCommonButton(e)}_createLockButton(){const e={component:B,props:{title:"Lock",activeChartWidget:this.activeChartWidget()}};this._addCommonButton(e)}_createRemoveButton(){const e={component:I,props:{title:Ee,activeChartWidget:this.activeChartWidget()},showForSmallScreen:!0};this._addCommonButton(e)}_createDotsButton(){this._addCommonButton({component:Z,props:{title:Se,activeChartWidget:this.activeChartWidget()},showForSmallScreen:!0})}_createAlertButton(){}_createSourceActions(){this._createLockButton()}_createLineStyleButton(e){const t=this.selectedSources().filter(le.isLineTool);if(!t.length)return!1;let o,i=this._propertyApplierImpl();if(1===t.length){if(o=t[0].properties().linesStyles||e,!o)return!1}else{
const e=t.map((e=>e.properties().linestyle||e.properties().lineStyle||e.properties().linesStyles)).filter(c.notUndefined);if(!e.length)return!1;o=new d.CollectiblePropertyUndoWrapper(new p.LineToolCollectedProperty(e),xe,this._propertyApplierImpl()),i={...i,setProperty:(e,t)=>e.setValue(t)}}return this._addPropertyButton({component:ie,props:{property:o,title:Le,propertyApplier:i,"data-name":"style",undoText:we}}),!0}_createFontSizeButton(e){const t=this.selectedSources();if(0===t.length)return!1;const o=t[0];if(!(0,ge.isDataSource)(o))return!1;const i={component:se,props:{property:o.properties().fontsize||e,title:Pe,propertyApplier:this._propertyApplierImpl(),"data-name":"font-size",undoText:ye}};return this._addPropertyButton(i),!0}_createCommonButtons(){this._commonButtons.length&&this._clearCommonButtons(),a.enabled("property_pages")&&this._createSettingsButton(),this._createSourceActions(),this._createRemoveButton(),this._createDotsButton()}_prepareProperties(e){const t=this.selectedSources().filter((t=>t.properties()[e]));if(!(t.filter((t=>t.properties()[e].visible())).length<1))return t.map((t=>t.properties()[e])).filter(c.notNull)}_createProperty(e,t,o,i){if(t){const e=this._prepareProperties(o);if(!e)return;return this._isWidthProperty(e[0])?new _(new p.MultipleLineWidthsProperty(e),this._propertyApplierImpl(),i):new g.CollectibleColorPropertyUndoWrapper(new p.MultipleLineColorsProperty(e),this._propertyApplierImpl(),i)}if(e&&e.visible())return this._isWidthProperty(e)?new p.MultipleLineWidthsProperty([e]):new g.CollectibleColorPropertyDirectWrapper(new p.MultipleLineColorsProperty([e]))}_shouldShowBackgroundProperty(e,t){return!t||!t.fillBackground||!!t.fillBackground.value()}_isDrawingToolExcludingCustomUrlEventTool(e){return Boolean(null==e?void 0:e.toLowerCase().includes("linetool"))&&"LineToolTweet"!==e&&"LineToolIdea"!==e&&"LineToolImage"!==e}_updateVisibility(){(fe||this._isDrawingFinished.value())&&(this._toolbarVisible||this._propertiesVisible)?this._show():this.hide()}_showTemplatesOf(e){if(this._templatesButton&&this._clearTemplatesButton(),!fe)return;let t,o,i,n;if("sources"in e){if(t=e.sources,o=t[0].toolname,i=t[0].properties(),1===t.length){const e=t[0];n=()=>e.template()}}else o=e.tool,i=e.properties;this._templatesList=new ce.LinetoolTemplatesList(o,(e=>{if(t){const o=this.activeChartWidget().model();o.beginUndoMacro(Te),t.forEach((t=>o.applyLineToolTemplate(t,e,Te))),o.endUndoMacro(),this._onSourceChanged(t)}else e.intervalsVisibilities=(0,be.mergeIntervalVisibilitiesDefaults)(e.intervalsVisibilities),i.mergeAndFire(e),i.saveDefaults(),this._onToolChanged(o,i)})),this._addTemplatesButton({component:ue,props:{key:"Templates",model:this._templatesList,onSave:a.enabled("drawing_templates")?n:void 0,onRestore:()=>{void 0!==t?this.activeChartWidget().model().restoreLineToolsFactoryDefaults(t):i.restoreFactoryDefaults(),this.refresh()}}})}_isWidthProperty(e){return e instanceof p.LineToolWidthsProperty}}},816232:(e,t,o)=>{"use strict";o.r(t),o.d(t,{LinetoolTemplatesList:()=>d})
;var i=o(609838),n=o(917568),r=o(279708),s=o(540642),a=o(190266),l=o(153055),c=o(78943);const h=o(440891).enabled("drawing_templates");class d{constructor(e,t){this._toolName=e,this._applyTemplate=t,this._templatesDeferred=h?this._loadData():Promise.resolve()}getData(){return n.store.getState().templates[this._toolName]}templatesLoaded(){return this._templatesDeferred}loadTemplate(e,t){n.store.dispatch((0,r.loadTemplate)(this._toolName,e,(e=>{this._applyTemplate(e),null==t||t()})))}removeTemplate(e){n.store.dispatch((0,r.startRemoveTemplate)(this._toolName,e))}saveTemplate(e,t){const o=(0,s.clean)(e);n.store.dispatch((0,r.saveTemplate)(this._toolName,o,t))}deleteAction(e){(0,a.runOrSignIn)((()=>{const t=i.t(null,{replace:{name:e}},o(57285));(0,l.showConfirm)({text:t,onConfirm:t=>{this.removeTemplate(e),t.dialogClose()}})}),{source:"Delete line tool template"})}showSaveDialog(e){(0,a.runOrSignIn)((()=>{(0,l.showRename)({title:i.t(null,void 0,o(776047)),text:i.t(null,void 0,o(59233))+":",maxLength:64,source:this.getData()||[],autocompleteFilter:c.autocompleteFilter,onRename:t=>{if(-1!==(this.getData()||[]).indexOf(t.newValue)){const n=i.t(null,{replace:{name:t.newValue}},o(623276));(0,l.showConfirm)({text:n,onConfirm:o=>{e(t.newValue),o.dialogClose(),t.dialogClose()},onClose:t.focusInput},t.innerManager)}else e(t.newValue),t.dialogClose()}})}),{source:"Save line tool template",sourceMeta:"Chart"})}async _loadData(){return new Promise((e=>{this.getData()?e():n.store.dispatch((0,r.getTemplates)(this._toolName,e))}))}}},49337:(e,t,o)=>{"use strict";var i=o(272047).TranslatedString,n=o(233614).LineToolPropertiesWidgetBase;const r=o(523847).ColorPickerButton,s=o(822598).LineWidthButton;var a=o(405880),l=o(621065),c=o(448984),h=new i("change line tool(s) color",o.i18next(null,void 0,o(578655))),d=new i("change line tool(s) background color",o.i18next(null,void 0,o(150522))),p=new i("change line tool(s) text color",o.i18next(null,void 0,o(196142))),u=new i("change line tool(s) line width",o.i18next(null,void 0,o(81303))),m=o.i18next(null,void 0,o(747370)),_=o.i18next(null,void 0,o(211989)),g=o.i18next(null,void 0,o(77753)),v=o.i18next(null,void 0,o(681956)),b=o.i18next(null,void 0,o(369715)),f=o.i18next(null,void 0,o(614097)),y=o.i18next(null,void 0,o(492516)),w=o.i18next(null,void 0,o(992409)),T=o.i18next(null,void 0,o(353002)),x=o.i18next(null,void 0,o(475056)),C=o.i18next(null,void 0,o(128736)),E=o.i18next(null,void 0,o(265086)),S=o.i18next(null,void 0,o(346193)),L=o.i18next(null,void 0,o(307977)),P=o.i18next(null,void 0,o(908111));class M extends n{constructor(e){super(e),this._templatesButton=null}_createWidthsButton(e,t){if(this._lineWidthsProperty&&(this._lineWidthsProperty.destroy(),this._lineWidthsProperty=null),this._lineWidthsProperty=this._createProperty(e,t,"linesWidths",u),!this._lineWidthsProperty)return!0;var o=T;t&&(1!==this.selectedSources().filter((e=>e.properties().linesWidths)).length&&(o=x));return this._addPropertyButton({component:s,props:{title:o,multipleProperty:this._lineWidthsProperty,
propertyApplier:this._propertyApplierImpl(),"data-name":"line-tool-width",undoText:u}}),!0}_createColorsButton(e,t){return this._lineColorsProperty&&(this._lineColorsProperty.destroy(),this._lineColorsProperty=null),this._lineColorsProperty=this._createProperty(e,t,"linesColors",h),!this._lineColorsProperty||(this._addPropertyButton({component:r,props:{icon:a,title:_,property:this._lineColorsProperty,propertyApplier:this._propertyApplierImpl(),"data-name":"line-tool-color",undoText:h}}),!0)}_createBackgroundsButton(e,t){return this._backgroundsProperty&&(this._backgroundsProperty.destroy(),this._backgroundsProperty=null),this._backgroundsProperty=this._createProperty(e,t,"backgroundsColors",d),!this._backgroundsProperty||(this._addPropertyButton({component:r,props:{icon:l,title:f,property:this._backgroundsProperty,propertyApplier:this._propertyApplierImpl(),"data-name":"background-color",undoText:d}}),!0)}_createTextColorsButton(e,t){return this._textColorsProperty&&(this._textColorsProperty.destroy(),this._textColorsProperty=null),this._textColorsProperty=this._createProperty(e,t,"textsColors",p),!this._textColorsProperty||(this._addPropertyButton({component:r,props:{icon:c,title:v,property:this._textColorsProperty,propertyApplier:this._propertyApplierImpl(),"data-name":"text-color",undoText:p}}),!0)}_getPossibleProperty(e){for(var t=[],o=this._defaultToolProperties(),i=0;i<o.length;i++){var n=o[i];n.name in e&&t.push(n)}return t}showPropertiesOf(e,t,o){this._toolExceptionCases||(this._toolExceptionCases=this._createToolExceptionCases());var i=this._toolExceptionCases[e]||this._getPossibleProperty(t);if(this._clearProperties(),this._propertiesVisible=!1,i.length){for(var n={},s=0;s<i.length;s++){for(var a=i[s],l=t,c=a.name.split("."),h=0;h<c.length;++h)l=l&&l[c[h]];var d=a.showIf;if("function"!=typeof d||d(l,t)){var p=a.factory;if(p&&p.call(this,l,o))continue;if(!l)continue;if(this._propertiesVisible=!0,"combobox"!==a.inputType){const e={component:r,props:{icon:a.iconSvgCode,title:a.title,"data-name":a.dataName,property:l,propertyApplier:this._propertyApplierImpl(),undoText:a.undoText}};this._addPropertyButton(e);continue}n[a.name]=l}}this._currentProperties=n}}_defaultToolProperties(){return[{name:"linesColors",inputType:"colorPicker",iconSvgCode:a,title:m,factory:M.prototype._createColorsButton,dataName:"line-tool-color"},{name:"backgroundsColors",inputType:"colorPicker",iconSvgCode:l,title:b,factory:M.prototype._createBackgroundsButton,dataName:"background-color",showIf:this._shouldShowBackgroundProperty},{name:"textsColors",title:g,inputType:"colorPicker",iconSvgCode:c,factory:M.prototype._createTextColorsButton,dataName:"text-color"},{name:"linesWidths",inputType:"combobox",factory:M.prototype._createWidthsButton},{name:"linesStyles",title:y,inputType:"combobox",factory:M.prototype._createLineStyleButton}]}_regressionToolExceptionCases(){return[{name:"linesWidths",inputType:"combobox",factory:M.prototype._createWidthsButton}]}_pathExceptionCases(){return[{name:"linesColors",inputType:"colorPicker",
iconSvgCode:a,title:m,factory:M.prototype._createColorsButton,dataName:"line-tool-color"},{name:"linesWidths",inputType:"combobox",factory:M.prototype._createWidthsButton},{name:"lineStyle",title:y,inputType:"combobox",factory:M.prototype._createLineStyleButton}]}_riskPropertiesExceptionCases(){return[{name:"textcolor",title:g,inputType:"colorPicker",iconSvgCode:c,dataName:"text-color",undoText:p},{name:"profitBackground",title:C,inputType:"colorPicker",iconSvgCode:l,dataName:"background-color",undoText:d},{name:"stopBackground",title:E,inputType:"colorPicker",iconSvgCode:l,dataName:"background-color",undoText:d}]}_rangeExceptionCases(){return[{name:"linecolor",inputType:"colorPicker",iconSvgCode:a,title:m,dataName:"line-tool-color",undoText:h},{name:"backgroundColor",inputType:"colorPicker",iconSvgCode:l,title:b,dataName:"background-color",showIf:this._shouldShowBackgroundProperty,undoText:d},{name:"linesWidths",inputType:"combobox",factory:M.prototype._createWidthsButton}]}_brushPropertiesExceptionCase(){return[{name:"linesColors",inputType:"colorPicker",iconSvgCode:a,title:m,factory:M.prototype._createColorsButton,dataName:"line-tool-color"},{name:"backgroundsColors",inputType:"colorPicker",iconSvgCode:l,title:b,dataName:"background-color",factory:M.prototype._createBackgroundsButton},{name:"linesWidths",inputType:"combobox",factory:M.prototype._createWidthsButton}]}_bezierPropertiesExceptionCases(){return[{name:"linesColors",inputType:"colorPicker",iconSvgCode:a,title:m,factory:M.prototype._createColorsButton,dataName:"line-tool-color"},{name:"backgroundsColors",inputType:"colorPicker",iconSvgCode:l,dataName:"background-color",title:b,factory:M.prototype._createBackgroundsButton,showIf:this._shouldShowBackgroundProperty},{name:"linesWidths",inputType:"combobox",factory:M.prototype._createWidthsButton},{name:"linesStyles",title:y,inputType:"combobox",factory:M.prototype._createLineStyleButton}]}_textPropertiesExceptionCases(){return[{name:"color",title:g,inputType:"colorPicker",iconSvgCode:c,dataName:"text-color",undoText:p},{name:"backgroundColor",title:b,inputType:"colorPicker",iconSvgCode:l,dataName:"background-color",showIf:this._shouldShowBackgroundProperty,undoText:d},{name:"fontsize",title:w,inputType:"combobox",factory:M.prototype._createFontSizeButton}]}_notePropertiesExceptionCases(){return[{name:"markerColor",title:S,inputType:"colorPicker",iconSvgCode:a,dataName:"line-tool-color",undoText:h},{name:"textColor",title:g,inputType:"colorPicker",iconSvgCode:c,dataName:"text-color",undoText:p},{name:"fontSize",title:w,inputType:"combobox",factory:M.prototype._createFontSizeButton}]}_createToolExceptionCases(){return{LineToolBrush:M.prototype._brushPropertiesExceptionCase(),LineToolBezierQuadro:M.prototype._bezierPropertiesExceptionCases(),LineToolBezierCubic:M.prototype._bezierPropertiesExceptionCases(),LineToolText:M.prototype._textPropertiesExceptionCases(),LineToolTextAbsolute:M.prototype._textPropertiesExceptionCases(),LineToolBalloon:M.prototype._textPropertiesExceptionCases(),
LineToolComment:M.prototype._textPropertiesExceptionCases(),LineToolCallout:M.prototype._textPropertiesExceptionCases(),LineToolPriceLabel:M.prototype._textPropertiesExceptionCases(),LineToolDateRange:M.prototype._rangeExceptionCases(),LineToolPriceRange:M.prototype._rangeExceptionCases(),LineToolDateAndPriceRange:M.prototype._rangeExceptionCases(),LineToolNote:M.prototype._notePropertiesExceptionCases(),LineToolNoteAbsolute:M.prototype._notePropertiesExceptionCases(),LineToolRiskRewardLong:M.prototype._riskPropertiesExceptionCases(),LineToolRiskRewardShort:M.prototype._riskPropertiesExceptionCases(),LineToolPath:M.prototype._pathExceptionCases(),LineToolRegressionTrend:M.prototype._regressionToolExceptionCases(),LineToolBarsPattern:[{name:"color",title:m,inputType:"colorPicker",iconSvgCode:l,dataName:"background-color",undoText:h}],LineToolProjection:[{name:"color1",title:L,inputType:"colorPicker",iconSvgCode:l,dataName:"background-color",undoText:d},{name:"color2",title:P,inputType:"colorPicker",iconSvgCode:l,dataName:"background-color",undoText:d},{name:"linesWidths",inputType:"combobox",factory:M.prototype._createWidthsButton}],LineToolSignpost:[{name:"linesColors",inputType:"colorPicker",iconSvgCode:l,dataName:"background-color",title:m,factory:M.prototype._createBackgroundsButton,showIf:function(e,t){return t&&t.showImage.value()}},{name:"fontSize",title:w,inputType:"combobox",factory:M.prototype._createFontSizeButton}]}}}e.exports=M},403933:(e,t,o)=>{"use strict";o.d(t,{TradingLayoutBreakpoint:()=>n});var i=o(33335);const n={Mobile:i.mobile}},279708:(e,t,o)=>{"use strict";o.d(t,{addTemplate:()=>s,getTemplates:()=>n,loadTemplate:()=>h,removeTemplate:()=>l,saveTemplate:()=>c,setTemplates:()=>r,startRemoveTemplate:()=>a});var i=o(667259);function n(e,t){return{type:i.GET_TEMPLATES,toolName:e,callback:t}}function r(e,t){return{type:i.SET_TEMPLATES,templates:t,toolName:e}}function s(e,t){return{type:i.ADD_TEMPLATE,templateName:t,toolName:e}}function a(e,t){return{type:i.START_REMOVE_TEMPLATE,templateName:t,toolName:e}}function l(e,t){return{type:i.REMOVE_TEMPLATE,templateName:t,toolName:e}}function c(e,t,o){return{type:i.SAVE_TEMPLATE,templateName:t,toolName:e,content:o}}function h(e,t,o){return{type:i.LOAD_TEMPLATE,toolName:e,templateName:t,callback:o}}},667259:(e,t,o)=>{"use strict";function i(e){return"LINE_TOOL_TEMPLATE__"+e}o.d(t,{ADD_TEMPLATE:()=>c,GET_TEMPLATES:()=>n,LOAD_TEMPLATE:()=>h,REMOVE_TEMPLATE:()=>a,SAVE_TEMPLATE:()=>l,SET_TEMPLATES:()=>r,START_REMOVE_TEMPLATE:()=>s});const n=i("GET_TEMPLATES"),r=i("SET_TEMPLATES"),s=i("START_REMOVE_TEMPLATE"),a=i("REMOVE_TEMPLATE"),l=i("SAVE_TEMPLATE"),c=i("ADD_TEMPLATE"),h=i("LOAD_TEMPLATE")},917568:(e,t,o)=>{"use strict";o.d(t,{store:()=>T});var i=o(406047),n=o(746212),r=o(129885),s=o(650151),a=o(667259),l=o(937778),c=o(279708);function h(e,t){return t}var d=o(301341);const p=(0,l.getLogger)("Chart.LineToolTemplatesList");function u(e,t){return t}function*m(){for(;;){const{toolName:e,templateName:t,content:o}=u(a.SAVE_TEMPLATE,yield(0,r.take)(a.SAVE_TEMPLATE))
;try{yield(0,r.call)(d.backend.saveDrawingTemplate,e,t,o),yield(0,r.put)((0,c.addTemplate)(e,t))}catch(e){p.logWarn(e)}}}function*_(){for(;;){const{toolName:e,templateName:t}=u(a.START_REMOVE_TEMPLATE,yield(0,r.take)(a.START_REMOVE_TEMPLATE));try{yield(0,r.call)(d.backend.removeDrawingTemplate,e,t),yield(0,r.put)((0,c.removeTemplate)(e,t))}catch(e){p.logWarn(e)}}}function*g(){const e=new Map;for(;;){const{toolName:o,callback:i}=u(a.GET_TEMPLATES,yield(0,r.take)(a.GET_TEMPLATES));e.has(o)?(0,s.ensureDefined)(e.get(o)).push(i):(e.set(o,[i]),yield(0,r.fork)(t,o))}function*t(t){try{const e=h(d.backend.getDrawingTemplates,yield(0,r.call)(d.backend.getDrawingTemplates,t));yield(0,r.put)((0,c.setTemplates)(t,e))}catch(e){p.logWarn(e)}(0,s.ensureDefined)(e.get(t)).forEach((e=>null==e?void 0:e())),e.delete(t)}}function*v(){for(;;){const{toolName:e,templateName:t,callback:o}=u(a.LOAD_TEMPLATE,yield(0,r.take)(a.LOAD_TEMPLATE));try{const i=h(d.backend.loadDrawingTemplate,yield(0,r.call)(d.backend.loadDrawingTemplate,e,t));o&&o(i)}catch(e){p.logWarn(e)}}}function*b(){yield(0,r.all)([(0,r.call)(g),(0,r.call)(m),(0,r.call)(_),(0,r.call)(v)])}const f={templates:{}};function y(e,t){return e.localeCompare(t,void 0,{numeric:!0})}function w(e=f,t){switch(t.type){case a.ADD_TEMPLATE:{const{toolName:o,templateName:i}=t;if(!e.templates[o].includes(i)){const t=[...e.templates[o],i].sort(y);return{...e,templates:{...e.templates,[o]:t}}}return e}case a.SET_TEMPLATES:{const{toolName:o,templates:i}=t;return{...e,templates:{...e.templates,[o]:[...i].sort(y)}}}case a.REMOVE_TEMPLATE:{const{toolName:o,templateName:i}=t;return{...e,templates:{...e.templates,[o]:e.templates[o].filter((e=>e!==i))}}}default:return e}}const T=function(){const e=(0,n.default)(),t=(0,i.createStore)(w,(0,i.applyMiddleware)(e));return e.run(b),t}()},543259:(e,t,o)=>{"use strict";o.d(t,{CollectibleColorPropertyDirectWrapper:()=>a,CollectibleColorPropertyUndoWrapper:()=>s});var i=o(650151),n=o(571772);class r extends n.Property{constructor(e){super(),this._listenersMappers=[],this._isProcess=!1,this._baseProperty=e}destroy(){this._baseProperty.destroy(),super.destroy()}value(){const e=this._baseProperty.value();return"mixed"===e?"":e}visible(){return this._baseProperty.visible()}setValue(e){this._isProcess=!0,this._baseProperty.setValue(""===e?"mixed":e,void 0,{applyValue:this._applyValue.bind(this)}),this._isProcess=!1,this._listenersMappers.forEach((e=>{e.method.call(e.obj,this,"")}))}subscribe(e,t){const o=o=>{this._isProcess||t.call(e,this,"")},i={obj:e,method:t,callback:o};this._listenersMappers.push(i),this._baseProperty.subscribe(e,o)}unsubscribe(e,t){var o;const n=(0,i.ensureDefined)(null===(o=this._listenersMappers.find((o=>o.obj===e&&o.method===t)))||void 0===o?void 0:o.callback);this._baseProperty.unsubscribe(e,n)}unsubscribeAll(e){this._baseProperty.unsubscribeAll(e)}}class s extends r{constructor(e,t,o){super(e),this._propertyApplier=t,this._undoText=o}_applyValue(e,t){this._propertyApplier.setProperty(e,t,this._undoText)}}class a extends r{_applyValue(e,t){
e.setValue(t)}}},622860:(e,t,o)=>{"use strict";o.d(t,{CollectiblePropertyUndoWrapper:()=>l});var i=o(650151),n=o(609838),r=o(272047),s=o(571772);const a=new r.TranslatedString("change {propertyName} property",n.t(null,void 0,o(925167)));class l extends s.Property{constructor(e,t,o){super(),this._isProcess=!1,this._listenersMappers=[],this._valueApplier={applyValue:(e,t)=>{this._propertyApplier.setProperty(e,t,a)}},this._baseProperty=e,this._propertyApplier=o,this._propertyName=t}destroy(){this._baseProperty.destroy(),super.destroy()}value(){return this._baseProperty.value()}setValue(e,t){this._propertyApplier.beginUndoMacro(a.format({propertyName:this._propertyName})),this._isProcess=!0,this._baseProperty.setValue(e,void 0,this._valueApplier),this._isProcess=!1,this._propertyApplier.endUndoMacro(),this._listenersMappers.forEach((e=>{e.method.call(e.obj,this,"")}))}subscribe(e,t){const o=()=>{this._isProcess||t.call(e,this,"")};this._listenersMappers.push({obj:e,method:t,callback:o}),this._baseProperty.subscribe(e,o)}unsubscribe(e,t){var o;const n=(0,i.ensureDefined)(null===(o=this._listenersMappers.find((o=>o.obj===e&&o.method===t)))||void 0===o?void 0:o.callback);this._baseProperty.unsubscribe(e,n)}unsubscribeAll(e){this._baseProperty.unsubscribeAll(e)}}},214375:(e,t,o)=>{"use strict";o.d(t,{PropertyApplierWithoutSavingChart:()=>n});var i=o(979910);class n{constructor(e){this._undoModelSupplier=e}setProperty(e,t,o){this._undoModelSupplier().setProperty(e,t,o,i.lineToolsDoNotAffectChartInvalidation)}beginUndoMacro(e){return this._undoModelSupplier().beginUndoMacro(e)}endUndoMacro(){this._undoModelSupplier().endUndoMacro()}setWatchedValue(e,t,o){this._undoModelSupplier().undoHistory().setWatchedValue(e,t,o,i.lineToolsDoNotAffectChartInvalidation)}}},78943:(e,t,o)=>{"use strict";function i(e,t){return Boolean(""===e||e&&-1!==t.toLowerCase().indexOf(e.toLowerCase()))}o.d(t,{autocompleteFilter:()=>i})},405880:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path fill="currentColor" d="M10.62.72a2.47 2.47 0 0 1 3.5 0l1.16 1.16c.96.97.96 2.54 0 3.5l-.58.58-8.9 8.9-1 1-.14.14H0v-4.65l.14-.15 1-1 8.9-8.9.58-.58Zm2.8.7a1.48 1.48 0 0 0-2.1 0l-.23.23 3.26 3.26.23-.23c.58-.58.58-1.52 0-2.1l-1.16-1.16Zm.23 4.2-3.26-3.27-8.2 8.2 3.25 3.27 8.2-8.2Zm-8.9 8.9-3.27-3.26-.5.5V15h3.27l.5-.5Z"/></svg>'},460925:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M12 4h3v1h-1.04l-.88 9.64a1.5 1.5 0 0 1-1.5 1.36H6.42a1.5 1.5 0 0 1-1.5-1.36L4.05 5H3V4h3v-.5C6 2.67 6.67 2 7.5 2h3c.83 0 1.5.67 1.5 1.5V4ZM7.5 3a.5.5 0 0 0-.5.5V4h4v-.5a.5.5 0 0 0-.5-.5h-3ZM5.05 5l.87 9.55a.5.5 0 0 0 .5.45h5.17a.5.5 0 0 0 .5-.45L12.94 5h-7.9Z"/></svg>'},366493:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16.5 20L11 14.5 16.5 9"/></svg>'},379978:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path stroke="currentColor" d="M8 5l3.5 3.5L8 12"/></svg>'},844996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none"><path fill="currentColor" fillRule="evenodd" clipRule="evenodd" d="M7.5 13a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM5 14.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0zm9.5-1.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM12 14.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0zm9.5-1.5a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM19 14.5a2.5 2.5 0 1 1 5 0 2.5 2.5 0 0 1-5 0z"/></svg>'},80802:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 14" width="18" height="14"><path fill="currentColor" d="M6 11.17l-4.17-4.17-1.42 1.41 5.59 5.59 12-12-1.41-1.41-10.59 10.58z"/></svg>'},339750:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none"><path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M7 15l5 5L23 9"/></svg>'},333765:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"><path fill="currentColor" d="M9.707 9l4.647-4.646-.707-.708L9 8.293 4.354 3.646l-.708.708L8.293 9l-4.647 4.646.708.708L9 9.707l4.646 4.647.708-.707L9.707 9z"/></svg>'},123851:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><path fill="currentColor" d="M4 13h5v1H4v-1zM12 13h5v1h-5v-1zM20 13h5v1h-5v-1z"/></svg>'},357740:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor"><circle cx="9" cy="14" r="1"/><circle cx="4" cy="14" r="1"/><circle cx="14" cy="14" r="1"/><circle cx="19" cy="14" r="1"/><circle cx="24" cy="14" r="1"/></svg>'},780427:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><path fill="currentColor" d="M5.5 7a.5.5 0 0 0 0 1h17a.5.5 0 0 0 0-1h-17Zm0 6a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3Zm7 0a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3Zm6.5.5c0-.28.22-.5.5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5ZM7 20a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm5-1a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"/></svg>'},200501:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28"><path stroke="currentColor" d="M4 13.5h20"/></svg>'},636296:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="none"><path stroke="currentColor" d="M8 9.5H6.5a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h11a1 1 0 0 0 1-1V20m-8-1.5h11a1 1 0 0 0 1-1v-11a1 1 0 0 0-1-1h-11a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1z"/></svg>'},621065:e=>{
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" fill="none"><path stroke="currentColor" d="M13.5 6.5l-3-3-7 7 7.59 7.59a2 2 0 0 0 2.82 0l4.18-4.18a2 2 0 0 0 0-2.82L13.5 6.5zm0 0v-4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v6"/><path fill="currentColor" d="M0 16.5C0 15 2.5 12 2.5 12S5 15 5 16.5 4 19 2.5 19 0 18 0 16.5z"/><circle fill="currentColor" cx="9.5" cy="9.5" r="1.5"/></svg>'},25388:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 12" width="8" height="12" fill="currentColor"><rect width="2" height="2" rx="1"/><rect width="2" height="2" rx="1" y="5"/><rect width="2" height="2" rx="1" y="10"/><rect width="2" height="2" rx="1" x="6"/><rect width="2" height="2" rx="1" x="6" y="5"/><rect width="2" height="2" rx="1" x="6" y="10"/></svg>'},222978:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 1" width="18" height="1"><rect width="18" height="1" fill="currentColor" rx=".5"/></svg>'},114631:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 2" width="18" height="2"><rect width="18" height="2" fill="currentColor" rx="1"/></svg>'},206096:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 3" width="18" height="3"><rect width="18" height="3" fill="currentColor" rx="1.5"/></svg>'},206483:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 4" width="18" height="4"><rect width="18" height="4" fill="currentColor" rx="2"/></svg>'},266611:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="currentColor"><rect width="18" height="2" rx="1" x="5" y="14"/><rect width="18" height="1" rx=".5" x="5" y="20"/><rect width="18" height="3" rx="1.5" x="5" y="7"/></svg>'},608280:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none" stroke="currentColor"><path stroke-linecap="round" d="M15.5 18.5h6m-3 3v-6"/><rect width="6" height="6" rx="1.5" x="6.5" y="6.5"/><rect width="6" height="6" rx="1.5" x="15.5" y="6.5"/><rect width="6" height="6" rx="1.5" x="6.5" y="15.5"/></svg>'},448984:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 13 15" width="13" height="15" fill="none"><path stroke="currentColor" d="M4 14.5h2.5m2.5 0H6.5m0 0V.5m0 0h-5a1 1 0 0 0-1 1V4m6-3.5h5a1 1 0 0 1 1 1V4"/></svg>'},925931:(e,t,o)=>{"use strict";o.d(t,{nanoid:()=>i});let i=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_"),"")}}]);